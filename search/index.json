[{"content":" Welcome on my site, enojoy!\n ","href":"/","title":"Home"},{"content":"","href":"/authors/","title":"Authors"},{"content":"","href":"/categories/","title":"Categories"},{"content":"","href":"/tags/docker/","title":"Docker"},{"content":" TL;DR\nCentOS base images sucks! They\u0026rsquo;re old, not updated for months!\n As a professional DevOps I concern about a lot of things\u0026hellip; but security is always close to the top of the list. With Docker build environments and deployments became much more stable, which often is a result of just being stale ;/\nI\u0026rsquo;ve been talking about this for long time but it\u0026rsquo;s still hard for people to believe it. Let\u0026rsquo;s check then few, most popular images and when were they last time updated. I wrote a script for that, so feel free to check your list:\n Results show that not all images are frequently updated and if we get a little bit deeper and check how many packages require upgrade:\n   Image Creation date Age (in days) Packages to upgrade     centos:7 2020-11-14T00:20:04.644613188Z 75 16   centos:8 2020-12-08T00:22:53.076477777Z 51 12   debian:9 2021-01-12T00:35:06.08981705Z 16 0   debian:10 2021-01-12T00:32:37.071722022Z 16 0   ubuntu:18.04 2021-01-21T03:38:05.801776526Z 7 2   ubuntu:20.04 2021-01-21T03:38:23.37559427Z 7 4   alpine:3.11 2020-12-17T00:19:49.284211148Z 42 0   alpine:3.12 2020-12-17T00:19:42.11518025Z 42 0   alpine:3.13 2021-01-15T02:23:51.238454884Z 13 5   node:10 2021-01-27T20:32:54.257201224Z 0 13   node:12 2021-01-12T10:36:27.349274428Z 15 13   node:14 2021-01-12T10:33:48.195283512Z 15 13   node:15 2021-01-27T20:29:39.779176105Z 0 13   openjdk:8 2021-01-21T02:40:05.312239007Z 7 0   openjdk:11 2021-01-21T02:38:20.819671373Z 7 0   openjdk:15 2021-01-20T00:45:36.664060993Z 8 ?    Personally, I consider running yum upgrade or apt upgrade/apt dist-upgrade in Dockerfile as anti-pattern - instead builds should be running so frequently to automatically pull all new upgrades from base images. That\u0026rsquo;s theory, but with images like CentOS, you have to do it or risk running your software on unpatched and potentially unsecure system. That\u0026rsquo;s why I don\u0026rsquo;t like CentOS images as a base in general, they just suck from this perspective.\nThere\u0026rsquo;s also another issue here - running those upgrades makes your image just bigger. Sometimes significantly bigger. That\u0026rsquo;s not what I expect from base images\n","href":"/2021/01/how-old-are-docker-official-images/","title":"How old are Docker Official Images?"},{"content":"","href":"/posts/","title":"Posts"},{"content":"","href":"/tags/","title":"Tags"},{"content":"","href":"/authors/timor/","title":"timor"},{"content":"","href":"/categories/tip/","title":"Tip"},{"content":"I started my blog on custom (written by my) engine, but as I didn\u0026rsquo;t had enough time to enhance it I switched to Wordpress. I\u0026rsquo;ve been using Wordpress as an engine of my blog for past 8~9 years. I have small VPS with PHP + Nginx and you can find a lot of configuration examples from my config on this site ðŸ˜„\nThere was a time, when I was really satisfied by what it provides. Not only because of features, but also beacause I was able to play with insane configuration options (check out my caching reverse proxy config). For me it was opportuninty to excel with my skills.\nBut things change. I don\u0026rsquo;t have that much time to carry this server configuration, keep it properly updated and play with new features. Actually I don\u0026rsquo;t need that anymore as I\u0026rsquo;ve been there, I saw it already\u0026hellip;\nI\u0026rsquo;ve been thinking about switching to static page generator and putting my blog in eg. github pages for really long time. I even almost completely migrated it to pelican (after playing for a while with Octopress too). Eventually I\u0026rsquo;ve found Hugo and I loved it!\nAnd here we are, I switched blog to Hugo. I will try to share why I choose this configuration soon and how I handle it.\nKeep warm, be positvie, stay negative!\n","href":"/2020/10/bye-bye-wordpress/","title":"Bye Bye Wordpress!"},{"content":"","href":"/tags/hugo/","title":"hugo"},{"content":"","href":"/categories/off-topic/","title":"Off-topic"},{"content":"","href":"/tags/bash/","title":"bash"},{"content":"","href":"/categories/howto/","title":"HOWTO"},{"content":"","href":"/tags/linux/","title":"Linux"},{"content":"","href":"/tags/macos/","title":"MacOS"},{"content":"Few years ago I moved from Linux desktop to MacOS for my business, day to day work. There were 2 main reasons for that:\n Corporations don\u0026rsquo;t like Linux - they can\u0026rsquo;t manage it, they can\u0026rsquo;t support it, so they blocked it with \u0026ldquo;Security policy\u0026rdquo;, ISO20001, or other nonsense. Actually they\u0026rsquo;re partially right but in different place - many business collaboration applications don\u0026rsquo;t work well on LInux (or they don\u0026rsquo;t work at all)  Skype for Business - there\u0026rsquo;s open source alternative but to get full support you have to pay for additional codecs (as far as I remember) - it\u0026rsquo;s not working stable even in paid version Outlook and calendar support - I love Thunderbird and I use it for years, but calendar invitations didn\u0026rsquo;t work nice (honestly, they didn\u0026rsquo;t work nice even between different Outlook versions\u0026hellip;) Corporate VPN apps - Christ, I always was able to get it working eventually, but\u0026hellip; why bother    I\u0026rsquo;m older, maybe lazier, maybe smarter - I don\u0026rsquo;t like to spend my time resolving problems that don\u0026rsquo;t give me any value. That\u0026rsquo;s how I switched to MacOS - for business purposes only. Privately I still prefer Linux.\nAfter the switch I\u0026rsquo;ve found some differences. Annoying stuff like different behavior of home/end buttons, etc. So right now, on every Mac that I\u0026rsquo;m working with, I\u0026rsquo;m making it to work more like Linux desktop. I\u0026rsquo;ve found those information useful to few my friends too. I decided to publish this because I received too many questions about what to do, how to start?\nIf you think I\u0026rsquo;m missing something important or I did something really bad way - please comment, I will updated it.\nFAQ  How to make screnshots (full screen/partial/desktop recording)? How to change screenshot save localisation? Keyboard and keyboard shortcuts\u0026hellip; Special function keys do not work from external keyboard (it\u0026rsquo;s not Mac compatible ) Keyboard shortcuts are totally different than on Windows or Linux Problem with bash completion on linux boxes Bash completion do not work well on Mac, there are no completions for hosts configured in ssh_config or /etc/hosts How to add bash completion for docker? SSH agent for key management does not work by default How to automatically unlock private SSH keys on login (how to keep SSH private key password in OS X Keychain)? How to write to multiple terminal panes in iTerm2? Blurry fonts on external monitors Jump word left/right (Ctrl+left/right) shortcut don\u0026rsquo;t work on console (iTerm2) Packages on MacOS are outdated and updates arrive later than on Linux End/Home keys behave differently on MacOS I can\u0026rsquo;t use X forwarding with MacOS ssh client and Linux on second end I have problems working withÂ terminator on Mac   How to make screnshots (full screen/partial/desktop recording)? https://support.apple.com/pl-pl/HT201361\nHow to change screenshot save localisation? By default screenshots are saved on desktop which will turn into mess quickly. It\u0026rsquo;s possible to change default save localization for created screenshots: https://discussions.apple.com/docs/DOC-9081\nKeyboard and keyboard shortcuts\u0026hellip; Polish keyboard layout is terrific, location of tilde and backslash buttons cause both Left Shift and Enter to be really far from normal hands position - in my case it\u0026rsquo;s causing pain in hands after few hours of use Another problem is location of Right Alt, it\u0026rsquo;s hidden deeply under hand during writing so it\u0026rsquo;s not convenient to write polish letters like Ä…Å›Å‚Ã³Ä‡Åº, etc. Maybe it will be possible to remap few keys to make this layout more usable but right now experience is terrific.\nThis is really big issue. Because on Mac Win/CMD key is used a lot switch to normal keyboard doesn\u0026rsquo;t help. Use of most common shortcuts really overload my thumbs.\nBest solutions I\u0026rsquo;ve found is Karabiner-Elements. It allow to remap keys (ex. switch right alt/cmd) and you can define different options per device (internal/external keyboard). It\u0026rsquo;s also very useful to make standard PC keyboards to be mapped like Apple keyboard.\nSpecial function keys do not work from external keyboard (it\u0026rsquo;s not Mac compatible ) I don\u0026rsquo;t know if it\u0026rsquo;s possible to configure them. With Karabiner-Elements it\u0026rsquo;s possible to add support for some of them.\nKeyboard shortcuts are totally different than on Windows or Linux Here you could find introduction to most typical shortcuts:Â https://www.apple.com/support/pages/shortcuts/body.html No other way - you have to learn them.\nFew of my favorites, I use everyday:\n Cmd + Space - Spotlight search - think about it like â€˜Win' key in Gnome 3, you can start writing app or file name to start/open it Ctrl + Left/Right - switch Desktop on specific screen (full screen apps use \u0026ldquo;whole desktop\u0026rdquo; so it\u0026rsquo;s easy way to see what you have there or start new empty desktop) Ctrl + Up - shows all active windows, desktops, etc. Useful if you\u0026rsquo;re searching specific window  Problem with bash completion on linux boxes -bash: warning: setlocale: LC_CTYPE: cannot change locale (UTF-8) -bash: warning: setlocale: LC_CTYPE: cannot change locale (UTF-8) I solved it by marking option in iTerm2 to always set language system variables.\nBash completion do not work well on Mac, there are no completions for hosts configured in ssh_config or /etc/hosts I initially tried this one:Â http://davidalger.com/development/bash-completion-on-os-x-with-brew/Â - it generally works but only for some common tools, ex, svn requires manual download of:\ncurl -L http://svn.apache.org/repos/asf/subversion/trunk/tools/client-side/bash_completion -o /usr/local/etc/bash_completion.d/svn Right now I thing that Brew makes this even easier, because it\u0026rsquo;s installing a lot of bash_completion configs.\nHow to add bash completion for docker? Those two commands will solve problem:\ncurl -L https://raw.githubusercontent.com/docker/compose/master/contrib/completion/bash/docker-compose -o /usr/local/etc/bash_completion.d/docker-compose curl -L https://raw.githubusercontent.com/docker/docker-ce/blob/master/components/cli/contrib/completion/bash/docker -o /usr/local/etc/bash_completion.d/docker SSH agent for key management does not work by default There is a Keychain application installed on MacOS by default, it\u0026rsquo;s responsible for storing keys and managing access to them. To add ssh key to Keychain you have to run:\nssh-add -K and provide password to unlock key.\nSadly this works only one time, I have to manually add key to keychain every time I login by:\nssh-add ~/.ssh/id_rsa How to automatically unlock private SSH keys on login (how to keep SSH private key password in OS X Keychain)? It\u0026rsquo;s all nice described here: https://apple.stackexchange.com/a/250572\nHow to write to multiple terminal panes in iTerm2? use cmd + shift + i to write to all panes on all tabs, or cmd + alt + i to write to all panes on current tab only\nBlurry fonts on external monitors Fonts on external monitors are really blurry - they\u0026rsquo;re badly anti-aliased or hinting is bad. I\u0026rsquo;ve found, that MacOS disable hinting on external monitors. It\u0026rsquo;s possible to enable it back. Check below and play with it to get what would work for you.\nhttps://www.howtogeek.com/358596/how-to-fix-blurry-fonts-on-macos-mojave-with-subpixel-antialiasing/\nJump word left/right (Ctrl+left/right) shortcut don\u0026rsquo;t work on console (iTerm2) You have to configure special escape sequences for Alt+left/right, described here: http://apple.stackexchange.com/a/136931\nPackages on MacOS are outdated and updates arrive later than on Linux Yes, that\u0026rsquo;s sad true. When I have Ansible 2.3 on Jenkins server for MacOS only version 2.2 was available. Version 2.3 will arrive but some time later. This is causing problems in compatibility of code (newer features/options on Jenkins cause problems during deployment and I\u0026rsquo;m not able to test this all on my workstation before real release). Another problem connected to that is that some command line tool on Mac have different switches than on Linux, ex.Â date -rfc-3339=s is not available, causing scripts to broke on Mac when working on Linux, this also makes testing harder.\nMacOS also use quite old version of bash. As a result .bashrc won\u0026rsquo;t be parsed, you have to put everything to .bash_profile which will slow down starting of each new terminal session (ex. python virtual envs can add significant delay).\nEnd/Home keys behave differently on MacOS Generally you won\u0026rsquo;t find Home/End keys on typical MacBook keyboad - by default on Mac you have Command + Right keyboard shortcut to mimic End, andÂ Command + Left to mimic Home.\nBut\u0026hellip; by default Home/End will move you to the end of page, not line. If you want this behavior back in most of your apps you could try to change keybinding:\nOne option is to create ~/Library/KeyBindings/ and save a property list like this as ~/Library/KeyBindings/DefaultKeyBinding.dict:\n{ \u0026#34;\\UF729\u0026#34; = moveToBeginningOfLine:; \u0026#34;\\UF72B\u0026#34; = moveToEndOfLine:; \u0026#34;$\\UF729\u0026#34; = moveToBeginningOfLineAndModifySelection:; \u0026#34;$\\UF72B\u0026#34; = moveToEndOfLineAndModifySelection:; } Quit and reopen applications to apply the changes. Note that DefaultKeyBinding.dict is not supported by some applications like Xcode or Firefox.\nhttps://apple.stackexchange.com/questions/18016/can-i-change-the-behavior-of-the-home-and-end-keys-on-an-apple-keyboard-with-num\nI can\u0026rsquo;t use X forwarding with MacOS ssh client and Linux on second end There\u0026rsquo;s additional X11 server app that you can install on MacOS (it\u0026rsquo;s called XQuartz. I tried it for short time but I don\u0026rsquo;t need it anymore.\nI have problems working withÂ terminator on Mac For example:\n it\u0026rsquo;s running as python process but it\u0026rsquo;s not available in Lunchpad (not easy to switch with Cmd + Tab keyboard shortcuts are different than on Linux, so this is not making switch easier  I\u0026rsquo;ve found iTerm2, which is \u0026ldquo;state of the art\u0026rdquo; terminal for MacOS. It\u0026rsquo;s popular, well supported and feature complete.\nUseful key shortcuts:\n Cmd + T - new tab Cmd + D - spit vertically Cmd + Shift + D - split horizontally Cmd + Opt + Left/Right/Up/Down - move between shell windows (after split) Cmd + Left/Right - prev/next tab Ctrl + Cmd + Left/Right/Up/Down - change size of windows after split  ","href":"/2020/01/moving-from-linux-to-macos-first-steps/","title":"Moving from Linux to MacOS â€“ first steps"},{"content":"I had stragne statistics on one memcached servers. I had to look what it\u0026rsquo;s doing there. I found such commands that may be used to sniff, extract and make statistics from running memcached server.\nDebug GET commands tcpflow -c dst port 11211 | cut -b46- | grep ^get cut command will remove 46 bytes at beginning of every string (src, dst, port). You may need to adjust numeric parameter for cut to leave commands only. Output should look like:\nget myapp-cache-theme_registry get myapp-cache_field get myapp-cache-schema ... Debug everything except GET commands tcpflow -c dst port 11211 | cut -b46- | grep -v ^get Check transfer Add pv -r at the end to calculate transfer:\n$ tcpflow -c dst port 11211 | cut -b46- | grep ^get | pv -r \u0026gt; /dev/null tcpflow[11140]: listening on eth0 [8.25kB/s] Check command rates To check command rates not the transfer add -l param (stands for lines) to pv command:\n$ tcpflow -c dst port 11211 | cut -b46- | grep -v ^get | pv -rl \u0026gt; /dev/null tcpflow[9271]: listening on eth0 [1.51k/s] That should be enough for you to start debugging ðŸ˜„\nSource: http://www.streppone.it/cosimo/blog/tag/memcached/\n","href":"/2016/07/debuging-commands-running-on-memcached/","title":"Debuging commands running on memcached"},{"content":"It happen to me all the time that one of developers notifies me about some kind of problem that I can\u0026rsquo;t confirm from my account. Sometimes it was because of bad ssh keys configuration, other times file permissions, mostly such stuff. It\u0026rsquo;s sometimes convenient to \u0026ldquo;enter into someone\u0026rsquo;s shoes\u0026rdquo; to see what\u0026rsquo;s going on there.\nIf you\u0026rsquo;re root on machine you may do that like this:\nsu developer - Easy one but that\u0026rsquo;s not enough for all cases. When you use bastion host (or similar solutions) sometimes users have connection problems and it\u0026rsquo;s harder to check. When such user have ForwardAgent ssh option enabled you may stole this session to check login problems. After you switch to such user, you may wan\u0026rsquo;t to hide history (it\u0026rsquo;s optional ðŸ˜‰ ) - disable history like that:\nexport HISTFILESIZE=0 export HISTSIZE=0 unset HISTFILE Now you may stole ssh session, but first check if you have your dev is logged on:\n$ ls -la /tmp/ | grep ssh drwx------ 2 root root 4096 Apr 27 20:56 ssh-crYKv29798 drwx------ 2 developer developer 4096 Apr 27 18:03 ssh-cVXFo28108 Export SSH_AUTH_SOCK with path to developer\u0026rsquo;s agent socket:\nSSH_AUTH_SOCK=/tmp/ssh-cVXFo28108/agent.28108 Finally you may try to login via ssh as developer and see with his eyes what\u0026rsquo;s now working.\n","href":"/2016/04/how-to-stole-ssh-session-when-youre-root/","title":"How to stole ssh session when youâ€™re root"},{"content":"Virtualenvs in python are cheap but from time to time you will install something with pip on your system and when time comes removing all this crap could be difficult. I found this bash snippet that will uninstall package with all dependencies:\nfor dep in $(pip show python-neutronclient | grep Requires | sed \u0026#39;s/Requires: //g; s/,//g\u0026#39;) ; do sudo pip uninstall -y $dep ; done pip uninstall -y python-neutronclient Source: http://stackoverflow.com/a/32698209/4828478\n","href":"/2016/04/pip-uninstall-package-with-dependencies/","title":"pip - uninstall package with dependencies"},{"content":"","href":"/tags/python/","title":"Python"},{"content":"","href":"/tags/backup/","title":"backup"},{"content":"I\u0026rsquo;ve been using standard MySQL dumps as backup technique on my VPS for few years. It works fine and backups were usable few times when I needed them. But in other places I\u0026rsquo;m using xtrabackup. It\u0026rsquo;s faster when crating backups and a lot faster when restoring them - they\u0026rsquo;re binary so there is no need to reevaluate all SQL create tables/inserts/etc. Backups also include my.cnf config file so restoring on other machine should be easy.\nAfter I switched from MariaDB to Percona I have Percona repos configured, so I will use latest version of xtrabackup.\napt-get install -y percona-xtrabackup Prerequisities xtrabackup requires configured user to be able to make backups. One way is to write user and password in plaintext in ~/.my.cnf. Another is using mysql_config_editor to generate ~/.mylogin.cnf file with encrypted credentials. To be honest I didn\u0026rsquo;t check what kind of security provides this encryption but it feels better than keeping password in plaintext.\nI do not want to create new user for this task - I just used debian-sys-maint user. Check password for this user like this:\ngrep password /etc/mysql/debian.cnf Now create encrypted file:\nmysql_config_editor set --login-path=client --host=localhost --user=debian-sys-maint --password Hit enter and copy/paste password. File .mylogin.cnf should be created with binary content. We may check this with:\n# mysql_config_editor print [client] user = debian-sys-maint password = ***** host = localhost Looks OK.\nBackuping Now backup script. I placed it directly in cron.daily dir ex. /etc/cron.daily/zz-percona-backup with content:\n#!/bin/bash DATE=`date +%F-%H%M%S` DIR=/backup/xtrabackup DST=$DIR/${DATE}.tar.xz # this will produce directories with compresses files # mkdir -p $DST # xtrabackup --backup --compress --target-dir=$DST # this will produce tar.xz archives xtrabackup --backup --stream=tar | xz -9 \u0026gt; $DST # delete files older than 30 days find $DIR -type f -mtime +30 -delete I prefer to have single archive with backup because I\u0026rsquo;m transferring those files to my NAS (for security). But for local backups directories are more convenient and faster when restoring. Also tar archives have to be decompressed with -ioption.\nRestoring First time I saw it it scared me a little but after all worked fine and without problems\u0026hellip;\nservice mysql stop rm -rf /var/lib/mysql mkdir /var/lib/mysql Now prepare backup, if you used directory backups it\u0026rsquo;s easy:\nxtrabackup --decompress --target-dir=/backup/xtrabackup/2016-03-14-214233 xtrabackup --prepare --target-dir=/backup/xtrabackup/2016-03-14-214233 xtrabackup --copy-back --target-dir=/backup/xtrabackup/2016-03-14-214233 But if you used tar archives it\u0026rsquo;s little more messy\u0026hellip; You have to create temporary dir and extract archive there:\nmkdir /tmp/restore tar -xvif /backup/xtrabackup/2016-03-14-214233.tar.xz -C /tmp/restore xtrabackup --prepare --target-dir=/tmp/restore xtrabackup --copy-back --target-dir=/tmp/restore We have to fix ownership of restored files and db may be started:\nchown -R mysql:mysql /var/lib/mysql service mysql start If your backup is huge you should reorder commands to shutdown database after backup decompression.\nSource: https://www.percona.com/doc/percona-xtrabackup/2.3/xtrabackup_bin/xtrabackup_binary.html http://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html https://www.percona.com/doc/percona-xtrabackup/2.1/innobackupex/streaming_backups_innobackupex.html\n","href":"/2016/04/daily-mysql-backups-with-xtrabackup/","title":"Daily MySQL backups with xtrabackup"},{"content":"","href":"/tags/mysql/","title":"MySQL"},{"content":"","href":"/tags/percona/","title":"Percona"},{"content":"","href":"/tags/ssh/","title":"ssh"},{"content":"When you deploy your application in cloud you don\u0026rsquo;t need and don\u0026rsquo;t want your hosts exposed via SSH to the world. Malware scans whole network for easy SSH access and when find something will try some brute force attacks, overloading such machines. It\u0026rsquo;s easier to have one exposed, but secured host, that doesn\u0026rsquo;t host anything and is used as proxy/gateway to access our infrastructure- it\u0026rsquo;s called bastion host.\nAnsible is quite easy to integrate with bastion host configuration. We will need custom ansible.cfg and ssh_config file. So let\u0026rsquo;s start with ssh_config:\nHost bastion Hostname ip.xxx.xxx.xxx.xxx.or.host.name User ubuntu IdentityFile ~/.ssh/id_rsa PasswordAuthentication no ForwardAgent yes ServerAliveInterval 60 TCPKeepAlive yes ControlMaster auto ControlPath ~/.ssh/ansible-%r@%h:%p ControlPersist 15m ProxyCommand none LogLevel QUIET Host * User ubuntu IdentityFile ~/.ssh/id_rsa ServerAliveInterval 60 TCPKeepAlive yes ProxyCommand ssh -q -A ubuntu@bastion nc %h %p LogLevel QUIET StrictHostKeyChecking no Now I will describe what most important options mean. For bastion:\n User - I\u0026rsquo;m using Ubuntu kickstarted on cloud as bastion host with it\u0026rsquo;s default user. Never use root here - you don\u0026rsquo;t need that ForwardAgent yes - we want to forward our ssh keys through bastion to destination hosts, ServerAliveInterval 60 - this is like keepalive connection, ssh will send small ping/pong packets every 60 seconds so your connection won\u0026rsquo;t hung/terminate after long time, ControlMaster auto - we will open one connection to bastion host and multiplex other ssh connections through it, connection will be opened for ControlPersist time, ControlPath - this have to be configured same way like in ansible.cfg, ProxyCommand none - we\u0026rsquo;re setting ProxyCommand for all hosts but we need it disabled for bastion,``  Default hosts configuration:\n ProxyCommand ssh -q -A ubuntu@bastion nc %h %p - this is what makes all magic, it will pipe your ssh connection via bastion to destination host, StrictHostKeyChecking no - this options shouldn\u0026rsquo;t be there for production but it\u0026rsquo;s useful at beginning when you create and destroy machines few times before you test everything. Normally this will cause notifications about ssh key changes, but you\u0026rsquo;re aware of that - you just recreated those machines.  I\u0026rsquo;ve found examples without netcat but was unable to get them working - this one worked for me really well.\nTo test if connections work fine use this configuration like:\nssh -F ssh_config bastion ssh -F ssh_config other.host.behind.bastion And now ansible.cfg:\n[defaults] forks=20 [ssh_connection] ssh_args = -F ./ssh_config -o ControlMaster=auto -o ControlPersist=5m -o LogLevel=QUIET control_path = ~/.ssh/ansible-%%r@%%h:%%p pipelining=True Most important section here is in ssh_args where we\u0026rsquo;re pointing to ssh_config file in current dir with -F option. I also have to reenter configuration for multiplexing here - it wasn\u0026rsquo;t working with ssh only configuration. control_path option have to use same paths like ssh_config (% signs are escaped with %%).\nYou should be able to run ansible/ansible-playbook commands normally now - all traffic will be forwarded through bastion.\nIt\u0026rsquo;s good time now to install fail2ban on bastion and maybe reconfigure it to run ssh on crazy high port ðŸ™‚\nSources http://alexbilbie.com/2014/07/using-ansible-with-a-bastion-host/ http://blog.scottlowe.org/2015/12/24/running-ansible-through-ssh-bastion-host/ https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Multiplexing\n","href":"/2016/04/use-bastion-host-with-ansible/","title":"Use bastion host with Ansible"},{"content":"","href":"/tags/debian/","title":"Debian"},{"content":"Lately I was searching for mobile notebook that I could use for remote work. I checked f ThinkPad series but they were huge bricks that have nothing in common with \u0026lsquo;mobile\u0026rsquo; word. Then I saw ASUS Zenbook that I didn\u0026rsquo;t take into account before and it was exactly what I was searching for.\nConfiguration of Skylake based notebook right now is not straightforward - there are still glitches and small bugs that are waiting to be fixed. I want to sum up what I\u0026rsquo;ve done after installation. I started with freshÂ Ubuntu 16.04 to get Debian based distro with possibly latestÂ kernel and patches.\nSome SSD tweaks Change mount options for filesystems on SSD from:\n/dev/mapper/ubuntu--vg-root / ext4 errors=remount-ro 0 1 to:\n/dev/mapper/ubuntu--vg-root / ext4 discard,noatime,errors=remount-ro 0 1 And move /tmp to RAM with this additional line in /etc/fstab:\ntmpfs /tmp tmpfs defaults,noatime,mode=1777 0 0 Now add deadline scheduler for root disk - edit /etc/rc.local and add this line before exit 0:\necho deadline \u0026gt; /sys/block/sda/queue/scheduler echo 1 \u0026gt; /sys/block/sda/queue/iosched/fifo_batch I have configured swap but I don\u0026rsquo;t want to use it too much and setting low swappines sysctl option will help. Run this as root:\necho \u0026#34;vm.swappiness = 1\u0026#34; \u0026gt; /etc/sysctl.conf.d/90-swappines.conf sysctl -p /etc/sysctl.conf.d/90-swappines.conf Power usage tweaks I\u0026rsquo;ve installed laptop-mode-tools to achieve lower power usage on battery. So:\napt-get install -y laptop-mode-tools By default it\u0026rsquo;s cutting hard CPU performance on battery (half performance, no turbo) so I fixed this by changing /etc/laptop-mode/conf.d/intel_pstate.conf section On battery:\n#On battery BATT_INTEL_PSTATE_PERF_MIN_PCT=0 # Minimum performance, in percent BATT_INTEL_PSTATE_PERF_MAX_PCT=100 # Maximum performance, in percent BATT_INTEL_PSTATE_NO_TURBO=0 # Disable \u0026#34;Turbo Boost\u0026#34;? Laptop mode tools won\u0026rsquo;t start automatically so we may integrate them with pm-utils (that are already installed on Ubuntu) to get it running when needed. We have to create new config file:\nsudo touch /etc/pm/sleep.d/10-laptop-mode-tools sudo chmod a+x /etc/pm/sleep.d/10-laptop-mode-tools with content like this:\ncase $1 in hibernate) /etc/init.d/laptop-mode stop ;; suspend) /etc/init.d/laptop-mode stop ;; thaw)d /etc/init.d/laptop-mode start ;; resume) /etc/init.d/laptop-mode start ;; *) echo Something is not right. ;; esac Now I will enable ALPM for SATA in AHCI mode optimizations:\necho SATA_ALPM_ENABLE=true | sudo tee /etc/pm/config.d/sata_alpm And some kernel parameters in /etc/default/grub:\nGRUB_CMDLINE_LINUX=\u0026#34;pcie_aspm=force drm.vblankoffdelay=1 i915.semaphores=1\u0026#34; and update-grub with:\nupdate-grub You may use powertop to nail power heavy processes. There is also powerstat to benchmark power usage through time - I have:\nsudo pm-powersave true powerstat ...... Summary: System: 4.49 Watts on average with standard deviation 0.46 It\u0026rsquo;s really nice. I should be able to run about 8~9h! Sweet!\nSources https://www.reddit.com/r/linux/comments/3ia8ta/review_of_ubuntu_on_asus_ux305fa/\nhttps://help.ubuntu.com/community/PowerManagement/ReducedPower#Using_less_power_with_laptop-mode-tools\nhttps://help.ubuntu.com/community/AsusZenbook\nhttps://wiki.ubuntu.com/Kernel/PowerManagementALPM\nDisable touchpad when writing It\u0026rsquo;s crazy annoying when you tap touchpad during writing text and lose focus on editor window. There is solution for that, it\u0026rsquo;s even installed by default on Ubuntu and it\u0026rsquo;s called: syndaemon. It\u0026rsquo;s started by default like this:\nsyndaemon -i 1.0 -t -K -R 1 second feels too small for me. I will adjust it to 2s. There is no easy way to do this. I created script to run on login:\n#!/bin/bash killall syndaemon syndaemon -d -i 2.0 -t -K -R Now better ðŸ™‚\nVD-PAU I installed vdpauinfo tool to see if it\u0026rsquo;s working:\napt-get install -y vdpauinfo It wasn\u0026rsquo;t:\nvdpauinfo display: :0 screen: 0 Failed to open VDPAU backend libvdpau_va_gl.so: cannot open shared object file: No such file or directory Error creating VDPAU device: 1 I checked this library and couldn\u0026rsquo;t find it - it wasn\u0026rsquo;t installed. Easy fix:\napt-get install -y libvdpau-va-gl1 Check again:\nvdpauinfo display: :0 screen: 0 libva info: VA-API version 0.39.0 libva info: va_getDriverName() returns 0 libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so libva info: Found init function __vaDriverInit_0_39 libva info: va_openDriver() returns 0 API version: 1 Information string: OpenGL/VAAPI/libswscale backend for VDPAU Video surface: name width height types ------------------------------------------- 420 1920 1080 NV12 YV12 UYVY YUYV Y8U8V8A8 V8U8Y8A8 422 1920 1080 NV12 YV12 UYVY YUYV Y8U8V8A8 V8U8Y8A8 444 1920 1080 NV12 YV12 UYVY YUYV Y8U8V8A8 V8U8Y8A8 Decoder capabilities: name level macbs width height ---------------------------------------------------- MPEG1 --- not supported --- MPEG2_SIMPLE --- not supported --- MPEG2_MAIN --- not supported --- H264_BASELINE 51 16384 2048 2048 H264_MAIN 51 16384 2048 2048 H264_HIGH 51 16384 2048 2048 VC1_SIMPLE --- not supported --- VC1_MAIN --- not supported --- VC1_ADVANCED --- not supported --- MPEG4_PART2_SP --- not supported --- MPEG4_PART2_ASP --- not supported --- DIVX4_QMOBILE --- not supported --- DIVX4_MOBILE --- not supported --- DIVX4_HOME_THEATER --- not supported --- DIVX4_HD_1080P --- not supported --- DIVX5_QMOBILE --- not supported --- DIVX5_MOBILE --- not supported --- DIVX5_HOME_THEATER --- not supported --- DIVX5_HD_1080P --- not supported --- H264_CONSTRAINED_BASELINE 51 16384 2048 2048 H264_EXTENDED --- not supported --- H264_PROGRESSIVE_HIGH --- not supported --- H264_CONSTRAINED_HIGH --- not supported --- H264_HIGH_444_PREDICTIVE --- not supported --- HEVC_MAIN --- not supported --- HEVC_MAIN_10 --- not supported --- HEVC_MAIN_STILL --- not supported --- HEVC_MAIN_12 --- not supported --- HEVC_MAIN_444 --- not supported --- Output surface: name width height nat types ---------------------------------------------------- B8G8R8A8 8192 8192 y R8G8B8A8 8192 8192 y R10G10B10A2 8192 8192 y B10G10R10A2 8192 8192 y A8 8192 8192 y Bitmap surface: name width height ------------------------------ B8G8R8A8 8192 8192 R8G8B8A8 8192 8192 R10G10B10A2 8192 8192 B10G10R10A2 8192 8192 A8 8192 8192 Video mixer: feature name sup ------------------------------------ DEINTERLACE_TEMPORAL - DEINTERLACE_TEMPORAL_SPATIAL - INVERSE_TELECINE - NOISE_REDUCTION - SHARPNESS - LUMA_KEY - HIGH QUALITY SCALING - L1 - HIGH QUALITY SCALING - L2 - HIGH QUALITY SCALING - L3 - HIGH QUALITY SCALING - L4 - HIGH QUALITY SCALING - L5 - HIGH QUALITY SCALING - L6 - HIGH QUALITY SCALING - L7 - HIGH QUALITY SCALING - L8 - HIGH QUALITY SCALING - L9 - parameter name sup min max ----------------------------------------------------- VIDEO_SURFACE_WIDTH - VIDEO_SURFACE_HEIGHT - CHROMA_TYPE - LAYERS - attribute name sup min max ----------------------------------------------------- BACKGROUND_COLOR - CSC_MATRIX - NOISE_REDUCTION_LEVEL - SHARPNESS_LEVEL - LUMA_KEY_MIN_LUMA - LUMA_KEY_MAX_LUMA - Looks better now\u0026hellip; But not impressive, there\u0026rsquo;s only H264 support.\nI\u0026rsquo;ve tried it in VLC but it was crashing from time to time the whole VLC (leaving it running in background). Time to test VA-API ðŸ™‚\nVA-API Like earlier I have to install one tool to see what we have: vainfo\napt-get install -y vainfo Checking what we have on system:\nvainfo libva info: VA-API version 0.39.0 libva info: va_getDriverName() returns 0 libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so libva info: Found init function __vaDriverInit_0_39 libva info: va_openDriver() returns 0 vainfo: VA-API version: 0.39 (libva 1.7.0) vainfo: Driver version: Intel i965 driver for Intel(R) Skylake - 1.7.0 vainfo: Supported profile and entrypoints VAProfileMPEG2Simple :\tVAEntrypointVLD VAProfileMPEG2Simple :\tVAEntrypointEncSlice VAProfileMPEG2Main :\tVAEntrypointVLD VAProfileMPEG2Main :\tVAEntrypointEncSlice VAProfileH264ConstrainedBaseline:\tVAEntrypointVLD VAProfileH264ConstrainedBaseline:\tVAEntrypointEncSlice VAProfileH264Main :\tVAEntrypointVLD VAProfileH264Main :\tVAEntrypointEncSlice VAProfileH264High :\tVAEntrypointVLD VAProfileH264High :\tVAEntrypointEncSlice VAProfileH264MultiviewHigh :\tVAEntrypointVLD VAProfileH264MultiviewHigh :\tVAEntrypointEncSlice VAProfileH264StereoHigh :\tVAEntrypointVLD VAProfileH264StereoHigh :\tVAEntrypointEncSlice VAProfileVC1Simple :\tVAEntrypointVLD VAProfileVC1Main :\tVAEntrypointVLD VAProfileVC1Advanced :\tVAEntrypointVLD VAProfileNone :\tVAEntrypointVideoProc VAProfileJPEGBaseline :\tVAEntrypointVLD VAProfileJPEGBaseline :\tVAEntrypointEncPicture VAProfileVP8Version0_3 :\tVAEntrypointVLD VAProfileVP8Version0_3 :\tVAEntrypointEncSlice VAProfileHEVCMain :\tVAEntrypointVLD VAProfileHEVCMain :\tVAEntrypointEncSlice It requires package i965-va-driver to work but on my system it was installed (probably during VDPAU installation as dependency).\nIt was working almost fine\u0026hellip; In VLC on my machine VA-API on X11 was drawing through all desktops. VA-API DRM was working better\u0026hellip; But crashed my X11 server after few minutes of watching ;/\nOpenCL You may thing: for what the hell you need OpenCL on such tiny machine? I doesn\u0026rsquo;t care - I want it ðŸ™‚\nFirst install clinfo package:\napt-get install -y clinfo And run it:\nclinfo Number of platforms 0 Not too much ðŸ˜€\nFor Intel GPU/CPU OpenCL support we will need beignet package:\napt-get install -y beignet clinfo Number of platforms 1 Platform Name Intel Gen OCL Driver Platform Vendor Intel Platform Version OpenCL 1.2 beignet 1.1.1 Platform Profile FULL_PROFILE Platform Extensions cl_khr_global_int32_base_atomics cl_khr_global_int32_extended_atomics cl_khr_local_int32_base_atomics cl_khr_local_int32_extended_atomics cl_khr_byte_addressable_store cl_khr_spir cl_khr_icd Platform Extensions function suffix Intel Platform Name Intel Gen OCL Driver Number of devices 1 Device Name Intel(R) HD Graphics Skylake ULX GT2 Device Vendor Intel Device Vendor ID 0x8086 Device Version OpenCL 1.2 beignet 1.1.1 Driver Version 1.1.1 Device OpenCL C Version OpenCL C 1.2 beignet 1.1.1 Device Type GPU Device Profile FULL_PROFILE Max compute units 24 Max clock frequency 1000MHz Device Partition (core) Max number of sub-devices 1 Supported partition types None, None, None Max work item dimensions 3 Max work item sizes 512x512x512 Max work group size 512 Preferred work group size multiple 16 Preferred / native vector sizes char 16 / 8 short 8 / 8 int 4 / 4 long 2 / 2 half 0 / 8 (cl_khr_fp16) float 4 / 4 double 0 / 2 (n/a) Half-precision Floating-point support (cl_khr_fp16) Denormals No Infinity and NANs Yes Round to nearest Yes Round to zero No Round to infinity No IEEE754-2008 fused multiply-add No Support is emulated in software No Correctly-rounded divide and sqrt operations No Single-precision Floating-point support (core) Denormals No Infinity and NANs Yes Round to nearest Yes Round to zero No Round to infinity No IEEE754-2008 fused multiply-add No Support is emulated in software No Correctly-rounded divide and sqrt operations No Double-precision Floating-point support (n/a) Address bits 32, Little-Endian Global memory size 2147483648 (2GiB) Error Correction support No Max memory allocation 1073741824 (1024MiB) Unified memory for Host and Device Yes Minimum alignment for any data type 128 bytes Alignment of base address 1024 bits (128 bytes) Global Memory cache type Read/Write Global Memory cache size 8192 Global Memory cache line 64 bytes Image support Yes Max number of samplers per kernel 16 Max size for 1D images from buffer 65536 pixels Max 1D or 2D image array size 2048 images Max 2D image size 8192x8192 pixels Max 3D image size 8192x8192x2048 pixels Max number of read image args 128 Max number of write image args 8 Local memory type Global Local memory size 65536 (64KiB) Max constant buffer size 134217728 (128MiB) Max number of constant args 8 Max size of kernel argument 1024 Queue properties Out-of-order execution No Profiling Yes Prefer user sync for interop Yes Profiling timer resolution 80ns Execution capabilities Run OpenCL kernels Yes Run native kernels Yes SPIR versions printf() buffer size 1048576 (1024KiB) Built-in kernels __cl_copy_region_align4;__cl_copy_region_align16;__cl_cpy_region_unalign_same_offset;__cl_copy_region_unalign_dst_offset;__cl_copy_region_unalign_src_offset;__cl_copy_buffer_rect;__cl_copy_image_1d_to_1d;__cl_copy_image_2d_to_2d;__cl_copy_image_3d_to_2d;__cl_copy_image_2d_to_3d;__cl_copy_image_3d_to_3d;__cl_copy_image_2d_to_buffer;__cl_copy_image_3d_to_buffer;__cl_copy_buffer_to_image_2d;__cl_copy_buffer_to_image_3d;__cl_fill_region_unalign;__cl_fill_region_align2;__cl_fill_region_align4;__cl_fill_region_align8_2;__cl_fill_region_align8_4;__cl_fill_region_align8_8;__cl_fill_region_align8_16;__cl_fill_region_align128;__cl_fill_image_1d;__cl_fill_image_1d_array;__cl_fill_image_2d;__cl_fill_image_2d_array;__cl_fill_image_3d; Device Available Yes Compiler Available Yes Linker Available Yes Device Extensions cl_khr_global_int32_base_atomics cl_khr_global_int32_extended_atomics cl_khr_local_int32_base_atomics cl_khr_local_int32_extended_atomics cl_khr_byte_addressable_store cl_khr_fp16 cl_khr_spir cl_khr_icd NULL platform behavior clGetPlatformInfo(NULL, CL_PLATFORM_NAME, ...) Intel Gen OCL Driver clGetDeviceIDs(NULL, CL_DEVICE_TYPE_ALL, ...) Success [Intel] clCreateContext(NULL, ...) [default] Success [Intel] clCreateContextFromType(NULL, CL_DEVICE_TYPE_CPU) No devices found in platform clCreateContextFromType(NULL, CL_DEVICE_TYPE_GPU) Success (1) Platform Name Intel Gen OCL Driver Device Name Intel(R) HD Graphics Skylake ULX GT2 clCreateContextFromType(NULL, CL_DEVICE_TYPE_ACCELERATOR) No devices found in platform clCreateContextFromType(NULL, CL_DEVICE_TYPE_CUSTOM) No devices found in platform clCreateContextFromType(NULL, CL_DEVICE_TYPE_ALL) Success (1) Platform Name Intel Gen OCL Driver Device Name Intel(R) HD Graphics Skylake ULX GT2 ICD loader properties ICD loader Name OpenCL ICD Loader ICD loader Vendor OCL Icd free software ICD loader Version 2.2.8 ICD loader Profile OpenCL 1.2 NOTE:\tyour OpenCL library declares to support OpenCL 1.2, but it seems to support up to OpenCL 2.1 too. Sources https://wiki.archlinux.org/index.php/GPGPU#Intel\nSuspend/Hibernate on lid close Default configuration of Ubuntu 16.04 was that after I close lid screen was blocked and LCD disabled. But system was still working normally - I strongly prefer to hibernate in such case and use no battery at all.\nI achieved that with systemd-logind. Edit /etc/systemd/logind.conf and uncomment line with HandleLidSwitch:\n[Login] HandleLidSwitch=suspend HandleLidSwitchDocked=ignore Now restart systemd-logind service with:\nsystemctl restart systemd-logind.service Problem with function keys Function keys were mostly working but not always like I expected. For example when I disable touchpad - it\u0026rsquo;s not disabled ðŸ™‚\nI found that module asus-nb-wmi is responssible for that and it\u0026rsquo;s still buggy. So I disabled it at all with:\necho \u0026#34;blacklist asus-nb-wmi\u0026#34; \u0026gt; /etc/modprobe.d/blacklist-ux305.conf Volume UP/DOWN/MUTE are still working fine - that\u0026rsquo;s enough for me. Rest could be configured with some keyboard shortcuts - more info here.\nTODO/Issues I still face some bugs:\n I could see occasional flickering from time to time. Rather after running notebook for some time than overheating/overloading it. This may be driver issue or maybe SNA acceleration method - I have to experiment a little to get this solved.\nLooks like disabling Virtualization support and VT-d in BIOS helped. It\u0026rsquo;s not final solution but for now I don\u0026rsquo;t need it\u0026hellip; A lot ðŸ˜‰ Tapping sometimes behave strange, for ex. tap to click stops to work and I have to use touchpad buttons for that. I think this may be related to syndaemon configuration because it started after I tuned it.\nIt was that. My hack for syndaemon broke touchpad. I will play with this a little more later. I like to use copy by selection and paste by middle click on my desktop - I\u0026rsquo;m addicted to this option but it\u0026rsquo;s not working on my laptop. I\u0026rsquo;m not sure if this will be convenient enough on touchpad to use.\nTo right click just tap with two fingers, to middle click (third button) tap with three fingers. Copy/paste is again easy like before.  If you found errors in my text of know better solutions for described problems, please let me know in comments.\n","href":"/2016/04/tweaking-asus-zenbook-ux305ca-on-linux/","title":"Tweaking ASUS Zenbook UX305CA on Linux"},{"content":"","href":"/tags/ubuntu/","title":"Ubuntu"},{"content":"","href":"/tags/zenbook/","title":"Zenbook"},{"content":"","href":"/tags/ipv6/","title":"IPv6"},{"content":"I try to use IPv6 where it\u0026rsquo;s available but it\u0026rsquo;s sometimes so hard\u0026hellip; It happen quite often that I can\u0026rsquo;t download packages from repos because they weren\u0026rsquo;t configured on IPv6 vhosts even when host is available via IPv6 address. For APT you may use this trick to force IPv4 connections only:\necho \u0026#39;Acquire::ForceIPv4 \u0026#34;true\u0026#34;;\u0026#39; \u0026gt; /etc/apt/apt.conf.d/99force-ipv4 If you need more than that, then gai.conf will allow you to filter where you will be connecting via IPv4 and where via IPv6 - in example bellow you will prefer IPv4 whenever it\u0026rsquo;s available:\necho \u0026#39;precedence ::ffff:0:0/96 100\u0026#39; \u0026gt;\u0026gt; /etc/gai.conf ","href":"/2016/03/prefer-ipv4-over-ipv6/","title":"Prefer IPv4 over IPv6"},{"content":"Sometimes it\u0026rsquo;s easier to use octal file permissions but they\u0026rsquo;re not so easy to list. I caught myself few times that I didn\u0026rsquo;t remember how to list them - so this is a reason for that note.\nstat -c \u0026#34;%a %n\u0026#34; * 755 bin 755 games 755 include Yes, it\u0026rsquo;s that easy ðŸ˜ƒ\nAnd here also with human readable attributes:\nstat -c \u0026#39;%A %a %n\u0026#39; * drwxr-xr-x 755 bin drwxr-xr-x 755 games drwxr-xr-x 755 include ","href":"/2016/02/list-octal-file-permissions-in-bash/","title":"List octal file permissions in bash"},{"content":"","href":"/tags/php/","title":"PHP"},{"content":"","href":"/tags/wordpress/","title":"Wordpress"},{"content":"I was configuring WordPress with HyperDB plugin on PHP 7.0 but the only I get were constant 500 errors. As I found here PHP 7.0 is not supported by HyperDB for now - it\u0026rsquo;s rely on mysql php extension but in PHP 7.0 there is only mysqli extension. But few folks fixed it and it\u0026rsquo;s possible to use it.\ncurl -O https://raw.githubusercontent.com/soulseekah/hyperdb-mysqli/master/db.php mv db.php /var/www/wordpress/wp-content/ And configure it ex. like this:\ncat \u0026lt;\u0026lt;DBCONFIG \u0026gt; /var/www/wordpress/db-config.php \u0026lt;?php \\$wpdb-\u0026gt;save_queries = false; \\$wpdb-\u0026gt;persistent = false; \\$wpdb-\u0026gt;max_connections = 10; \\$wpdb-\u0026gt;check_tcp_responsiveness = true; \\$wpdb-\u0026gt;add_database(array( \u0026#39;host\u0026#39; =\u0026gt; \u0026#34;master.db.host\u0026#34;, \u0026#39;user\u0026#39; =\u0026gt; \u0026#34;wordpress\u0026#34;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#34;random_password\u0026#34;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#34;wordpress\u0026#34;, \u0026#39;write\u0026#39; =\u0026gt; 1, \u0026#39;read\u0026#39; =\u0026gt; 1, )); \\$wpdb-\u0026gt;add_database(array( \u0026#39;host\u0026#39; =\u0026gt; \u0026#34;slave.db.host\u0026#34;, \u0026#39;user\u0026#39; =\u0026gt; \u0026#34;wordpress\u0026#34;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#34;random_password\u0026#34;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#34;wordpress\u0026#34;, \u0026#39;write\u0026#39; =\u0026gt; 0, \u0026#39;read\u0026#39; =\u0026gt; 1, )); DBCONFIG Now WordPress could handle crash of master database.\nSources https://www.digitalocean.com/community/tutorials/how-to-optimize-wordpress-performance-with-mysql-replication-on-ubuntu-14-04\n","href":"/2016/02/wordpress-with-hyperdb-on-php-7-0/","title":"WordPress with HyperDB on PHP 7.0"},{"content":"I\u0026rsquo;m playing a lot with Docker lately. Building images, and then rebuilding, and then building again\u0026hellip; It\u0026rsquo;s pretty boring. To automate this task a little I used inotify to build automatically after I changed any file. This trick could be used in many different situations.\nYou will need inotify-tools package:\nsudo apt-get install -y inotify-tools Then run something like this:\nwhile inotifywait -e modify -r .; do docker-compose build; done This commands will rebuild my Docker images after any file change in current directory. Use Ctrl+c to exit from loop.\n","href":"/2016/02/automatically-build-after-file-change/","title":"Automatically build after file change"},{"content":"I never tried it before but today I needed to install WordPress\u0026hellip; From command line only. And there is a way to do this with wp-cli.\nWP-CLI installation First some requirements (as root):\napt-get install php5-cli php5-mysql mysql-client curl And now installation of wp-cli (as root too):\ncurl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar chmod +x wp-cli.phar mv wp-cli.phar /usr/local/bin/wp Check if it\u0026rsquo;s working:\n$ wp --version WP-CLI 0.22.0 WordPress installation Now you should switch to user of your web application, ex. like this:\nsu - www-data -s /bin/bash And install WP:\nwp core download --path=/var/www/wordpress wp core config --path=/var/www/wordpress \\  --dbname=wordpress \\  --dbuser=wordpress \\  --dbpass=wordpresspass \\  --dbhost=localhost \\  --locale=pl_PL wp core install --path=/var/www/wordpress \\  --url=\u0026#34;http://example.com\u0026#34; \\  --title=\u0026#34;Example blog\u0026#34; \\  --admin_user=never_use_admin_here \\  --admin_password=admin_pass \\  --admin_email=admin@example.com \\  --skip-email Here you may find more about wp-cli configuration and commands.\n","href":"/2016/02/install-wordpress-from-command-line/","title":"Install WordPress from command-line"},{"content":"When I started playing with Docker I was running a lot of commands to build image, delete containers running on old image, run containers based on new image, etc\u0026hellip; A lot of log commands with links, volumes, etc\u0026hellip;\nThen I started searching for something to automate this task and here I get to docker-compse command, this is how you may install it:\npip install docker-compose And install additional bash completions (run as root):\ncurl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose \u0026gt; /etc/bash_completion.d/docker-compose Then you may prepare docker-compose.yml file like:\nweb: build: . command: php -S 0.0.0.0:8000 -t /code ports: - \u0026#34;8000:8000\u0026#34; links: - db volumes: - .:/code db: image: orchardup/mysql environment: MYSQL_DATABASE: wordpress More informations about syntax may be found here: https://docs.docker.com/compose/compose-file/\nAnd run such environment with:\ndocker-compose up Or to run this in background:\ndocker-compose up -d To stop and cleanup it use:\ndocker-compose stop \u0026amp;\u0026amp; docker-compose rm -f -v Other usable commands are:\ndocker-compose build --force-rm # to rebuild images and clean after docker-compose ps # to list containers I\u0026rsquo;m still playing with volumes in this but don\u0026rsquo;t have anything interesting enough to paste here - maybe later.\nSources https://docs.docker.com/compose/install/\nhttps://docs.docker.com/compose/completion/\n","href":"/2016/02/install-docker-compose/","title":"Install Docker Compose"},{"content":"I\u0026rsquo;ve played with Docker a little in it early days but didn\u0026rsquo;t stick for longer with it. It\u0026rsquo;s stable now so I wanted to check how it\u0026rsquo;s running now.\nI really can\u0026rsquo;t accept this method of installation:\ncurl -fsSL https://get.docker.com/ | sh I think that world is going to it\u0026rsquo;s end when I see such scritps\u0026hellip; I prefer to do this manually, knowing exactly what I have to do.\nInstall prerequisites:\napt-get update apt-get install -y apt-transport-https ca-certificates Purge old packages if you used them:\napt-get purge lxc-docker* apt-get purge docker.io* Add GPG key:\napt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D Add repo - use ONLY ONE repo appropriate for your system (lsb_release -a to check):\necho \u0026#34;deb https://apt.dockerproject.org/repo debian-wheezy main\u0026#34; \u0026gt; /etc/apt/sources.list.d/docker.list echo \u0026#34;deb https://apt.dockerproject.org/repo debian-jessie main\u0026#34; \u0026gt; /etc/apt/sources.list.d/docker.list echo \u0026#34;deb https://apt.dockerproject.org/repo debian-stretch main\u0026#34; \u0026gt; /etc/apt/sources.list.d/docker.list echo \u0026#34;deb https://apt.dockerproject.org/repo ubuntu-precise main\u0026#34; \u0026gt; /etc/apt/sources.list.d/docker.list echo \u0026#34;deb https://apt.dockerproject.org/repo ubuntu-trusty main\u0026#34; \u0026gt; /etc/apt/sources.list.d/docker.list Refresh repos and install Docker:\napt-get update apt-get install -y docker-engine Start service if it\u0026rsquo;s not running:\nservice docker start Grant access to docker service for non-root user I don\u0026rsquo;t like to use apps that require me to use root account. Docker even advice not to do so - service is running as root and you should add docker group and user to it to grant access to service socket:\ngroupadd docker gpasswd -a ${USER} docker service docker restart Now logout, login again and and you should be able to use docker command:\ndocker version docker info docker run hello-world Have fun ðŸ˜ƒ\nSources https://docs.docker.com/linux/\nhttps://docs.docker.com/engine/installation/\n","href":"/2016/02/manual-installation-of-docker-on-debian-ubuntu/","title":"Manual installation of Docker on Debian/Ubuntu"},{"content":"I started playing with Docker and here I will write some commands that where not so obvious at beginning ðŸ˜ƒ\nList running containers:\ndocker ps List also not running containers:\ndocker ps -a Remove all containers (be careful with that):\ndocker rm $(docker ps -a -q) Remove all images:\ndocker rmi $(docker images -q) Docker won\u0026rsquo;t remove any old volumes used by containers, so after some time you may be interested in deleting them all:\ndocker volume rm $(docker volume ls -q) Run container and enter bash:\ndocker run --name deb -t -i debian:jessie /bin/bash Show build logs from container:\ndocker logs deb Enter bash into running container:\ndocker exec -it deb /bin/bash Build image from Dockerfile in current directory:\ndocker build -t my_web . After playing a little with this command I started searching for something to automate my tasks a little, and found docker-compose - you may be interested in it too.\nSources https://techoverflow.net/blog/2013/10/22/docker-remove-all-images-and-containers/\n","href":"/2016/02/some-usefull-commands-in-docker/","title":"Some usefull commands in Docker"},{"content":"I was doing a lot of changes to my old posts, switched to HTTPS, etc. Sometimes it was useful to change some particular text in all my old posts at a time, but there is no such feature in WordPress. But WordPress runs on MySQL and I could use SQL query to update such posts.\nMake backup - it\u0026rsquo;s not required but strongly advised ðŸ˜ƒ\nNow use this query as template to replace in place whatever you need:\neYou should see something like:\nQuery OK, 157 rows affected (0.04 sec) Rows matched: 455 Changed: 157 Warnings: 0 This will remove \u0026lt;!--more--\u0026gt;from all posts (it\u0026rsquo;s used by WordPress to span article when showed on tag/category pages).\nAnother example to update all URLs to HTTPS:\nUPDATE wp_posts SET post_content = REPLACE(post_content, \u0026#34;http://gagor.pl\u0026#34;, \u0026#34;https://gagor.pl\u0026#34;); Be careful with that and make DB backup before you start.\n","href":"/2016/02/mass-replace-in-wordpress-posts-via-mysql-query/","title":"Mass replace in WordPress posts via MySQL query"},{"content":"","href":"/tags/silverlight/","title":"Silverlight"},{"content":"From few days I have access to UPC\u0026rsquo;s www.horizon.tv platform - until now it was useless on Linux. But there is Pipelight that will use Wine to emulate Silverlight on Linux and it\u0026rsquo;s working pretty well - you\u0026rsquo;re just few commands away from achieving that:\n# stop browser killall firefox # remove old version if you have it sudo apt-get remove pipelight Now configure repos and install packages:\nsudo apt-add-repository ppa:pipelight/stable sudo apt-get update sudo apt-get install --install-recommends pipelight-multi sudo pipelight-plugin --update Enable plugin (run it with sudo for system wide installation):\npipelight-plugin --enable silverlight Start Firefox and test if plugin is working here: http://bubblemark.com/silverlight2.html\nNow enter www.horizon.tv and try it yourself.\nP.S. It works only on Firefox because Chrome do not support NPAPI plugins anymore ðŸ˜ƒ\nSources http://www.webupd8.org/2013/08/pipelight-use-silverlight-in-your-linux.html\n","href":"/2016/02/use-www-horizon-tv-with-pipelight-silverlight-on-linux-ubuntu/","title":"Use www.horizon.tv with Pipelight/Silverlight on Linux/Ubuntu"},{"content":"I just bought new wifi card for my desktop computer. Like in topic, it\u0026rsquo;s Intel Dual Band Wireless-AC 7260 for Desktop.\nI was searching for card that:\n support AC standard have 5GHz network support (2,4GHz channels are cluttered heavily in my neighborhood have PCI/PCIx or USB3 connector is Linux friendly (no modules compilation by hand, support for aircrack-ng, kismet)  This one is the only I found that comply my expectations.\nI found time to play with kismet and aircrack-ng and it was working fine. Card works without problems on kernel 4.2.0. Highest transfer on my net I could get from my NAS - about 23 MB/s (megabytes per second) - much better than on my old N router (approx 6,5 MB/s).\nHere\u0026rsquo;s information from lspci -vvv:\n05:00.0 Network controller: Intel Corporation Wireless 7260 (rev 73) Subsystem: Intel Corporation Dual Band Wireless-AC 7260 Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx+ Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast \u0026gt;TAbort- \u0026lt;TAbort- \u0026lt;MAbort- \u0026gt;SERR- \u0026lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Interrupt: pin A routed to IRQ 39 Region 0: Memory at f7c00000 (64-bit, non-prefetchable) [size=8K] Capabilities: [c8] Power Management version 3 Flags: PMEClk- DSI+ D1- D2- AuxCurrent=0mA PME(D0+,D1-,D2-,D3hot+,D3cold+) Status: D0 NoSoftRst- PME-Enable- DSel=0 DScale=0 PME- Capabilities: [d0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Address: 00000000fee0400c Data: 4123 Capabilities: [40] Express (v2) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s \u0026lt;512ns, L1 unlimited ExtTag- AttnBtn- AttnInd- PwrInd- RBE+ FLReset+ DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd- ExtTag- PhantFunc- AuxPwr+ NoSnoop+ FLReset- MaxPayload 128 bytes, MaxReadReq 128 bytes DevSta: CorrErr+ UncorrErr- FatalErr- UnsuppReq- AuxPwr+ TransPend- LnkCap: Port #0, Speed 2.5GT/s, Width x1, ASPM L0s L1, Exit Latency L0s \u0026lt;4us, L1 \u0026lt;32us ClockPM+ Surprise- LLActRep- BwNot- ASPMOptComp- LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x1, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- DevCap2: Completion Timeout: Range B, TimeoutDis+, LTR+, OBFF Via WAKE# DevCtl2: Completion Timeout: 16ms to 55ms, TimeoutDis-, LTR-, OBFF Disabled LnkCtl2: Target Link Speed: 2.5GT/s, EnterCompliance- SpeedDis- Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS- Compliance De-emphasis: -6dB LnkSta2: Current De-emphasis Level: -3.5dB, EqualizationComplete-, EqualizationPhase1- EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest- Capabilities: [100 v1] Advanced Error Reporting UESta: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UEMsk: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UESvrt: DLP+ SDES+ TLP- FCP+ CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol- CESta: RxErr- BadTLP+ BadDLLP- Rollover- Timeout- NonFatalErr+ CEMsk: RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+ AERCap: First Error Pointer: 00, GenCap- CGenEn- ChkCap- ChkEn- Capabilities: [140 v1] Device Serial Number 7c-5c-f8-ff-xx-xx-xx-xx Capabilities: [14c v1] Latency Tolerance Reporting Max snoop latency: 0ns Max no snoop latency: 0ns Capabilities: [154 v1] Vendor Specific Information: ID=cafe Rev=1 Len=014 \u0026lt;?\u0026gt; Kernel driver in use: iwlwifi And iwconfig:\nwlp5s0 IEEE 802.11abgn ESSID:\u0026#34;cis5\u0026#34; Mode:Managed Frequency:5.5 GHz Access Point: 34:7A:60:XX:XX:XX Bit Rate=780 Mb/s Tx-Power=22 dBm Retry short limit:7 RTS thr:off Fragment thr:off Power Management:off Link Quality=60/70 Signal level=-50 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:7 Invalid misc:184 Missed beacon:0 If you\u0026rsquo;re thinking about buying any Linux friendly AC wifi card - this one is worth it\u0026rsquo;s price.\n","href":"/2016/02/intel-dual-band-wireless-ac-7260-for-desktop-on-linux/","title":"Intel Dual Band Wireless-AC 7260 for Desktop on Linux"},{"content":"","href":"/tags/ddos/","title":"DDoS"},{"content":"","href":"/tags/dos/","title":"DoS"},{"content":"","href":"/tags/iptables/","title":"iptables"},{"content":"I watched nice presentation about how Cloudflare protects itself against DoS. Most of us are not able to do that exactly like them but some of tips were general enough to be used on typical web front server.\nI took notes from this presentation and presented here. Thanks to Marek agreement I also reposted all examples (in easier to copy paste way).\nHowto prepare against ACK/FIN/RST/X-mas flood Use conntrack rule:\niptables -A INPUT --dst 1.2.3.4 -m conntrack --ctstate INVALID -j DROP which will only work with disabled tcp_loose setting (it\u0026rsquo;s by default enabled) with addition to sysctl:\nsysctl -w net.netfilter.nf_conntrack_tcp_loose=0 Howto prepare against SYN floods SYN flood is hard case - because when you use conntrack it will make your performance worst validating state for every new single packet.\nThe only way to get around this is to enable syncookies:\nsysctl -w net.ipv4.tcp_syncookies=1 sysctl -w net.ipv4.tcp_timestamps=1 Enabling syncookies will cause loose of some of connection informations, that are pretty useful like:\n window scaling factor ECN bit (Explicit Congestion Notification)  For that we will use tcp_timestamp option, that will use few bits from timestamp field to store some of this informations.\nThis still may be not efficient enough, but in kernel 4.4 there will be some update to how syncookies are served that should make it few times faster than with older one.\nRelated docs: https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt\nHowto prepare against botnet attack Symptoms:\n concurrent connection count going up many sockets in orphaned state many sockets in time wait state  Solutions:\n Enable connlimit feature on conntrack to limit amount of concurrent connections to our service Use hashlimits to rate limit SYN packets per IP Use ipsets to efficiently block many IP/subnet addresses  manual blacklisting - feed IP blacklist from HTTP server logs supports subnets, timeouts automatic blacklisting hashlimits   Disable HTTP keep-alives to make this attack look more like SYN flood  This may still not work against DDoS because huge amount of bots won\u0026rsquo;t allow you to block them efficiently enough.\nSome exciting system tweaks and examples from this presentation I hope to find some time to merge them into template/script that could be used much easier - but first I have to play with these rules a little and test what will be most useful.\nNIC: Discard with flow steering ethtool -N eth3 flow-type udp4 dst-ip 129.168.254.30 dst-port 53 action -1 Flow steering for priority ethtool -X eth3 weight 0 1 1 1 1 1 1 1 1 1 1 ethtool -N eth3 flow-type tcp4 dst-port 22 action 0 SYN backlog size sysctl -w net.core.somaxconn=65535 sysctl -w net.ipv4.tcp_max_syn_backlog=65535 It\u0026rsquo;s rounded to next power of two (in this case to 65536).\nSYN backlog decay sysctl -w net.ipv4.tcp_synack_retries=1 L7 connection count sysctl -w net.ipv4.tcp_max_orphans=262144 sysctl -w net.ipv4.tcp_orphan_retries=1 sysctl -w net.ipv4.tcp_max_tw_buckets=360000 sysctl -w net.ipv4.tcp_tw_reuse=1 sysctl -w net.ipv4.tcp_fin_timeout=5 L3: u32 iptables -A INPUT \\  --dst 1.2.3.4 \\  --p udp -m udp --dport 53 \\  -m u32 --u32 \u0026#34;6\u0026amp;0xFF=0x6 \u0026amp;\u0026amp; 4\u0026amp;0x1FFF=0 \u0026amp;\u0026amp; 0\u0026gt;\u0026gt;22\u0026amp;0x3C@4=0x29\u0026#34; \\  -j DROP L4: Conntrack iptables -t raw -A PREROUTING \\  -i eth2 \\  --dst 1.2.3.4 \\  -j ACCEPT iptables -t raw -A PREROUTING \\  -i eth2 \\  -j NOTRACK iptables -A INPUT \\  --dst 1.2.3.4 \\  -m conntrack --ctstate INVALID \\  -j DROP Tuning conntrack sysctl -w net.netfilter.nf_conntrack_tcp_loose=0 sysctl -w net.netfilter.nf_conntrack_helper=0 sysctl -w net.nf_conntrack_max=2000000 echo 2500000 \u0026gt; /sys/module/nf_conntrack/parameters/hashsize More info about conntrack sysctl options: https://www.kernel.org/doc/Documentation/networking/nf_conntrack-sysctl.txt\nL7: Connlimit iptables -t raw -A PREROUTING \\  -i eth2 \\  --dst 1.2.4.5 \\  -j ACCEPT iptables -A INPUT \\  --dst 1.2.3.4 \\  -p tcp -m tcp --dport 80 \\  -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN \\  -m connlimit \\  --connlimit-above 10 \\  --connlimit-mask 32 \\  --connlimit-saddr \\  -j DROP L7: ipset for blacklisting ipset -exist create ta_d335c5 hash:net family inet ipset add ta_d335c5 192.168.0.0/16 ipset add ta_d335c5 10.0.0/8 iptables -A INPUT \\  -m set --match-set ta_d335c5 src \\  -j DROP L7: being evil - TARPIT iptables -A INPUT \\  -m set --match-set ta_d335c5 src \\  -j TARPIT TARPIT target will imitate successful connection for the client (bot in this case) but without responding to it\u0026rsquo;s queries. It will cost that bot a lot more resources and time to timeout and drop this connection than when using DROP or REJECT here.\nL7: hashlimit for rate limiting iptables -A INPUT \\  --dst 1.2.3.4 -p tcp -m tcp --dport 80 \\  --tcp-flags FIN,SYN,RST,PSH,ACK,URG SYN \\  -m hashlimit \\  --hashlimi-above 123/sec \\  --hashlimit-burst 5 \\  --hashlimit-mode srcip \\  --hashlimit-srcmask 24 \\  --hashlimit-name 341654b1d4af9bf \\  -j DROP L7: auto-blacklist ipset -exist create blacklist hash:net timeout 60 iptables -A INPUT \\  --dst 1.2.3.4 \\  -m set --match-set blaclist src \\  -j DROP iptables -A INPUT \\  --dst 1.2.3.4 -p tcp -m tcp --dport 80 \\  --tcp-flags FIN,SYN,RST,PSH,ACK,URG SYN \\  -m hashlimit \\  --hashlimit-above 100/sec \\  --hashlimit-mode srcip \\  --hashlimit-srcmask 24 \\  --hashlimit-name hl_blacklist \\  -j SET --add-set blacklist src L7+: payload in TCP - string iptables -A INPUT \\  --dst 1.2.3.4 \\  -p tcp --dport 80 \\  -m string \\  --hex-string 486f737777777777... \\  --from 231 --to 300 \\  -j DROP For more informations and explanations watch this great presentation:\nAnd here is the whole presentation with additional examples:\nhttps://speakerdeck.com/majek04/lessons-from-defending-the-indefensible\n","href":"/2016/02/prepare-for-dos-like-cloudflare-do/","title":"Prepare for DoS like Cloudflare do"},{"content":"","href":"/tags/security/","title":"Security"},{"content":"","href":"/tags/gnome/","title":"Gnome"},{"content":"I was looking at backup task running on my desk and saw that it\u0026rsquo;s spending a lot of time on ~/.local/share/zeitgeist directory. I checked and it had 4.6GB:\ndu -sh ~/.local/share/zeitgeist/* 118M activity.sqlite 44M activity.sqlite.bck 32K activity.sqlite-shm 4,4G activity.sqlite-wal 311M fts.index WTF? Fortunately I found here that I could easily delete some of this:\nzeitgeist-daemon --quit Now check that it\u0026rsquo;s not running:\nps axu | grep zeitgeist-daemon timor 9105 0.0 0.0 10756 2140 pts/5 S+ 19:01 0:00 grep --color=auto zeitgeist-daemon Nothing there so we may start deleting:\ncd ~/.local/share/zeitgeist rm -r fts.index rm activity.sqlite-wal rm activity.sqlite-shm Start zeitgeist-daemon again:\nzeitgeist-daemon --replace\u0026amp; Now check files sizes again:\ndu -sh ~/.local/share/zeitgeist/* 118M activity.sqlite 44M activity.sqlite.bck 32K activity.sqlite-shm 4,0K activity.sqlite-wal 640K fts.index Much better ðŸ˜ƒ\n","href":"/2016/02/zeitgeist-activity-sqlite-wal-getting-huge/","title":"Zeitgeist activity.sqlite-wal getting huge"},{"content":"","href":"/tags/nginx/","title":"nginx"},{"content":"There are many possible real life cases and not all optimization technics will be suitable for you but I hope it will be a good starting place.\nAlso you shouldn\u0026rsquo;t copy paste examples with faith that they will make your server fly ðŸ˜ƒ You have to support your decisions with excessive tests and help of monitoring system (ex. Grafana).\nCache static and dynamic content Setting caching static and dynamic content strategy may offload your server from additional load from repetitive downloads of same, rarely updated files. This will make your site to load faster for frequent visitors.\nExample configuration:\nlocation ~* ^.+\\.(?:jpg|png|css|gif|jpeg|js|swf|m4v)$ { access_log off; log_not_found off; tcp_nodelay off; open_file_cache max=500 inactive=120s; open_file_cache_valid 45s; open_file_cache_min_uses 2; open_file_cache_errors off; expires max; } For additional performance gain, you may:\n disable logging for static files, disable tcp_nodelay option - it\u0026rsquo;s useful to send a lot of small files (ideally smaller than single TCP packet - 1,5Kb), but images are rather big files and sending them all together will gain better performance, play with open_file_cache - it will take off some IO load, add long long expires.  Caching dynamic content is harder case. There are articles that are rarely updated and they may lay in cache forever but other pages are pretty dynamic and shouldn\u0026rsquo;t be cached for long. Even if caching dynamic content sounds scary for you it\u0026rsquo;s not. So called micro caching (caching for short period of time, like 1s) - is great solution for digg effect or slashdotting.\nLet say your page gets ten views per second and you will cache ever site for 1s, then you will be able to server 90% of requests from cache. Leaving precious CPU cycles for other tasks.\nCompress data On your page you should use filetypes that are efficiently compressed like: JPEG, PNG, MP3, etc. But all HTML, CSS, JS may be compressed too on the fly by web server, just enable options like that globally:\ngzip on; gzip_vary on; gzip_disable \u0026#34;msie6\u0026#34;; gzip_comp_level 1; gzip_proxied any; gzip_buffers 16 8k; gzip_min_length 50; gzip_types text/plain text/css application/json application/x-javascript application/javascript text/javascript application/atom+xml application/xml application/xml+rss text/xml image/x-icon text/x-js application/xhtml+xml image/svg+xml; You may also precompress these files stronger during build/deploy process and use gzip_static module to serve them without additional overhead for compression. Ex.:\ngzip_static on; Then use script like this to compress files:\nfind /var/www -iname *.js -print0 |xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;gzip -c9 \u0026#34;{}\u0026#34; \u0026gt; \u0026#34;{}.gz\u0026#34; \u0026amp;\u0026amp; touch -r \u0026#34;{}\u0026#34; \u0026#34;{}.gz\u0026#34;\u0026#39; find /var/www -iname *.css -print0 |xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;gzip -c9 \u0026#34;{}\u0026#34; \u0026gt; \u0026#34;{}.gz\u0026#34; \u0026amp;\u0026amp; touch -r \u0026#34;{}\u0026#34; \u0026#34;{}.gz\u0026#34;\u0026#39; Files have to had same timestamp like original (not compressed) file to be used by Nginx.\nOptimize SSL/TLS New optimized versions of HTTP protocols like HTTP/2 or SPDY require HTTPS configuration (at least in browsers implementation). Then SSL/TLS high cost of every new HTTPS connection became crucial case for further optimizations.\nThere are few steps required for improved SSL/TLS performance.\nEnable SSL session caching Use ssl_session_cache directive to cache parameters used when securing each new connection, ex.:\nssl_session_cache builtin:1000 shared:SSL:10m; Enable SSL session tickets Tickets store information about specific SSL/TLS connection so connection may be reused without new handshake, ex.:\nssl_session_tickets on; Configure OCSP stapling for SSL This will lower handshaking time by caching SSL/TLS certificate informations. This is per site/certificate configuration, ex.:\nssl_stapling on; ssl_stapling_verify on; ssl_certificate /etc/ssl/certs/my_site_cert.crt; ssl_certificate_key /etc/ssl/private/my_site_key.key; ssl_trusted_certificate /etc/ssl/certs/authority_cert.pem; A ssl_trusted_certificate file have to point to trusted certificate chain file - root + intermediate certificates (this can be downloaded from your certificate provider site (sometimes you have to merge by yourself those files).\nExcessive article in this topic could be found here: https://raymii.org/s/tutorials/OCSP_Stapling_on_nginx.html\nImplement HTTP/2 or SPDY If you have HTTPS configured the only thing you have to do is to add two options on listen directive, ex.:\nlisten 443 ssl http2; # currently http2 is preferred against spdy;  # on SSL enabled vhost ssl on; You may also advertise for HTTP connection that you have newer protocol available, for that on HTTP connections use this header:\nadd_header Alternate-Protocol 443:npn-spdy/3; SPDY and HTTP/2 protocols use:\n headers compression, single, multiplexed connection (carrying pieces of multiple requests and responses at the same time) rather than multiple connection for every piece of web page.  After SPDY or HTTP/2 implementation you no longer need typical HTTP/1.1 optimizations like:\n domain sharding, resource (JS/CSS) merging, image sprites.  Tune other nginx performance options Access logs Disable access logs were you don\u0026rsquo;t need them, ex.: for static files. You may also use buffer and flush options with access_log directive, ex.:\naccess_log /var/log/nginx/access.log buffer=1m flush=10s; With buffer Nginx will hold that much data in memory before writing it to disk. flush tells Nginx how often it should write gathered logs to disk.\nProxy buffering Turning proxy buffering may impact performance of your reverse proxy.\nNormally when buffering is disabled, Nginx will pass response directly to client synchronously.\nWhen buffering is enable it will store response in memory set by proxy_buffer_size option and if response is too big it will be stored in temporary file.\nproxy_buffering on; proxy_buffer_size 16k; Keepalive for client and upstream connections] Every new connection costs some time for handshake and will add latency to requests. By using keepalive connections will be reused without this overhead.\nFor client connections:\nkeepalive_timeout = 120s; For upstream connections:\nupstream web_backend { server 127.0.0.1:80; server 10.0.0.2:80; keepalive 32; } Limit connections to some resources Some time users/bots overload your service by querying it to fast. You may limit allowed connections to protect your service in such case, ex.:\nlimit_conn_zone $binary_remote_addr zone=owncloud:1m; server { # ...  limit_conn owncloud 10; # ... } Adjust woker count Normally Nginx will start with only 1 worker process, you should adjust this variable to at the number of CPU\u0026rsquo;s, in case of quad core CPU use in main section:\nworker_processes 4; Use socket sharding In latest kernel and Nginx versions (at least 1.9.1) there is new feature of sockets sharding. This will offload management of new connections to kernel. Each worker will create a socket listener and kernel will assign new connections to them as they become available.\nlisten 80 reuseport; Thread pools Thread pools are solution for mostly long blocking IO operations that may block whole Nginx event queue (ex. when used with big files or slow storage).\nlocation / { root /storage; aio threads; } This will help a lot if you see many Nginx processes in D state, with high IO wait times.\nTune Linux for performance Backlog queue If you could see on your system connection that appear to be staling then you have to increase net.core.somaxconn. This system parameter describes the maximum number of backlogged sockets. Default is 128 so setting this to 1024 should be no big deal on any decent machine.\necho \u0026#34;net.core.somaxconn=1024\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p /etc/sysctl.conf File descriptors If your system is serving a lot of connections you may get reach system wide open descriptor limit. Nginx uses up to two descriptors for each connection. Then you have to increase sys.fs.fs_max.\necho \u0026#34;sys.fs.fs_max=3191256\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p /etc/sysctl.conf Ephemeral ports Nginx used as a proxy creates temporary (ephemeral) ports for each upstream server. On busy proxy servers this will result in many connection in TIME_WAIT state.\nSolution for that is to increase range of available ports by setting net.ipv4.ip_local_port_range. You may also benefit from lowering net.ipv4.tcp_fin_timeout setting (connection will be released faster, but be careful with that).\nUse reverse-proxy This with microcaching technic is worth separate article, I will add link here when it will be ready.\nSource:  http://www.fromdual.com/huge-amount-of-time-wait-connections https://www.nginx.com/blog/10-tips-for-10x-application-performance/ https://www.nginx.com/blog/socket-sharding-nginx-release-1-9-1/ https://www.nginx.com/blog/thread-pools-boost-performance-9x/ https://tweaked.io/guide/kernel/ https://t37.net/nginx-optimization-understanding-sendfile-tcp_nodelay-and-tcp_nopush.html  ","href":"/2016/01/optimize-nginx-for-performance/","title":"Optimize Nginx for performance"},{"content":"","href":"/tags/xen/","title":"Xen"},{"content":"Sometime you need to make quick and dirty image backup of VM running on XenServer and this post is about such case ðŸ˜ƒ\nList machines:\nxl list Name ID Mem VCPUs State Time(s) Domain-0 0 4066 8 r----- 3526567.3 webfront1.example.com 1 4096 4 r----- 3186487.2 webfront2.example.com 2 2048 2 -b---- 920408.2 Now you may export one:\nxe vm-export vm=webfront1.example.com filename=/srv/backup/webfront.xva Export succeeded You may also use uuid for that - list machines with xe vm-list (best with less) and then:\nxe vm-export uuid=1234a43d-c5af-f1ef-b3c1-12347f63d84c filename=/srv/backup/webfront.xva That\u0026rsquo;s all!\n","href":"/2016/01/xenserver-export-vm-to-file/","title":"XenServer - export VM to file"},{"content":"","href":"/tags/curl/","title":"curl"},{"content":"","href":"/tags/nagios/","title":"Nagios"},{"content":"Sometimes deployment process or other havy task may cause some Nagios checks to rise below normal levels and bother admin. If this is expected and you want to add downtime on host/service during this task you may use this script:\n#!/bin/bash  function die { echo $1; exit 1; } if [[ $# -eq 0 ]] ; then die \u0026#34;Give hostname and time in minutes as parameter!\u0026#34; fi if [[ $# -eq 1 ]] ; then MINUTES=15 else MINUTES=$2 fi HOST=$1 NAGURL=http://nagios.example.com/nagios/cgi-bin/cmd.cgi USER=nagiosuser PASS=nagiospassword SERVICENAME=someservice COMMENT=\u0026#34;Deploying new code\u0026#34; export MINUTES echo \u0026#34;Scheduling downtime on $HOSTfor $MINUTESminutes...\u0026#34; # The following is urlencoded already STARTDATE=`date \u0026#34;+%d-%m-%Y %H:%M:%S\u0026#34;` # This gives us the date/time X minutes from now ENDDATE=`date \u0026#34;+%d-%m-%Y %H:%M:%S\u0026#34; -d \u0026#34;$MINUTESmin\u0026#34;` curl --silent --show-error \\  --data cmd_typ=56 \\  --data cmd_mod=2 \\  --data host=$HOST \\  --data-urlencode \u0026#34;service=$SERVICENAME\u0026#34; \\  --data-urlencode \u0026#34;com_data=$COMMENT\u0026#34; \\  --data trigger=0 \\  --data-urlencode \u0026#34;start_time=$STARTDATE\u0026#34; \\  --data-urlencode \u0026#34;end_time=$ENDDATE\u0026#34; \\  --data fixed=1 \\  --data hours=2 \\  --data minutes=0 \\  --data btnSubmit=Commit \\  --insecure \\  $NAGURL -u \u0026#34;$USER:$PASS\u0026#34;| grep -q \u0026#34;Your command request was successfully submitted to Nagios for processing.\u0026#34; || die \u0026#34;Failed to con tact nagios\u0026#34;; echo Scheduled downtime on nagios from $STARTDATE to $ENDDATE Threat this script as template with some tips:\n I you want to add downtime on service, then provide SERVICENAME and --data cmd_typ=56 \\. If you want downtime on whole host, just remove this line: --data-urlencode \u0026quot;service=$SERVICENAME\u0026quot; \\ and --data cmd_typ=86 \\ Another thing that in my example nagios page use basic auth for security, if your don\u0026rsquo;t use it, you may remove -u \u0026quot;$USER:$PASS\u0026quot; from parameters. If you get Start or end time not valid, then you have to adapt dates to your formats of dates accepted by Nagios (probably this depends on Nagios version or timezone configuration).  Sources http://stackoverflow.com/questions/6842683/how-to-set-downtime-for-any-specific-nagios-host-for-certain-time-from-commandli\n","href":"/2016/01/nagios-downtime-on-hostservice-from-command-line-with-curl/","title":"Nagios - downtime on host/service from command line with curl"},{"content":"","href":"/tags/collectd/","title":"CollectD"},{"content":"","href":"/tags/grafana/","title":"Grafana"},{"content":"Now when you have CollectD and InfluxDB installed you may configure Grafana ðŸ˜ƒ\nFirst configure repo with current Grafana version (select your distro):\ncurl https://packagecloud.io/gpg.key | sudo apt-key add - deb https://packagecloud.io/grafana/testing/debian/ wheezy main Now install package (on wheezy I needed to install apt-transport-https to allow installation of packages from repo via HTTPS):\napt-get update apt-get install -y apt-transport-https apt-get install -y grafana By default Grafana will use sqlite database to keep information about users, etc:\n[database] # Either \u0026#34;mysql\u0026#34;, \u0026#34;postgres\u0026#34; or \u0026#34;sqlite3\u0026#34;, it\u0026#39;s your choice ;type = sqlite3 ;host = 127.0.0.1:3306 ;name = grafana ;user = root ;password = If that\u0026rsquo;s ok for you, you may leave it as is. I prefer to configure MySQL database (create user, database, grant permissions to user):\n[database] type = mysql host = 127.0.0.1:3306 name = grafana user = grafana password = mydbpassword So Grafana should be running on port 3000 by default, now it\u0026rsquo;s time to connect ex.: http://localhost:3000 (use your host). Now click Data sources on left panel, then Add new on top panel and fill source data like below:\nBecause we didn\u0026rsquo;t set authorization for InfluxDB you may just type whatever login/password there. Now Test Connection and Save and you should be ready to play with Grafana.\nI also used scripted dashboard for Grafana to add easily statistics for my hosts, you may find it here: https://github.com/anryko/grafana-influx-dashboard\nSources http://docs.grafana.org/installation/debian/\n","href":"/2016/01/grafana-installation-and-configuraton-with-influxdb-and-collectd-on-debian-ubuntu/","title":"Grafana - installation and configuraton with InfluxDB and CollectD on Debian/Ubuntu"},{"content":"","href":"/tags/influxdb/","title":"InfluxDB"},{"content":"I wanted/needed some statistics on few my machines. I saw earlier grafana and was impressed so this was starting point. Then I started reading about graphite, carbon and whisper, and thenâ€¦ I found InfluxDB. Project is young but looks promising.\nLet\u0026rsquo;s start! On project page there is no info about repo but it\u0026rsquo;s available, configure it:\ncurl -sL https://repos.influxdata.com/influxdb.key | apt-key add - echo \u0026#34;deb https://repos.influxdata.com/debian wheezy stable\u0026#34; \u0026gt; /etc/apt.sources.list.d/influxdb.conf for Ubuntu use url like (of course selecting your version):\necho \u0026#34;deb https://repos.influxdata.com/ubuntu wily stable\u0026#34; \u0026gt; /etc/apt.sources.list.d/influxdb.conf Now install package (on wheezy I needed to install apt-transport-https to allow installation of packages from repo via HTTPS):\napt-get install -y apt-transport-https apt-get install -y influxdb Now edit /etc/influxdb/influxdb.conf and uncoment/fill [collectd] section like this:\n[collectd] enabled = true bind-address = \u0026#34;:8096\u0026#34; database = \u0026#34;collectd_db\u0026#34; typesdb = \u0026#34;/usr/share/collectd/types.db\u0026#34; You may adjust port to whatever suits you best. database sets InfluxDB database used to store collectd data, and typesdb is file from collectd package defining collectd metrics structure (this is location for Debian) - so you have collectd service installed earlier.\nNow you may check if InfluxDB is working fine by connecting to web admin panel, by standard on port 8083.\nSources https://github.com/influxdata/influxdb/issues/585\u0026quot;\nhttps://anomaly.io/collectd-metrics-to-influxdb/\n","href":"/2016/01/influxdb-installation-and-configuration-on-debianubuntu/","title":"InfluxDB - installation and configuration on Debian/Ubuntu"},{"content":"I wanted/needed some statistics on few my machines. I saw earlier grafana and was impressed so this was starting point. Then I started reading about graphite, carbon and whisper, and thenâ€¦ I found InfluxDB. Project is young but looks promising.\nInstallation of collectd is easy on Debian because packages are in default repo. One problem is that packages may be old, ex. on wheezy it version 5.1. But in backports/backports-sloppy you may find current 5.5, so enable backports first:\necho \u0026#34;deb http://http.debian.net/debian wheezy-backports main contrib non-free\u0026#34; \u0026gt; /etc/apt/sources.list.d/backports.list echo \u0026#34;deb http://http.debian.net/debian wheezy-backports-sloppy main contrib non-free\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list.d/backports.list Install package:\napt-get update apt-get install -y -t backports-sloppy collectd collectd-utils # or on recent system just apt-get install -y collectd collectd-utils Now edit configuration /etc/collectd/collectd.conf and add network section:\nLoadPlugin network \u0026lt;Plugin \u0026#34;network\u0026#34;\u0026gt; Server \u0026#34;localhost\u0026#34; \u0026#34;8096\u0026#34; \u0026lt;/Plugin\u0026gt; Use your InfluxDB hostname:port.\nNow select and add enable some plugins - list here and restart service:\nservice collectd restart That\u0026rsquo;s all - now install InfluxDB.\nSources https://anomaly.io/collectd-metrics-to-influxdb/\nhttp://backports.debian.org/Instructions/\n","href":"/2016/01/collectd-installation-and-configuration-with-influxdb-on-debianubuntu/","title":"CollectD - installation and configuration with InfluxDB on Debian/Ubuntu"},{"content":"","href":"/tags/letsencrypt/","title":"LetsEncrypt"},{"content":"From the first moment I heard about Let\u0026rsquo;s Encrypt I liked it and wanted to use it as fast as possible. But the more I read how they want to implement it, the more I dislike it.\nCurrent project with automatic configuration is not what I want to use at all. I have many very complicated configs and I do not trust such tools enough to use them. I like UNIX\u0026rsquo;s single purpose principle, tools should do one thing and do it well - nothing more.\nBut there is one neet tool that use Let\u0026rsquo;s Encrypt API only leaving all configuration for me, it\u0026rsquo;s acme-tiny python based script. I won\u0026rsquo;t copy/paste examples - documentation is written pretty well.\n","href":"/2016/01/lets-encrypt-without-auto-configuration/","title":"Letâ€™s Encrypt - without auto configuration"},{"content":"","href":"/tags/openssl/","title":"OpenSSL"},{"content":"","href":"/tags/fail2ban/","title":"fail2ban"},{"content":"Lately I had a lot of brute force attacks on my WordPress blog. I used basic auth to /wp-admin part in nginx configuration to block this and as a better solution I wan\u0026rsquo;t to block source IPs at all on firewall.\nTo do this, place this filter code in /etc/fail2ban/filter.d/wp-login.conf:\n# WordPress brute force wp-login.php filter: # # Block IPs trying to authenticate in WordPress blog # # Matches e.g. # 178.218.54.109 - - [31/Dec/2015:10:39:34 +0100] \u0026#34;POST /wp-login.php HTTP/1.1\u0026#34; 401 188 \u0026#34;-\u0026#34; \u0026#34;Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0\u0026#34; # [Definition] failregex = ^\u0026lt;HOST\u0026gt; .* \u0026#34;POST /wp-login.php ignoreregex = Then edit your /etc/fail2ban/jail.local and add:\n[wp-login] enabled = true port = http,https filter = wp-login logpath = /var/log/nginx/access.log maxretry = 3 Now restart fail2ban:\nservice fail2ban restart All done ðŸ˜„\n","href":"/2015/12/fail2ban-block-wp-login-php-brute-force-attacks/","title":"fail2ban - block wp-login.php brute force attacks"},{"content":"","href":"/tags/ansible/","title":"Ansible"},{"content":"I have some Ansible roles to configure my vps, Raspberry Pi, etc. I like to test them before I broke something on my real, not clustered machines - I use Vagrant for that.\nBut with it I had one problem - in playbooks I define hosts as groups of severs ex. web for my vps:\n- hosts: web gather_facts: True sudo: True ... But testing machine wasn\u0026rsquo;t in this group and when I run vagrant I could only see:\n$ vagrant provision ==\u0026gt; default: Running provisioner: fix-no-tty (shell)... default: Running: inline script ==\u0026gt; default: Running provisioner: ansible... PLAY [web] ******************************************************************** skipping: no hosts matched PLAY RECAP ******************************************************************** To get rid of this I have to add default vagrant machine to my default group in Vagrantfile:\nconfig.vm.provision \u0026#34;ansible\u0026#34; do |ansible| ansible.groups = { \u0026#34;web\u0026#34; =\u0026gt; [\u0026#34;default\u0026#34;] } ansible.sudo = true ansible.limit = \u0026#34;all\u0026#34; ansible.playbook = \u0026#34;web.yml\u0026#34; end And that solved my problem ðŸ˜„\n","href":"/2015/12/ansible-on-vagrant-skipping-no-hosts-matched/","title":"Ansible on Vagrant - skipping: no hosts matched"},{"content":"","href":"/tags/apache/","title":"Apache"},{"content":"Normally you want dynamic content to be fresh and not catchable. But sometimes it may be useful to cache it, like when you have website behind reverse proxy. To do this try something like this:\n\u0026lt;filesmatch \u0026#34;\\.(php|cgi|pl)$\u0026#34;\u0026gt; Header unset Pragma Header unset Expires Header set Cache-Control \u0026#34;max-age=3600, public\u0026#34; \u0026lt;/filesmatch\u0026gt; Sources http://www.askapache.com/htaccess/speed-up-your-site-with-caching-and-cache-control.html\n","href":"/2015/12/apache-force-caching-dynamic-php-content-with-mod_headers/","title":"Apache - Force caching dynamic PHP content with mod_headers"},{"content":"","href":"/tags/vagrant/","title":"Vagrant"},{"content":"","href":"/tags/mariadb/","title":"MariaDB"},{"content":"It will happen from time to time, that you\u0026rsquo;re on alien machine and have to brutally update things in db without knowing credentials. Example is for root (quite secure candidate to change because it shouldn\u0026rsquo;t be used in app ðŸ˜ƒ ) but will work for any user.\n shutdown db  service mysql stop  create text file with command like this (update user accordingly) ex. in /tmp/pwchange.txt  SET PASSWORD FOR \u0026#34;root\u0026#34;@\u0026#34;localhost\u0026#34; = PASSWORD(\u0026#34;HereYourNewPassword\u0026#34;);  start mysqld with --init-file param  mysqld_safe --init-file=/tmp/pwchange.txt sometimes you may require to point configuration file ex. --defaults-file=/etc/mysql/my.cnf\n wait until it loads and kill mysql (ex. Ctrl+C / kill / etc) start mysql  service mysql start  delete file with password  rm -f /tmp/pwchange.txt You should be able to login with updated password.\nSources https://dev.mysql.com/doc/refman/5.5/en/resetting-permissions.html\n","href":"/2015/12/mysql-reset-root-password/","title":"MySQL - reset root password"},{"content":"I hate movies recorded on phone in vertical position. This just short tip how I dealt with with it last time:\nfor m in *.mp4 do avconv -i $m -vf \u0026#34;transpose=1\u0026#34; -codec:a copy -codec:v libx264 -preset slow -crf 23 rotated-$m done Other examples:\nhttp://stackoverflow.com/questions/3937387/rotating-videos-with-ffmpeg\nhttp://superuser.com/questions/578321/how-to-flip-a-video-180Â°-vertical-upside-down-with-ffmpeg\n","href":"/2015/12/rotate-movies/","title":"Rotate movies"},{"content":"I had some passwords saved in remmina but like it always happen, I wasn\u0026rsquo;t been able to remember them when needed. Trying to restore them I found that they\u0026rsquo;re encrypted in .remmina directory.\nThen I used this script to the decrypt them:\nimport base64 from Crypto.Cipher import DES3 secret = base64.decodestring(\u0026#34;\u0026lt;STRING FROM remmina.prefs\u0026gt;\u0026#34;) password = base64.decodestring(\u0026#34;\u0026lt;STRING FROM XXXXXXX.remmina\u0026gt;\u0026#34;) print DES3.new(secret[:24], DES3.MODE_CBC, secret[24:]).decrypt(password) Sources http://askubuntu.com/questions/290824/how-to-extract-saved-password-from-remmina\n","href":"/2015/12/extract-password-saved-in-remmina/","title":"Extract password saved in remmina"},{"content":"After long break I\u0026rsquo;m thinking about writing more on my blog. I was reviewing my favorites/bookmarks and half of them was broken, so I can\u0026rsquo;t rely on them in case of knowledge management.\nI think I will write shorter, less descriptive articles just to be pointers to useful solutions from past.\n","href":"/2015/12/im-back/","title":"Iâ€™m back"},{"content":"Allow from IP without password prompt, and also allow from any address with password prompt\nOrder deny,allow Deny from all AuthName \u0026#34;htaccess password prompt\u0026#34; AuthUserFile /web/askapache.com/.htpasswd AuthType Basic Require valid-user Allow from 172.17.10.1 Satisfy Any Sources http://www.askapache.com/htaccess/apache-authentication-in-htaccess.html\n","href":"/2015/12/apache-authbasic-but-excluding-ip/","title":"Apache AuthBasic but excluding IP"},{"content":"When configuring RAID it\u0026rsquo;s quite important to have the same partition tables on every disk. I\u0026rsquo;v done this many times on msdos partition tables like this:\nsfdisk -d /dev/sda | sfdisk /dev/sdb but it\u0026rsquo;s not working any more on GPT partition tables. Hopefully it still can be done but with different toolstack ðŸ˜„\nInstall gdisk:\napt-get install -y gdisk Then use sgdisk like this:\nsgdisk -R /dev/sd_dest /dev/sd_src sgdisk -G /dev/sd_dest First command will copy partition from /dev/sd_src to /dev/sd_dest. Second will randomize partition UUID\u0026rsquo;s - needed only if you want to use disks in same machine (this is my case).\n","href":"/2014/07/copy-gtp-partiotion-table-between-disks/","title":"Copy GTP partiotion table between disks"},{"content":"","href":"/tags/django/","title":"Django"},{"content":"There is need plugin for Django, named django-debug-toolbar but it needs some time to configure. So when I need simple way to debug SQL queries I use small hack. Add to your settings.py:\nLOGGING = { \u0026#39;version\u0026#39;: 1, \u0026#39;disable_existing_loggers\u0026#39;: False, \u0026#39;handlers\u0026#39;: { \u0026#39;console\u0026#39;: { \u0026#39;level\u0026#39;: \u0026#39;DEBUG\u0026#39;, \u0026#39;class\u0026#39;: \u0026#39;logging.StreamHandler\u0026#39;, } }, \u0026#39;loggers\u0026#39;: { \u0026#39;django.db.backends\u0026#39;: { \u0026#39;handlers\u0026#39;: [\u0026#39;console\u0026#39;], \u0026#39;level\u0026#39;: \u0026#39;DEBUG\u0026#39;, }, } } To get this working DEBUG option have to be set to True:\nDEBUG = True After this setup, when you run you app in development mode:\n./manage.py runserver you will see SQL queries in console output.\nSources https://docs.djangoproject.com/en/1.6/topics/logging/#examples\n","href":"/2014/05/quickly-setup-sql-query-logging-on-console-in-django/","title":"Quickly setup SQL query logging on console in Django"},{"content":"","href":"/tags/centos/","title":"CentOS"},{"content":"On Debian in default installation you have different configuration files for PHP in Apache, FPM, CLI, etc. But on CentOS you have only one php.ini for all of them. In case I have, I need to have different configuration file for scripts running in CLI mode (more memory, etc). I could run it like this:\nphp -c /etc/php-cli.ini script.php But this a little burdensome. So I do it like this:\ncat \u0026gt; /etc/profile.d/php-cli-ini.sh \u0026lt;\u0026lt;SCRIPT #!/bin/bash alias php=\u0026#34;php -c /etc/php-cli.ini\u0026#34; SCRIPT cp /etc/php.ini /etc/php-cli.ini Logout, login and now every user can run PHP scripts in CLI with different configuration - exactly what I need :)\n","href":"/2014/05/changing-default-php-ini-file-for-php-cli-on-centos/","title":"Changing default php.ini file for PHP-CLI on CentOS"},{"content":"Everybody knows passwd command but it\u0026rsquo;s useless when you need to change ex. root password from command line without waiting for input. In such case oneliner below could help:\necho \u0026#34;root:new_password\u0026#34; | chpasswd ","href":"/2014/05/command-to-change-root-password/","title":"Command to change root password"},{"content":"These are few steps to get Steam running on Ubuntu:\nwget -c media.steampowered.com/client/installer/steam.deb dpkg -i steam.deb apt-get install -f apt-get update Solutions for some issues Some time ago I needed 32 bit flash even on 64 bit system - I don\u0026rsquo;t need it currently but I\u0026rsquo;m living this as a tip.\napt-get install adobe-flashplugin:i386 After Ubuntu upgrade I was unable to run Steam anymore - It shouted on me with strange \u0026ldquo;networking problem\u0026rdquo;. I have to clean Steam configuration with:\nsteam --reset Sources http://linuxg.net/how-to-install-the-latest-steam-client-available-on-ubuntu-13-10-13-04-12-10-12-04-and-linux-mint-15-14-13/\nhttp://askubuntu.com/questions/353522/why-is-steam-not-able-to-connect-steam-network\n","href":"/2014/04/install-steam-on-debian-ubuntu/","title":"Install Steam on Debian/Ubuntu"},{"content":"","href":"/tags/fedora/","title":"Fedora"},{"content":"When I was trying to update packages on one host I\u0026rsquo;ve stuck with yum hung on update. I run strace and see:\nstrace -p 43734 Process 43734 attached - interrupt to quit futex(0x807c938, FUTEX_WAIT, 1, NULL \u0026lt;unfinished ...\u0026gt; Process 43734 detached It looks like yum database was corrupted, to repair this run:\nrm -f /var/lib/rpm/__db* rpm --rebuilddb yum clean all yum update Instead rm on db-files you could use gzip to have backup of these files.\n","href":"/2014/04/rebuild-yum-rpm-database/","title":"Rebuild yum/rpm database"},{"content":"","href":"/tags/red-hat/","title":"Red Hat"},{"content":"I\u0026rsquo;ve few Nagios checks that require root privileges but running nrpe as root user is not acceptable. I prefer to use sudo for only these few commands.\nRun visudo and coment out this line:\n#Defaults requiretty This change is crucial to get scripts working.\nThen add at the end of file:\n%nrpe ALL=(ALL) NOPASSWD: /usr/lib64/nagios/plugins/ I\u0026rsquo;ve used nrpe group, but you have to add exactly group that your nrpe process uses.\nNow you should be able to run checks as root - edit /etc/nagios/nrpe.cfg and add check like this:\ncommand[check_as_root]=/usr/bin/sudo /usr/lib64/nagios/plugins/check_with_root_privileges ","href":"/2014/03/nagios-run-checks-as-root-with-nrpe/","title":"Nagios - run checks as root with NRPE"},{"content":"","href":"/tags/seo/","title":"SEO"},{"content":"After reading some SEO stuff I wanted to add some meta tags to my WordPress blog. I found this site: codex.wordpress.org/Meta_Tags_in_WordPress.\nSo WordPress thinks that it\u0026rsquo;s not necessary to have this meta tags any more\u0026hellip; But I want it! ðŸ˜ƒ Next funny thing is how they suggest to add meta tags: copy header.php - what about theme updates?\nI prefer to use functions.php file - just create it in your courrent theme directory with such content:\n\u0026lt;?php // this will remove WordPress version from header remove_action(\u0026#39;wp_head\u0026#39;, \u0026#39;wp_generator\u0026#39;); // handler function for adding custom tags function custom_header_meta() { ?\u0026gt;\u0026lt;meta name=\u0026#34;author\u0026#34; content=\u0026#34;Tomasz GÄ…gor\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;contact\u0026#34; content=\u0026#34;my@mail.com\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026lt;?php wp_title( \u0026#39;|\u0026#39;, true, \u0026#39;right\u0026#39; ); ?\u0026gt;\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;keywords\u0026#34; content=\u0026#34;some keywords\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;verify-v1\u0026#34; content=\u0026#34;google webmaster identification\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;msvalidate.01\u0026#34; content=\u0026#34;bing webmaster identification\u0026#34; /\u0026gt; \u0026lt;meta property=\u0026#34;fb:admins\u0026#34; content=\u0026#34;facebook identificatio\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;copyright\u0026#34; content=\u0026#34;Copyright (c)1997-2014 Tomasz GÄ…gor. All Rights Reserved.\u0026#34; /\u0026gt; \u0026lt;?php } // running handler function add_action(\u0026#39;wp_head\u0026#39;, \u0026#39;custom_header_meta\u0026#39;); ","href":"/2014/03/wordpress-add-meta-tags-author-description-keywords-etc/","title":"WordPress - add meta tags: author, description, keywords, etc"},{"content":"","href":"/tags/mediawiki/","title":"MediaWiki"},{"content":"Let say you have MediaWiki installation but you lost admin credentials. If you have other account or if you could create one without any rights we\u0026rsquo;re in home ðŸ˜‰\nWe have few options to do this.\nReset admin password We have to connect to database and use this SQL:\nUPDATE `user` SET user_password = CONCAT( SUBSTRING(user_password, 1, 3), SUBSTRING(MD5(user_name), 1, 8), \u0026#39;:\u0026#39;, MD5(CONCAT(SUBSTRING(MD5(user_name), 1, 8), \u0026#39;-\u0026#39;, MD5(\u0026#39;new password\u0026#39;)))) WHERE user_name = \u0026#39;Admin\u0026#39;; Just replace Admin with your username and new password with your password.\nRaise another user rights If we don\u0026rsquo;t want to mess with admin account we could raise permissions for other user, ex. Tom:\nINSERT INTO user_groups (ug_user, ug_group) VALUES( SELECT user_id FROM user WHERE user_name = \u0026#39;Tom\u0026#39;, \u0026#39;bureaucrat\u0026#39;); INSERT INTO user_groups (ug_user, ug_group) VALUES( SELECT user_id FROM user WHERE user_name = \u0026#39;Tom\u0026#39;, \u0026#39;sysop\u0026#39;); Sources http://www.mediawiki.org/wiki/Manual_talk:Resetting_passwords\nhttp://www.mediawiki.org/wiki/Manual_talk:AdminSettings.php\n","href":"/2014/03/mediawiki-recover-admin-rights/","title":"Mediawiki - recover admin rights"},{"content":"I need to check memory usage of memcached server so I used:\necho stats | nc 127.0.0.1 11211 STAT pid 2743 STAT uptime 263 STAT time 1395438951 STAT version 1.4.13 STAT pointer_size 64 STAT rusage_user 0.482926 STAT rusage_system 2.675593 STAT curr_items 8667 STAT total_items 10742 STAT bytes 23802513 STAT curr_connections 296 STAT total_connections 399 STAT connection_structures 297 STAT cmd_flush 0 STAT cmd_get 52578 STAT cmd_set 10792 STAT get_hits 28692 STAT get_misses 23886 STAT evictions 0 STAT bytes_read 35984361 STAT bytes_written 192647437 STAT limit_maxbytes 536870912 STAT threads 2 STAT accepting_conns 1 STAT listen_disabled_num 0 STAT replication MASTER STAT repcached_qi_free 8189 STAT repcached_wdata 0 STAT repcached_wsize 1026048 END For me, bytes value was important but you could find more about all statistics here.\n","href":"/2014/03/checking-memcached-status/","title":"Checking memcached status"},{"content":"","href":"/tags/memcached/","title":"memcached"},{"content":"","href":"/tags/postfix/","title":"postfix"},{"content":"I have development server with postfix - I wanted to allow outbound traffic to one domain but cut off all the rest. I definitely do not want that test mail or any debug info goes to service users.\nI have to add something like that to /etc/postfix/transport:\nallowed.domain.com : * discard: Then run:\npostmap /etc/postfix/transport At end, add these to /etc/postfix/main.cf:\ntransport_maps = hash:/etc/postfix/transport Reload postfix:\npostfix reload Test if it works:\necho test | mail -s test whatever@whatever.com You should see in logs that message was dropped:\nMar 18 21:14:28 devmx1 postfix/cleanup[29968]: 1E77654391: message-id=20140318211428.1E77280521@domain.com\u0026gt; Mar 18 21:14:28 devmx1 postfix/qmgr[28282]: 1E77654391: from=\u0026lt;root@domain.com\u0026gt;, size=431, nrcpt=1 (queue active) Mar 18 21:14:28 devmx1 postfix/discard[29970]: 1E77654391: to=\u0026lt;whatever@whatever.com\u0026gt;, relay=none, delay=0.1, delays=0.09/0.01/0/0, dsn=2.0.0, status=sent (whatever.com) Mar 18 21:14:28 devmx1 postfix/qmgr[28282]: 1E77654391: removed ","href":"/2014/03/postfix-automatically-drop-outbound-mail/","title":"Postfix - automatically drop outbound mail"},{"content":"In recent Ansible update to 1.5 version there is really nice feature ssh pipelining. This option is serious alternative to accelerated mode.\nJust add to you config file (ex. ~/.ansible.cfg):\n[ssh_connection] pipelining=True Now run any playbook - you will see the difference ðŸ˜„\nSource (and extended info about):\nhttp://blog.ansibleworks.com/2014/01/15/ssh-connection-upgrades-coming-in-ansible-1-5/\n","href":"/2014/03/ansible-ssh-pipelining/","title":"Ansible - ssh pipelining"},{"content":"","href":"/tags/devops/","title":"DevOps"},{"content":"To najlepszy przepis na chrusty jaki znam - wychodzÄ… bardzo kruche i delikatne.\nSkÅ‚adniki  4 zÃ³Å‚tka, 4 Å‚yÅ¼ki wina biaÅ‚ego lub czerwonego, 4 Å‚yÅ¼ki mÄ…ki.  SposÃ³b przygotowania Wszystkie skÅ‚adniki wymieszaÄ‡ i wyrobiÄ‡. Ciasto powinno byÄ‡ mniej wiecej takie jak na pierogi. BiÄ‡ paÅ‚kÄ…/waÅ‚kiem, skÅ‚adaÄ‡ na pÃ³Å‚ i tak kilka razy przez ok 5 minut. Potem ciasto rozwaÅ‚kowaÄ‡ bardzo cieniutko i wykrawaÄ‡ chrusty, maÅ‚e bo mocno rosnÄ…. NastÄ™pnie wrzucaÄ‡ na rozgrzany olej/smalec.\n","href":"/2014/02/chrusty-faworki/","title":"Chrusty, faworki"},{"content":"","href":"/categories/gotowanie/","title":"Gotowanie"},{"content":"I had quite simple task - compare two lists of hosts and check if hosts from first one are also on the second one. I started with diff:\ndiff -u biglist.txt hosts_to_check.txt | grep -E \u0026#34;^\\+\u0026#34; It was fine but output needs some filtering to get what I want.\nI\u0026rsquo;ve found another example with grep:\ngrep -Fxv -f biglist.txt hosts_to_check.txt | sort -n This will search for all lines in hosts_to_check.txt which don\u0026rsquo;t match any line in biglist.txt. So after this I\u0026rsquo;ve got list of hosts that I have to check. That\u0026rsquo;s exactly what I need ðŸ˜„\n","href":"/2014/02/comparing-two-lists-in-bash/","title":"Comparing two lists in bash"},{"content":"","href":"/tags/active-directory/","title":"Active Directory"},{"content":"After WSUS installing on Windows Server 2012 I discovered that it\u0026rsquo;s running on port 8530, different than on older version of Windows (it was using port 80 from beginning). But what\u0026rsquo;s more interesting it was running ONLY on IPv6 interface! Switching binding configuration in IIS doesn\u0026rsquo;t help.\nI could stand switching port - it\u0026rsquo;s nothing hard with GPO, but IPv6 only configuration was not acceptable.\nAfter googling for some time I found one command that solved my problems by switching WSUS to older behavior and run it on port 80 (on default website).\nJust run on elevated command line:\nC:\\Program Files\\Update Services\\Tools\\WSUSutil usecustomwebsite false After half a minute WSUS was working like a charm ðŸ˜ƒ\nSources http://social.technet.microsoft.com/Forums/windowsserver/en-US/88514e56-1179-4af7-9f5e-5339d3e750a5/how-to-change-wsus-2012-port-to-80?forum=winserverwsus\nhttp://community.spiceworks.com/topic/160971-how-do-you-change-the-port-number-for-your-wsus\n","href":"/2014/01/change-default-wsus-port-from-8530-to-80-on-windows-server-2012/","title":"Change default WSUS port from 8530 to 80 on Windows Server 2012"},{"content":"After reading some good opinions about MariaDB I wanted to give it a try. Upgrade looks quite straight forward but I found some issues a little tricky.\nInstallation Add repo and key:\ncat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;SRC deb http://mirrors.supportex.net/mariadb/repo/5.5/debian wheezy main deb-src http://mirrors.supportex.net/mariadb/repo/5.5/debian wheezy main SRC (find more repositories here)\nNow install MariaDB:\nsudo apt-get update sudo apt-get install mariadb-server It could be better to install mariadb-server-5.5 and mariadb-client-5.5 package instead, because of this error.\nMariaDB repo pinning Some time after installation I have problem with newer packages from Debian repositories that upgraded my MariaDB installation back to MySQL - it\u0026rsquo;s described here, so I used pinning to resolve that.\ncat \u0026gt; /etc/apt/preferences.d/mariadb.pref \u0026lt;\u0026lt;PIN Package: * Pin: origin mirrors.supportex.net Pin-Priority: 1000 PIN Results Before migration to MariaDB, front page of my blog needs about 650 ms to generate. After switch, it was only about 550ms. So it\u0026rsquo;s about 15% - absolutely for free ðŸ˜„\n","href":"/2014/01/debian-upgrade-mysql-to-mariadb/","title":"Debian - Upgrade MySQL to MariaDB"},{"content":"I was thinking about allowing access to my website using SPDY protocol for better performance and security (and for fun of course ðŸ˜ƒ ). But SPDY have one disadvantage - you need SSL certificate signed by known authority that will verfiy in common browsers. So you can\u0026rsquo;t use self signed certificates because everyone will see a warning entering your site. Certs are quite expensive so I started searching for free one and to my surprise I found such!\nI found these two sites where you can generate freeware certificates for your website:\n https://www.startssl.com/ (I prefer this one because it better recognized) https://www.cacert.org  I wouldn\u0026rsquo;t trust these certification authorities enough to use it for: access my mail or other private data. But I\u0026rsquo;m fine with using it for my public websites (like my blog) to gain speed from SPDY.\nConfiguring cert Fetch the Root CA and Class 1 Intermediate Server CA certificates:\nwget http://www.startssl.com/certs/ca.pem wget http://www.startssl.com/certs/sub.class1.server.ca.pem Create a unified certificate from your certificate and the CA certificates:\ncat ssl.crt sub.class1.server.ca.pem ca.pem \u0026gt; /etc/nginx/conf/ssl-unified.crt Enable SPDY Configure your nginx server to use the new key and certificate (in the global settings or a server section):\nssl on; ssl_certificate /etc/nginx/conf/ssl-unified.crt; ssl_certificate_key /etc/nginx/conf/ssl.key; Then enable SPDY like that:\nserver { listen your_ip:80; listen your_id:443 default_server ssl spdy; # other stuff } Advertise SPDY protocol Now advertise SPDY with Alternate-Protocol header - add this clause in main location:\nadd_header Alternate-Protocol \u0026#34;443:npn-spdy/2\u0026#34;; Have fun with SPDY on your site ðŸ˜„\n","href":"/2014/01/nginx-enabling-spdy-with-freeware-certificate/","title":"Nginx - enabling SPDY with freeware certificate"},{"content":"I\u0026rsquo;ve been using different code editors for different purposes. Gedit was fine for small scripts but not for bigger projects. It lacks intelligent code completion (function/class names, etc.). I was searching for convenient editor for Python, Perl, Ruby with support for frameworks like Django, Rails, etc. I know Sublime Text - but it\u0026rsquo;s paid. There is LimeText - open source clone, but it\u0026rsquo;s not ready to be used on daily basics.\nI found Brackets - open source editor designed by Adobe. I\u0026rsquo;m testing it right now.\nBrackets installation on Ubuntu sudo add-apt-repository ppa:webupd8team/brackets sudo apt-get update sudo apt-get install brackets Source http://www.webupd8.org/2013/11/install-brackets-in-ubuntu-via-ppa-open.html\nI was using Brackets for some time and while it\u0026rsquo;s really nice editor - it\u0026rsquo;s mostly designed for webmasters (writing web apps). But I also need to write in Ruby, Python, Perl and many other - then Github announced Atom editor. I switched to Atom - it\u0026rsquo;s similar to Brackets but covers my interests better ðŸ™‚\nAtom installation on Ubuntu Similarly to Brackets installation. Add ppa and install:\nsudo add-apt-repository ppa:webupd8team/atom sudo apt-get update sudo apt-get install -y atom Atom plugins I use Atom is great because of all plugins available - my favorite are:\n language-docker (Dockerfile syntax highlighting) language-terraform (Terraform files syntax highlighting) language-python autocomplete-python (with Kite) linter-foodcritic linter-python-pep8 linter-rubocop minimap tabs-to-spaces  Atom themes I use Default dark theme in Atom is really nice - but there are better themes. My favorite are:\n UI Theme: seti-ui Syntax theme: Monokai  ","href":"/2014/01/searching-for-better-code-editor/","title":"Searching for better code editor"},{"content":"","href":"/tags/spdy/","title":"SPDY"},{"content":"","href":"/tags/windows/","title":"Windows"},{"content":"","href":"/tags/wsus/","title":"WSUS"},{"content":"After connecting few computers with Windows 8.1 to domain we found that these computers are not recognized or recognized as Windows 6.3 (which is true) on WSUS 3.0 running on Windows Server 2008. The bad thing was that they can\u0026rsquo;t properly report to WSUS and get updates from it.\nI found that there are two updates that have to be installed (but they\u0026rsquo;re not working without additional steps):\n http://support.microsoft.com/kb/2720211 http://support.microsoft.com/kb/2734608  After installation of second update there are two additional steps that have to be performed to get WSUS working:\n Reindex the WSUS Database Use the Server Cleanup Wizard - this one is trivial, so I hope you get this right  Reindex the WSUS Database To do this perform these steps:\n Copy sript from this site to file named WsusDBMaintenance.sql Install sqlcmd from this site - search for file named like \u0026ldquo;SQLServer2005_SQLCMD\u0026rdquo; with proper architecture (x86/amd64/ia64) run: sqlcmd -S np:\\\\.\\pipe\\MSSQL$MICROSOFT##SSEE\\sql\\query -i C:\\path to script saved in first point\\WsusDBMaintenance.sql  Use WSUS Server Cleanup Wizard  Done. Your WSUS will not recognize 8.1 clients but will work with them and serve updates.\nSources http://social.technet.microsoft.com/Forums/en-US/559fe878-e2a2-4ec6-9d91-55ea1b67caef/manage-windows-81-windows-server-2012-r2-on-wsus-30?forum=winserverwsus\n","href":"/2014/01/manage-windows-8-1-and-windows-server-2012-r2-in-wsus-3-0/","title":"Manage Windows 8.1 and Windows Server 2012 R2 in WSUS 3.0"},{"content":"I love Shotwell for it\u0026rsquo;s simplicity and easy export to Piwigo. After Christmas I added new photos to my library but after that I made some modifications to them (red eye reduction, etc\u0026hellip;). Because Shotwell generate thumbnails only on import, all my modifications were not visible on preview.\nI\u0026rsquo;ve started searching how to regenerate thumbs and found this info. There were two issues with this method:\n this howto was for old version (with old paths) and only for 128px thumbs I definitely don\u0026rsquo;t want to regenerate thumbnails for 40k photos!  After some tweaking this will do work for thumbnails from last month (enough for me):\nsqlite3 ~/.local/share/shotwell/data/photo.db \\  \u0026#34;select id||\u0026#39; \u0026#39;||filename from PhotoTable where date(timestamp,\u0026#39;unixepoch\u0026#39;,\u0026#39;localtime\u0026#39;) \u0026gt; date(\u0026#39;now\u0026#39;,\u0026#39;start of month\u0026#39;,\u0026#39;-1 month\u0026#39;) order by timestamp desc\u0026#34; | while read id filename; do tf1=$(printf ~/.local/share/shotwell/thumbs/thumbs128/thumb%016x.jpg $id); tf2=$(printf ~/.local/share/shotwell/thumbs/thumbs360/thumb%016x.jpg $id); test -e \u0026#34;$tf\u0026#34; || { echo -n \u0026#34;Generating thumb for $filename\u0026#34;; convert \u0026#34;$filename\u0026#34; -auto-orient -thumbnail 128x128 $tf1 convert \u0026#34;$filename\u0026#34; -auto-orient -thumbnail 360x360 $tf2 echo } done Remember to install imagemagick:\napt-get install imagemagick ","href":"/2014/01/regenerate-thumbnails-in-shotwell-for-last-month/","title":"Regenerate thumbnails in Shotwell 0.15 (for last month)"},{"content":"","href":"/tags/javascript/","title":"Javascript"},{"content":"Few days ago I\u0026rsquo;ve read a book â€˜Even Faster Web Sitesâ€˜ about websites optimisation and I found one thing usefuluseful, not only on websites. There was a small tip about looploop unlooping. I want to quote them for later use.\nFirst - with switch statement var iterations = Math.ceil(values.length / 8); var startAt = values.length % 8; var i = 0; do { switch(startAt) { case 0: process(values[i++]); case 7: process(values[i++]); case 6: process(values[i++]); case 5: process(values[i++]); case 4: process(values[i++]); case 3: process(values[i++]); case 2: process(values[i++]); case 1: process(values[i++]); } startAt = 0; } while(--iterations \u0026gt; 0); Second - without switch var iterations = Math.floor(values.length / 8); var leftover = values.length % 8; var i = 0; if(leftover \u0026gt; 0) { do { process(values[i++]); } while(--leftover \u0026gt; 0); } do { process(values[i++]); process(values[i++]); process(values[i++]); process(values[i++]); process(values[i++]); process(values[i++]); process(values[i++]); process(values[i++]); } while (--iterations \u0026gt; 0); I found second example more readable and I prefer it.\nThese examples after translation could be easily used in other scripting languages.\n","href":"/2014/01/loop-unlooping-in-javascript/","title":"Loop unlooping in Javascript"},{"content":"Some time ago I write article about tracking nicknames of users (from comments) on a WordPress blog with Piwik. This time I\u0026rsquo;m doing same but for Google Analytics.\nI\u0026rsquo;m using Google Analytics plugin for WordPress so I\u0026rsquo;ve edited googleanalytics.php file to add some additional code for user tracking:\n\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; var i,x,y,ARRcookies=document.cookie.split(\u0026#34;;\u0026#34;); var comment_author = \u0026#34;\u0026#34;; for (i=0;i\u0026lt;ARRcookies.length;i++) { x=ARRcookies[i].substr(0,ARRcookies[i].indexOf(\u0026#34;=\u0026#34;)); y=ARRcookies[i].substr(ARRcookies[i].indexOf(\u0026#34;=\u0026#34;)+1); x=x.replace(/^\\s+|\\s+$/g,\u0026#34;\u0026#34;); if (x.indexOf(\u0026#34;comment_author\u0026#34;) != -1 \u0026amp;\u0026amp; x.indexOf(\u0026#34;comment_author_email\u0026#34;) == -1 \u0026amp;\u0026amp; x.indexOf(\u0026#34;comment_author_url\u0026#34;) == -1) { comment_author = unescape(y); } } var _gaq = _gaq || []; _gaq.push([\u0026#39;_setAccount\u0026#39;, \u0026#39;UA-YOUR-UNIQ-NUMBER\u0026#39;]); _gaq.push([\u0026#39;_setCustomVar\u0026#39;, 1, \u0026#39;Nickname\u0026#39;, comment_author, 1]); _gaq.push([\u0026#39;_trackPageview\u0026#39;]); (function() { var ga = document.createElement(\u0026#39;script\u0026#39;); ga.type = \u0026#39;text/javascript\u0026#39;; ga.async = true; ga.src = (\u0026#39;https:\u0026#39; == document.location.protocol ? \u0026#39;https://ssl\u0026#39; : \u0026#39;http://www\u0026#39;) + \u0026#39;.google-analytics.com/ga.js\u0026#39;; var s = document.getElementsByTagName(\u0026#39;script\u0026#39;)[0]; s.parentNode.insertBefore(ga, s); })(); \u0026lt;/script\u0026gt; Source https://developers.google.com/analytics/devguides/collection/gajs/gaTrackingCustomVariables?hl=pl\n","href":"/2014/01/tracking-users-by-nickname-on-wordpress-using-google-analytics/","title":"Tracking users by nickname on WordPress using Google Analytics"},{"content":"Some time ago I\u0026rsquo;ve show how to precompress js and css file with gzip to be available for Nginx\u0026rsquo;s mod_gzip. In default configuration Apache don\u0026rsquo;t have such module but similar functionality could be achieved with few custom rewirtes.\nBasically we will start with these rewrites to serve gzipped CSS/JS files if they exist and the client accepts gzip compression:\nRewriteEngine on RewriteCond %{HTTP:Accept-encoding} gzip RewriteCond %{REQUEST_FILENAME}\\.gz -s RewriteRule ^(.*)\\.(js|css)$ $1\\.$2\\.gz [QSA] Then we need to setup proper content types for such compressed files - I know how to do this in two ways:\n pure rewrites with mod_header - witch should serve correct content type and prevent mod_deflate to gzip files that are already gzipped RewriteRule \\.css\\.gz$ - [T=text/css,E=no-gzip:1,E=manualgzip:1] RewriteRule \\.js\\.gz$ - [T=text/javascript,E=no-gzip:1,E=manualgzip:1] \u0026lt;ifmodule mod_headers.c\u0026gt; # setup this header only if rewrites above were used Header set Content-Encoding \u0026#34;gzip\u0026#34; env=manualgzip \u0026lt;/ifmodule\u0026gt;  by using Files clause (we could add this globally in httpd.conf) \u0026lt;files *.css.gz\u0026gt; ForceType text/css Header set Content-Encoding \u0026#34;gzip\u0026#34; \u0026lt;/files\u0026gt; \u0026lt;files *.js.gz\u0026gt; #ForceType text/javascript # lately this one is more popular ForceType application/javascript Header set Content-Encoding \u0026#34;gzip\u0026#34; \u0026lt;/files\u0026gt;   Both ways work fine. First one sets no-gzip variable to bypass second time compression. Second one rely on such option in my mod_deflate\u0026rsquo;s config:\nSetEnvIfNoCase Request_URI \\.(?:exe|t?gz|zip|bz2|sit|rar|gz)$ no-gzip dont-vary which won\u0026rsquo;t compress any gz file, and this is why I have to setup Content-Encoding to gzip manually.\nIn both cases you will end with javacript and CSS files served from earlier prepared precomressed versions, with proper content type without engaging mod_deflate regardless you use js/css or js.gz/css.gz extension. But I strongly suggest to use extensions without gz - you will be able to disable this mechanism without any change in website code.\nIf you don\u0026rsquo;t know how to prepare files just look here.\nP.S.\nI found another similar but BAD example - it\u0026rsquo;s using AddEncoding clause to add gzip content type to ALL gzip files - this will cause problems with other compressed files with gz extension ex. tar.gz. Don\u0026rsquo;t do this. My rules above are more selective.\nSources http://stackoverflow.com/questions/7947906/add-expiry-headers-using-apache-for-paths-which-dont-exist-in-the-filesystem http://stackoverflow.com/questions/9076752/how-to-force-apache-to-use-manually-pre-compressed-gz-file-of-css-and-js-files\n","href":"/2013/12/apache-precompressing-static-files-with-gzip/","title":"Apache - precompressing static files with gzip"},{"content":"","href":"/tags/mod_rewrite/","title":"mod_rewrite"},{"content":"","href":"/tags/android/","title":"Android"},{"content":"I\u0026rsquo;m happy owner of Galaxy Nexus 7 and lately I updated my tablet to Android 4.4 Kitkat. One of features I most expected was ability to block some permissions of some applications. Such setting was available in 4.4 version but was removed in latest 4.4.2 - Google didn\u0026rsquo;t explain it exactly why. I don\u0026rsquo;t like when for ex. game need: camera or GPS access - for what I asked?\nBut there is new app so called App Ops that unhides build-in interface allowing edit of application permissions. I strongly suggest to install it.\nRequirements You will need rooted device with Android 4.3 or 4.4 version.\nThis instruction could brick your device - use it on your own responsibility.\nInstall Xposed Read instructions here: http://forum.xda-developers.com/showthread.php?t=1574401 (because installation of this package have in history some bricked devices).\n download the Xposed Installer APK and install it launch the Xposed Installer and go to the \u0026ldquo;Framework\u0026rdquo; section, then click on \u0026ldquo;Install/Update\u0026rdquo; reboot your device  Install App Ops Read instructions here: http://forum.xda-developers.com/showthread.php?t=2564865\n download newest version from here, for now it will be AppOpsXposed-1.5 install it search for new App ops option in Settings under PERSONAL section  ","href":"/2013/12/android-xposed-appops-reclaim-control-over-installed-applications-permissions/","title":"Android: Xposed + AppOps - reclaim control over installed applications permissions"},{"content":"After the last NSA scandal I\u0026rsquo;ve found some time to read some texts about PFS and ECDSA keys lately. I always used RSA keys but wanted to give a try to ECDSA so I wanted to give it a try (test performance, etc). Here is how I\u0026rsquo;ve done it.\nFirstly find your favorite curve. A short tip about bit length and complexity could be found here. From it you will now that using 256 bit ECDSA key should be enough for next 10-20 years.\n$ openssl ecparam -list_curves secp112r1 : SECG/WTLS curve over a 112 bit prime field secp112r2 : SECG curve over a 112 bit prime field secp128r1 : SECG curve over a 128 bit prime field secp128r2 : SECG curve over a 128 bit prime field secp160k1 : SECG curve over a 160 bit prime field secp160r1 : SECG curve over a 160 bit prime field secp160r2 : SECG/WTLS curve over a 160 bit prime field secp192k1 : SECG curve over a 192 bit prime field secp224k1 : SECG curve over a 224 bit prime field secp224r1 : NIST/SECG curve over a 224 bit prime field secp256k1 : SECG curve over a 256 bit prime field secp384r1 : NIST/SECG curve over a 384 bit prime field secp521r1 : NIST/SECG curve over a 521 bit prime field prime192v1: NIST/X9.62/SECG curve over a 192 bit prime field prime192v2: X9.62 curve over a 192 bit prime field prime192v3: X9.62 curve over a 192 bit prime field prime239v1: X9.62 curve over a 239 bit prime field prime239v2: X9.62 curve over a 239 bit prime field prime239v3: X9.62 curve over a 239 bit prime field prime256v1: X9.62/SECG curve over a 256 bit prime field sect113r1 : SECG curve over a 113 bit binary field sect113r2 : SECG curve over a 113 bit binary field sect131r1 : SECG/WTLS curve over a 131 bit binary field sect131r2 : SECG curve over a 131 bit binary field sect163k1 : NIST/SECG/WTLS curve over a 163 bit binary field sect163r1 : SECG curve over a 163 bit binary field sect163r2 : NIST/SECG curve over a 163 bit binary field sect193r1 : SECG curve over a 193 bit binary field sect193r2 : SECG curve over a 193 bit binary field sect233k1 : NIST/SECG/WTLS curve over a 233 bit binary field sect233r1 : NIST/SECG/WTLS curve over a 233 bit binary field sect239k1 : SECG curve over a 239 bit binary field sect283k1 : NIST/SECG curve over a 283 bit binary field sect283r1 : NIST/SECG curve over a 283 bit binary field sect409k1 : NIST/SECG curve over a 409 bit binary field sect409r1 : NIST/SECG curve over a 409 bit binary field sect571k1 : NIST/SECG curve over a 571 bit binary field sect571r1 : NIST/SECG curve over a 571 bit binary field c2pnb163v1: X9.62 curve over a 163 bit binary field c2pnb163v2: X9.62 curve over a 163 bit binary field c2pnb163v3: X9.62 curve over a 163 bit binary field c2pnb176v1: X9.62 curve over a 176 bit binary field c2tnb191v1: X9.62 curve over a 191 bit binary field c2tnb191v2: X9.62 curve over a 191 bit binary field c2tnb191v3: X9.62 curve over a 191 bit binary field c2pnb208w1: X9.62 curve over a 208 bit binary field c2tnb239v1: X9.62 curve over a 239 bit binary field c2tnb239v2: X9.62 curve over a 239 bit binary field c2tnb239v3: X9.62 curve over a 239 bit binary field c2pnb272w1: X9.62 curve over a 272 bit binary field c2pnb304w1: X9.62 curve over a 304 bit binary field c2tnb359v1: X9.62 curve over a 359 bit binary field c2pnb368w1: X9.62 curve over a 368 bit binary field c2tnb431r1: X9.62 curve over a 431 bit binary field wap-wsg-idm-ecid-wtls1: WTLS curve over a 113 bit binary field wap-wsg-idm-ecid-wtls3: NIST/SECG/WTLS curve over a 163 bit binary field wap-wsg-idm-ecid-wtls4: SECG curve over a 113 bit binary field wap-wsg-idm-ecid-wtls5: X9.62 curve over a 163 bit binary field wap-wsg-idm-ecid-wtls6: SECG/WTLS curve over a 112 bit prime field wap-wsg-idm-ecid-wtls7: SECG/WTLS curve over a 160 bit prime field wap-wsg-idm-ecid-wtls8: WTLS curve over a 112 bit prime field wap-wsg-idm-ecid-wtls9: WTLS curve over a 160 bit prime field wap-wsg-idm-ecid-wtls10: NIST/SECG/WTLS curve over a 233 bit binary field wap-wsg-idm-ecid-wtls11: NIST/SECG/WTLS curve over a 233 bit binary field wap-wsg-idm-ecid-wtls12: WTLS curvs over a 224 bit prime field Oakley-EC2N-3: IPSec/IKE/Oakley curve #3 over a 155 bit binary field. Not suitable for ECDSA. Questionable extension field! Oakley-EC2N-4: IPSec/IKE/Oakley curve #4 over a 185 bit binary field. Not suitable for ECDSA. Questionable extension field! Now generate new private key with chosen curve (prime256v1 looks fine, like: c2pnb272w1, sect283k1, sect283r1 or secp256k1, etc)\n$ openssl ecparam -out ec_key.pem -name prime256v1 -genkey And generate self-signed certificate that could be directly used:\n$ openssl req -new -key ec_key.pem -x509 -nodes -days 365 -out cert.pem You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Country Name (2 letter code) [AU]:PL State or Province Name (full name) [Some-State]:example.pl Locality Name (eg, city) []:example.pl Organization Name (eg, company) [Internet Widgits Pty Ltd]:example.pl Organizational Unit Name (eg, section) []:example.pl Common Name (e.g. server FQDN or YOUR name) []:example.pl Email Address []:hostmaster@example.pl ","href":"/2013/12/generate-ecdsa-key-with-openssl/","title":"Generate ECDSA key with OpenSSL"},{"content":"Lately I tried to remove some streams from MKV file - I wanted: video, audio in my language and no subtitles. I achieved it with mkvtoolnix utils.\nFirstly I have to identify streams in file:\n$ mkvmerge -i input_file.mkv File \u0026#39;test.mkv\u0026#39;: container: Matroska Track ID 0: video (V_MPEG4/ISO/AVC) Track ID 1: audio (A_DTS) Track ID 2: audio (A_AC3) Track ID 3: audio (A_DTS) Track ID 4: audio (A_AC3) Track ID 5: subtitles (S_TEXT/UTF8) Track ID 6: subtitles (S_TEXT/UTF8) Chapters: 16 entries You could use more verbose tool mkvinfo for that purpose too.\nNow we know what to do next:\n$ mkvmerge -o out.mkv -d 0 --audio-tracks 2 --no-subtitles input_file.mkv mkvmerge v6.3.0 (\u0026#39;You can\u0026#39;t stop me!\u0026#39;) built on Jun 29 2013 11:48:33 \u0026#39;test.mkv\u0026#39;: Using the demultiplexer for the format \u0026#39;Matroska\u0026#39;. \u0026#39;test.mkv\u0026#39; track 0: Using the output module for the format \u0026#39;AVC/h.264\u0026#39;. \u0026#39;test.mkv\u0026#39; track 2: Using the output module for the format \u0026#39;AC3\u0026#39;. The file \u0026#39;out.mkv\u0026#39; has been opened for writing. Progress: 100% The cue entries (the index) are being written... Muxing took 3 minutes 10 seconds. This is the fastest way - no need for conversion of any stream.\nSource: http://bunin.livejournal.com/357913.html\n","href":"/2013/12/delete-audio-track-from-mkv-file/","title":"Delete audio track from mkv file"},{"content":"Some time ago I prepared a PC that was responsible for batch encoding of movies to formats suitable for web players (such as. Video.js, JW Player, Flowplayer, etc.)\nI used HandBrake for conversion to MP4 format (becase this soft was the fastest one) and ffmpeg (aka avconv in new version) for two pass encoding to WEBM.\nBelow are commands used by me for that conversion:\n MP4  HandBrakeCLI -e x264 -q 20.0 -a 1 -E faac -B 64 -6 mono -R 44.1 -D 0.0 -f mp4 --strict-anamorphic -m -x ref=1:weightp=1:subq=2:rc-lookahead=10:trellis=0:8x8dct=0 -O -i \u0026#34;input_file.avi\u0026#34; -o \u0026#34;output_file.mp4\u0026#34;  WEBM  avconv -y -i \u0026#34;input_file.avi\u0026#34; -codec:v libvpx -b:v 600k -qmin 10 -qmax 42 -maxrate 500k -bufsize 1000k -threads 4 -an -pass 1 -f webm /dev/null avconv -y -i \u0026#34;input_file.avi\u0026#34; -codec:v libvpx -b:v 600k -qmin 10 -qmax 42 -maxrate 500k -bufsize 1000k -threads 4 -codec:a libvorbis -b:a 96k -pass 2 -f webm \u0026#34;output_file.webm\u0026#34; Nginx configuration for MP4 I used configuration similar to that below for MP4 pseudostreaming and to protect direct urls to videos from linking on other sites (links will expire after sometime). There is also example usage of limit_rate clause that will slow down downloading of a file (it\u0026rsquo;s still two times bigger than video streaming speed so should be enough).\nlocation ~ \\.m(p4|4v)$ { ## This must match the URI part related to the MD5 hash and expiration time.  secure_link $arg_ticket,$arg_e; ## The MD5 hash is built from our secret token, the URI($path in PHP) and our expiration time.  secure_link_md5 somerandomtext$uri$arg_e; ## If the hash is incorrect then $secure_link is a null string.  if ($secure_link = \u0026#34;\u0026#34;) { return 403; } ## The current local time is greater than the specified expiration time.  if ($secure_link = \u0026#34;0\u0026#34;) { return 403; } ## If everything is ok $secure_link is 1.  mp4; mp4_buffer_size 10m; mp4_max_buffer_size 1024m; limit_rate 1024k; limit_rate_after 5m; } Sources http://nginx.org/en/docs/http/ngx_http_mp4_module.html\nhttp://wiki.nginx.org/HttpSecureLinkModule\n","href":"/2013/12/preparing-video-files-for-streaming-on-website-in-mp4-and-webm-format/","title":"Preparing video files for streaming on website in MP4 and WEBM format"},{"content":"SPDY is new protocol proposed by Google as an alternative for HTTP(S). Currently Chrome and Firefox browsers are using it as default if available on server. It is faster in most cases by few to several percent. The side effect of using mod_spdy is that it\u0026rsquo;s working well only with thread safe Apache\u0026rsquo;s modules. PHP module for Apache is not thread safe so we need to use PHP as CGI or FastCGI service. CGI is slow - so running mod_spdy for performance gain with CGI is simply pointless. FastCGI is better but it\u0026rsquo;s not possible to share APC cache in FastCGI mode (ex. using spawn-fcgi), so it\u0026rsquo;s poor too. Best for PHP is PHP-FPM which is FastCGI service with dynamic process manager and could use full advantages of APC. In such configuration I could switch from apache prefork to worker which should use less resources and be moreÂ predictable.\nInstallation On Squeeze we need to install dot.deb repository - instructions are here:Â http://www.dotdeb.org/instructions/\nThen we could install:\napt-get install apache2-mpm-worker php5-fpm libapache2-mod-fastcgi Now, mod_spdy - packages are available here:Â https://developers.google.com/speed/spdy/mod_spdy/ Choose your architecture.\nwgetÂ https://dl-ssl.google.com/dl/linux/direct/mod-spdy-beta_current_i386.deb dpkg -iÂ mod-spdy-beta_current_i386.deb Installation of this package will add automatically a new apt repository for mod_spdy.\nIf you have Apache\u0026rsquo;s module for PHP still installed you should remove it (you won\u0026rsquo;t need in anymore):\napt-get purge libapache2-mod-php5 Configuring PHP-FPM First I\u0026rsquo;m changing php-fpm default pool configuration file - edit /etc/php5/fpm/pool.d/www.conf\n; I want it to listen on socket, not on port listen = /var/run/php5-fpm/site1.socket ;uncomment to set proper permission for socket listen.owner = www-data listen.group = www-data listen.mode = 0660 ;uncomment and change to - PHP leaks, so kill child after 100 requests pm.max_requests = 100 ; for proper chroot handling we will need also php_admin_value[doc_root] = /var/www/site1 php_admin_value[cgi.fix_pathinfo] = 0 Now restart php-fpm:\nservice php5-fpm restart Connecting Apache with PHP-FPM In VirtualHost paste this:\n\u0026lt;IfModule mod_fastcgi.c\u0026gt; Alias /php5.fcgi /var/www/site1/php5.fcgi FastCGIExternalServer /var/www/site1/php5.fcgi -socket /var/lib/apache2/fastcgi/site1.socket AddType application/x-httpd-fastphp5 .php Action application/x-httpd-fastphp5 /php5.fcgi \u0026lt;Directory \u0026#34;/var/www/site1/\u0026#34;\u0026gt; Order deny,allow Deny from all \u0026lt;Files \u0026#34;php5.fcgi\u0026#34;\u0026gt; Order allow,deny Allow from all \u0026lt;/Files\u0026gt; \u0026lt;/Directory\u0026gt; \u0026lt;/IfModule\u0026gt; Enable needed modules and restart Apache:\na2enmod actions a2enmod fastcgi service apache2 restart SSL SPDY requires encrypted connection so you need configured SSL (virtualhost running on port 443). Typical configuration for SSL looks similar to this:\n\u0026lt;virtualhost *:443\u0026gt; # some random stuff - exactly like in you NON SSL configuration ðŸ˜„ SSLEngine on SSLCertificateFile /etc/ssl/certs/example.com.crt SSLCertificateKeyFile /etc/ssl/private/example.com.priv.key SSLCACertificateFile /etc/ssl/private/ca.crt\u0026lt;/virtualhost\u0026gt; Testing Should work now ðŸ˜ƒ\nSo, use Chromium, enter the site you just configured and then on second tab go to: chrome://net-internals/#spdy. You should see your site there if it\u0026rsquo;s running on SPDY.\nYou could also use plugins for Firefox or Chromium to test if site is running on SPDY.\nAdvertise SPDY on HTTP When you test if SPDY is working fine (and is faster in your configuration) you could advertise availability of SPDY protocol on your HTTP VirtualHost. Thanks to that when browser supports SPDY it will use it for faster access. To do this just add header in configuration:\nHeader set Alternate-Protocol \u0026#34;443:spdy/2\u0026#34; There are more options that could be used, if you need just check docs here.\n","href":"/2013/12/running-apache-with-mod_spdy-and-php-fpm/","title":"Running Apache with mod_spdy and PHP-FPM"},{"content":"","href":"/tags/mdadm/","title":"mdadm"},{"content":"","href":"/tags/raid/","title":"RAID"},{"content":"Yesterday I have problem with fglrx witch cause ugly system reset. After that, one of my drives was marked as failed in RAID5 array. Hotspare was automatically used to rebuild array. But this hotspare is the oldest and slowest drive I\u0026rsquo;ve got\u0026hellip;\nAfter rebuild I\u0026rsquo;ve tested failed drive and it was fine - no bad block, no any other issue - so I wanted it running back in array.\nWhat I do:\n I\u0026rsquo;ve added checked disk to array as spare  mdadm /dev/md0 -a /dev/sdb1  I\u0026rsquo;veÂ set this \u0026ldquo;slow\u0026rdquo; drive as failed (and rebuild started)  mdadm /dev/md0 -f /dev/sdf1  I removed this drive  echo 1 \u0026gt; /sys/block/sdf/device/delete  I run dmesg to see what was scsi host of this drive  dmesg [ 1302.433419] sd 8:0:0:0: [sdf] Synchronizing SCSI cache [ 1302.433468] sd 8:0:0:0: [sdf] Stopping disk  Now I could readd this drive  echo \u0026#34;- - -\u0026#34; \u0026gt; /sys/class/scsi_host/host8/scan  I run dmesgÂ again to see if disk was detected  dmesg [ 1489.013270] scsi 8:0:0:0: Direct-Access ATA SEAGATE ST2000DM001 1AQ1 PQ: 0 ANSI: 5 [ 1489.013375] sd 8:0:0:0: [sdf] 3907029168 512-byte logical blocks: (2.00 TB/1.81 TiB) [ 1489.013397] sd 8:0:0:0: Attached scsi generic sg6 type 0 [ 1489.013445] sd 8:0:0:0: [sdf] Write Protect is off [ 1489.013447] sd 8:0:0:0: [sdf] Mode Sense: 00 3a 00 00 [ 1489.013466] sd 8:0:0:0: [sdf] Write cache: enabled, read cache: enabled, doesn\u0026#39;t support DPO or FUA [ 1498.318159] sdf: sdf1 [ 1498.318391] sd 8:0:0:0: [sdf] Attached SCSI disk  Now I could re-add this drive to the array as spare  mdadm /dev/md0 -a /dev/sdf1 ","href":"/2013/12/re-adding-failed-drive-in-mdadm/","title":"Re-adding failed drive in mdadm"},{"content":"I was configuring GlusterFS on few servers using Ansible and have a need to update /etc/hosts with hostnames for easier configuration. I found this one working:\n- name: Update /etc/hosts lineinfile: dest=/etc/hosts regexp=\u0026#39;.*{{item}}$\u0026#39; line=\u0026#39;{{hostvars.{{item}}.ansible_default_ipv4.address}} {{item}}\u0026#39; state=present with_items: \u0026#39;{{groups.somegroup}}\u0026#39; Source: http://xmeblog.blogspot.com/2013/06/ansible-dynamicaly-update-etchosts.html\n","href":"/2013/12/ansible-dynamicaly-update-etc-hosts-files-on-target-servers/","title":"Ansible - Dynamicaly update /etc/hosts files on target servers"},{"content":"","href":"/tags/ghost/","title":"Ghost"},{"content":"I\u0026rsquo;ve started testing new Ghost blogging platform for a while on a virtual machine before I take decision about switching to it (or maybe won\u0026rsquo;t)\u0026hellip; After few days, I wanted to go forward with more testing and stuck on \u0026ldquo;e-mail and password\u0026rdquo; login prompt ðŸ˜ƒ\nI\u0026rsquo;ve started looking into files and found ghost_dir/content/data/ghost-dev.db SQLite database. It can be opened like that:\nsqlite3 content/data/ghost-dev.db Then you could see whats your mail (and other info):\nsqlite\u0026gt; select * from users Now password - after searching a little I found: ghost_dir/core/server/models/user.js file. There is a tip in it:\n// Hash the provided password with bcrypt return nodefn.call(bcrypt.hash, _user.password, null, null); So I used this site: http://bcrypthashgenerator.apphb.com/ to generate bcrypt hash and updated it in DB:\nsqlite\u0026gt; update users set password=\u0026#34;$2a$10$f29LDrB8S1JMfdF40Vmf1.h2OyhtlcefaMrFQVpHeX9XQ7Xiq17KC\u0026#34; where id = 1; sqlite\u0026gt; .quit Additionally as suggested by henshao: if the account has been locked, you can set status to active to unlock the account, like that:\nsqlite\u0026gt; update users set status = â€œactiveâ€; Now try to log with updated credentials.\nP.S. I strongly suggest to change password after successful login.\n","href":"/2013/11/reset-user-password-in-your-own-ghost-blog/","title":"Reset user password in your own Ghost Blog"},{"content":"It\u0026rsquo;s quite rare to have problems with XFS and inodes exhaustion. Mostly because XFS doesn\u0026rsquo;t have inode limit in a manner known from other filesystems - it\u0026rsquo;s using some percentage of whole filesystem as a limit and in most distributions it\u0026rsquo;s 25%. So it\u0026rsquo;s really huge amount of inodes. But some tools and distributions lowered limit ex. 5% or 10% and there you could have problems more often.\nYou could check what is you limit by issuing xfs_info with drive and searching for imaxpct value:\nroot@zombi:~# xfs_info /srv/backup/ metadane=/dev/mapper/slow-backup isize=256 agcount=17, agsize=2621440 blks = sectsz=512 attr=2 data = bsize=4096 blocks=44564480, imaxpct=25 = sunit=0 swidth=0 blks naming =version 2 bsize=4096 ascii-ci=0 log =internal bsize=4096 blocks=20480, version=2 = sectsz=512 sunit=0 blks, lazy-count=1 realtime=brak extsz=4096 blocks=0, rtextents=0 In this case I have 25% and it could be changed dynamically with xfs_growfs -m XX where XX is new percentage of volume capacity.\nIt\u0026rsquo;s also possible to change imaxpct on creation time by adding option -i maxpct=XX.\n","href":"/2013/11/inodes-on-xfs/","title":"Inodes on XFS"},{"content":"","href":"/tags/xfs/","title":"XFS"},{"content":"I\u0026rsquo;ve bought a NAS and customized it a little. But there was one thing which make my nights sleepless. NAS was seeking disks every 5~10 seconds - these was really irritating - especially when it was silent in room. I found that part of firmware was indexing or logging something so I wanted it dead! kill -9 was unsuccessful - process restarted after a while\u0026hellip;. wrrr\u0026hellip;\nI googled a little and found another signal I could use SIGSTOP, which will freeze process until I send SIGCONT to it - that was exactly what I need (because I normally use NFS/Samba and don\u0026rsquo;t need nothing more running on this device).\nkill -SIGSTOP `pgrep svcd` Because with this process paused Web GUI is not working, I need from time to time run it again:\nkill -SIGCONT `pgrep svcd` Sources http://major.io/2009/06/15/two-great-signals-sigstop-and-sigcont/\n","href":"/2013/11/kill-with-sigstop-and-sigcont/","title":"Kill with SIGSTOP and SIGCONT"},{"content":"I\u0026rsquo;ve just bought new toy - Iomega StorCenter ix2-200 Cloud Edition. I have to play with few options before I could start using it. First thing - Firmware upgrade.\nFirmware upgrade I\u0026rsquo;ve started searching for latest firmware for ix2-200 Cloud and found that I have to register on Lenovo site to get firmware\u0026hellip; I don\u0026rsquo;t like such sites where they force me to give all private data, but after few clicks on \u0026ldquo;Recommended articles\u0026rdquo; on that site I landed here:\nhttps://lenovo-eu-en.custhelp.com/app/answers/detail/a_id/26790\nSo it looks that I don\u0026rsquo;t need to register - point for me.\nSSH access I like to be root on my devices so I want SSH access with root privileges - nothing easier. Login to admin panel and then go to URL:\nhttp://[your-nas-ip]/diagnostics.html On this site you have to enable \u0026ldquo;remote access for technical support\u0026rdquo;, then you could login to your device via SSH using credentials:\n login: root password: soho+your_admin_password  That\u0026rsquo;s all I need to start ðŸ˜ƒ\nOther customization This device is running Debian Lenny for ARM but changed a little by producer. This HOWTO shows few tricks about installing custom software and changing default behavior. Based on: http://techmonks.net/installing-transmission-and-dnsmasq-on-a-nas/\n","href":"/2013/11/my-new-toy-iomega-storcenter-ix2-200-cloud-edition/","title":"My new toy - Iomega StorCenter ix2-200 Cloud Edition"},{"content":"After some configuration changes I\u0026rsquo;ve stuck with VBP not listening nor on HTTP, nor on SSH port. Last resort was to use CLI to reenable HTTP access. Connect with parameters:\n Baud rate: 9600 Parity: none Bits: 8 Stopbits: 1 Flow control: none  Then in login prompt you have to use login credentials (yes - they\u0026rsquo;re the same on every box (WTF?)):\n User: - root Pass: - @#$%^\u0026amp;*!()  Password is shift + 2345678190 - there is 1 before 9!\nAfter logging on, there are three commands that should reenable HTTP access:\n/etc/conf/bin/ep_mfg cfg_commit /etc/conf/bin/config_network Works for me!\nSources http://community.polycom.com/t5/Management-Security-and-Rich/VBP-ST-Factory-Reset-Problems/td-p/8974 http://community.polycom.com/t5/Management-Security-and-Rich/I-can-t-access-to-a-Polycom-VBP-5300-ST-by-HTTP/td-p/18698 http://blogs.scansource.com/polycom-vbp-e-series-reset-procedures/\n","href":"/2013/11/reenable-web-interface-on-polycom-vbp-5300-st-from-cli/","title":"Reenable web interface on Polycom VBP 5300 ST from CLI"},{"content":"I\u0026rsquo;ve crated this blog to get feedback from other IT guys about what I\u0026rsquo;m doing wrong (or not good enough). But this idea failed\u0026hellip;\nI have only few comments on my blog (and about thousand and a half spams per month) - so, no feedback in my national language at all.\nSwitching to English should make my audience bigger and I hope to have more attention thanks to that. This will be also a good practice of my English skill. I hope to find enough free time to translate some of older articles, but for now I\u0026rsquo;m thinking rather about changing engine of blog - to something more convenient. Maybe Octopress or Ghost.\nI hope you enjoy a little more.\n","href":"/2013/11/changing-language-of-articles-on-my-blog-to-english/","title":"Changing language of articles on my blog to English"},{"content":"","href":"/tags/gearman/","title":"Gearman"},{"content":"Niedawno zainteresowaÅ‚em siÄ™ usÅ‚ugÄ… Gearman i jedynej rzeczy ktÃ³rej mi brakowaÅ‚o to jakiegoÅ› Å‚atwego mechanizmu zarzÄ…dzajÄ…cego workerami. Ale jak zwykle okazaÅ‚o siÄ™ Å¼e inni mieli juÅ¼ ten problem i odpowiednie narzÄ™dzie istnieje - mowa o GearmanManagerze.\nInstalacja GearmanManagera Aby zainstalowaÄ‡ GeramanManagera na serwerze gdzie juÅ¼ mamy Gearmana trzeba wykonaÄ‡ kilka krokÃ³w (wczeÅ›niej powinniÅ›my teÅ¼ zainstalowaÄ‡ moduÅ‚ gearmana do php\u0026rsquo;a):\napt-get install git -y git clone https://github.com/brianlmoon/GearmanManager.git cd GearmanManager/install chmod +x install.sh ./install.sh Detecting linux distro as redhat- or debian-compatible Where is your php executable? (usually /usr/bin) /usr/bin Which PHP library to use, pecl/gearman or PEAR::Net_Gearman? 1) pecl 2) pear #? 1  Installing to /usr/local/share/gearman-manager Installing executable to /usr/local/bin/gearman-manager Installing configs to /etc/gearman-manager Installing init script to /etc/init.d/gearman-manager Install ok! Run /etc/init.d/gearman-manager to start and stop Worker scripts can be installed in /etc/gearman-manager/workers, configuration can be edited in /etc/gearman-manager/config.ini Mamy dziaÅ‚ajÄ…cego GearmanManagera. Zalecam przyglÄ…dniÄ™cie siÄ™ plikowi config-advanced.ini bo jest tam kilka opcji, ktÃ³re warto dodatkowo ustawiÄ‡.\nSprawdzenie dziaÅ‚ania Geramana i GearmanManagera PrzykÅ‚ad workera moÅ¼na znaleÅºÄ‡ tutaj http://brian.moonspot.net/GearmanManager. Po pobraniu go i zapisaniu w pliku /etc/gearman-manager/workers/fetch_url.php moÅ¼emy rÄ™cznie zakolejkowaÄ‡ zadanie dla Geramana:\ngearman -f fetch_url -- http://google.pl/robots.txt Å¹rÃ³dÅ‚o:\nhttps://github.com/brianlmoon/GearmanManager\nhttp://brian.moonspot.net/GearmanManager\n","href":"/2013/11/gearmanmanager-wygodne-zarzadzanie-workerami/","title":"GearmanManager: wygodne zarzÄ…dzanie workerami"},{"content":"W teorii nie powinno siÄ™ blokowaÄ‡ aktualizacji pakietÃ³w bo Å‚atajÄ… dziury itd\u0026hellip;. Ale! ZdarzyÅ‚y mi siÄ™ ostatnio dwie sytuacje, ktÃ³re do tego mnie zmusiÅ‚y:\n aktualizacja hudsona koÅ„czyÅ‚a siÄ™ bÅ‚Ä™dem przy starcie usÅ‚ugi, aktualizacja domU Xen skoÅ„czyÅ‚a siÄ™ problemem z kompatybilnoÅ›ciÄ… mechanizmu udev w systemie i jÄ…drze (hypervisor miaÅ‚ starsze jÄ…dro niÅ¼ spodziewaÅ‚o siÄ™ DomU).  W takich sytuacjach bardzo przydaje siÄ™ moÅ¼liwoÅ›Ä‡ zablokowania aktualizacji jednej \u0026ldquo;psujÄ…cej\u0026rdquo; paczki na pewien okres czasu by nie opÃ³ÅºniaÄ‡ innych aktualizacji a sobie daÄ‡ czas na rozpracowanie problemu.\nWstrzymywanie aktualizacji pakietu AktualizacjÄ™ wstrzymujemy o tak:\necho \u0026#34;paczka hold\u0026#34; | dpkg --set-selections Odblokowanie aktualizacji pakietu By ponownie zezwoliÄ‡ na aktualizacjÄ™ wystarczy:\necho \u0026#34;paczka install\u0026#34; | dpkg --set-selections Sprawdzenie listy wstrzymanych paczek dpkg --get-selections | grep hold Å¹rÃ³dÅ‚o:\nhttp://www.debianadmin.com/how-to-prevent-a-package-from-being-updated-in-debian.html\n","href":"/2013/11/debian-zablokowanie-aktualizacji-pakietu/","title":"Debian - zablokowanie aktualizacji pakietu"},{"content":"Ostatnio trafiÅ‚em na ciekawÄ… usÅ‚ugÄ™, ktÃ³ra pozwala oddelegowaÄ‡ dÅ‚ugo trwajÄ…ce zadania z usÅ‚ugi webowej. Mowa o Gearman\u0026rsquo;ie. UsÅ‚uga jest o tyle ciekawa Å¼e nie narzuca ani jÄ™zyka dla klienta (wiÄ™kszoÅ›Ä‡ popularnych ma gotowe biblioteki), ani jÄ™zyk dla skryptÃ³w w tej usÅ‚udze nie jest narzucany. MoÅ¼na tÄ™ usÅ‚ugÄ™ wykorzystaÄ‡ jako most pomiÄ™dzy PHP a np. JavÄ…/Pythonem lub do zlecenia zadaÅ„ z serwera na Linux\u0026rsquo;ie do wykonania na serwerze Windowsowym (bo np. narzÄ™dzia dostÄ™pne sÄ… tylko dla Windowsa). O innych zaletach moÅ¼na poczytaÄ‡ na stronce wiÄ™c nie bÄ™dÄ™ przynudzaÄ‡.\nStandardowo zainstalowaÅ‚em paczkÄ™ z repo Debiania i rozbiÅ‚em siÄ™ przy kompilacji moduÅ‚u z PECL\u0026rsquo;a - w repo byÅ‚a jakaÅ› prehistoryczna wersja. PostanowiÅ‚em uruchomiÄ‡ aktualnÄ… wersje 1.0.6 z gaÅ‚Ä™zi testowej przekompilowujÄ…c jÄ… na Wheezym (by uniknÄ…Ä‡ zaleÅ¼noÅ›ci z wersji testowej).\nInstalacja gearman\u0026rsquo;a Dorzucamy ÅºrÃ³dÅ‚a z testing - dziÄ™ki temu nie aktualizujemy systemu ale bÄ™dziemy mogli pobraÄ‡ Å›wieÅ¼e paczki ÅºrÃ³dÅ‚owe:\necho \u0026#34;deb-src http://ftp.pl.debian.org/debian jessie main non-free contrib\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list apt-get update Przygotowujemy katalog roboczy, pobieramy paczki i kompilujemy:\nmkdir gearman cd gearman apt-get build-dep gearman-job-server -y apt-get install bzr apt-get source gearman-job-server cd gearmand-1.0.6 ./debian/rules clean ./debian/rules binary cd .. dpkg -i gearman-job-server_1.0.6-2_i386.deb gearman-tools_1.0.6-2_i386.deb libgearman-dev_1.0.6-2_i386.deb libgearman7_1.0.6-2_i386.deb apt-get install -f -y MusiaÅ‚em rÄ™cznie doinstalowaÄ‡ bazar (paczka bzr), bo w czasie kompilacji pojawiaÅ‚y siÄ™ bÅ‚Ä™dy z tym poleceniem - nie jestem pewien na ile jest potrzebne ale oczywiÅ›cie moÅ¼emy to posprzÄ…taÄ‡ po skompilowaniu paczek.\nP.S. Jestem przekonany Å¼e zamiast \u0026ldquo;rules clean/binary\u0026rdquo; jest jakieÅ› polecenie, ktÃ³rego powinno siÄ™ uÅ¼yÄ‡ ale nie mogÅ‚em sobie go przypomnieÄ‡\u0026hellip;\nInstalacja moduÅ‚u dla PHP'a  PoniewaÅ¼ wczeÅ›niej zainstalowaliÅ›my aktualne biblioteki libgearman-dev to instalacja moduÅ‚u dla PHP powinna byÄ‡ bardzo prosta:\npecl install gearman echo \u0026#34;extension=gearman.so\u0026#34; \u0026gt; /etc/php5/conf.d/gearman.ini P.S. W paczkach PHP 5.3 z dotdeb\u0026rsquo;a moÅ¼na znaleÅºÄ‡ juÅ¼ skompilowany moduÅ‚ dla gearman\u0026rsquo;a.\nNa razie tyle - muszÄ™ teraz poszukaÄ‡ jak w wygodny, zautomatyzowany sposÃ³b zarzÄ…dzaÄ‡ skryptami zleconymi do gearman\u0026rsquo;a.\n","href":"/2013/10/instalacja-gearman-job-server-1-0-6-na-debianie-wheezy/","title":"Instalacja gearman-job-server 1.0.6 na Debianie Wheezy"},{"content":"Kolejna zabawna sytuacja - pewna aplikacja dotNET\u0026rsquo;owa dziaÅ‚aÅ‚a dziwnie na 64-bitowym systemie, a tymczasem na 32-bitowej maszynie ta sama aplikacja dziaÅ‚aÅ‚a bez problemÃ³w. Jedyna rÃ³Å¼nica to inne wersje klientÃ³w ODBC na tych systemach, ktÃ³re po kilku testach okazaÅ‚y siÄ™ byÄ‡ przyczynÄ… caÅ‚ego zÅ‚a.\nPojawiÅ‚ siÄ™ pomysÅ‚ by odpaliÄ‡ aplikacje na 64 bitowym systemie ale w trybie 32 bit - poniÅ¼ej krÃ³tkie HOWTO jak to osiÄ…gnÄ…Ä‡:\n potrzebujemy narzÄ™dzia corflags.exe ktÃ³re pozwoli oznaczyÄ‡ nam binarkÄ™ jako 32-bitowÄ…, do pobrania tutaj a instrukcja jej uÅ¼ycia tutaj. Instalujemy Windows SDK i zaznaczamy wyÅ‚Ä…cznie .NET Development Tools w kategorii Developer Tools / Windows Development Tools Odpalamy CMD i w nim CorFlags z lokalizacji: C:\\Program Files\\Microsoft SDKs\\Windows\\v7.1\\Bin (przynajmniej u mnie):  cd C:\\Program Files\\Microsoft SDKs\\Windows\\v7.1\\Bin\\ CorFlags.exe c:\\sciezka\\do\\pliku.exe /32BIT+ Tyle - aplikacja uruchomiÅ‚a siÄ™ bez problemu jako 32 bitowa i korzystaÅ‚a z 32 bitowego ODBC.\nÅ¹rÃ³dÅ‚a http://stackoverflow.com/questions/10945664/run-anycpu-as-32-bit-on-64-bit-systems\nhttp://stackoverflow.com/questions/242304/where-should-i-download-corflags-exe-from\n","href":"/2013/10/uruchamiania-aplikacji-net-jako-32-bitowej-w-64-bitowym-systemie/","title":"Uruchamianie aplikacji .NET jako 32-bitowej w 64-bitowym systemie"},{"content":"Od jakiegoÅ› czasu moÅ¼na kupiÄ‡ w NetArcie certyfikaty SSL, a niedawno zrobili na nie promocjÄ™ - 15zÅ‚ za pierwszy rok (za certyfikat na jednÄ… stronkÄ™). Tzw. tanie i dobre. Po wyrobieniu certyfikatu i zapisaniu z panelu klienta mam pliczki: stonka.crt i netart_rootca.crt, ktÃ³re wrzucamy do Apachego, powiedzmy tak:\nSSLCertificateFile /etc/ssl/certs/stonka.crt SSLCertificateKeyFile /etc/ssl/private/priv.key SSLCACertificateFile /etc/ssl/certs/netart_rootca.crt Certyfikat dziaÅ‚a w Chromie ale nie weryfikuje siÄ™ w Firefoxie i Internet Explorerze. FF wyÅ›wietla bÅ‚Ä…d: sec_error_unknown_issuer - co oznacza brak certyfikatu wystawcy gdzieÅ› w Å‚aÅ„cuchu certyfikatÃ³w. W FAQ zero jak chodzi o konfiguracjÄ™ certyfikatÃ³w na serwerze poza NetArt\u0026rsquo;em\u0026hellip;\nPrzeglÄ…dnÄ…Å‚em informacje certyfikatu rootca:\nopenssl x509 -in netart_rootca.crt -text -noout\u0026lt;/pre\u0026gt; Certificate: Data: Version: 3 (0x2) Serial Number: 46:53:b1:a6:1e:ba:2d:c7:a3:2e:f9:39:5a:4e:f8:8c Signature Algorithm: sha1WithRSAEncryption Issuer: C=PL, O=Unizeto Technologies S.A., OU=Certum Certification Authority, CN=Certum Global Services CA Validity Not Before: Jul 6 10:31:40 2012 GMT Not After : Jul 4 10:31:40 2022 GMT Subject: C=PL, O=NetArt Sp\\xC3\\xB3\\xC5\\x82ka Akcyjna S.K.A., OU=http://nazwa.pl, CN=nazwaSSL Subject Public Key Info: Public Key Algorithm: rsaEncryption RSA Public Key: (2048 bit) Modulus (2048 bit): 00:cc:91:f5:f7:01:09:4f:75:c8:09:c7:14:8f:e4: 1a:99:78:20:99:40:59:6f:10:2f:ff:fe:d0:10:ff: 06:a3:39:3d:c4:f1:4b:07:cf:22:39:20:80:43:50: c1:af:b4:01:71:a0:a3:30:11:52:d3:d2:98:d9:c2: 69:f7:e3:00:d9:19:3f:3d:b3:3b:52:75:e3:d3:0c: ab:ff:57:01:3a:83:5c:f5:02:bb:28:fe:90:38:8e: a2:84:cf:61:48:e7:99:e0:72:24:b6:11:58:4a:18: 57:0d:34:18:5e:35:c8:b3:ac:04:5f:8d:38:2f:a2: cf:d2:dc:74:d8:41:02:ec:e0:db:0c:54:81:a4:7a: c5:34:d5:19:86:b6:1e:65:f7:3c:f6:b2:dd:3a:b5: b7:91:61:18:fd:81:2c:8a:68:d7:d6:a8:33:b7:47: b8:f9:48:ad:35:ee:11:93:f9:c2:a9:fa:94:8e:4f: bb:d1:1e:a7:64:74:b4:f9:0f:88:a7:11:a7:33:1a: c2:b1:14:0c:12:a8:6b:82:44:78:4e:d5:79:8f:5c: 60:29:47:4c:36:35:52:c7:ad:6c:c0:20:39:93:f1: c8:b3:3b:d9:c6:ec:dd:22:45:27:a2:50:12:07:f8: fe:38:79:24:89:b9:f7ðŸ‡©ðŸ‡ªe0:c6:e9:64:e3:f4:0b: fa:c7 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Basic Constraints: critical CA:TRUE, pathlen:0 X509v3 CRL Distribution Points: URI:http://crl.certum.pl/gsca.crl Authority Information Access: CA Issuers - URI:http://repository.certum.pl/gsca.cer X509v3 Authority Key Identifier: keyid:45:C5:B2:86:4E:CC:DD:29:97:E4:DD:14:C4:6E:AE:4D:B8:C1:77:F8 X509v3 Subject Key Identifier: 9D:CE:F0:5A:B4:CB:25:CF:36:A5:82:5D:8F:F7:7F:98:46:19:37:2E X509v3 Key Usage: critical Certificate Sign, CRL Sign X509v3 Certificate Policies: Policy: X509v3 Any Policy CPS: https://www.certum.pl/CPS Signature Algorithm: sha1WithRSAEncryption 53:01:c7:87:ad:ac:d7:52:32:1f:79:5d:87:f0:01:88:8e:99: 3f:07:d8:e4:bc:84:0a:8d:5f:d5:d5:62:c2:9b:79:33:46:f9: 8a:d9:b2:96:ed:35:8a:29:3b:5f:38:7a:6a:70:1d:8b:84:1a: a3:90:81:f7:2e:60:77:78:f0:d0:84:a3:e9:8a:3c:ef:8a:34: 6b:b1:9c:e8:e1:76:f4:87:1e:7b:3c:18:6f:98:70:2c:2a:8a: 22:f5:ba:96:52:7e:26:62:8b:96:03:32:22:f9:80:d7:f1:dd: 9e:c2:79:b4:17:0d:40:ff:50:6a:28:6f:e8:6f:11:8a:f9:b4: 65:2b:52:86:31:50:c7:4d:e6:f3:beðŸ‡©ðŸ‡ª6a:d1:89:90:27:61: 6c:1c:7d:90:1f:9a:ed:02:d4:01:22:5e:8b:0b:c9:99:34:f1: 1d:04:f4:d6:d0:71:7c:8f:0c:31:a3:2f:20:ad:35:c8:d3:b4: 0b:38:74:89:a5:d3:55:72:e9:af:b0:b8:9f:02:c9:85:69:01: d8:7e:00:44:25:91:2c:5e:5b:9f:ed:52:a8:bb:5d:94:20:f4: c4:82:35ðŸ‡©ðŸ‡ªe5:d3:05:3c:14:d5:08:80:e4:74:47:e3:fa:f7: 8c:73:40:a8:2d:ea:1f:96:c8:e3:03:2c:62:08:cc:44:02:46: a5:81:c2:0a CA NetArtu nie jest domyÅ›lnie zainstalowane w Å¼adnej przeglÄ…darce wiÄ™c nic dziwnego - ale sÄ… tam klucze Unizeto/Certum - dorzucÄ™ wiÄ™c klucz CA (Chrome najwidoczniej sam potrafi to zrobiÄ‡):\nwget http://repository.certum.pl/gsca.cer openssl x509 -inform der -in gsca.cer -out gsca.pem cat gsca.pem \u0026gt;\u0026gt; netart_rootca.crt Restart Apachego i przeglÄ…darki juÅ¼ nie krzyczÄ…. Mogliby siÄ™ tylko wysiliÄ‡ na jakÄ…Å› instrukcjÄ™ albo udostÄ™pnienie od razu cabudle.crt z wszystkimi potrzebnymi certami.\n","href":"/2013/10/certyfikaty-nazwassl-na-wlasnym-serwerze/","title":"Certyfikaty nazwaSSL na wÅ‚asnym serwerze"},{"content":"TrafiÅ‚ mi siÄ™ ostatnio ciekawy problem - otÃ³Å¼ standardowo przed koÅ„cem roku poprawiaÅ‚em filtry antyspamowe i optymalizowaÅ‚em konfiguracjÄ™ Postfix\u0026rsquo;a. ChciaÅ‚em zmieniÄ‡ domyÅ›lnÄ… wartoÅ›Ä‡ smtpd_delay_reject=yes na smtpd_delay_reject=no by odrzucaÄ‡ spamerÃ³w najwczeÅ›niej jak to moÅ¼liwe. I ciekawe kuku, ktÃ³re sobie zrobiÅ‚em polegaÅ‚o na tym Å¼e sam nie mogÅ‚em wysyÅ‚aÄ‡ poczty po logowaniu SSL\u0026rsquo;em\u0026hellip;\nDostawaÅ‚em przy tym bardzo wymownÄ… odpowiedÅº:\nOct 8 16:30:39 tyr postfix/smtpd[21039]: NOQUEUE: reject: CONNECT from unknown[67.x.x.x]: 554 5.7.1 \u0026lt;unknown [67.x.x.x]\u0026gt;: Client host rejected: Access denied; proto=SMTP\u0026lt;/unknown\u0026gt; WiÄ™c wrzuciÅ‚em debug_peer_list = 67.x.x.x do main.cf by zobaczyÄ‡ dokÅ‚adniej o co biega:\nOct 8 16:47:49 tyr postfix/smtpd[23899]: \u0026gt;\u0026gt;\u0026gt; START Client host RESTRICTIONS \u0026lt; \u0026lt;\u0026lt; Oct 8 16:47:49 tyr postfix/smtpd[23899]: generic_checks: name=permit_sasl_authenticated Oct 8 16:47:49 tyr postfix/smtpd[23899]: generic_checks: name=permit_sasl_authenticated status=0 Oct 8 16:47:49 tyr postfix/smtpd[23899]: generic_checks: name=reject Oct 8 16:47:49 tyr postfix/smtpd[23899]: NOQUEUE: reject: CONNECT from unknown[67.x.x.x]: 554 5.7.1 \u0026lt;unknown[67.x.x.x]\u0026gt;: Client host rejected: Access denied; proto=SMTP Oct 8 16:47:49 tyr postfix/smtpd[23899]: generic_checks: name=reject status=2 Oct 8 16:47:49 tyr postfix/smtpd[23899]: \u0026gt; unknown[67.x.x.x]: 554 5.7.1 \u0026lt;unknown [67.x.x.x]\u0026gt;: Client host rejected: Access denied Oct 8 16:47:49 tyr postfix/smtpd[23899]: watchdog_pat: 0xb82c67f8 Oct 8 16:47:53 tyr postfix/smtpd[23899]: \u0026lt; unknown[67.x.x.x]: QUIT Oct 8 16:47:53 tyr postfix/smtpd[23899]: \u0026gt; unknown[67.x.x.x]: 221 2.0.0 Bye\u0026lt;/unknown\u0026gt; generic_checks: name=permit_sasl_authenticated status=0 sugeruje Å¼e autoryzacja jest ok, a chwile pÃ³Åºniej reject. SprawdziÅ‚em konfiguracjÄ™ SASL\u0026rsquo;a (z dovecot\u0026rsquo;a) i zaczynaÅ‚em bezskutecznie komentowaÄ‡ kolejne linie w main.cf. Jaja polegaÅ‚y na tym Å¼e po ustawieniu smtpd_delay_reject=yes wszystko wracaÅ‚o do normy\u0026hellip; Ale nie chciaÅ‚em tego tak zostawiÄ‡.\nOlÅ›niÅ‚o mnie dopiero po chwili - przecieÅ¼ poÅ‚Ä…czenia SSL SMTP odbywajÄ… siÄ™ na inny port - zdefiniowany w master.cf - moÅ¼e coÅ› tam bruÅºdzi. A tutaj od razu rzuciÅ‚a mi siÄ™ w oczy rÃ³Å¼nica w konfiguracji dla usÅ‚ugi submission i ssmtp:\nsubmission inet n - - - - smtpd ... -o smtpd_sender_restrictions=reject_sender_login_mismatch,permit_sasl_authenticated,reject ... smtps inet n - - - - smtpd ... -o smtpd_client_restrictions=permit_sasl_authenticated,reject ... Submission ustawiaÅ‚em niedawno i widocznie trafiÅ‚em na lepszego FAQ\u0026rsquo;a ðŸ˜ƒ WyglÄ…da na to Å¼e sprawdzanie autoryzacji SASL w smtpd_client_restrictions odbywaÅ‚o siÄ™ w tym przypadku zanim klient siÄ™ autoryzowaÅ‚ (albo byÅ‚o jakieÅ› lekkie opÃ³Åºnienie). Zamiana smtpd_client_restrictions na smtpd_sender_restrictions zaÅ‚atwiÅ‚o sprawÄ™. Przy okazji zauwaÅ¼yÅ‚em Å¼e po SSL\u0026rsquo;u moÅ¼na byÅ‚o spooflowaÄ‡ innych uÅ¼ytkownikÃ³w co rÃ³wnieÅ¼ postanowiÅ‚em szybko naprawiÄ‡. A wszystko dlatego Å¼e zachciaÅ‚o mi siÄ™ \u0026ldquo;wczesnych optymalizacji\u0026rdquo; i chciaÅ‚em w tych usÅ‚ugach pominÄ…Ä‡ czÄ™Å›Ä‡ checkÃ³w, ktÃ³re mam w main.cf.\nW minimalnej wersji konfiguracja w master.cf powinna wyglÄ…daÄ‡ tak:\nsubmission inet n - - - - smtpd -o smtpd_tls_security_level=encrypt -o smtpd_tls_auth_only = yes -o smtpd_sasl_auth_enable=yes smtps inet n - - - - smtpd -o smtpd_tls_wrappermode=yes -o smtpd_sasl_auth_enable=yes P.S. ZnalazÅ‚em potencjalnego winnego - w dokumentacji dovecot\u0026rsquo;a wykorzystano smtpd_client_restrictions: http://wiki2.dovecot.org/HowTo/PostfixAndDovecotSASL\n","href":"/2013/10/postfix-ciekawy-problem-z-smtpd_delay_reject-i-permit_sasl_authenticated/","title":"Postfix: ciekawy problem z smtpd_delay_reject i permit_sasl_authenticated"},{"content":"Pomimo Å¼e Python duÅ¼o czÄ™Å›ciej wykorzystywany jest w Å›rodowiskach UNIX\u0026rsquo;owcy/Linux\u0026rsquo;owych to znajdzie siÄ™ kilka fajnych zastosowaÅ„ dla tego jÄ™zyka na Windowsie. MoÅ¼liwoÅ›ci na instalacjÄ™ jest kilka, a najprostsza to wykorzystanie instalatora ActiveState. Wersja ta ma w sobie wszystko co potrzebne:\n rozszerzenia dla API Windows menadÅ¼era pakietÃ³w PyPM dokumentacjÄ™  Niestety jakiÅ› czas temu zmieniÅ‚y siÄ™ zasady licencjonowania w ActiveState i aktualne wersje dla zastosowaÅ„ produkcyjnych wymagajÄ… zakupu licencji (1000$/rok - aÅ¼ chce siÄ™ zacytowaÄ‡ z Dnia Åšwira: czizys k\u0026hellip;wa\u0026hellip;). Wiem jak lepiej wydaÄ‡ takÄ… kasÄ™ wiÄ™c sprÃ³bujÄ™ uzyskaÄ‡ podobnÄ… funkcjonalnoÅ›Ä‡ na tym co moÅ¼na pobraÄ‡ za darmo z sieci.\n  Instalatory Python\u0026rsquo;a dla Windows moÅ¼na znaleÅºÄ‡ tutaj: http://www.python.org/download/releases/\n  Teraz pakiety z obsÅ‚ugÄ… API Windows (wybieramy stosownie do wczeÅ›niej pobranej wersji Pythona): http://sourceforge.net/projects/pywin32/files/pywin32/\n  I na koniec setuptools by mÃ³c doinstalowaÄ‡ dodatkowe moduÅ‚y. Wybieramy interesujÄ…cÄ… nas wersjÄ™ tutaj: https://pypi.python.org/pypi/setuptools/\n  Obecnie jest to 1.1.6 - zgodnie z opisem z tej strony: https://pypi.python.org/pypi/setuptools/1.1.6#windows pobieramy ez_setup.py i uruchamiamy.\n  Na koniec odpalamy CLI i instalujemy inne przydatne nam paczki, np.:\neasy_install couchdb easy_install cx-oracle  P.S. I tutaj maÅ‚y kruczek - instalacja cx-Oracle z pomocÄ… easy_install uda siÄ™ tylko na 32-bitowych Windowsach, na 64-bitowych konieczne jest zainstalowanie Visual Studio Express by moÅ¼liwe byÅ‚o skompilowanie paczek\u0026hellip; (tak mnie teÅ¼ siÄ™ w tej chwili juÅ¼ odechciewaÅ‚o\u0026hellip;)\nAle na szczÄ™Å›cie w przypadku tej paczki da siÄ™ inaczej, wystarczy pobraÄ‡ juÅ¼ skompilowanÄ… paczkÄ™ ze strony: http://cx-oracle.sourceforge.net dopasowanÄ… do wybranej wczeÅ›niej wersji Pythona. P.S. 2. MoÅ¼na siÄ™ obyÄ‡ bez tej paczki i wykorzystaÄ‡ pyodbc razem z kontrolerem ODBC z klienta Oracle, ale pyodbc nie obsÅ‚uguje wywoÅ‚aÅ„ procedur ze zmiennymi wiÄ…zanymi in/out lub out - a ja akurat tego potrzebowaÅ‚em, jeÅ›li to nie twÃ³j problem to pyodbc bÄ™dzie prostsze ðŸ˜„    ","href":"/2013/09/instalacja-pythona-na-windowsie/","title":"Instalacja Pythonâ€™a na Windowsie"},{"content":"Ten one liner zaÅ‚atwia sprawÄ™:\npython -c \u0026#39;import django; print \u0026#34;.\u0026#34;.join([str(s) for s in django.VERSION]);\u0026#39; ","href":"/2013/09/sprawdzanie-zainstalowanej-wersji-django/","title":"Sprawdzanie zainstalowanej wersji Django"},{"content":"","href":"/tags/spam/","title":"SPAM"},{"content":"I\u0026rsquo;ve just received a comment on my blog with text attached below. It looks like spam message template. I think it could be easily used for creation of banning rules, etc. Use it in a way that will make this dumbass spammer look even more stupid ;-)\n{ {I have|Iâ€™ve} been {surfing|browsing} online more than {three|3|2|4} hours today, yet I never found any interesting article like yours. {Itâ€™s|It is} pretty worth enough for me. {In my opinion|Personally|In my view}, if all {webmasters|site owners|website owners|web owners} and bloggers made good content as you did, the {internet|net|web} will be {much more|a lot more} useful than ever before.| I {couldnâ€™t|could not} {resist|refrain from} commenting. {Very well|Perfectly|Well|Exceptionally well} written!| {I will|Iâ€™ll} {right away|immediately} {take hold of|grab|clutch|grasp|seize|snatch} your {rss|rss feed} as I {can not|canâ€™t} {in finding|find|to find} your {email|e-mail} subscription {link|hyperlink} or {newsletter|e-newsletter} service. Do {you have|youâ€™ve} any? {Please|Kindly} {allow|permit|let} me {realize|recognize|understand|recognise|know} {so that|in order that} I {may just|may|could} subscribe. Thanks.| {It is|Itâ€™s} {appropriate|perfect|the best} time to make some plans for the future and {it is|itâ€™s} time to be happy. {I have|Iâ€™ve} read this post and if I could I {want to|wish to|desire to} suggest you {few|some} interesting things or {advice|suggestions|tips}. {Perhaps|Maybe} you {could|can} write next articles referring to this article. I {want to|wish to|desire to} read {more|even more} things about it!| {It is|Itâ€™s} {appropriate|perfect|the best} time to make {a few|some} plans for {the future|the longer term|the long run} and {it is|itâ€™s} time to be happy. {I have|Iâ€™ve} {read|learn} this {post|submit|publish|put up} and if I {may just|may|could} I {want to|wish to|desire to} {suggest|recommend|counsel} you {few|some} {interesting|fascinating|attention-grabbing} {things|issues} or {advice|suggestions|tips}. {Perhaps|Maybe} you {could|can} write {next|subsequent} articles {relating to|referring to|regarding} this article. I {want to|wish to|desire to} {read|learn} {more|even more} {things|issues} {approximately|about} it!| {I have|Iâ€™ve} been {surfing|browsing} {online|on-line} {more than|greater than} {three|3} hours {these days|nowadays|today|lately|as of late}, {yet|but} I {never|by no means} {found|discovered} any {interesting|fascinating|attention-grabbing} article like yours. {Itâ€™s|It is} {lovely|pretty|beautiful} {worth|value|price} {enough|sufficient} for me. {In my opinion|Personally|In my view}, if all {webmasters|site owners|website owners|web owners} and bloggers made {just right|good|excellent} {content|content material} as {you did|you probably did}, the {internet|net|web} {will be|shall be|might be|will probably be|can be|will likely be} {much more|a lot more} {useful|helpful} than ever before.| Ahaa, its {nice|pleasant|good|fastidious} {discussion|conversation|dialogue} {regarding|concerning|about|on the topic of} this {article|post|piece of writing|paragraph} {here|at this place} at this {blog|weblog|webpage|website|web site}, I have read all that, so {now|at this time} me also commenting {here|at this place}.| I am sure this {article|post|piece of writing|paragraph} has touched all the internet {users|people|viewers|visitors}, its really really {nice|pleasant|good|fastidious} {article|post|piece of writing|paragraph} on building up new {blog|weblog|webpage|website|web site}.| Wow, this {article|post|piece of writing|paragraph} is {nice|pleasant|good|fastidious}, my {sister|younger sister} is analyzing {such|these|these kinds of} things, {so|thus|therefore} I am going to {tell|inform|let know|convey} her.| {Saved as a favorite|bookmarked!!}, {I really like|I like|I love} {your blog|your site|your web site|your website}!| Way cool! Some {very|extremely} valid points! I appreciate you {writing this|penning this} {article|post|write-up} {and the|and also the|plus the} rest of the {site is|website is} {also very|extremely|very|also really|really} good.| Hi, {I do believe|I do think} {this is an excellent|this is a great} {blog|website|web site|site}. I stumbledupon it ;) {I will|I am going to|Iâ€™m going to|I may} {come back|return|revisit} {once again|yet again} {since I|since i have} {bookmarked|book marked|book-marked|saved as a favorite} it. Money and freedom {is the best|is the greatest} way to change, may you be rich and continue to {help|guide} {other people|others}.| Woah! Iâ€™m really {loving|enjoying|digging} the template/theme of this {site|website|blog}. Itâ€™s simple, yet effective. A lot of times itâ€™s {very hard|very difficult|challenging|tough|difficult|hard} to get that â€žperfect balanceâ€ between {superb usability|user friendliness|usability} and {visual appearance|visual appeal|appearance}. I must say {that youâ€™ve|you have|youâ€™ve} done a {awesome|amazing|very good|superb|fantastic|excellent|great} job with this. {In addition|Additionally|Also}, the blog loads {very|extremely|super} {fast|quick} for me on {Safari|Internet explorer|Chrome|Opera|Firefox}. {Superb|Exceptional|Outstanding|Excellent} Blog!| These are {really|actually|in fact|truly|genuinely} {great|enormous|impressive|wonderful|fantastic} ideas in {regarding|concerning|about|on the topic of} blogging. You have touched some {nice|pleasant|good|fastidious} {points|factors|things} here. Any way keep up wrinting.| {I love|I really like|I enjoy|I like|Everyone loves} what you guys {are|are usually|tend to be} up too. {This sort of|This type of|Such|This kind of} clever work and {exposure|coverage|reporting}! Keep up the {superb|terrific|very good|great|good|awesome|fantastic|excellent|amazing|wonderful} works guys Iâ€™ve {incorporated||added|included} you guys to {|my|our||my personal|my own} blogroll.| {Howdy|Hi there|Hey there|Hi|Hello|Hey}! Someone in my {Myspace|Facebook} group shared this {site|website} with us so I came to {give it a look|look it over|take a look|check it out}. Iâ€™m definitely {enjoying|loving} the information. Iâ€™m {book-marking|bookmarking} and will be tweeting this to my followers! {Terrific|Wonderful|Great|Fantastic|Outstanding|Exceptional|Superb|Excellent} blog and {wonderful|terrific|brilliant|amazing|great|excellent|fantastic|outstanding|superb} {style and design|design and style|design}.| {I love|I really like|I enjoy|I like|Everyone loves} what you guys {are|are usually|tend to be} up too. {This sort of|This type of|Such|This kind of} clever work and {exposure|coverage|reporting}! Keep up the {superb|terrific|very good|great|good|awesome|fantastic|excellent|amazing|wonderful} works guys Iâ€™ve {incorporated|added|included} you guys to {|my|our|my personal|my own} blogroll.| {Howdy|Hi there|Hey there|Hi|Hello|Hey} would you mind {stating|sharing} which blog platform youâ€™re {working with|using}? Iâ€™m {looking|planning|going} to start my own blog {in the near future|soon} but Iâ€™m having a {tough|difficult|hard} time {making a decision|selecting|choosing|deciding} between BlogEngine/Wordpress/B2evolution and Drupal. The reason I ask is because your {design and style|design|layout} seems different then most blogs and Iâ€™m looking for something {completely unique|unique}. P.S {My apologies|Apologies|Sorry} for {getting|being} off-topic but I had to ask!| {Howdy|Hi there|Hi|Hey there|Hello|Hey} would you mind letting me know which {webhost|hosting company|web host} youâ€™re {utilizing|working with|using}? Iâ€™ve loaded your blog in 3 {completely different|different} {internet browsers|web browsers|browsers} and I must say this blog loads a lot {quicker|faster} then most. Can you {suggest|recommend} a good {internet hosting|web hosting|hosting} provider at a {honest|reasonable|fair} price? {Thanks a lot|Kudos|Cheers|Thank you|Many thanks|Thanks}, I appreciate it!| {I love|I really like|I like|Everyone loves} it {when people|when individuals|when folks|whenever people} {come together|get together} and share {opinions|thoughts|views|ideas}. Great {blog|website|site}, {keep it up|continue the good work|stick with it}!| Thank you for the {auspicious|good} writeup. It in fact was a amusement account it. Look advanced to {far|more} added agreeable from you! {By the way|However}, how {can|could} we communicate?| {Howdy|Hi there|Hey there|Hello|Hey} just wanted to give you a quick heads up. The {text|words} in your {content|post|article} seem to be running off the screen in {Ie|Internet explorer|Chrome|Firefox|Safari|Opera}. Iâ€™m not sure if this is a {format|formatting} issue or something to do with {web browser|internet browser|browser} compatibility but I {thought|figured} Iâ€™d post to let you know. The {style and design|design and style|layout|design} look great though! Hope you get the {problem|issue} {solved|resolved|fixed} soon. {Kudos|Cheers|Many thanks|Thanks}| This is a topic {that is|thatâ€™s|which is} {close to|near to} my heartâ€¦ {Cheers|Many thanks|Best wishes|Take care|Thank you}! {Where|Exactly where} are your contact details though?| Itâ€™s very {easy|simple|trouble-free|straightforward|effortless} to find out any {topic|matter} on {net|web} as compared to {books|textbooks}, as I found this {article|post|piece of writing|paragraph} at this {website|web site|site|web page}.| Does your {site|website|blog} have a contact page? Iâ€™m having {a tough time|problems|trouble} locating it but, Iâ€™d like to {send|shoot} you an {e-mail|email}. Iâ€™ve got some {creative ideas|recommendations|suggestions|ideas} for your blog you might be interested in hearing. Either way, great {site|website|blog} and I look forward to seeing it {develop|improve|expand|grow} over time.| {Hola|Hey there|Hi|Hello|Greetings}! Iâ€™ve been {following|reading} your {site|web site|website|weblog|blog} for {a long time|a while|some time} now and finally got the {bravery|courage} to go ahead and give you a shout out from {New Caney|Kingwood|Huffman|Porter|Houston|Dallas|Austin|Lubbock|Humble|Atascocita} {Tx|Texas}! Just wanted to {tell you|mention|say} keep up the {fantastic|excellent|great|good} {job|work}!| Greetings from {Idaho|Carolina|Ohio|Colorado|Florida|Los angeles|California}! Iâ€™m {bored to tears|bored to death|bored} at work so I decided to {check out|browse} your {site|website|blog} on my iphone during lunch break. I {enjoy|really like|love} the {knowledge|info|information} you {present|provide} here and canâ€™t wait to take a look when I get home. Iâ€™m {shocked|amazed|surprised} at how {quick|fast} your blog loaded on my {mobile|cell phone|phone} .. Iâ€™m not even using WIFI, just 3G .. {Anyhow|Anyways}, {awesome|amazing|very good|superb|good|wonderful|fantastic|excellent|great} {site|blog}!| Its {like you|such as you} {read|learn} my {mind|thoughts}! You {seem|appear} {to understand|to know|to grasp} {so much|a lot} {approximately|about} this, {like you|such as you} wrote the {book|e-book|guide|ebook|e book} in it or something. {I think|I feel|I believe} {that you|that you simply|that you just} {could|can} do with {some|a few} {%|p.c.|percent} to {force|pressure|drive|power} the message {house|home} {a bit|a little bit}, {however|but} {other than|instead of} that, {this is|that is} {great|wonderful|fantastic|magnificent|excellent} blog. {A great|An excellent|A fantastic} read. {Iâ€™ll|I will} {definitely|certainly} be back.| I visited {multiple|many|several|various} {websites|sites|web sites|web pages|blogs} {but|except|however} the audio {quality|feature} for audio songs {current|present|existing} at this {website|web site|site|web page} is {really|actually|in fact|truly|genuinely} {marvelous|wonderful|excellent|fabulous|superb}.| {Howdy|Hi there|Hi|Hello}, i read your blog {occasionally|from time to time} and i own a similar one and i was just {wondering|curious} if you get a lot of spam {comments|responses|feedback|remarks}? If so how do you {prevent|reduce|stop|protect against} it, any plugin or anything you can {advise|suggest|recommend}? I get so much lately itâ€™s driving me {mad|insane|crazy} so any {assistance|help|support} is very much appreciated.| Greetings! {Very helpful|Very useful} advice {within this|in this particular} {article|post}! {It is the|Itâ€™s the} little changes {that make|which will make|that produce|that will make} {the biggest|the largest|the greatest|the most important|the most significant} changes. {Thanks a lot|Thanks|Many thanks} for sharing!| {I really|I truly|I seriously|I absolutely} love {your blog|your site|your website}.. {Very nice|Excellent|Pleasant|Great} colors \u0026amp; theme. Did you {create|develop|make|build} {this website|this site|this web site|this amazing site} yourself? Please reply back as Iâ€™m {looking to|trying to|planning to|wanting to|hoping to|attempting to} create {my own|my very own|my own personal} {blog|website|site} and {would like to|want to|would love to} {know|learn|find out} where you got this from or {what the|exactly what the|just what the} theme {is called|is named}. {Thanks|Many thanks|Thank you|Cheers|Appreciate it|Kudos}!| {Hi there|Hello there|Howdy}! This {post|article|blog post} {couldnâ€™t|could not} be written {any better|much better}! {Reading through|Looking at|Going through|Looking through} this {post|article} reminds me of my previous roommate! He {always|constantly|continually} kept {talking about|preaching about} this. {I will|Iâ€™ll|I am going to|I most certainly will} {forward|send} {this article|this information|this post} to him. {Pretty sure|Fairly certain} {he will|heâ€™ll|heâ€™s going to} {have a good|have a very good|have a great} read. {Thank you for|Thanks for|Many thanks for|I appreciate you for} sharing!| {Wow|Whoa|Incredible|Amazing}! This blog looks {exactly|just} like my old one! Itâ€™s on a {completely|entirely|totally} different {topic|subject} but it has pretty much the same {layout|page layout} and design. {Excellent|Wonderful|Great|Outstanding|Superb} choice of colors!| {There is|Thereâ€™s} {definately|certainly} {a lot to|a great deal to} {know about|learn about|find out about} this {subject|topic|issue}. {I like|I love|I really like} {all the|all of the} points {you made|youâ€™ve made|you have made}.| {You made|Youâ€™ve made|You have made} some {decent|good|really good} points there. I {looked|checked} {on the internet|on the web|on the net} {for more info|for more information|to find out more|to learn more|for additional information} about the issue and found {most individuals|most people} will go along with your views on {this website|this site|this web site}.| {Hi|Hello|Hi there|Whatâ€™s up}, I {log on to|check|read} your {new stuff|blogs|blog} {regularly|like every week|daily|on a regular basis}. Your {story-telling|writing|humoristic} style is {awesome|witty}, keep {doing what youâ€™re doing|up the good work|it up}!| I {simply|just} {could not|couldnâ€™t} {leave|depart|go away} your {site|web site|website} {prior to|before} suggesting that I {really|extremely|actually} {enjoyed|loved} {the standard|the usual} {information|info} {a person|an individual} {supply|provide} {for your|on your|in your|to your} {visitors|guests}? Is {going to|gonna} be {back|again} {frequently|regularly|incessantly|steadily|ceaselessly|often|continuously} {in order to|to} {check up on|check out|inspect|investigate cross-check} new posts| {I wanted|I needed|I want to|I need to} to thank you for this {great|excellent|fantastic|wonderful|good|very good} read!! I {definitely|certainly|absolutely} {enjoyed|loved} every {little bit of|bit of} it. {I have|Iâ€™ve got|I have got} you {bookmarked|book marked|book-marked|saved as a favorite} {to check out|to look at} new {stuff you|things you} postâ€¦| {Hi|Hello|Hi there|Whatâ€™s up}, just wanted to {mention|say|tell you}, I {enjoyed|liked|loved} this {article|post|blog post}. It was {inspiring|funny|practical|helpful}. Keep on posting!| I {{leave|drop|{write|create}} a {comment|leave a response}|drop a {comment|leave a response}|{comment|leave a response}} {each time|when|whenever} I {appreciate|like|especially enjoy} a {post|article} on a {site|{blog|website}|site|website} or {I have|if I have} something to {add|contribute|valuable to contribute} {to the discussion|to the conversation}. {It is|Usually it is|Usually itâ€™s|Itâ€™s} {a result of|triggered by|caused by} the {passion|fire|sincerness} {communicated|displayed} in the {post|article} I {read|looked at|browsed}. And {on|after} this {post|article} Kopiowanie wolumenÃ³w LVM z dd i netcat | timorâ€™s site. I {{was|was actually} moved|{was|was actually} excited} enough to {drop|{leave|drop|{write|create}}|post} a {thought|{comment|{comment|leave a response}a response}} {:-P|:)|;)|;-)|: -)} I {do have|actually do have} {{some|a few} questions|a couple of questions|2 questions} for you {if you {donâ€™t|do not|usually do not|tend not to} mind|if itâ€™s {allright|okay}}. {Is it|Could it be} {just|only|simply} me or {do|does it {seem|appear|give the impression|look|look as if|look like} like} {some|a few} of {the|these} {comments|responses|remarks} {look|appear|come across} {like they are|as if they are|like} {coming from|written by|left by} brain dead {people|visitors|folks|individuals}? :-P And, if you are {posting|writing} {on|at} {other|additional} {sites|social sites|online sites|online social sites|places}, {Iâ€™d|I would} like to {follow|keep up with} {you|{anything|everything} {new|fresh} you have to post}. {Could|Would} you {list|make a list} {all|every one|the complete urls} of {your|all your} {social|communal|community|public|shared} {pages|sites} like your {twitter feed, Facebook page or linkedin profile|linkedin profile, Facebook page or twitter feed|Facebook page, twitter feed, or linkedin profile}?| {Hi there|Hello}, I enjoy reading {all of|through} your {article|post|article post}. I {like|wanted} to write a little comment to support you.| I {always|constantly|every time} spent my half an hour to read this {blog|weblog|webpage|website|web site}â€™s {articles|posts|articles or reviews|content} {everyday|daily|every day|all the time} along with a {cup|mug} of coffee.| I {always|for all time|all the time|constantly|every time} emailed this {blog|weblog|webpage|website|web site} post page to all my {friends|associates|contacts}, {because|since|as|for the reason that} if like to read it {then|after that|next|afterward} my {friends|links|contacts} will too.| My {coder|programmer|developer} is trying to {persuade|convince} me to move to .net from PHP. I have always disliked the idea because of the {expenses|costs}. But heâ€™s tryiong none the less. Iâ€™ve been using {Movable-type|WordPress} on {a number of|a variety of|numerous|several|various} websites for about a year and am {nervous|anxious|worried|concerned} about switching to another platform. I have heard {fantastic|very good|excellent|great|good} things about blogengine.net. Is there a way I can {transfer|import} all my wordpress {content|posts} into it? {Any kind of|Any} help would be {really|greatly} appreciated!| {Hello|Hi|Hello there|Hi there|Howdy|Good day}! I could have sworn Iâ€™ve {been to|visited} {this blog|this web site|this website|this site|your blog} before but after {browsing through|going through|looking at} {some of the|a few of the|many of the} {posts|articles} I realized itâ€™s new to me. {Anyways|Anyhow|Nonetheless|Regardless}, Iâ€™m {definitely|certainly} {happy|pleased|delighted} {I found|I discovered|I came across|I stumbled upon} it and Iâ€™ll be {bookmarking|book-marking} it and checking back {frequently|regularly|often}!| {Terrific|Great|Wonderful} {article|work}! {This is|That is} {the type of|the kind of} {information|info} {that are meant to|that are supposed to|that should} be shared {around the|across the} {web|internet|net}. {Disgrace|Shame} on {the {seek|search} engines|Google} for {now not|not|no longer} positioning this {post|submit|publish|put up} {upper|higher}! Come on over and {talk over with|discuss with|seek advice from|visit|consult with} my {site|web site|website} . {Thank you|Thanks} =)| Heya {iâ€™m|i am} for the first time here. I {came across|found} this board and I find It {truly|really} useful \u0026amp; it helped me out {a lot|much}. I hope to give something back and {help|aid} others like you {helped|aided} me.| {Hi|Hello|Hi there|Hello there|Howdy|Greetings}, {I think|I believe|I do believe|I do think|Thereâ€™s no doubt that} {your site|your website|your web site|your blog} {might be|may be|could be|could possibly be} having {browser|internet browser|web browser} compatibility {issues|problems}. {When I|Whenever I} {look at your|take a look at your} {website|web site|site|blog} in Safari, it looks fine {but when|however when|however, if|however, when} opening in {Internet Explorer|IE|I.E.}, {it has|itâ€™s got} some overlapping issues. {I just|I simply|I merely} wanted to {give you a|provide you with a} quick heads up! {Other than that|Apart from that|Besides that|Aside from that}, {fantastic|wonderful|great|excellent} {blog|website|site}!| {A person|Someone|Somebody} {necessarily|essentially} {lend a hand|help|assist} to make {seriously|critically|significantly|severely} {articles|posts} {I would|I might|Iâ€™d} state. {This is|That is} the {first|very first} time I frequented your {web page|website page} and {to this point|so far|thus far|up to now}? I {amazed|surprised} with the {research|analysis} you made to {create|make} {this actual|this particular} {post|submit|publish|put up} {incredible|amazing|extraordinary}. {Great|Wonderful|Fantastic|Magnificent|Excellent} {task|process|activity|job}!| Heya {iâ€™m|i am} for {the primary|the first} time here. I {came across|found} this board and I {in finding|find|to find} It {truly|really} {useful|helpful} \u0026amp; it helped me out {a lot|much}. {I am hoping|I hope|Iâ€™m hoping} {to give|to offer|to provide|to present} {something|one thing} {back|again} and {help|aid} others {like you|such as you} {helped|aided} me.| {Hello|Hi|Hello there|Hi there|Howdy|Good day|Hey there}! {I just|I simply} {would like to|want to|wish to} {give you a|offer you a} {huge|big} thumbs up {for the|for your} {great|excellent} {info|information} {you have|youâ€™ve got|you have got} {here|right here} on this post. {I will be|Iâ€™ll be|I am} {coming back to|returning to} {your blog|your site|your website|your web site} for more soon.| I {always|all the time|every time} used to {read|study} {article|post|piece of writing|paragraph} in news papers but now as I am a user of {internet|web|net} {so|thus|therefore} from now I am using net for {articles|posts|articles or reviews|content}, thanks to web.| Your {way|method|means|mode} of {describing|explaining|telling} {everything|all|the whole thing} in this {article|post|piece of writing|paragraph} is {really|actually|in fact|truly|genuinely} {nice|pleasant|good|fastidious}, {all|every one} {can|be able to|be capable of} {easily|without difficulty|effortlessly|simply} {understand|know|be aware of} it, Thanks a lot.| {Hi|Hello} there, {I found|I discovered} your {blog|website|web site|site} {by means of|via|by the use of|by way of} Google {at the same time as|whilst|even as|while} {searching for|looking for} a {similar|comparable|related} {topic|matter|subject}, your {site|web site|website} {got here|came} up, it {looks|appears|seems|seems to be|appears to be like} {good|great}. {I have|Iâ€™ve} bookmarked it in my google bookmarks. {Hello|Hi} there, {simply|just} {turned into|became|was|become|changed into} {aware of|alert to} your {blog|weblog} {thru|through|via} Google, {and found|and located} that {it is|itâ€™s} {really|truly} informative. {Iâ€™m|I am} {gonna|going to} {watch out|be careful} for brussels. {I will|Iâ€™ll} {appreciate|be grateful} {if you|should you|when you|in the event you|in case you|for those who|if you happen to} {continue|proceed} this {in future}. {A lot of|Lots of|Many|Numerous} {other folks|folks|other people|people} {will be|shall be|might be|will probably be|can be|will likely be} benefited {from your|out of your} writing. Cheers!| {I am|Iâ€™m} curious to find out what blog {system|platform} {you have been|you happen to be|you are|youâ€™re} {working with|utilizing|using}? Iâ€™m {experiencing|having} some {minor|small} security {problems|issues} with my latest {site|website|blog} and {I would|Iâ€™d} like to find something more {safe|risk-free|safeguarded|secure}. Do you have any {solutions|suggestions|recommendations}?| {I am|Iâ€™m} {extremely|really} impressed with your writing skills {and also|as well as} with the layout on your {blog|weblog}. Is this a paid theme or did you {customize|modify} it yourself? {Either way|Anyway} keep up the {nice|excellent} quality writing, {itâ€™s|it is} rare to see a {nice|great} blog like this one {these days|nowadays|today}.| {I am|Iâ€™m} {extremely|really} {inspired|impressed} {with your|together with your|along with your} writing {talents|skills|abilities} {and also|as {smartly|well|neatly} as} with the {layout|format|structure} {for your|on your|in your|to your} {blog|weblog}. {Is this|Is that this} a paid {subject|topic|subject matter|theme} or did you {customize|modify} it {yourself|your self}? {Either way|Anyway} {stay|keep} up the {nice|excellent} {quality|high quality} writing, {itâ€™s|it is} {rare|uncommon} {to peer|to see|to look} a {nice|great} {blog|weblog} like this one {these days|nowadays|today}..| {Hi|Hello}, Neat post. {There is|Thereâ€™s} {a problem|an issue} {with your|together with your|along with your} {site|web site|website} in {internet|web} explorer, {may|might|could|would} {check|test} this? IE {still|nonetheless} is the {marketplace|market} {leader|chief} and {a large|a good|a big|a huge} {part of|section of|component to|portion of|component of|element of} {other folks|folks|other people|people} will {leave out|omit|miss|pass over} your {great|wonderful|fantastic|magnificent|excellent} writing {due to|because of} this problem.| {Iâ€™m|I am} not sure where {you are|youâ€™re} getting your {info|information}, but {good|great} topic. I needs to spend some time learning {more|much more} or understanding more. Thanks for {great|wonderful|fantastic|magnificent|excellent} {information|info} I was looking for this {information|info} for my mission.| {Hi|Hello}, i think that i saw you visited my {blog|weblog|website|web site|site} {so|thus} i came to â€œreturn the favorâ€.{I am|Iâ€™m} {trying to|attempting to} find things to {improve|enhance} my {website|site|web site}!I suppose its ok to use {some of|a few of} your ideas ","href":"/2013/09/spammer-screwed-up/","title":"Spammer screwed up"},{"content":"","href":"/tags/raspberry-pi/","title":"Raspberry Pi"},{"content":"WyprzeÄ‡ siÄ™ nie mogÄ™ Å¼e gadÅ¼ety dziaÅ‚ajÄ…ce na Linuksie po prostu mnie krÄ™cÄ…, wiÄ™c tylko kwestiÄ… czasu byÅ‚o aÅ¼ Pi zawita na moim biurku. ZakupiÅ‚em wiÄ™c model B w drugiej wersji, obudowÄ™ z moÅ¼liwoÅ›ciÄ… mocowania VESA, kabelek HDMI, Å‚adowarka z mojej myszy pasowaÅ‚a idealnie (5.05V i 1A) i na poczÄ…tek karta SD klasa 10 4GB.\nSzukajÄ…c rÃ³Å¼nych systemÃ³w (a moÅ¼e ROM\u0026rsquo;Ã³w) natrafiÅ‚em na oficjalnÄ… stronÄ™: http://www.raspberrypi.org/downloads\nNa poczÄ…tek wystarczy a sprawdzajÄ…c na stronach projektÃ³w okazaÅ‚o siÄ™ Å¼e wersje na tej stronie sÄ… caÅ‚kiem aktualne.\nChociaÅ¼ paczka NOOB wyglÄ…daÅ‚a kuszÄ…co to byÅ‚Ä… najwiÄ™ksza i Å›ciÄ…gnÄ™Å‚a mi siÄ™ jak juÅ¼ dziaÅ‚aÅ‚em na OpenELEC\u0026rsquo;u. Na dobrÄ… sprawÄ™ nie rozumiem czemu tÄ™ drogÄ™ opisano jako trudniejszÄ…\u0026hellip;\nNagrywanie obrazu na kartÄ™ SD  Wpinamy kartÄ™ SD w czytnik Odpalamy:  dmesg i szukamy jakÄ… literkÄ™ jej przyporzÄ…dkowano w systemie\n Odpalamy na tym dysku:  fdisk -l /dev/sdh (w moim przypadku) i upewniamy siÄ™ Å¼e rozmiar i tablica partycji odpowiadajÄ… naszej karcie (pomyÅ‚ka literki to bankowa utrata danych i co najmniej jedna nieprzespana noc\u0026hellip;)\n Rozpakowujemy obraz:  unzip 2013-07-26-wheezy-raspbian.zip  MoÅ¼emy wgrywaÄ‡:  sudo dd bs=1M if=2013-07-26-wheezy-raspbian.img of=/dev/sdh status kopiowania moÅ¼emy podglÄ…daÄ‡ tak:\nkill -USR1 `pidof dd` (o ile mamy uruchomiony jeden proces dd w systemi)\n W przypadku niektÃ³rych obrazÃ³w moÅ¼e byÄ‡ potrzebna zmiana rozmiaru partycji (bo domyÅ›lnie przygotowane sÄ… dla mniejszych kart - polecam parted lub gparted do tego zadania  MoÅ¼na startowaÄ‡!\n","href":"/2013/09/raspberry-pi-pierwsze-kroki/","title":"Raspberry Pi: pierwsze kroki"},{"content":"PolubiÅ‚em Nginx\u0026rsquo;a i wykorzystujÄ™ go na coraz wiÄ™cej sposobÃ³w. Kilka rzeczy udaÅ‚o mi siÄ™ caÅ‚kiem fajnie w nim skonfigurowaÄ‡ i postanowiÅ‚em zebraÄ‡ te przykÅ‚ady by nastÄ™pnym razem gdy postanowiÄ™ do nich siÄ™gnÄ…Ä‡ nie musieÄ‡ wertowaÄ‡ konfigÃ³w po serwerach ðŸ˜ƒ\nSÅ‚owo wstÄ™pu NiektÃ³re rewrite\u0026rsquo;y koÅ„czÄ… siÄ™ znakiem ? - czemu?\nOtÃ³Å¼ Nginx prÃ³buje automatycznie dodawaÄ‡ parametry na koÅ„cu przepisanego adresu. JeÅ›li jednak wykorzystamy zmiennÄ… $request_uri to ona sama w sobie zawiera juÅ¼ parametry zapytania (czyli to co w URI znajduje siÄ™ po znaku ?) i wÅ‚aÅ›nie dodanie pytajnika tuÅ¼ za tÄ… zmiennÄ… powoduje Å¼e argumenty nie sÄ… dublowane.\nMa to teÅ¼ zastosowanie gdy chcemy by rewrite kierowaÅ‚ np. na gÅ‚Ã³wnÄ… stronÄ™ beÅ¼ Å¼adnych dodatkowych argumentÃ³w (zostanÄ… one obciÄ™te).\nWiÄ™cej na ten temat moÅ¼na znaleÅºÄ‡ w dokumentacji Nginx.\nInna warta wspomnienia uwaga dotyczy drobnej optymalizacji, o ktÃ³rej warto pamiÄ™taÄ‡ na etapie tworzenia rewrite\u0026rsquo;Ã³w (moÅ¼na znaleÅºÄ‡ masÄ™ kiepskich przykÅ‚adÃ³w w sieci): na poczÄ…tku najlepiej jest stworzyÄ‡ coÅ› co dziaÅ‚a (i przy maÅ‚ym ruchu moÅ¼e to byÄ‡ wystarczajÄ…ce) a pÃ³Åºniej optymalizowaÄ‡ - moje przykÅ‚ady staraÅ‚em siÄ™ zoptymalizowaÄ‡ wedÅ‚ug zalecanych praktyk.\nDlatego zamiast pisaÄ‡:\nrewrite ^(.*)$ $scheme://www.domain.com$1 permanent; lepiej napisaÄ‡:\nrewrite ^ $scheme://www.domain.com$request_uri? permanent; (nie wykorzystujemy przechowywania wartoÅ›ci dopasowania - mniejsze zuÅ¼ycie pamiÄ™ci i lÅ¼ejsza interpretacja REGEXP\u0026rsquo;a).\nA jeszcze lepiej napisaÄ‡:\nreturn 301 $scheme://www.domain.com$request_uri; (w ogÃ³le nie wykorzystujemy REGEXP\u0026rsquo;Ã³w praktycznie zerowy narzut na przetwarzanie) - dziÄ™ki za uwagÄ™: lukasamd.\nPrzekierowanie starej domeny na nowÄ… server { listen 80; server_name old-domain.com www.old-domain.com; return 301 $scheme://www.new-domain.com$request_uri; # rewrite ^ $scheme://www.new-domain.com$request_uri? permanent;  # or  # rewrite ^ $scheme://www.new-domain.com? permanent; } Wykorzystanie return w tej sytuacji jest nieco bardziej optymalne gdyÅ¼ nie angaÅ¼uje w ogÃ³le silnika REGEXP a w tej sytuacji jest wystarczajÄ…ce.\nPierwsza linia z rewrite i $request_uri spowoduje przepisywanie teÅ¼ parametrÃ³w wywoÅ‚aÅ„ do nowej lokalizacji co jest jak najbardziej sensowne gdy pomimo domeny nie zmieniÅ‚a siÄ™ zbytnio struktura strony.\nJeÅ›li strona jednak siÄ™ zmieniÅ‚a to moÅ¼emy zdecydowaÄ‡ o przekierowaniu bez parametrÃ³w - po prostu na gÅ‚Ã³wnÄ… stronÄ™ - i to robi druga linia.\nW obu przypadkach parametr permanent nakazuje uÅ¼ycie kodu przekierowania HTTP 301 (Moved Permanently), co uÅ‚atwi zorientowanie siÄ™ crawlerom Å¼e ta zmiana jest juÅ¼ na staÅ‚e.\nDodanie WWW na poczÄ…tku domeny server { listen 80; server_name domaim.com; return 301 $scheme://www.domain.com$request_uri; #rewrite ^ $scheme://www.domain.com$request_uri? permanent;  # or  #rewrite ^(.*)$ $scheme://www.domain.com$1 permanent; } PrzykÅ‚ad zakomentowany jest wedÅ‚ug dokumentacji mniej optymalny ale rÃ³wnieÅ¼ zadziaÅ‚a. Reszta jest prosta i samoopisujÄ…ca siÄ™ ðŸ˜ƒ\nA to jeszcze bardziej ogÃ³lna wersja dla wielu domen:\nserver { listen 195.117.254.80:80; server_name domain.pl domain.eu domain.com; return 301 $scheme://www.$http_host$request_uri; #rewrite ^ $scheme://www.$http_host$request_uri? permanent; } Ta wersja wykorzystuje zmiennÄ… $http_host do przekierowania na domenÄ™ z zapytania (zmienna ta zawiera teÅ¼ numer portu jeÅ›li jest niestandardowy np. 8080, w przeciwieÅ„stwie do zmiennej $host, ktÃ³ra zawiera tylko domenÄ™).\nUsuniÄ™cie WWW z poczÄ…tku domeny server { listen 80; server_name www.domain.com; return 301 $scheme://domain.com$request_uri; #rewrite ^ $scheme://domain.com$request_uri? permanent; } Czasami moÅ¼e siÄ™ przydaÄ‡ jeszcze inny kawaÅ‚ek, gdy strona dziaÅ‚a na wielu domenach i chcemy przekierowaÄ‡ wszystkie:\nserver { server_name www.domain.com _ ; # server_name www.domain1.com www.domain2.com www.domain3.eu www.domain.etc.com;  if ($host ~* www\\.(.*)) { set $pure_host $1; return 301 $scheme://$pure_host$request_uri; #rewrite ^ $scheme://$pure_host$request_uri? permanent;  #rewrite ^(.*)$ $scheme://$pure_host$1 permanent;  } } ChoÄ‡ to podejÅ›cie nie jest zalecane (pomimo zwiÄ™zÅ‚oÅ›ci). Lepiej zdefiniowaÄ‡ dwa bloki server z domenami www.* i domenami bez www na poczÄ…tku. Ale z drugiej strony to cholernie wygodne\u0026hellip; ðŸ˜ƒ\nPrzekierowanie \u0026ldquo;pozostaÅ‚ych\u0026rdquo; zapytaÅ„ na domyÅ›lnÄ… domenÄ™ server { listen 80 default; server_name _; rewrite ^ $scheme://www.domena.com; #rewrite ^ $scheme://www.domena.com/search/$host; } To bardzo przydatny przykÅ‚ad - czyli domyÅ›lny vhost, ktÃ³ry \u0026ldquo;przyjmie\u0026rdquo; wszystkie zapytania do domen nie zdefiniowanych w konfiguracji i przekieruje na naszÄ… \u0026ldquo;gÅ‚Ã³wnÄ… stronÄ™\u0026rdquo;.\nZakomentowany przykÅ‚ad jest nieco bardziej przekombinowany bo prÃ³buje wykorzystaÄ‡ wyszukiwarkÄ™ na naszej stronie do wyszukania \u0026ldquo;czegoÅ›\u0026rdquo; pomocnego - z tym przykÅ‚adem naleÅ¼y uwaÅ¼aÄ‡ bo jeÅ›li do serwera trafi duÅ¼o bÅ‚Ä™dnych zapytaÅ„ to moÅ¼e zostaÄ‡ przeciÄ…Å¼ony \u0026ldquo;bzdetnymi\u0026rdquo; wyszukiwaniami.\nPrzekierowanie pewnych podstron po zmianie struktury strony server { listen 80; server_name www.domain.com; location / { try_files $uri $uri/ @rewrites; } location @rewrites { rewrite /tag/something $scheme://new.domain.com permanent; rewrite /category/hobby /category/painting permanent; # etc ...  rewrite ^ /index.php last; } } Im starsza strona tym wiÄ™cej zbiera siÄ™ linkÃ³w, ktÃ³rych po prostu nie moÅ¼na usunÄ…Ä‡, a ktÃ³re z racji wprowadzonych zmian nie majÄ… prawa bytu w nowym ukÅ‚adzie. Warto je przekierowaÄ‡ w nowe miejsca, lub najbardziej odpowiadajÄ…ce/bliskie tym starym. Problemem moÅ¼e siÄ™ wkrÃ³tce staÄ‡ duÅ¼a lista przekierowaÅ„, ktÃ³ra zaciemni konfiguracjÄ™.\nPowyÅ¼szy sposÃ³b w doÅ›Ä‡ optymalny sposÃ³b porzÄ…dkuje takie przekierowania - najpierw sprawdza czy przypadkiem nie prÃ³bujemy pobraÄ‡ istniejÄ…cych plikÃ³w, jeÅ›li nie to wrzuca nas nas na listÄ™ przekierowaÅ„, a jeÅ›li i tu nic nie znajdzie to zapytanie przekazywane jest do gÅ‚Ã³wnego skryptu strony.\nPrzekierowanie w zaleÅ¼noÅ›ci od wartoÅ›ci parametru w URI if ($args ~ producent=toyota){ rewrite ^ $scheme://toyota.domena.com$request_uri? permanent; } To rzadko stosowane przekierowanie a w dodatku maÅ‚o czytelnie i ponoÄ‡ maÅ‚o wydajne\u0026hellip; Ale potrafi byÄ‡ bardzo przydatne gdy chcemy przepisaÄ‡ adres w zaleÅ¼noÅ›ci od wartoÅ›ci parametru np. gdy pewna podstrona doczeka siÄ™ rozbudowy w zupeÅ‚nie nowym serwisie lub gdy chcemy Å‚adnie przekierowaÄ‡ adresy ze starej strony na nowÄ….\nBlokowanie dostÄ™pu do ukrytych plikÃ³w location ~ /\\. { access_log off; log_not_found off; deny all; } PrzyznajÄ™ - to nie rewrite\u0026hellip; Ale ta linijka jest rÃ³wnie przydatna - pozwala zablokowaÄ‡ moÅ¼liwoÅ›Ä‡ pobierania ukrytych plikÃ³w (np. .htaccess\u0026rsquo;Ã³w po konfiguracji z Apachego).\nWyÅ‚Ä…czenie logowania dla robots.txt i favicon.ico location = /favicon.ico { try_files /favicon.ico =204; access_log off; log_not_found off; } location = /robots.txt { try_files /robots.txt =204; access_log off; log_not_found off; } To teÅ¼ nie rewrite - ale bardzo fajnie obsÅ‚uguje sytuacjÄ™ gdy mamy i gdy nie mamy powyÅ¼szych dwÃ³ch pliczkÃ³w. Po pierwsze wyÅ‚Ä…cza logowanie i serwuje je gdy sÄ… dostÄ™pne. Gdy nie istniejÄ… to serwuje puste pliki (kod 204) dziÄ™ki czemu nie przeszkadzajÄ… nam 404-ki ðŸ˜ƒ\nBlokowanie dostÄ™pu do obrazkÃ³w dla nieznanych referererÃ³w location ~* ^.+\\.(?:jpg|png|css|gif|jpeg|js|swf)$ { # definiujemy poprawnych refererow  valid_referers none blocked *.domain.com domain.com; if ($invalid_referer) { return 444; } expires max; break; } Zabezpieczenie warte tyle co nic bo banalne do ominiÄ™cia - ale jeÅ›li zdarzy siÄ™ Å¼e ktoÅ› postanowi wykorzystaÄ‡ grafikÄ™ z naszej stronki np. w aukcji na allegro czy wÅ‚asnym sklepie to tÄ… prostÄ… sztuczkÄ… moÅ¼emy go przyciÄ…Ä‡ i przewaÅ¼nie jest to wystarczajÄ…ce.\nMuszÄ™ teÅ¼ zaznaczyÄ‡ szczegÃ³lne znaczenie wartoÅ›ci kodu bÅ‚Ä™du 444 w Nginx\u0026rsquo;ie - powoduje on zerwanie poÅ‚Ä…czenia bez wysyÅ‚ania jakiejkolwiek odpowiedzi. JeÅ›li nie chcemy byÄ‡ tak okrutni to moÅ¼emy uÅ¼yÄ‡ innego kodu, np.: 403 albo 402 ðŸ˜ƒ\nPrzekierowanie ciekawskich w \u0026ldquo;ciemnÄ… dupÄ™\u0026rdquo; location ~* ^/(wp-)?admin(istrator)?/? { rewrite ^ http://whatismyipaddress.com/ip/$remote_addr redirect; } Ten prosty redirect odwodzi wielu amatorÃ³w zbyt gÅ‚Ä™bokiego penetrowania naszej strony\u0026hellip; A pozostaÅ‚ych na pewno rozbawi ðŸ˜ƒ\nInne przykÅ‚ady konfiguracji na mojej stronie:\n Nginx - hide server version and name in Server header and error pages Nginx - kompresowanie plikÃ³w dla gzip_static Nginx - konfiguracja pod WordPressâ€™a Nginx - ustawienie domyÅ›lnego vhosta Nginx - mÃ³j domyÅ›lny config  Å¹rÃ³dÅ‚a http://www.engineyard.com/blog/2011/useful-rewrites-for-nginx/\nhttp://wiki.nginx.org/HttpRewriteModule\n","href":"/2013/09/nginx-przydatne-rewritey-i-rozne-sztuczki/","title":"Nginx - przydatne rewriteâ€™y i rÃ³Å¼ne sztuczki"},{"content":"ChcÄ…c pobawiÄ‡ siÄ™ tor\u0026rsquo;em postanowiÅ‚em udostÄ™pniÄ‡ jedna z moich stron z wykorzystaniem mechanizmu hidden service. Nie spodobaÅ‚ mi siÄ™ jedynie sposÃ³b generowania nazw, ktÃ³re byÅ‚y maÅ‚o opisowe - ale najwidoczniej nie mnie jednemu, bo szybko namierzyÅ‚em Shallot, ktÃ³ry generuje kolejne nazwy aÅ¼ trafi na pasujÄ…cÄ… do zadanego regexp\u0026rsquo;a.\n","href":"/2013/09/tor-generowanie-milszej-nazwy-dla-hidden-service/","title":"tor: generowanie milszej nazwy dla hidden service"},{"content":"Ostatnio zbyt duÅ¼o grzebiÄ™ przy \u0026ldquo;windach\u0026rdquo; - ale cÃ³Å¼, czasem trzeba. Ostatnio ustawiaÅ‚em DFS\u0026rsquo;a z replikacjÄ… dla dwÃ³ch sporych zasobÃ³w i jedna z rzeczy, o ktÃ³rÄ… siÄ™ rozbiÅ‚em to brak jakiegokolwiek podglÄ…du tej synchronizacji z GUI. Ale znalazÅ‚em jedno polecenie, ktÃ³re dziaÅ‚a w shellu (choÄ‡ to siÄ™ chyba batch tutaj nazywa) od Windows Server 2008 R2:\ndfsrdiag ReplicationState /member:nazwaservera Polecenie co prawda nie podaje postÄ™pu procentowego ale moÅ¼na zobaczyÄ‡ \u0026ldquo;czy coÅ› jeszcze siÄ™ synchronizuje\u0026rdquo; i czy nie ma Å¼adnych bÅ‚Ä™dÃ³w. JeÅ¼eli to polecenie to za maÅ‚o to moÅ¼na sprÃ³bowaÄ‡ bardziej gadatliwej wersji:\ndfsrdiag ReplicationState /member:nazwaservera /all ","href":"/2013/09/dfs-sprawdzanie-statusu-replikacji/","title":"DFS - sprawdzanie statusu replikacji"},{"content":"Ostatnio aktualizowaÅ‚em swojego Nexusa do 4.3 i byÅ‚o miÅ‚o tylko mi roota i recovery wystrzeliÅ‚o\u0026hellip; No ale Å¼aden problem - chwila googlania, kilka poleceÅ„ i mam recovery i roota. Dzisiaj wrzuciÅ‚em nieduÅ¼Ä… aktualizacjÄ™, ktÃ³ra Å‚ata kilka bugÃ³w i znÃ³w po root\u0026rsquo;cie ;/\nZapisze sobie wiÄ™c instrukcjÄ™ by kolejnym razem juÅ¼ nie googlaÄ‡ ðŸ˜ƒ\nP.S. Wiem co robiÄ™ ryzykujÄ…c uceglenie swojego urzÄ…dzenia - u mnie ta instrukcja dziaÅ‚a ale nie mogÄ™ tego zagwarantowaÄ‡ kaÅ¼demu - dlatego jeÅ›li juÅ¼ siÄ™ zdecydujesz to ROBISZ TO NA WÅASNÄ„ ODPOWIEDZIALNOÅšÄ†!\nBÄ™dzie potrzebne Android SDK lub przynajmniej maÅ‚a paczka z fastboot i adb (wiÄ™cej info o instalacji w linkach na koÅ„cu).\n Na poczÄ…tek sprawdzamy czy nie ma nowego recovery, preferujÄ™ CWM\u0026rsquo;a wiÄ™c zerkamy tutaj Pobieram wersjÄ™ touch (bo na tak duÅ¼ym ekranie caÅ‚kiem komfortowo siÄ™ jÄ… obsÅ‚uguje): recovery-clockwork-touch-6.0.3.6-grouper.img NastÄ™pna waÅ¼na paczka to SuperSU - sprawdzamy jaka jest najnowsza wersja: www.chainfire.eu, a gdy juÅ¼ to wiemy to googlamy za niÄ… na xda developers lub download.chainfire.eu Aktualna paczka to: UPDATE-SuperSU-v1.55.zip ZaktualizowanÄ… paczkÄ™ SuperSU pobieramy/wrzucamy na urzÄ…dzenie. WyÅ‚Ä…czamy tablet WÅ‚Ä…czamy tablet przytrzymujÄ…c rÃ³wnoczeÅ›nie przyciski Volume down + Power do czasu aÅ¼ urzÄ…dzenie zacznie startowaÄ‡ - czekamy aÅ¼ zobaczymy Bootmanagera (rozgrzebany robot ðŸ˜ƒ ) Przechodzimy do katalogu z fastboot i otwieramy tam Command Line (np. przytrzymujÄ…c Shift na folderze i wybierajÄ…c opcjÄ™ OtwÃ³rz tutaj okno wiersza poleceÅ„ - u mnie:  cd D:\\Nexus 7\\4.3\\adt-bundle-windows-x86_64-20130729\\sdk\\platform-tools  Wpisujemy polecenie (uwzglÄ™dniajÄ… wersjÄ™ recovery, ktÃ³rÄ… wgrywamy):  fastboot flash recovery recovery-clockwork-touch-6.0.3.6-grouper.img JeÅ¼eli wszystko pÃ³jdzie pomyÅ›lnie to powinno wypisaÄ‡ coÅ› w rodzaju:\nsending \u0026#39;recovery\u0026#39; (6740 KB)... OKAY [ 0.826s] writing \u0026#39;recovery\u0026#39;... OKAY [ 0.486s] finished. total time: 1.312s JeÅ¼eli zobaczymy: \u0026lt; waiting for device \u0026gt; tzn. Å¼e urzÄ…dzenie nie jest gotowe i moÅ¼na wcisnÄ…Ä‡ Ctrl+C, moÅ¼e nawet trzeba bÄ™dzie poszukaÄ‡ na to rozwiÄ…zania\u0026hellip; \n KorzystajÄ…c z klawiszy Volume down/up wybieramy Recovery Mode i wybÃ³r potwierdzamy przyciskiem Power Po zaÅ‚adowaniu CWM\u0026rsquo;a wybieramy kolejno:  install zip choose zip from sdcard (lÄ…dujemy po tym w /sdcard) i w moim przypadku idÄ™ dalej do 0/Download/ wybieramy - UPDATE-SuperSU-v1.55.zip potwierdzamy wybÃ³r Yes - Install UPDATE-SuperSU-v1.55.zip po instalacji wybieramy +++++Go Back+++++ nastÄ™pnie reboot system now gdy pojawi siÄ™ ROM may flash stock recovery on boot. Fix? THIS CAN NOT BE UNDONE. - wybranie YES nadpisze stock\u0026rsquo;owe recovery (wÅ‚aÅ›ciwie po to instalujÄ™ CWM\u0026rsquo;a), ale moÅ¼na teÅ¼ wybraÄ‡ NO a CWM przepadnie    No i brawo - mamy 4.3 build JWR66Y i root\u0026rsquo;a z CWM recovery ðŸ˜ƒ\nPo restarcie sprawdzamy czy mamy roota odpalajÄ…c choÄ‡by SuperSU.\nÅ¹rÃ³dÅ‚a http://www.info-pc.info/2013/07/how-to-root-nexus-7-android-43-jwr66v.html\nhttp://forum.xda-developers.com/showthread.php?t=2377511\nhttp://forum.xda-developers.com/showthread.php?t=1538053\n","href":"/2013/09/rootowanie-androida-4-3-na-google-nexus-7-po-aktualizacji-do-jwr66y/","title":"Rootâ€™owanie Androida 4.3 na Google Nexus 7 po aktualizacji do JWR66Y"},{"content":"Niedawno chciaÅ‚em skopiowaÄ‡ maszynÄ™ wirtualnÄ… z jednego hypervisora na innego. ByÅ‚y to 3 wolumeny LVM o rozmiarach od 50 do 100GB. Dawno temu zrobiÅ‚em sobie skrypty do backupu - jeden kompresuje wolumeny LVM - a drugi pozwala odtworzyÄ‡ z dekompresja na drugim serwerze. Tyle Å¼e przy tak duÅ¼ej maszynce bÄ™dzie to trwaÅ‚o masakrycznie dÅ‚ugo - fajnie byÅ‚oby mÃ³c rÃ³wnoczeÅ›nie kopiowaÄ‡ i odtwarzaÄ‡ (live)\u0026hellip;\nI wtedy przypomniaÅ‚o mi siÄ™ narzÄ™dzie netcat - zrobiÅ‚em snapshoty wolumenÃ³w i mogÅ‚em zaczynaÄ‡. W najbardziej podstawowej wersji potrzebowaÅ‚em tylko tyle:\n na ÅºrÃ³dle: dd if=/dev/vgsas/vm1-sys | pv --size 50G | nc -l -p 8888  na docelowym: nc 192.168.1.10 8888 | dd of=/dev/vgsas/vm1-sys   Lub wariacje z kompresjÄ…:\n na ÅºrÃ³dle: dd if=/dev/vgsas/vm1-sys | pv --size 50G | pigz -2 | nc -l -p 8888  na docelowym: nc 192.168.1.10 8888 | pigz -d | dd of=/dev/vgsas/vm1-sys   No dobra - pv nie jest najbardziej podstawowe\u0026hellip; Ale umoÅ¼liwia podglÄ…d postÄ™pu wysyÅ‚ania/obierania (zaleÅ¼y, z ktÃ³rej strony go wrzuciÄ‡) co przy tak dÅ‚ugim procesie jest niezmiernie przydatne.\nDo kompresji zalecaÅ‚bym pigz (czyli Parallel GZIP) z ratio dostosowanym do przepustowoÅ›ci sieci - po gigabicie siÄ™ nie opÅ‚acaÅ‚o nawet na oÅ›miordzeniowcu.\n","href":"/2013/09/kopiowanie-wolumenow-lvm-z-dd-i-netcat/","title":"Kopiowanie wolumenÃ³w LVM z dd i netcat"},{"content":"","href":"/tags/gpo/","title":"GPO"},{"content":"Raz na jakiÅ› czas trzeba coÅ› niestandardowego wrzuciÄ‡ do instalacji w Active Directory a Å¼e nie wszystkie aplikacje majÄ… dostÄ™pne paczki MSI to trzeba siÄ™ nieco natrudziÄ‡.\nPoniÅ¼ej wrzucam skrypt, ktÃ³ry instaluje GIMP\u0026rsquo;a 2.8 z domyÅ›lnego instalatora (wersja InnoSetup) przy okazji odinstalowujÄ…c wczeÅ›niejsze wersje zainstalowane rÄ™cznie.\nZapisujemy poniÅ¼szy kod jako np. gimp-install.cmd\n@echo off REM Installs GIMP cls echo ---------------------------------------------------- echo . echo . echo . Installing/Updating GIMP - Please Wait echo . echo . echo ---------------------------------------------------- REM Test if actual IF exist \u0026#34;%ProgramFiles%\\GIMP\\bin\\gimp-2.8.exe\u0026#34; GOTO SkipInstall REM Exit the application taskkill.exe /F /FI \u0026#34;IMAGENAME eq gimp-2.8.exe\u0026#34; \u0026gt;nul REM Uninstall existing GIMP version, delete folder if exist \u0026#34;%ProgramFiles%\\GIMP 2\\uninst\\unins000.exe\u0026#34; \u0026#34;%ProgramFiles%\\GIMP 2\\uninst\\unins000.exe\u0026#34; /VERYSILENT :: Wait for 20 seconds ping -n 40 127.0.0.1 \u0026gt; NUL if exist \u0026#34;%ProgramFiles%\\GIMP 2\\\u0026#34; rd \u0026#34;%ProgramFiles%\\GIMP 2\\\u0026#34; /Q /S REM Install new version \u0026#34;\\\\serwerplikow.local\\Instalki\\GIMP\\gimp-2.8.4-setup.exe\u0026#34; /VERYSILENT /NORESTART /DIR=\u0026#34;%PROGRAMFILES%\\GIMP 2.8\u0026#34; REM Skip installation if acctuall :SkipInstall REM Return exit code to SCCM exit /B %EXIT_CODE% Tworzymy nowÄ… reguÅ‚kÄ™ GPO i zmierzamy do: Computer Configuration\\Policies\\Windows Settings\\Scripts\\Startup\nW nowym okienku wybieramy Show Files\u0026hellip;\nWklejamy plik skryptu do tego folderu i teraz moÅ¼emy dodaÄ‡ go w tym samym oknie (Add\u0026hellip;) - dziÄ™ki wrzuceniu skryptu w tym miejscu bÄ™dzie siÄ™ on automatycznie replikowaÄ‡ na inne kontrolery. Skrypt bÄ™dzie co prawda uruchamiany przy kaÅ¼dym starcie komputera ale pierwszy warunek bÄ™dzie sprawdzaÄ‡ czy aplikacja jest zainstalowana wiÄ™c nie spowolni to znacznie startu.\nSkrypt znalazÅ‚em gdzieÅ› na sieci ale nie mogÄ™ namierzyÄ‡ ÅºrÃ³dÅ‚a.\n","href":"/2013/08/gpo-instalacja-gimpa-2-8/","title":"GPO: Instalacja GIMPâ€™a 2.8"},{"content":"NarzÄ™dzia xz-utils dostÄ™pne w nowszych systemach korzystajÄ… z mocniejszych algorytmÃ³w kompresji (jakaÅ› odmiana LZMA, coÅ› w stylu 7zip\u0026rsquo;a) przy zachowaniu kompatybilnoÅ›ci skÅ‚adni poleceÅ„ z gzip\u0026rsquo;em/bzip\u0026rsquo;em - da siÄ™ je zatem Å‚atwo zintegrowaÄ‡ w obecnych systemach. Ja chciaÅ‚em wykorzystaÄ‡ xz do kompresji logÃ³w, ktÃ³re bywajÄ… przydatne ale przez wiÄ™kszoÅ›Ä‡ czasy tylko zajmujÄ… miejsce :simple_smile:\nW /etc/logrotate.conf dopisujemy:\ncompresscmd /usr/bin/xz uncompresscmd /usr/bin/unxz compressext .xz compressoptions -9T2 compressoptions moÅ¼na nie ustawiaÄ‡ bo domyÅ›lnie ma wartoÅ›Ä‡ -9 (czyli kompresuj na maxa), mÃ³j dodatek (czyli -T2) uÅ¼yje dwÃ³ch wÄ…tkÃ³w procesora gdy juÅ¼ ten mechanizm zostanie zimplementowany (bo na razie nie jest) :simple_smile:\n","href":"/2013/07/logrotate-kompresja-logow-xz/","title":"logrotate: kompresja logÃ³w xz"},{"content":"Na jednym z urzÄ…dzeÅ„ miaÅ‚em problem z odtworzeniem plikÃ³w (gÅ‚Ã³wnie MKV) z dÅºwiÄ™kiem zakodowanym w DTS. PomijajÄ…c Å¼e np. na tablecie 6-cio kanaÅ‚y DTS jest mi \u0026ldquo;niezbÄ™dny inaczej\u0026rdquo; to konwertujÄ…c go do AAC stereo plik jest po prostu sporo mniejszy. OczywiÅ›cie nie zamierzam transkodowaÄ‡ Å›cieÅ¼ki video i na moje potrzeby mogÅ‚em sobie odpuÅ›ciÄ‡ zmianÄ™ czÄ™stotliwoÅ›ci prÃ³bkowania.\nNajproÅ›ciej wykorzystaÄ‡ pakiet ffmpeg (po nowemu avconv) lub mencoder (choÄ‡ ten miewaÅ‚ niegdyÅ› problem z poprawnym zapisywaniem wynikowych plikÃ³w mkv, wiÄ™c potrzebny jest dodatkowo mkvmerge z pakietu mkvtoolnix). mencoder transkoduje szybciej wykorzystujÄ…c wiÄ™cej rdzeniu CPU, ale pÃ³Åºniej potrzebny byÅ‚ drugi przebieg z mkvmerge. ffmpeg jechaÅ‚ na jednym procku nawet z opcjÄ… threads ale za to wszystko mogÄ™ zrobiÄ‡ jednym poleceniem.\nPaczki instalujemy tak:\napt-get install libav-tools libavcodec-extra MKV DTS do MKV AAC stereo avconv -i input.mkv -c copy -c:a libvo_aacenc -b:a 128k -ac 2 -threads auto output-stereo-aac.mkv GdybyÅ›my chcieli zakodowaÄ‡ wszystkie kanaÅ‚y z DTS do AAC to wystarczy pominÄ…Ä‡ parametr -ac 2.\nMKV DTS do MKV AC3 (wszystkie kanaÅ‚y) avconv -i input.mkv -c copy -c:aÂ libvo_aacenc -b:a 128k -threads auto output-ac3.mkv MKV DTS do MKV AC3 z mencoder\u0026rsquo;em AVI=`mktemp video.XXXXXX.avi` mencoder \u0026#34;input.mkv\u0026#34; -o $AVI -oac lavc -lavcopts acodec=ac3:abitrate=448 -ovc copy mkvmerge $AVI -o output.AC3.mkv rm $AVI ","href":"/2013/07/bezstratna-konwersja-mkv-z-dts-do-ac3-lub-aac/","title":"Bezstratna konwersja MKV z DTS do AC3 lub AAC"},{"content":"Raz na jakiÅ› czas gdy grzebiÄ™ przy maciorach muszÄ™ \u0026ldquo;odkryÄ‡\u0026rdquo; nowy volumen FC (lub rzadziej SCSI), ktÃ³ry wÅ‚aÅ›nie utworzyÅ‚em a restart serwera nie wchodzi w rachubÄ™ (zresztÄ… na czÄ™Å›ci systemÃ³w nic on nie da).\nBy to zrobiÄ‡ sÄ… dwie moÅ¼liwoÅ›ci:\nRÄ™czne wydanie poleceÅ„ odkrywajÄ…cych volumeny (na jajkach od 2.6.x) Sprawdzamy jakie mamy karty:\nls /sys/class/fc_host/ (wypisze siÄ™ coÅ› w stylu: host1, host2)\nWydajemy do wybranej przez nas karty Å¼Ä…danie wykonania LIP (to siÄ™ chyba tÅ‚umaczy jako loopback initialization) co skutkuje przeskanowaniem szyny FC:\necho 1 \u0026gt;/sys/class/fc_host/host1/issue_lip Czekamy 15~30 sekund aby zadziaÅ‚aÅ‚o polecenie.\nRzÄ…damy przeskanowania dostÄ™pnych volumenÃ³w SCSI/FC:\necho - - - \u0026gt;/sys/class/scsi_host/host1/scan (myÅ›lniki w echo oznaczajÄ… sprawdzenie wszystkich kanaÅ‚Ã³w, targetÃ³w i lun\u0026rsquo;Ã³w - jeÅ¼eli mamy bardzo duÅ¼o volumenÃ³w to moÅ¼na tutaj nieco optymalizowaÄ‡, ale to nie byÅ‚ mÃ³j problem)\nOdpalamy np. dmesg aby zobaczyÄ‡ jakie nowe volumeny siÄ™ pojawiÅ‚y.\nÅ¹rÃ³dÅ‚o: http://misterd77.blogspot.com/2007/12/how-to-scan-scsi-bus-with-26-kernel.html\nKorzystamy ze skryptu rescan-scsi-bus.sh Skrypt ten automatycznie robi to co potrzebujemy, skanujÄ…c wszystkie karty FC pod kÄ…tem nowych volumenÃ³w.\nwget http://rescan-scsi-bus.sh/ -O rescan-scsi-bus.sh chmod +x rescan-scsi-bus.sh ./rescan-scsi-bus.sh I tyle!\nÅ¹rÃ³dÅ‚o: http://rescan-scsi-bus.sh/\n","href":"/2013/07/dodawanie-urzadzen-scsifc-bez-restartu-serwera/","title":"Dodawanie urzÄ…dzeÅ„ SCSI/FC bez restartu serwera"},{"content":"","href":"/tags/fc/","title":"FC"},{"content":"","href":"/tags/scsi/","title":"SCSI"},{"content":"","href":"/tags/bittorrent/","title":"BitTorrent"},{"content":"","href":"/tags/btsync/","title":"btsync"},{"content":"Bardzo spodobaÅ‚a mi siÄ™ nowa aplikacja do zdalnej synchronizacji folderÃ³w z wykorzystaniem P2P. Ja wykorzystaÅ‚em jÄ… do automatycznych backupÃ³w archiwum zdjÄ™Ä‡ - zebraÅ‚o mi siÄ™ tego juÅ¼ prawie 130GB! KaÅ¼de narzÄ™dzie, ktÃ³re chce np. je kompresowaÄ‡ i raz na czas robiÄ‡ FULL backup jest skazane na poraÅ¼kÄ™ - a fotek przybywa.\nNa poczÄ…tek pobieramy interesujÄ…cÄ… nas wersjÄ™:\nwget http://btsync.s3-website-us-east-1.amazonaws.com/btsync_i386.tar.gz wget http://btsync.s3-website-us-east-1.amazonaws.com/btsync_x64.tar.gz Oraz paczkÄ™ ze skryptami dla Debiana:\nwget http://www.yeasoft.com/downloads/various/btsync-linux-deploy.tar.gz Ja wyciÄ…gam z niej skrypt /etc/init.d/btsync i konfiguracjÄ™ /etc/*\nTeraz user z ograniczonymi uprawnieniami, na ktÃ³rym bÄ™dzie dziaÅ‚aÄ‡ nasza usÅ‚uga (moÅ¼na wykorzystaÄ‡ swojego usera aby mÃ³c synchronizowaÄ‡ swoje foldery):\nuseradd -d /var/lib/btsync -m -s /bin/sh btsync Odpalamy z domyÅ›lnÄ… konfiguracjÄ… Å¼eby tylko dziaÅ‚aÅ‚o - dokonfiguruje pÃ³Åºniej:\ncd /etc/btsync mv default.conf default.btsync.btsync.conf chown root:btsync default.btsync.btsync.conf chmod 640 default.btsync.btsync.conf service btsync start Powinno dziaÅ‚aÄ‡ wiÄ™c sprawdÅºmy:\nps axu | grep bts netstat -nlp Tadam!\n","href":"/2013/07/debian-instalacja-bittorrent-sync-btsync/","title":"Debian - Instalacja Bittorrent Sync (btsync)"},{"content":"Jest kilka powodÃ³w dla ktÃ³rych tworzenie patchy jest przydatne - jeÅ›li tu jesteÅ› to pewnie masz jakiÅ› wÅ‚asny\u0026hellip;\nTworzenie patch\u0026rsquo;a diff -crB old new \u0026gt; from-old-to-new.patch W powyÅ¼szym poleceniu zaÅ‚oÅ¼yÅ‚em Å¼e old i new to katalogi z wieloma podkatalogami i plikami - stÄ…d opcja -r. -c dodaje kilka linijek \u0026ldquo;kontekstu\u0026rdquo; przez co Å‚atwiej rozeznaÄ‡ siÄ™ w patch\u0026rsquo;u. Opcja -B ignoruje puste linie, ktÃ³rych patchowanie mnie nie interesuje.\nPatchowanie Na poczÄ…tek zawsze warto wywoÅ‚aÄ‡ polecenie z opcjÄ… -dry-run by zobaczyÄ‡ czy patch wykona siÄ™ poprawnie:\npatch --dry-run -p1 -i from-old-to-new.patch Opcja -p1 zakÅ‚ada Å¼e uruchamiamy patcha z folderu \u0026ldquo;projektu\u0026rdquo;, ktÃ³ry chcemy patchowaÄ‡. OpcjÄ™ -i moÅ¼na z powodzeniem zastÄ…piÄ‡ przekierowaniem \u0026lt; .\nJeÅ¼eli nie widzimy Å¼adnych komunikatÃ³w \u0026ldquo;FAILED\u0026rdquo; to moÅ¼emy uruchomiÄ‡ patcha:\npatch -p1 -i from-old-to-new.patch ","href":"/2013/04/tworzenie-patchy-z-poleceniami-diff-i-patch/","title":"Tworzenie patchâ€™y z poleceniami diff i patch"},{"content":"MiaÅ‚em ostatnio zabawnÄ… sytuacjÄ™ gdy kilka serwerÃ³w z zainstalowanym NTPD miaÅ‚o rozjazdy rzÄ™du kilkunastu sekund. WyszÅ‚o na to Å¼e moje serwery synchronizowaÅ‚y siÄ™ z rÃ³Å¼nymi zewnÄ™trznymi serwerami NTP pomiÄ™dzy, ktÃ³rymi byÅ‚y rozjazdy i te rozjazdy synchronizowaÅ‚y siÄ™ na moich serwerach. Jeden \u0026ldquo;z moich\u0026rdquo; ustanowiÅ‚em gÅ‚Ã³wnym a wszystkie inne przekierowaÅ‚em na niego (komentujÄ…c wszystkie inne serwery NTP w konfiguracji). WymusiÅ‚em synchronizacjÄ™:\nntp -q SprawdziÅ‚em jak duÅ¼y jest offset i jitter (powinny byÄ‡ bardzo maÅ‚e):\nntpq -p i tak rzeczywiÅ›cie byÅ‚o - problem z gÅ‚owy.\nP.S. JeÅ¼eli nie potrzebujemy/chcemy/etc instalowaÄ‡ serwera NTP to moÅ¼emy zamiast tego uÅ¼yÄ‡ polecenia ntpdate w cronie (np. co godzinÄ™):\nntpdate moj.serwer.ntp ","href":"/2013/03/rozsynchronizowane-serwery-ntp/","title":"Rozsynchronizowane serwery NTP"},{"content":"","href":"/tags/fortigate/","title":"Fortigate"},{"content":"Do niedawna na moim telefonie VPN\u0026rsquo;ami byÅ‚y: PPTP lub L2TP - oba niespecjalnie mi siÄ™ podobaÅ‚y. Ale od wersji 4-tej pojawiÅ‚y siÄ™ dwa nowe tryby: IPSec Xauth PSK i IPSec Xauth RSA. W pierwszym autoryzacja wykorzystuje login i hasÅ‚o, w drugim certyfikaty.\nTryb IPSec Xauth PSK jest bardzo wygodny bo Å‚atwo moÅ¼na poÅ‚Ä…czyÄ‡ go z zewnÄ™trznymi mechanizmamiÂ uwierzytelniajÄ…cymiÂ np. LDAP, Active Directory, itp.\nPokaÅ¼Ä™ jak skonfigurowaÄ‡ swojego Fortigate\u0026rsquo;a by umoÅ¼liwiÄ‡ poÅ‚Ä…czenie z telefonÃ³w i tabletÃ³w na Androidzie 4.x do \u0026ldquo;Intranetu\u0026rdquo;. WiÄ™kszoÅ›Ä‡ konfiguracji moÅ¼na przeprowadziÄ‡ tylko w trybie CLI - zakÅ‚adam Å¼e wiesz jak to zrobiÄ‡. To co wygodniej moÅ¼na zrobiÄ‡ w trybie WWW to gÅ‚Ã³wnie tworzenie reguÅ‚ dostÄ™pu na zaporze.\nP.S. Teoretycznie powinno to teÅ¼ zadziaÅ‚aÄ‡ na IPhone\u0026rsquo;ach/IPad\u0026rsquo;ach itp., przy czym udaÅ‚o mi siÄ™ to zestawiÄ‡ na 4GS ale na 5-ce juÅ¼ nie - nie miaÅ‚em tych aparatÃ³w na tyle dÅ‚ugo by dokÅ‚adniej to zbadaÄ‡.\nNa poczÄ…tek konfigurujemy fazÄ™ pierwszÄ… - ja lubiÄ™ interface mode ale oczywiÅ›cie bÄ™dzie to dziaÅ‚aÄ‡ rÃ³wnieÅ¼ w trybie policy (trzeba bÄ™dzie nieco polecenia zmieniÄ‡).\nconfig vpn ipsec phase1-interface edit \u0026#34;vpn-android\u0026#34; set type dynamic set interface \u0026#34;port1\u0026#34; set dhgrp 2 set peertype one set xauthtype auto set mode aggressive set mode-cfg enable set proposal aes128-sha1 aes128-md5 3des-sha1 set negotiate-timeout 15 set peerid \u0026#34;jakis-mobilny-identyfikator\u0026#34; set authusrgrp \u0026#34;grupa-ludzikow\u0026#34; set psksecret haslo set unity-support enable set ipv4-start-ip 172.16.0.5 set ipv4-end-ip 172.16.0.100 set ipv4-netmastk 255.255.255.0 set ipv4-dns-server1 172.16.0.1 set ipv4-dns-server2 8.8.8.8 next end Jedna ciekawostka - opcja unity-support domyÅ›lnie jest ustawiana na enable i proponujÄ™Â jÄ…Â tak zostawiÄ‡ - dziÄ™ki temu ta sama konfiguracja bÄ™dzie dziaÅ‚aÄ‡Â na urzÄ…dzeniach z iOS\u0026rsquo;e i OS X, wystarczy skonfigurowaÄ‡ VPN jako Cisco ðŸ˜ƒ\nNo to faza druga:\nconfig vpn ipsec phase2-interface edit \u0026#34;mobile-vpn-p2\u0026#34; set keepalive enable set pfs disable set phase1name \u0026#34;vpn-android\u0026#34; set proposal aes128-sha1 aes128-md5 3des-sha1 set keylifeseconds 3600 next end Kilka ustawieÅ„ na interfejsie:\nconfig system interface edit \u0026#34;vpn-android\u0026#34; set ip 172.16.0.1 255.255.255.255 set allowaccess ping set type tunnel set remote-ip 139.x.x.10 set interface \u0026#34;port1\u0026#34; next end WÅ‚Ä…czymy sobie serwer DNS na interfejsie VPN:\nconfig system dns-server edit \u0026#34;vpn-android\u0026#34; next end No to teraz trzeba utworzyÄ‡ co najmniej jednÄ… reguÅ‚Ä™ na zaporze zezwalajÄ…cÄ… na dostÄ™p z interfejsu vpn-android (z adresÃ³w tej sieci) do jakiejÅ› sieci intranetowej (np. wewnÄ™trznego serwera WWW), na odpowiednich portach.\nPonadto jeÅ›li chcemy mÃ³c korzystaÄ‡ z cache DNS\u0026rsquo;a na interfejsie vpn-android to musimy umoÅ¼liwiÄ‡ do niego dostÄ™p tworzÄ…c reguÅ‚Ä™ z interfejsu vpn-android (z adresÃ³w przydzielanych przez mode-cfg) do vpn-android (przynajmniej do DNS\u0026rsquo;a - 172.16.0.1).\nJeÅ¼eli chcemy by urzÄ…dzenia mobilne mogÅ‚y Å‚Ä…czyÄ‡ siÄ™ do zewnÄ™trznych usÅ‚ug przez tunel VPN (co w niektÃ³rych przypadkach moÅ¼e byÄ‡ bardzo cenne) to musimy teÅ¼ utworzyÄ‡ reguÅ‚Ä™ z interfejsu vpn-android do ktÃ³regoÅ› z interfejsÃ³w WAN\u0026rsquo;owskich.A tak naleÅ¼y to wyklikaÄ‡ na telefonie\nhttp://kb.fortinet.com/kb/viewContent.do?externalId=FD31619\u0026amp;sliceId=1\n","href":"/2013/03/fortigate-vpn-ipsec-psk-xauth-z-androida-4-x/","title":"Fortigate - VPN IPSec PSK XAuth z Androidâ€™a 4.x"},{"content":"","href":"/tags/fortios/","title":"FortiOS"},{"content":"","href":"/tags/vpn/","title":"VPN"},{"content":"On Debian you have to install nginx-extras package (because it have built in headers_more module). Then you need two options (best in global configuration /etc/nginx/nginx.conf file, http part):\nserver_tokens off; more_set_headers \u0026#39;Server: BadAss\u0026#39;; And it\u0026rsquo;s good to setup non standard error pages on every site (500 and 404 at minimum):\nerror_page 403 404 http://mysite.com/areyoulost; error_page 502 503 504 /500.html; ","href":"/2013/01/nginx-hide-server-version-and-name-in-server-header-and-error-pages/","title":"Nginx - hide server version and name in Server header and error pages"},{"content":"W PHP 5.3 pojawiÅ‚a siÄ™ nowa zmienna: max_input_vars, ktÃ³ra limituje iloÅ›Ä‡ pÃ³l moÅ¼liwych do przesÅ‚ania przez formularz, obcinajÄ…c nadmiarowe. Pozwala to zapobiec atakom DoS na tablice hashujÄ…ce (przynajmniej w tym jednym miejscu). DomyÅ›lna wartoÅ›Ä‡ tej zmiennej to 1000 i kreatywnym programistom udaje siÄ™ tÄ… wartoÅ›Ä‡ bez problemu osiÄ…gnÄ…Ä‡ ðŸ˜ƒ\nWarte odnotowania jest to Å¼e majÄ…c suhosin\u0026rsquo;a trzeba pamiÄ™taÄ‡ o jeszcze dwÃ³ch innych zmiennych:\nmax_input_vars = 3000 suhosin.post.max_vars = 3000 suhosin.request.max_vars = 3000 Zmienne moÅ¼na zmieniÄ‡ od razu w /etc/php5/apache2/php.ini (choÄ‡ te dla suhosin\u0026rsquo;a lepiej wrzuciÄ‡ do /etc/php5/conf.d/suhosin.ini). A jeszcze lepszym pomysÅ‚em jest ustawienie tych zmiennych bezpoÅ›rednio dla danego vhost\u0026rsquo;a, w Apache\u0026rsquo;m np. tak:\nphp_value max_input_vars 3000 php_value suhosin.post.max_vars 3000 php_value suhosin.request.max_vars 3000 ","href":"/2013/01/php-max_input_vars/","title":"PHP - max_input_vars"},{"content":"","href":"/tags/badblocks/","title":"badblocks"},{"content":"Dyski siÄ™ zuÅ¼ywajÄ… i w koÅ„cu wczeÅ›niej czy pÃ³Åºniej pojawiajÄ… siÄ™ na nich bad sectory. Jeden z moich dyskÃ³w ciut siÄ™ posypaÅ‚ a Å¼e sÅ‚uÅ¼y wyÅ‚Ä…cznie do backupÃ³w to mogÄ™ z tym Å¼yÄ‡. Ale z drugiej strony jeÅ¼eli juÅ¼ bÄ™dÄ™ musiaÅ‚ siÄ™gnÄ…Ä‡ do backupÃ³w to chcÄ™ mieÄ‡ pewnoÅ›Ä‡ Å¼e coÅ› odzyskam, dlatego postanowiÅ‚em zrobiÄ‡ kilka testÃ³w. Nawet jeÅ›li nie naprawi to sektorÃ³w to przynajmniej zostanÄ… zaznaczone jako uszkodzone i realokowane.\nNa poczÄ…tek zaczÄ…Å‚em od prÃ³by puszczenia badblocks w trybie nie destruktywnym na caÅ‚ym dysku:\nbadblocks -b 4096 -nsv /dev/sdf Poszukiwanie wadliwych blokÃ³w w trybie z niedestruktywnym zapisem Od bloku 0 do 488378645 Poszukiwanie wadliwych blokÃ³w (odczyt i niedestruktywny zapis) Testowanie wzorcem losowym: ^Ctowe w 1.28%, minÄ™Å‚o 10:47 (bÅ‚Ä™dÃ³w: 0/0/0) Interrupted at block 6262912 Otrzymano przerwanie, sprzÄ…tam ZaczekaÅ‚em 10 minut i na podstawie bieÅ¼Ä…cych statystyk oszacowaÅ‚em Å¼e test zajmie ponad 13 godzin\u0026hellip; Jak widaÄ‡ przerwaÅ‚em - sprawdÅºmy wiÄ™c co powiedzÄ… testy smart\u0026rsquo;a. Co prawda niczego one nie naprawiÄ… ale zidentyfikujÄ…, na ktÃ³rym sektorze zaczynajÄ… siÄ™ problemy. BÄ™dÄ™ mÃ³gÅ‚ wtedy puÅ›ciÄ‡ badblocks juÅ¼ od tego miejsca oszczÄ™dzajÄ…c nieco czasu\u0026hellip; WiÄ™c:\nsmartctl -t long /dev/sdf smartctl 5.41 2011-06-09 r3365 [x86_64-linux-3.2.0-34-generic] (local build) Copyright (C) 2002-11 by Bruce Allen, http://smartmontools.sourceforge.net === START OF OFFLINE IMMEDIATE AND SELF-TEST SECTION === Sending command: \u0026#34;Execute SMART Extended self-test routine immediately in off-line mode\u0026#34;. Drive command \u0026#34;Execute SMART Extended self-test routine immediately in off-line mode\u0026#34; successful. Testing has begun. Please wait 255 minutes for test to complete. Test will complete after Sat Nov 24 03:59:21 2012 Use smartctl -X to abort test. 255 minut to trochÄ™ ponad 4 godziny - przynajmniej skoÅ„czy siÄ™ do rana. No to jeszcze:\nshutdown -h 4:15 I zerkniemy jutro co znajdzie test ðŸ˜ƒ\nDzieÅ„ drugi Zerkamy\u0026hellip; i:\nsmartctl -l selftest /dev/sdf smartctl 5.41 2011-06-09 r3365 [x86_64-linux-3.2.0-34-generic] (local build) Copyright (C) 2002-11 by Bruce Allen, http://smartmontools.sourceforge.net === START OF READ SMART DATA SECTION === SMART Self-test log structure revision number 1 Num Test_Description Status Remaining LifeTime(hours) LBA_of_first_error # 1 Extended offline Completed: read failure 90% 15196 164529056 # 2 Short offline Aborted by host 10% 15192 - WidaÄ‡ tutaj wyniki dwÃ³ch testÃ³w - przy czym interesuje nas ten dÅ‚uÅ¼szy z numerkiem 1. Niestety mam jakiÅ› bad sektor i mam pierwszy adres jego wystÄ…pienia - szkoda Å¼e to gdzieÅ› w pierwszych 10% dysku - miaÅ‚em nadziejÄ™ Å¼e gdzieÅ› dalej (byÅ‚oby mniej do sprawdzenia). Ale jeÅ›li badsectory zaczynajÄ… siÄ™ tak wczeÅ›nie to puszczÄ™ badblocks od poczÄ…tku - niech przejedzie caÅ‚y dysk - albo siÄ™ coÅ› naprawi, albo padnie. Ale przynajmniej sprawa siÄ™ wyjaÅ›ni ðŸ˜‰\nÅ¹rÃ³dÅ‚a http://smartmontools.sourceforge.net/badblockhowto.html\nhttp://sourceforge.net/apps/trac/smartmontools/wiki/SamsungF4EGBadBlocks\nman badblocks\n","href":"/2012/12/linux-naprawianie-bad-sectorow/","title":"Linux - naprawianie bad sectorÃ³w"},{"content":"","href":"/tags/smartctl/","title":"smartctl"},{"content":"","href":"/tags/piwik/","title":"Piwik"},{"content":"Korzystam z instancji Piwik\u0026rsquo;a do monitorowania odwiedzin na stronie i postanowiÅ‚em pokombinowaÄ‡ czy da siÄ™ w ten sposÃ³b monitorowaÄ‡ wejÅ›cia konkretnych osÃ³b na bazie wpisanego w polu komentarza loginu/ksywki. Jak zaczÄ…Å‚em grzebaÄ‡ to przy okazji zmieniÅ‚em teÅ¼ sposÃ³b Å‚adowania skryptÃ³w Piwika na asynchroniczny.\nA leci to mniej wiÄ™cej tak:\n\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; var i,x,y,ARRcookies=document.cookie.split(\u0026#34;;\u0026#34;); var comment_author = \u0026#34;\u0026#34;; for (i=0;i\u0026lt;ARRcookies.length;i++) { x=ARRcookies[i].substr(0,ARRcookies[i].indexOf(\u0026#34;=\u0026#34;)); y=ARRcookies[i].substr(ARRcookies[i].indexOf(\u0026#34;=\u0026#34;)+1); x=x.replace(/^\\s+|\\s+$/g,\u0026#34;\u0026#34;); if (x.indexOf(\u0026#34;comment_author\u0026#34;) != -1 \u0026amp;\u0026amp; x.indexOf(\u0026#34;comment_author_email\u0026#34;) == -1 \u0026amp;\u0026amp; x.indexOf(\u0026#34;comment_author_url\u0026#34;) == -1) { comment_author = unescape(y); } } var _paq = _paq || []; (function(){ var u=((\u0026#34;https:\u0026#34; == document.location.protocol) ? \u0026#34;https://url.instancji.piwika.pl/\u0026#34; : \u0026#34;http://url.instancji.piwika.pl/\u0026#34;); _paq.push([\u0026#39;setSiteId\u0026#39;, 1]); _paq.push([\u0026#39;setTrackerUrl\u0026#39;, u+\u0026#39;piwik.php\u0026#39;]); _paq.push([\u0026#39;setCustomVariable\u0026#39;,\u0026#39;1\u0026#39;,\u0026#39;Author\u0026#39;, comment_author]); _paq.push([\u0026#39;trackPageView\u0026#39;]); _paq.push([\u0026#39;enableLinkTracking\u0026#39;]); var d=document, g=d.createElement(\u0026#39;script\u0026#39;), s=d.getElementsByTagName(\u0026#39;script\u0026#39;)[0]; g.type=\u0026#39;text/javascript\u0026#39;; g.defer=true; g.async=true; g.src=u+\u0026#39;piwik.js\u0026#39;; s.parentNode.insertBefore(g,s); })(); \u0026lt;/script\u0026gt; Å¹rÃ³dÅ‚o http://piwik.org/docs/javascript-tracking/#toc-asynchronous-tracking http://codex.wordpress.org/WordPress_Cookies#Commenters\n","href":"/2012/12/piwik-sledzenie-asynchroniczne-logowanie-ksywy-komentujacego-w-wordpressie/","title":"Piwik: Å›ledzenie asynchroniczne + logowanie ksywy komentujÄ…cego w WordPressâ€™ie"},{"content":"Dawno, dawno temu\u0026hellip; Za gÃ³rami, za lasami\u0026hellip; czytaÅ‚em sobie tekst Lemat\u0026rsquo;a o dokuczaniu spamerom i pomyÅ›laÅ‚em Å¼e sam teÅ¼ tak mogÄ™ i nawet chcÄ™ wiÄ™c popeÅ‚niÅ‚em skrypcik, ktÃ³ry dla losowych sÅ‚Ã³w generowaÅ‚ maile. Skrypcik dziaÅ‚aÅ‚ z dwa lata na mojej poprzedniej stronie i nie raz zdarzyÅ‚o siÄ™ tam jakiejÅ› mendzie zapÄ™tliÄ‡. JakoÅ› nie miaÅ‚em czasu od razu, a pÃ³Åºniej zapomniaÅ‚em wrzuciÄ‡ go na nowÄ… stronie i tak zostaÅ‚o - na pewien czas.\nNiedawno przeglÄ…dajÄ…c logi zauwaÅ¼yÅ‚em Å¼e jakieÅ› spam-boty jednak tÄ™skniÄ… za tÄ… podstronÄ… i postanowiÅ‚em jÄ… wskrzesiÄ‡.\nPomysÅ‚ jest prosty i polega na generowaniu na pewnej podstronie duÅ¼ej iloÅ›ci \u0026ldquo;z dupy\u0026rdquo; maili. OczywiÅ›cie w robots.txt dajemy Disallow dla tej Å›cieÅ¼ki i jeÅ›li bot jest kulturalny to nie bÄ™dzie tam zaglÄ…daÅ‚. Crawlery spamerÃ³w przewaÅ¼nieÂ kulturalneÂ nie sÄ… wiÄ™c tam wpadnÄ… i siÄ™ zapÄ™tlÄ… zapychajÄ…c sobie bazÄ™ Å›mieciami - taka baza traci wartoÅ›Ä‡ dla klientÃ³w spamera, wiÄ™c przewaÅ¼nie skutkuje to dodaniem naszej strony na spamerskÄ… \u0026ldquo;black listÄ™ - nie crawlowaÄ‡\u0026rdquo;. Dla mnie cool ðŸ˜ƒ (w rzadszych przypadkach spamer moÅ¼e chcieÄ‡ siÄ™ zemÅ›ciÄ‡\u0026hellip;).\nJeÅ¼eli ktoÅ› bÄ™dzie zainteresowany to mogÄ™ udostÄ™pniÄ‡ skrypcik (ma postaÄ‡ szablonu strony dla WordPress\u0026rsquo;a) - choÄ‡ zachÄ™cam do samodzielnego napisania wÅ‚asnego - zawsze trudniej bÄ™dzie spamerom z automatu go przeskoczyÄ‡ (jak np. antyspam.pl). NaleÅ¼y przy tym zwrÃ³ciÄ‡ uwagÄ™ na kilka rzeczy:\n nie zrÃ³b sobie kuku - nie generuj fake emaili dla wÅ‚asnych, istniejÄ…cych domen (bo moÅ¼e siÄ™ okazaÄ‡ Å¼e ktÃ³ryÅ› spamer jednak sprÃ³buje wysÅ‚aÄ‡ te setki tysiÄ™cy bÅ‚Ä™dnych maili i zrobiÄ‡ Ci DDOS\u0026rsquo;a zabijajÄ…c serwer bÅ‚Ä™dnie nadanymi mailami), nie rÃ³b innym kuku - nie generuj fake maili w cudzych domenach (no chyba Å¼e w domenach Canadian Pharmacy), jeÅ¼eli jednak nadal upierasz siÄ™ przy istniejÄ…cej domenie (np. by Å›ledziÄ‡ statystyki zapytaÅ„\u0026hellip;) to ustaw rekord MX na hosta z IP 127.0.0.1 - jak dobrze pÃ³jdzie spamer sam sobie zrobi DOS\u0026rsquo;a (spodziewaÅ‚bym siÄ™ jednak w takiej sytuacji odwetu) :simple_smile:  Å¹rÃ³dÅ‚o szablonu PaczkÄ™ z szablonem moÅ¼na pobraÄ‡Â tutaj.\nPaczka zawiera plik havefun_template.php, ktÃ³ry naleÅ¼y umieÅ›ciÄ‡ w katalogu szablonu WordPress\u0026rsquo;a. Ja wykorzystaÅ‚em w generatorze wp_post z WordPress\u0026rsquo;a - zmodyfikowania zapytania dla innej bazy nie powinno byÄ‡ zbyt trudne. Samo zapytanie nieco zoptymalizowaÅ‚em przez co zwraca mniej losowe wyniki (zwraca losowy blok n wierszy z tabeli a nie caÅ‚kiem losowe elementy) co dla potrzeb tego skryptu jest caÅ‚kiem OK. JeÅ¼eli pomysÅ‚ z bazÄ… siÄ™ nie podoba (bo np. moÅ¼e generowaÄ‡ zbyt duÅ¼e obciÄ…Å¼enie) to proponujÄ™ wyszukaÄ‡ sobie jakiÅ› generator Lorem ipsum\u0026hellip;\nMiÅ‚ej zabawy.\nBawiÄ…c siÄ™ ostatnio nowym szablonem Twenty Thirteen przygotowaÅ‚em nowÄ… wersjÄ™ pliku havefun_template.php dla tego szablonu.\n","href":"/2012/12/jak-dokuczac-spamerom/","title":"Jak dokuczaÄ‡ spamerom"},{"content":"Ruski serwer WWW ma przydatnÄ… funkcjÄ™ serwowania wersji plikÃ³w skompresowanych gzip\u0026rsquo;em - przez co moÅ¼emy plik skompresowaÄ‡ raz i bÄ™dzie on serwowany klientom obsÅ‚ugujÄ…cym kompresjÄ™ HTTP ale juÅ¼ bez kaÅ¼dorazowego kompresowania go. Jest to bardzo przydatne na stronach z duÅ¼ym ruchem gdzie moÅ¼na w ten sposÃ³b zaoszczÄ™dziÄ‡ takty CPU na wÅ‚aÅ›ciwÄ… obsÅ‚ugÄ™ poÅ‚Ä…czeÅ„ a nie kompresjÄ™. Drugie miejsce gdzie moÅ¼e to byÄ‡ przydatne to VPS\u0026rsquo;y i \u0026ldquo;cienkie\u0026rdquo; serwery, ktÃ³re na kompresji przy wiÄ™kszymÂ obciÄ…Å¼eniuÂ spÄ™dzajÄ… zbyt duÅ¼o czasu i daje siÄ™ to odczuÄ‡ w dziaÅ‚aniu strony. A Å¼e obecnie standardem jest Å‚adowanie przez stronki np. jQuery, paru pluginÃ³w do niego, jQueryUI, masy CSS\u0026rsquo;Ã³w, itd - to na prawdÄ™ jest co kompresowaÄ‡ ðŸ˜ƒ\nDodatkowa zaleta tego rozwiÄ…zania jest taka, Å¼e o ile w przypadku kompresji online raczej kompresujemy na niskich poziomach by nieco zmniejszyÄ‡ dane a rÃ³wnoczeÅ›nie nie zabijaÄ‡ CPU - to w przypadku kompresji pod ten moduÅ‚ moÅ¼emy raz na jakiÅ› czas \u0026ldquo;przejechaÄ‡\u0026rdquo; pliki maksymalnÄ… kompresjÄ… by byÅ‚y jeszcze mniejsze (zaoszczÄ™dzi to nieco pasma i rÃ³wnoczeÅ›nie przyspieszy Å‚adowanie strony bo jest mniej do pobrania).\nPrekompresjÄ™ wybranych typÃ³w plikÃ³w moÅ¼na przeprowadziÄ‡ np. tak:\nfind /var/www -iname *.js -print0 |xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;gzip -c9 \u0026#34;{}\u0026#34; \u0026gt; \u0026#34;{}.gz\u0026#34; \u0026amp;\u0026amp; touch -r \u0026#34;{}\u0026#34; \u0026#34;{}.gz\u0026#34;\u0026#39; find /var/www -iname *.css -print0 |xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;gzip -c9 \u0026#34;{}\u0026#34; \u0026gt; \u0026#34;{}.gz\u0026#34; \u0026amp;\u0026amp; touch -r \u0026#34;{}\u0026#34; \u0026#34;{}.gz\u0026#34;\u0026#39; gzip skompresuje a touch zadba by timestampy obu plikÃ³w byÅ‚y takie same (co jest zalecanÄ… praktykÄ… przy wykorzystaniu tego moduÅ‚u). Dwa powyÅ¼sze polecenia moÅ¼na odpaliÄ‡ praktycznie w ciemno na obecnie serwowanej stronie i nie powinny spowodowaÄ‡ zbyt duÅ¼ego chaosu\u0026hellip; Trzeba pamiÄ™taÄ‡ jedynie by zostaÅ‚y uruchomione z uÅ¼ytkownika, ktÃ³ry ma dostÄ™p do zapisu w danym vhoÅ›cie i by serwer WWW miaÅ‚ dostÄ™p do tak utworzonego pliku.\nZ moich obserwacji wynika Å¼e gdy timestamp pliku bez gz jest nowszy niÅ¼ wersji skompresowanej to serwowana jest ta Å›wieÅ¼sza wersja ale wtedy juÅ¼ z ewentualnÄ… kompresjÄ… online.\nMocniejsze kompresowanie plikÃ³w PNG MoÅ¼e nie do koÅ„ca w temacie tego posta ale bardzo czÄ™sto gdy stosujÄ™ gzip_static_module to optymalizujÄ™ teÅ¼ PNG\u0026rsquo;i. Pliki PNG sÄ… kompresowane w sposÃ³b bezstratny ale przewaÅ¼nie programy graficzne nie zapisujÄ… ich w najmniejszej moÅ¼liwej postaci bo trwaÅ‚oby to zbyt dÅ‚ugo. MoÅ¼na uÅ¼yÄ‡ do tego celu narzÄ™dzi takich jak: optipng lub pngcrush. A poniÅ¼ej odpowiedni one-liner by skompresowaÄ‡ wszystkie PNG\u0026rsquo;i w serwisach WWW:\nfind /var/www -iname *.png -print0 |xargs -0 optipng -quiet -preserve -o7 Uwaga! WywoÅ‚anie tego skryptu moÅ¼e potrwaÄ‡ bardzo dÅ‚ugo i z tego powodu raczej nie nadaje siÄ™ do umieszczenia w cronie. Jednak rÄ™czne puszczenie po duÅ¼ych zmianach w serwisie lub z filtrem w find by kompresowane byÅ‚y tylko nowsze pliki bÄ™dzie OK.\nOptymalizowanie plikÃ³w JPG/JPEG Co prawda pliki JPG/JPEG kompresujÄ…Â siÄ™Â stratnie ale moÅ¼ne je nieco zoptymalizowaÄ‡ np. usuwajÄ…c niepotrzebne dane z nagÅ‚Ã³wkÃ³w i zamieniajÄ…c na progresywne. MoÅ¼emy do tego wykorzystaÄ‡Â takie polecenie:\nfind /var/www -iname \u0026#39;*.jpg\u0026#39; -print0 | xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;jpegtran -optimize -progressive -copy none -outfile \u0026#34;{}\u0026#34; \u0026#34;{}\u0026#34;\u0026#39; ","href":"/2012/12/nginx-kompresowanie-plikow-dla-gzip_static/","title":"Nginx - kompresowanie plikÃ³w dla gzip_static"},{"content":"Gdy juÅ¼ siÄ™ dorobi systemu Active Directory wygodnie jest wykorzystaÄ‡ jego bazÄ™ uÅ¼ytkownikÃ³w do autoryzacji w rÃ³Å¼nych miejscach, np. do pewnych \u0026ldquo;tajnych i tajniejszych\u0026rdquo; stron w Apache. NajproÅ›ciej moÅ¼na to zrobiÄ‡ z wykorzystaniem LDAP.\nWarto sprawdziÄ‡ czy i jak moÅ¼emy dostaÄ‡ siÄ™ do kontrolerÃ³w. Gdy juÅ¼ mamy wszystkie potrzebne parametry konfigurujemy Apachego - na poczÄ…tek aktywujemy moduÅ‚y:\na2enmod ldap a2enmod authnz_ldap Teraz moÅ¼emy edytujemy globalny plik konfiguracyjny mod_ldap\u0026rsquo;a by ustawiÄ‡ nieco cache\u0026rsquo;y (bardzo przydatne). WartoÅ›ci moÅ¼na dostosowaÄ‡ do potrzeb ale przykÅ‚adowe powinny wystarczyÄ‡ na poczÄ…tku:\nLDAPSharedCacheSize 500000 LDAPCacheEntries 1024 LDAPCacheTTL 600 LDAPOpCacheEntries 1024 LDAPOpCacheTTL 600 \u0026lt;Location /ldap-status\u0026gt; SetHandler ldap-status Order deny,allow Deny from all # Allow from 127.0.0.1 ::1 Allow from 192.168.1.15/32 Satisfy all \u0026lt;/Location\u0026gt; Warto zwrÃ³ciÄ‡ uwagÄ™ na drugÄ… czÄ™Å›Ä‡ - moÅ¼na aktywowaÄ‡ podglÄ…d statusu mod_ldap\u0026rsquo;a co bywa przydatne na etapie testÃ³w (np. by zobaczyÄ‡ kto aktualnie jest zalogowany) - ja umoÅ¼liwiÅ‚em dostÄ™p ze swojego zdalnego komputera. Teraz restart Apachego aby wszystko siÄ™ zaÅ‚adowaÅ‚o:\ninvoke-rc.d apache2 restart Åšrodowisko mamy gotowe, moÅ¼emy skonfigurowaÄ‡ vhosta. PoniÅ¼sze opcje wrzucamy np. do klauzuli \u0026lt;Directory\u0026gt; lub \u0026lt;Location\u0026gt;:\nAuthtype basic Authname \u0026#34;Zaloguj sie kontem domenowym\u0026#34; AuthBasicProvider ldap AuthzLDAPAuthoritative Off AuthUserFile /dev/null AuthLDAPUrl \u0026#34;ldap://server1.nazwadomeny.local:389 10.0.0.32:389/DC=nazwadomeny,DC=local?sAMAccountName?sub?(objectClass=person)\u0026#34; NONE AuthLDAPBindDN \u0026#34;CN=kontodomenowe,OU=System Accounts,DC=nazwadomeny,DC=local\u0026#34; AuthLDAPBindPassword \u0026#34;haslo konta domenowego\u0026#34; Require valid-user # Require ldap-dn ou=Jakies przykladowe OU NajwaÅ¼niejsze parametry to:\n AuthLDAPUrl - tutaj podajemy parametry do poÅ‚Ä…czenia LDAP, w pierwszej czÄ™Å›ci moÅ¼emy podaÄ‡ kilka serwerÃ³w by mieÄ‡ backup, pÃ³Åºniej korzeÅ„ od ktÃ³rego bÄ™dzie rozpoczynane przeszukiwanie drzewa (tutaj caÅ‚a domena), na koÅ„cu filtry, AuthLDAPBindDN - konto ktÃ³rym autoryzujemy siÄ™ do kontrolera by mÃ³c przeszukiwaÄ‡ na nim obiekty (podane jako Å›cieÅ¼ka LDAP), AuthLDAPBindPassword - hasÅ‚o do powyÅ¼szego konta, Require ldap-dn - moÅ¼na nie tylko sprawdzaÄ‡ czy uÅ¼ytkownik jest prawidÅ‚owy ale rÃ³wnieÅ¼ czy jest w pewnym OU, grupie itd\u0026hellip;  Teoretycznie wszystko jest poprawnie ale za cholerÄ™ nie chciaÅ‚o dziaÅ‚aÄ‡ dopiero dodanie do /etc/ldap/ldap.conf opcji: REFERRALS off sprawiÅ‚o Å¼e autoryzacja dziaÅ‚a poprawnie - oneliner by to uzyskaÄ‡:\necho \u0026#34;REFERRALS off\u0026#34; \u0026gt;\u0026gt; /etc/ldap/ldap.conf Ja mam Apachego 2.2 i jest to jedyna opcja by uzyskaÄ‡ ten efekt. W wersji od 2.4 jest dodatkowa opcjaÂ LDAPReferrals, ktÃ³ra pozwala na zmianÄ™ tego zachowania wprost z konfiguracji Apachego.\n","href":"/2012/12/apache-mod_authnz_ldap-z-active-directory/","title":"Apache: mod_authnz_ldap z Active Directory"},{"content":"","href":"/tags/ldap/","title":"LDAP"},{"content":"ChciaÅ‚em wysÅ‚aÄ‡ z Python\u0026rsquo;a maila z krzakami tab by Å‚adnie siÄ™ wyÅ›wietlaÅ‚y i okazaÅ‚o siÄ™ to caÅ‚kiem nietrywialne.\nNa szczÄ™Å›cie googiel podpowiedziaÅ‚ mi doskonaÅ‚ego gotowca, ktÃ³rego zamierzam zapisaÄ‡ by mi nie zginÄ…Å‚:\n#!/usr/bin/env python # -*- coding: utf-8 -*- import smtplib from email.mime.text import MIMEText from email.Header import Header from email.Utils import parseaddr, formataddr def send_email(sender, recipient, subject, body): \u0026#34;\u0026#34;\u0026#34;Send an email. All arguments should be Unicode strings (plain ASCII works as well). Only the real name part of sender and recipient addresses may contain non-ASCII characters. The email will be properly MIME encoded and delivered though SMTP to localhost port 25. This is easy to change if you want something different. The charset of the email will be the first one out of US-ASCII, ISO-8859-1 and UTF-8 that can represent all the characters occurring in the email. \u0026#34;\u0026#34;\u0026#34; # Header class is smart enough to try US-ASCII, then the charset we # provide, then fall back to UTF-8. header_charset = \u0026#39;ISO-8859-2\u0026#39; # We must choose the body charset manually for body_charset in \u0026#39;US-ASCII\u0026#39;, \u0026#39;UTF-8\u0026#39;, \u0026#39;ISO-8859-2\u0026#39;: try: body.encode(body_charset) except UnicodeError: pass else: break # Split real name (which is optional) and email address parts sender_name, sender_addr = parseaddr(sender) recipient_name, recipient_addr = parseaddr(recipient) # We must always pass Unicode strings to Header, otherwise it will # use RFC 2047 encoding even on plain ASCII strings. sender_name = str(Header(unicode(sender_name), header_charset)) recipient_name = str(Header(unicode(recipient_name), header_charset)) # Make sure email addresses do not contain non-ASCII characters sender_addr = sender_addr.encode(\u0026#39;ascii\u0026#39;) recipient_addr = recipient_addr.encode(\u0026#39;ascii\u0026#39;) # Create the message (\u0026#39;plain\u0026#39; stands for Content-Type: text/plain) msg = MIMEText(body.encode(body_charset), \u0026#39;plain\u0026#39;, body_charset) msg[\u0026#39;From\u0026#39;] = formataddr((sender_name, sender_addr)) msg[\u0026#39;To\u0026#39;] = formataddr((recipient_name, recipient_addr)) msg[\u0026#39;Subject\u0026#39;] = Header(unicode(subject), header_charset) # Send the message via SMTP to localhost:25 smtp = smtplib.SMTP(\u0026#34;localhost\u0026#34;) smtp.sendmail(sender, recipient, msg.as_string()) smtp.quit() Wykorzystanie:\nsend_email( u\u0026#34;GÄ…ska \u0026lt;gaska@test.pl\u0026gt;\u0026#34;, u\u0026#34;TchÃ³rz \u0026lt;tchorz@test2.pl\u0026gt;\u0026#34;, u\u0026#34;GrzegrzÃ³Å‚kÄ™ testujÄ…c..\u0026#34;, u\u0026#34;Ä…Å›Å‚Ã³Å§ itd...\u0026#34; ) Å¹rÃ³dÅ‚o http://mg.pov.lt/blog/unicode-emails-in-python.html\n","href":"/2012/12/python-wysylanie-maili-w-unicode/","title":"Python - wysyÅ‚anie maili w unicode"},{"content":"MoÅ¼na lubieÄ‡ AD, moÅ¼na go nie lubieÄ‡\u0026hellip; Ale jak juÅ¼ siÄ™ ma to warto czasem zintegrowaÄ‡ go z tym\u0026hellip; i tamtym\u0026hellip; Od strony Linuksa najwygodniej moÅ¼na to osiÄ…gnÄ…Ä‡ przez LDAP. A Å¼eby to dobrze zrobiÄ‡ trzeba najpierw przetestowaÄ‡ czy aby wszystko dziaÅ‚a jak byÅ›my sobie tego Å¼yczyli. I tutaj bardzo przydatne jest narzÄ™dzie ldapsearch.\nDo odpytywania LDAP\u0026rsquo;a potrzebujemy jeden pakiecik, ktÃ³ry zawiera kilka narzÄ™dzi do jego obsÅ‚ugi:\napt-get install ldap-utils Teraz moÅ¼emy prÃ³bowaÄ‡ przeszukiwaÄ‡ katalog np. tak:\nldapsearch -L -x -b \u0026#34;DC=nazwadomeny,DC=local\u0026#34; -D \u0026#34;CN=jakies_konto_w_ad,OU=System Accounts,DC=nazwadomeny,DC=local\u0026#34; -h kontroler.nazwadomeny.local -p 389 -W Polecenie to odpyta kontroler o adresieÂ kontroler.nazwadomeny.localÂ (oczywiÅ›cie moÅ¼emy uÅ¼yÄ‡ teÅ¼ adresu IP) o wszystkie elementy w domenie. Port 389 na kontrolerze domeny musi byÄ‡ otwarty na zaporze - moÅ¼na teÅ¼ wykorzystaÄ‡ 3268 (o ile jest otwarty).\nParametr -b okreÅ›la poczÄ…tkowÄ… gaÅ‚Ä…Åº wyszukiwania - moÅ¼emy tu dodaÄ‡ konkretne OU itd.. by zmniejszyÄ‡ liczbÄ™ elementÃ³w.\n-D to uÅ¼ytkownik na ktÃ³rego siÄ™ logujemy by uzyskaÄ‡ dostÄ™p do katalogu.\n-W zapyta nas o hasÅ‚o dla tego uÅ¼ytkownika.\nOczywiÅ›cie moÅ¼emy nie potrzebowaÄ‡ wszystkich obiektÃ³w z katalogu a tylko np. loginy kont uÅ¼ytkownikÃ³w (ale juÅ¼ nie kont maszyn) - do tego celu moÅ¼emy uÅ¼yÄ‡ filtrÃ³w, np. tak:\nldapsearch -x -b \u0026#34;DC=nazwadomeny,DC=local\u0026#34; -D \u0026#34;CN=jakies_konto_w_ad,OU=System Accounts,DC=nazwadomeny,DC=local\u0026#34; -h kontroler.nazwadomeny.local -p 3268 -w \u0026#39;haslo czystym tekstem\u0026#39; \u0026#39;(\u0026amp;(objectClass=person)(!(objectClass=computer)))\u0026#39; sAMAccountName No i dostajemy listÄ™ loginÃ³w Å¼ywychÂ uÅ¼ytkownikÃ³w. UÅ¼ycie opcjiÂ -wÂ moÅ¼e wydawaÄ‡ siÄ™ nieco kontrowersyjne ale z drugiej strony jest bardzo wygodne gdy chcemy dane wyjÅ›ciowe wykorzystaÄ‡ w skrypcie. PrzykÅ‚adowo moÅ¼emy wynik tego polecenie puÅ›ciÄ‡ przez awk by otrzymaÄ‡ same loginy i dodatkowo wszystkie maÅ‚ymi/duÅ¼ymi literami:\npoprzednie_polecenie | awk \u0026#39;/sAMAccountName/ {print tolower($2);}\u0026#39; W podobny sposÃ³b moÅ¼emy wyciÄ…gnÄ…Ä‡ wszystkie emaile osÃ³b z pewnej grupy itd, itp\u0026hellip;.\nTutaj moÅ¼na znaleÅºÄ‡ podstawowe info o reguÅ‚ach tworzenia filtrÃ³w: http://www.ldapexplorer.com/en/manual/109010000-ldap-filter-syntax.htm\n","href":"/2012/12/ldapsearch-w-active-directory/","title":"ldapsearch w Active Directory"},{"content":"SkÅ‚adniki  1 paczka bezsmakowego kleiku ryÅ¼owego (190~170 g), 2 jajka, 1 kostka miÄ™kkiego masÅ‚a (250 g), 1 pÅ‚aska Å‚yÅ¼eczka proszku do pieczenia, pÃ³Å‚ szklanki cukru, cukier waniliowy (16 g) (niekoniecznie), 8 czubatych Å‚yÅ¼ek wiÃ³rkÃ³w kokosowych, dÅ¼em do wypeÅ‚nienia ciastek (opcjonalnie - ja lubiÄ™ je rÃ³wnieÅ¼ bez dÅ¼emu).  SposÃ³b przygotowania Wszystkie skÅ‚adniki poÅ‚Ä…czyÄ‡ razem i wyrobiÄ‡ (najlepiej siÄ™ ugniata rÄ™kÄ…). FormowaÄ‡ kulki wielkoÅ›ci maÅ‚ego orzecha wÅ‚oskiego, ukÅ‚adaÄ‡ na blaszce wyÅ‚oÅ¼onej papierem do pieczenia w niewielkich odlegÅ‚oÅ›ciach (trochÄ™ urosnÄ…). JeÅ¼eli planujemy opcjÄ™ z dÅ¼emem to w kaÅ¼dej kulce naleÅ¼y zrobiÄ‡ wgÅ‚Ä™bienie - ja lekko przyciskaÅ‚em palcem.\nPiec w temperaturze 180ÂºC przez 15~20 minut, aÅ¼ zrobiÄ… siÄ™ zÅ‚ociste. Po ostudzeniu wgÅ‚Ä™bienia napeÅ‚niÄ‡ dÅ¼emem.\nÅ¹rÃ³dÅ‚o (moja wersja jest nieco przerobiona): http://www.mojewypieki.com/przepis/ciasteczka-z-kleiku-ryzowego\n","href":"/2012/11/ciastka-z-kleiku-ryzowego/","title":"Ciastka z kleiku ryÅ¼owego"},{"content":"SkÅ‚adniki  2 szklanki miÄ…Å¼szu dyni (startego lub zmiksowanego), 2 szklanki mÄ…ki, 0,75 szklanki cukru, 3 jajka, 5 Å‚yÅ¼eczek cynamonu, 16 g cukru wanilinowego, 0,75 szklanki oleju, Å‚yÅ¼eczka sody oczyszczonej, garÅ›Ä‡ orzechÃ³w wÅ‚oskich.  SposÃ³b przygotowania Ubijamy biaÅ‚ka z cukrem. Do ubitej piany dodajemy Å¼Ã³Å‚tka i kolejne skÅ‚adniki: mÄ…kÄ™, olej, cukier wanilinowy, sodÄ™ i cynamon. CaÅ‚oÅ›Ä‡ miksujemy jeszcze przez chwilÄ™, a nastÄ™pnie dodajemy posiekany lub starty i odsÄ…czony (moÅ¼na np. mocno Å›cisnÄ…Ä‡ w dÅ‚oniach)Â miÄ…Å¼sz dyniÂ oraz drobno pokrojoneÂ orzechy wÅ‚oskie i jeszcze chwilÄ™ mieszamy.\nMasÄ™ przekÅ‚adamy do wysmarowanej masÅ‚em i oprÃ³szonej mÄ…kÄ… formy - na duÅ¼ej blaszce ciasto wyjdzie doÅ›Ä‡ cienkie, wiÄ™c moÅ¼na piec np. w foremce keksowej. BlaszkÄ™ z ciastem wkÅ‚adamy do nagrzanego do 180Â°C piekarnika i w tej temperaturzeÂ pieczemy przez ok. 40-50 minut. MoÅ¼na podawaÄ‡ posypane cukrem pudrem lub cynamonem.\n","href":"/2012/11/ciasto-z-dynia/","title":"Ciasto z dyniÄ…"},{"content":"CouchDB databases on version 0.11.x swell very fast. They should be compacted daily for best performance and space usage. Here is my script that could be run in cron and will compact all databases:\n#!/bin/bash IP=\u0026#34;10.0.0.121\u0026#34; DBS=`curl -sS -X GET http://$IP:5984/_all_dbs | sed -r \u0026#34;s/([,\\\u0026#34;[])|(\\])+/ /g\u0026#34;` for d in $DBS; do curl -H \u0026#34;Content-Type: application/json\u0026#34; -X POST http://$IP:5984/$d/_compact done More informations about compacting could be found here (also for version 1.2.x).\n","href":"/2012/11/automatically-compact-couchdb-databases-in-0-11-x/","title":"Automatically compact CouchDB databases in version 0.11.x"},{"content":"","href":"/tags/couchdb/","title":"CouchDB"},{"content":"","href":"/tags/ext4/","title":"ext4"},{"content":"","href":"/tags/lvm/","title":"LVM"},{"content":"Po zakupie nowych dyskÃ³w zamierzam utworzyÄ‡ zdegradowanÄ… macierz RAID5 z dwÃ³ch dyskÃ³w (na trzecim na razie znajdujÄ… siÄ™ dane), potem utworzyÄ‡ wolumen LVM, sformatowaÄ‡ go, przekopiowaÄ‡ dane z pojedynczego dysku na macierz i doÅ‚Ä…czyÄ‡ trzeci dysk do macierzy odbudowujÄ…cÂ parzystoÅ›Ä‡. Zadanie bÄ™dzie o tyle ciekawe Å¼e dysk ma 4KB sektory i trzeb bÄ™dzie dbaÄ‡ o wyrÃ³wnanie zasobu do rozmiaru sektora, a w przypadku LVM\u0026rsquo;a wyrÃ³wnanie do chunk\u0026rsquo;a z macierzy.\nPrawidÅ‚owe wyrÃ³wnanie partycji KupujÄ…c nowy dysk (o pojemnoÅ›ci od 500GB w gÃ³rÄ™), mamy spore szanse Å¼e trafimy na sztukÄ™, ktÃ³ra wykorzystuje 4KB sektory do alokacji danych. PoniewaÅ¼ statystyczny rozmiar przechowywanych plikÃ³w roÅ›nie i nawet proste zdjÄ™cie ma powyÅ¼ej 1MB to wykorzystanie blokÃ³w o tym rozmiarze wiÄ™kszym niÅ¼ 512 bajtÃ³w jest jak najbardziej uzasadnione - zresztÄ… wiÄ™kszoÅ›Ä‡ systemÃ³w plikÃ³w i tak wykorzystuje bloki 4~8KB. Jest tylko jedno ALE: jeÅ¼eli nie uwzglÄ™dnimy tego podczas partycjonowania dysku to sektory 4KB systemu plikÃ³w zamiast znajdowaÄ‡ siÄ™ w rÃ³wno w odpowiadajÄ…cych im fizycznych 4KB sektorach dysku - mogÄ… zachodziÄ‡ na 2 sektory fizyczne - w takiej sytuacji kaÅ¼de odwoÅ‚anie to takiego sektora w systemie plikÃ³w wymaga odczytania/zapisanie dwÃ³ch sektorÃ³w fizycznych. Co prawda w dyskach stosuje siÄ™ mechanizmy, ktÃ³re powinny zoptymalizowaÄ‡ takie sytuacje ale jak potwierdzajÄ… benchmarki Åºle wyrÃ³wnane partycja mogÄ… znacznie obniÅ¼yÄ‡ wydajnoÅ›Ä‡ dysku. A jeszcze zabawniej jest jeÅ›li kupimy dysk SSD bo w nich bardzo czÄ™sto fizyczne bloki sÄ… 128~512KB i Å¼eby byÅ‚o zabawniej to bardzo czÄ™sto dyski SSD deklarujÄ… (choÄ‡by przez SMART\u0026rsquo;a) Å¼e majÄ… bloki 512B - SIC!\nJeÅ›li mamy fart i nasz dysk raportuje rozmiar fizycznego sektora to moÅ¼emy to sprawdziÄ‡ tak:\ncat /sys/block/sda/queue/physical_block_size U mnie to polecenie zwrÃ³ciÅ‚o 4096 czyli 4KB co jest zgodne z deklaracjÄ… producenta.\nDobre podejÅ›cie do tematu wyrÃ³wnania partycji zaproponowaÅ‚ Teo Tso czyli wybranie takich parametrÃ³w gÅ‚owic/sektorÃ³w na Å›cieÅ¼ce by fdisk automatycznie wyrÃ³wnywaÅ‚ partycje do oczekiwanej przez nas wielkoÅ›ci bloku. Teo proponowaÅ‚ uÅ¼ycie 224 gÅ‚owic i 56 sektorÃ³w - co da wyrÃ³wnanie do 128KB dla wszystkich partycji z wyjÄ…tkiem pierwszej (pierwsza bÄ™dzie wyrÃ³wnana do 4KB o ile nie wymusimy startu z 256 sektora). JeÅ¼eli mamy dysk z blokami 4KB lub pierwszÄ… partycjÄ™ zamierzamy wykorzystaÄ‡ jako np. /boot (gdzie wydajnoÅ›Ä‡ nie ma aÅ¼ takiego duÅ¼ego znaczenia) to jest to ok. Ale jeÅ›li kompatybilnoÅ›Ä‡ z DOS\u0026rsquo;em mamy w powaÅ¼aniu to moÅ¼emy w fdisku utworzyÄ‡ pierwszÄ… partycjÄ™ wyrÃ³wnanÄ… do 128KB lub 1MB.\nPrzewaÅ¼nie wolaÅ‚emÂ cfdiska od fdiskaÂ (bo po co siÄ™ mÄ™czyÄ‡ z topornym interfejsem) ale nie udaÅ‚o mi siÄ™ skubaÅ„ca zmusiÄ‡ by tworzyÅ‚ pierwszÄ… partycjÄ™ w sposÃ³b nie kompatybilny z DOS\u0026rsquo;em. fdisk pomimo topornoÅ›ci po podaniu liczby gÅ‚owic i sektorÃ³w w Å›cieÅ¼ce podpowiedziaÅ‚ mi poprawne wyrÃ³wnanie partycji (a gdybyÅ›my posiadali starszÄ… wersjÄ™, ktÃ³ra nie jest tak sprytna to przynajmniej moÅ¼emy podaÄ‡ rÄ™cznie od ktÃ³rego sektora ma zaczynaÄ‡ siÄ™ partycja).\nWyrÃ³wnanie do 128KB fdisk -u -H 224 -S 56 /dev/sdX Opcja -u zmienia domyÅ›lnÄ… jednostkÄ™ na sektory (mamy wtedy mniejsze liczby, ktÃ³re Å‚atwiej siÄ™ przelicza). Dla wyrÃ³wnania do 128KB pierwsza partycja powinna siÄ™ zaczynaÄ‡ na 256 sektorze. Do wyrÃ³wnania do 4KB wystarczy zaczÄ…Ä‡ na 56 sektorze (wystarczajÄ…ce przy czÄ™Å›ci nowszych dyskÃ³w twardych).\nWyrÃ³wnanie do 1MB JeÅ›li jednak dysponujemy dyskiem SSD z ciÄ™Å¼ko powiedzieÄ‡ jak duÅ¼ym blokiem to lepiej wykorzystaÄ‡ wyrÃ³wnanie do 1MB - zmarnujemy trochÄ™ wiÄ™cej miejsca (tych parÄ™ MB jakoÅ› przeÅ¼yjemy) ale w tym rozmiarze na pewno zmieÅ›ci siÄ™ kaÅ¼dy sektor (a moÅ¼e nawet Erase Block, ktÃ³ry obecnie przewaÅ¼nie ma 512KB choÄ‡ zdarzajÄ… siÄ™ sztuki z 4MB). MoÅ¼na to osiÄ…gnÄ…Ä‡ z ustawieniem 64 gÅ‚owic i 32 sektorÃ³w na Å›cieÅ¼kÄ™, robimy to tak:\nfdisk -u -H 64 -S 32 /dev/sdX Pierwsza partycja powinna siÄ™ zaczynaÄ‡ na 2048 sektorze dla wyrÃ³wnania do 1MB lub 8192 sektorze jeÅ›li chcemy zaczÄ…Ä‡ od 4MB.\nPo odpaleniu fdiska z tymi parametrami wybieramy opcjÄ™ n i lecimy dalej zgodnie z podpowiedziami, np.:\nfdisk -u -H 224 -S 56 /dev/sdc Polecenie (m wyÅ›wietla pomoc): \u0026lt;strong\u0026gt;m\u0026lt;/strong\u0026gt; Polecenie a zmiana flagi rozruchu b modyfikacja etykiety dysku BSD c zmiana flagi kompatybilnoÅ›ci z DOS-em d usuniÄ™cie partycji l wypisanie znanych typÃ³w partycji m wyÅ›wietlenie tego menu \u0026lt;strong\u0026gt;n dodanie nowej partycji\u0026lt;/strong\u0026gt; o utworzenie nowej, pustej DOS-owej tablicy partycji p wypisanie tablicy partycji q zakoÅ„czenie bez zapisywania zmian s utworzenie nowej, pustej etykiety dysku Suna t zmiana ID systemu partycji u zmiana jednostek wyÅ›wietlania/wprowadzania v weryfikacja tablicy partycji w zapis tablicy partycji na dysk i zakoÅ„czenie x dodatkowe funkcje (tylko dla ekspertÃ³w) Polecenie (m wyÅ›wietla pomoc): \u0026lt;strong\u0026gt;n\u0026lt;/strong\u0026gt; Partition type: p primary (0 primary, 0 extended, 4 free) e extended Select (default \u0026lt;strong\u0026gt;p\u0026lt;/strong\u0026gt;): Using default response p Numer partycji (1-4, domyÅ›lnie \u0026lt;strong\u0026gt;1\u0026lt;/strong\u0026gt;): PrzyjÄ™to wartoÅ›Ä‡ domyÅ›lnÄ… 1 Pierwszy sektor (2048-15240575, domyÅ›lnie \u0026lt;strong\u0026gt;2048\u0026lt;/strong\u0026gt;): PrzyjÄ™to wartoÅ›Ä‡ domyÅ›lnÄ… 2048 Ostatni sektor, +sektorÃ³w lub +rozmiar{K,M,G} (2048-15240575, domyÅ›lnie 15240575): \u0026lt;strong\u0026gt;+100M\u0026lt;/strong\u0026gt; Polecenie (m wyÅ›wietla pomoc): \u0026lt;strong\u0026gt;p\u0026lt;/strong\u0026gt; Dysk /dev/sdc: 7803 MB, bajtÃ³w: 7803174912 gÅ‚owic: 224, sektorÃ³w/Å›cieÅ¼kÄ™: 56, cylindrÃ³w: 1214, w sumie sektorÃ³w: 15240576 Jednostka = sektorÃ³w, czyli 1 * 512 = 512 bajtÃ³w Rozmiar sektora (logiczny/fizyczny) w bajtach: 512 / 512 Rozmiar we/wy (minimalny/optymalny) w bajtach: 512 / 512 Identyfikator dysku: 0xc3072e18 UrzÄ…dzenie Rozruch PoczÄ…tek Koniec BlokÃ³w ID System /dev/sdc1 2048 206847 102400 83 Linux Polecenie (m wyÅ›wietla pomoc): \u0026lt;strong\u0026gt;w\u0026lt;/strong\u0026gt; Tablica partycji zostaÅ‚a zmodyfikowana! WywoÅ‚ywanie ioctl() w celu ponownego odczytu tablicy partycji. UWAGA: ponowny odczyt tablicy partycji zakoÅ„czyÅ‚ siÄ™ bÅ‚Ä™dem 16: UrzÄ…dzenie lub zasoby zajÄ™te. JÄ…dro nadal uÅ¼ywa starej tablicy. Nowa tablica bÄ™dzie uÅ¼ywana po nastÄ™pnym restarcie systemu albo po uruchomieniu partprobe(8) lub kpartx(8) Synchronizacja dyskÃ³w. P.S. Po co w ogÃ³le partycjonowaÄ‡ - moÅ¼na uÅ¼yÄ‡ caÅ‚ych urzÄ…dzeÅ„ Co prawda w przypadku gdy zamierzam caÅ‚e dyski poÅ›wiÄ™ciÄ‡ na RAID\u0026rsquo;a mÃ³gÅ‚bym ich nie partycjonowaÄ‡ tylko uÅ¼yÄ‡ caÅ‚ych urzÄ…dzeÅ„ i zadbaÄ‡ tylko by mdadm poprawnie siÄ™ wyrÃ³wnaÅ‚ (co zresztÄ… robi automatycznie do 4KB), ale obawiaÅ‚em siÄ™ jak wzglÄ™dem takich dyskÃ³w zachowajÄ… siÄ™ inne systemy ktÃ³re mam zainstalowane na komputerze - nie chciaÅ‚bym aby przypadkiem uznaÅ‚y Å¼e to jakiÅ› uszkodzony dysk po czym zainicjowaÅ‚y tablicÄ™ partycji\u0026hellip; MoÅ¼e to nieuzasadniona fobia ale wiem Å¼e wzglÄ™dem partycji RAID Autodetect nic takiego mi siÄ™ nie przytrafi ðŸ˜ƒ\nTworzenie macierzy RAID Jak juÅ¼ utworzymy poÅ¼Ä…dane partycje na pierwszym dysku to musimy je powieliÄ‡ na wszystkich pozostaÅ‚ych dyskach, ktÃ³re zamierzamy wÅ‚Ä…czyÄ‡ do macierzy - najproÅ›ciej zrobiÄ‡ to sfdisk\u0026rsquo;iem:\nsfdisk -d /dev/sdX | sfdisk /dev/sdY Przy czym dysk sdX to ÅºrÃ³dÅ‚owy dysk z gotowymi partycjami, a dysk sdY to kaÅ¼dy na ktÃ³rym chcemy odtworzyÄ‡ partycje. MoÅ¼na by zrobiÄ‡ na to Å‚adnÄ… pÄ™telkÄ™ jeÅ›li mamy wiÄ™cej tych dyskÃ³w ale celowo tego nie zrobiÄ™ bo jak znam Å¼ycie to kiedyÅ› ktoÅ› to skopiuje ze znakiem nowego wiersza i wrzuci do konsoli\u0026hellip; ðŸ˜€\nTeraz tworzÄ™ zdegradowanÄ… (z dwÃ³ch dyskÃ³w) macierz RAID5\u0026hellip; Ale na dobrÄ… sprawÄ™ bezpieczniej byÅ‚oby utworzyÄ‡ macierz RAID1 z dwÃ³ch dyskÃ³w (o ile miejsca byÅ‚oby wystarczajÄ…co na przeniesienie danych) a po przeniesieniu danych na macierz dodanie trzeciego dysku i powiÄ™kszenie macierzy z reshapingiem do RAID5 - postanowiÅ‚em pominÄ…Ä‡ takie rozwiÄ…zanie bo nie baÅ‚em siÄ™ utraty danych, miaÅ‚em dokÅ‚adnÄ… kopiÄ™ na innej macierzy ðŸ˜ƒ\nWiÄ™c tworzymy macierz:\nmdadm --create /dev/md0 --level=5 --raid-devices=2 --chunk=512k /dev/sdX1 /dev/sdY1 Na dobrÄ… sprawÄ™ z powyÅ¼szych opcji tylko chunk nadaje siÄ™ do \u0026ldquo;dopasowania\u0026rdquo; - ja mam zamiar utworzyÄ‡ macierz z doÅ›Ä‡ duÅ¼ych zasobÃ³w (3x2TB) i przechowywaÄ‡ na niej raczej duÅ¼e pliki wiÄ™c 512KB wydaje mi siÄ™ dobrÄ… wartoÅ›ciÄ…. GdybyÅ›my jednak potrzebowali wiÄ™kszej liczby I/O dla maÅ‚ych pliczkÃ³w to mniejsza wartoÅ›Ä‡ moÅ¼e byÄ‡ lepsza. Warto zrobiÄ‡ kilka benchmarkÃ³w dla rÃ³Å¼nych wartoÅ›ci chunk\u0026rsquo;a i dopasowaÄ‡ do przewidywanego przez nas obciÄ…Å¼enia.\nAby macierz byÅ‚a widoczne juÅ¼ w czasie startu systemu naleÅ¼y dodatkowo wykonaÄ‡ polecenie:\nmdadm --detail --scan \u0026gt;\u0026gt; /etc/mdadm/mdadm.conf Warto teÅ¼ w pliku /etc/mdadm/mdadm.conf odkomentowaÄ‡ i wpisaÄ‡ jakieÅ› sensowne wartoÅ›ci dla HOMEHOST, MAILADDR.\nI teraz moÅ¼emy odbudowaÄ‡ obraz initrd:\nupdate-initramfs -u Optymalizacja macierzy RAID5 Sam proces tworzenia macierzy moÅ¼e zajÄ…Ä‡ kilka/kilkanaÅ›cie godzin - dlatego warto mu pomÃ³c kilkoma zmianami.\nspeed_limit_xxx Na pierwszy rzut - domyÅ›lne wartoÅ›ci dla minimalnej i maksymalnej prÄ™dkoÅ›ci budowania/regenerowania/odtwarzania macierzy RAID5, moÅ¼na je sprawdziÄ‡:\ncat /proc/sys/dev/raid/speed_limit_max 200000 cat /proc/sys/dev/raid/speed_limit_min 1000 DomyÅ›lnie jest to minimum 1MB/s i maksimum 200MB/s. PodbijajÄ…c minimalnÄ… prÄ™dkoÅ›Ä‡ do 10~50MB/s moÅ¼na kosztem wiÄ™kszego obciÄ…Å¼enia systemu zmusiÄ‡ macierz by odbudowywaÅ‚a siÄ™ szybciej. OsobiÅ›cie uwaÅ¼am tÄ… optymalizacjÄ™ za maÅ‚o znaczÄ…cÄ… bo caÅ‚y mechanizm doÅ›Ä‡ elastycznie reaguje na obciÄ…Å¼enie systemu i jeÅ›li nic nie robimy to prÄ™dkoÅ›ci odbudowy sÄ… doÅ›Ä‡ wysokie. Ale moÅ¼na to zrobiÄ‡ tak:\necho 50000 \u0026gt; /proc/sys/dev/raid/speed_limit_min lub tak:\nsysctl -w dev.raid.speed_limit_min=50000 stripe_cache_size Ta optymalizacja pomogÅ‚a mi duÅ¼o - ok. 30% wzrost wydajnoÅ›ci macierzy (rÃ³wnieÅ¼ w czasie odbudowy parzystoÅ›ci). MoÅ¼emy sprawdziÄ‡ wartoÅ›Ä‡ tego parametru, np. tak:\ncat /sys/block/md0/md/stripe_cache_size DomyÅ›lnie jest to wartoÅ›Ä‡ 128 - bida z nÄ™dzÄ…, u mnie ustawienie na 32768 (maksymalna wartoÅ›Ä‡ tego parametru) daÅ‚o najwiÄ™kszy wzrost wydajnoÅ›ci - ale juÅ¼ 8192 znacznie poprawiÅ‚o wydajnoÅ›Ä‡.\nfor i in 256 512 1024 2048 4096 8192 16384 32768; do echo \u0026#34;Testowanie $i\u0026#34; echo $i \u0026gt; /sys/block/md0/md/stripe_cache_size sync echo 3 \u0026gt; /proc/sys/vm/drop_caches dd if=/dev/zero of=file bs=1M count=10000 done WyÅ‚Ä…czenie NCQ dla wszystkich dyskÃ³w w macierzy WydaÅ‚o mi siÄ™ to nieco kontrowersyjne bo NCQ powinno pomagaÄ‡ przy losowych odczytach/zapisach - ale zapuÅ›ciÅ‚em test bonnie++ i okazaÅ‚o siÄ™ Å¼e z wÅ‚Ä…czonym NCQ czasy dostÄ™pu dla niektÃ³rych obciÄ…Å¼eÅ„ rosnÄ… nawet dziesiÄ™ciokrotnie! Warto wiÄ™c sprawdziÄ‡ tÄ… opcjÄ™ pod przewidywanym przez nas scenariuszem obciÄ…Å¼enia.\nNCQ dla poszczegÃ³lnych dyskÃ³w moÅ¼na wyÅ‚Ä…czyÄ‡ np. tak:\nfor d in sdb sdc sdd do echo 1 \u0026gt; /sys/block/$d/device/queue_depth done WyÅ‚Ä…czenie cache dyskowych WyÅ‚Ä…czenie wbudowanej w dyski pamiÄ™ci cache akurat nie zwiÄ™ksza wydajnoÅ›ci ale w przypadku awarii zasilania (lub innej gwaÅ‚townej awarii systemu) zwiÄ™ksza szanse macierzy na przeÅ¼ycie takiego incydentu. Obecnie wiÄ™kszoÅ›Ä‡ systemÃ³w plikÃ³w korzysta z opÃ³Åºnienia zapisu by bardziej optymalnie zapisaÄ‡ dane na dysku - dlatego gdy zapisujemy dany to najpierw trafiajÄ… one do cache systemowego. Dopiero po sync\u0026rsquo;u sÄ… przesyÅ‚ane do cache dyskowego skÄ…d dopiero po pewnym czasie trafiajÄ… na dysk. WyÅ‚Ä…czenie pamiÄ™ci cache na dyskach \u0026ldquo;usuwa\u0026rdquo; nam to drugie opÃ³Åºnienie.\nhdparm -W0 /dev/sd* Zmiana parametrÃ³w odczytu z wyprzedzeniem Bardzo waÅ¼nym parametrem majÄ…cym wpÅ‚yw na wydajnoÅ›Ä‡ macierzy jest odpowiednie ustawienie odczytu z wyprzedzeniem. Obecnie ustawionÄ… wartoÅ›Ä‡ moÅ¼emy sprawdziÄ‡ tak (wartoÅ›Ä‡ wyraÅ¼ona jest w 512 bajtowych sektorach):\nblockdev --getra /dev/md0 U mnie domyÅ›lnie byÅ‚o 4096 (a na innym starszym systemie tylko 1536) to moÅ¼e byÄ‡ zbyt maÅ‚o dla konfiguracji RAID. WiÄ™ksze wartoÅ›ci moÅ¼na ustawiÄ‡ np. tak:\nblockdev --setra 65536 /dev/md0 A tak moÅ¼na wykonaÄ‡ sprawdzanie, ktÃ³ra wartoÅ›Ä‡ bÄ™dzie dla nas najbardziej optymalna:\ndd if=/dev/zero of=file bs=1M count=10000 for i in 1536 4096 8192 16384 32768 65536 131072 262144 524288; do echo \u0026#34;Testowanie $i\u0026#34; blockdev --setra $i /dev/md0 sync echo 3 \u0026gt; /proc/sys/vm/drop_caches dd if=file of=/dev/null bs=1M done Tworzenie zasobu LVM MajÄ…c juÅ¼ macierze tworzÄ™ na niej volumen LVM - najpierw przygotowanie zasobu:\npvcreate /dev/md0 JeÅ¼eli w /etc/lvm/lvm.conf mamy ustawione opcje:\nmd_component_detection = 1 md_chunk_alignment = 1 data_alignment_detection = 1 To LVM powinien automatycznie wykryÄ‡ rozmiar chunk\u0026rsquo;a z RAID\u0026rsquo;a i dostosowaÄ‡ swoje metadane, oraz poczÄ…tek danych tak by wszystko byÅ‚o prawidÅ‚owo wyrÃ³wnane wzglÄ™dem macierzy.\nJeÅ›li nie mamy szczÄ™Å›cia (bardzo stare jajko/LVM) to bÄ™dziemy musieli uÅ¼yÄ‡ opcji -metadatasize i/lub -dataalignment:\npvcreate --metadatasize 500k /dev/md0 Teraz ciekawostka - LVM potrzebuje na 192KB na dane nagÅ‚Ã³wkowe kaÅ¼dego wolumenu i kaÅ¼dy utworzony pÃ³Åºniej zasÃ³b byÅ‚by o te 192KB przesuniÄ™ty, wiÄ™c \u0026hellip; trafia nasze wyrÃ³wnanie do 128KB. Dlatego zmuszamy LVM\u0026rsquo;a by zaalokowaÅ‚ nieco wiÄ™cej - tutaj 256KB. OK - ale w poleceniu jest 250 - WTF? I to aby byÅ‚o zabawnie jest to jak najbardziej prawidÅ‚owa wartoÅ›Ä‡ - nie wiem jaka w tym logika, ale by metadane zajmowaÅ‚y 256KB podajemy 250k, by zajmowaÅ‚y 512KB podajemy 500k itd\u0026hellip;\nInaczej jest z opcjÄ… -dataalignment, tutaj najbardziej optymalnie naleÅ¼y podaÄ‡ rozmiar chunk\u0026rsquo;a*iloÅ›Ä‡ aktywnych dyskÃ³w (dla RAID5 odejmujemy jeden) - albo minimalnie rozmiar chunka, np.:\npvcreate --dataalignment 512K /dev/md0 PoprawnoÅ›Ä‡ moÅ¼emy sprawdziÄ‡ poleceniem:\npvs /dev/md0 -o+pe_start PV VG Fmt Attr PSize PFree 1st PE /dev/md0 vgraid lvm2 a- 1,82t 488,89g 512,00k U mnie 1st PE zaczyna siÄ™ na 512KB, wiÄ™c jest OK.\nTeraz tworzymy grupÄ™:\nvgcreate vgraid /dev/md0 Polecenie vgcreate posiada parametr -s ktÃ³ry pozwala okreÅ›liÄ‡ do wielokrotnoÅ›ci jakiej wartoÅ›ci bÄ™dzie zaokrÄ…glana wielkoÅ›Ä‡ wolumenu - wartoÅ›Ä‡ ta powinna byÄ‡ wielokrotnoÅ›ciÄ… chunk\u0026rsquo;a z macierzy. DomyÅ›lnie ma ona wartoÅ›Ä‡ 4MB wiÄ™c wszystko bÄ™dzie Å‚adnie wyrÃ³wnane.\nI moÅ¼emy zaczÄ…Ä‡ tworzyÄ‡ volumeny logiczne:\nlvcreate -L1T -nsrv vgraid Formatowanie To teraz formatowanie - tutaj teÅ¼ czasem trzeba siÄ™ wysiliÄ‡ by utworzony przez nas filesystem dziaÅ‚aÅ‚ moÅ¼liwie optymalnie na macierzy i bloku o odpowiednim rozmiarze. W przypadku filesystemu na macierzy sÄ… dwa waÅ¼ne parametry: stride i stripe-width. Stride powinien odpowiadaÄ‡ rozmiarowi podanemu jako chunk podczas tworzenia macierzy ale wyraÅ¼onego w blokach systemu plikÃ³w (domyÅ›lnie 4KB). Stripe-width powinno byÄ‡ ustawione na: stride * N, gdzie N to iloÅ›Ä‡ aktywnych dyskÃ³w w macierzy (dla RAID5 jest to iloÅ›Ä‡ dyskÃ³w minus 1) - przykÅ‚adowo dla bloku 4KB i chunk\u0026rsquo;a 512KB, stride powinien wynosiÄ‡ 128 (512/4). Z kolei stripe-width dla 3 dyskÃ³w to 128*(3-1)=256. PrawidÅ‚owe dobranie tych parametrÃ³w moÅ¼e daÄ‡ wzrost wydajnoÅ›ci rzÄ™du 40% (wedÅ‚ug moich testÃ³w). Teoretycznie na nowszych systemach tworzone systemy plikÃ³w automatycznie powinny wykryÄ‡ najbardziej optymalne wyrÃ³wnanie - moÅ¼emy wiÄ™c sprÃ³bowaÄ‡ puÅ›ciÄ‡ format bez tych parametrÃ³w i pÃ³Åºniej skontrolowaÄ‡ ich wartoÅ›ci poleceniem:\ntune2fs -l /dev/vgraid/srv Na poczÄ…tek przykÅ‚ad dla systemu plikÃ³w dla maÅ‚ych i Å›rednich plikÃ³w:\nmkfs.ext4 -E stride=128,stripe-width=256,resize=4T -m0 /dev/vgraid/srv Jeden dodatkowy parametr to resize - pozwala on zmieniÄ‡ domyÅ›lne ustawienie maksymalnego rozmiaru do ktÃ³rego moÅ¼emy powiÄ™kszyÄ‡ dany filesystem - domyÅ›lnie jest to wartoÅ›Ä‡ 1000 razy wiÄ™ksza od poczÄ…tkowej wielkoÅ›ci - ciut przekozaczone. MoÅ¼e nie oszczÄ™dzi to duÅ¼o miejsca na dysku (kilkadziesiÄ…t/kilkaset MB) ale na pewno skrÃ³ci czas fsck\u0026rsquo;a.\nKolejny dodatek to -m0 ktÃ³re wyÅ‚Ä…cza alokacjÄ™ 5% przestrzeni dyskowej dla root\u0026rsquo;a i usÅ‚ug systemowych - po prostu tutaj tego nie potrzebujÄ™ a 5% z 1TB to 50GB marnujÄ…cego siÄ™ miejsca!\nJeÅ›li wiemy Å¼e bÄ™dziemy przechowywaÄ‡ na danym zasobie tylko stosunkowo duÅ¼e pliki to moÅ¼na uÅ¼yÄ‡ takich opcji:\nmkfs.ext4 -E stride=128,stripe-width=256,resize=4T -T largefile -m0 /dev/vgraid/srv Opcja -T to wykorzystanie szablonÃ³w opcji dla tworzenia systemÃ³w plikÃ³w, ktÃ³re moÅ¼na edytowaÄ‡ i dodawaÄ‡ w pliku: /etc/mke2fs.conf. Szablon largefile wykorzystuje mniejszÄ… liczbÄ™ inodÃ³w dla nowego filesystemu, jeÅ›li zamierzamy przechowywaÄ‡ gÅ‚Ã³wnie duÅ¼e pliki to zmniejszy to czas formatowania i pÃ³Åºniejszych fsck\u0026rsquo;Ã³w na tym systemie plikÃ³w.\nTestowanie wydajnoÅ›ci ZalecaÅ‚bym testowanie wydajnoÅ›ci na kolejnych etapach przygotowania dyskÃ³w i powtarzaÄ‡ te same benchmarki po kaÅ¼dej zmianie, tak wiÄ™c testujemy:\n Na poczÄ…tek wszystkie dyski, z ktÃ³rych zamierzamy zbudowaÄ‡ RAID\u0026rsquo;a by wykluczyÄ‡ ewentualne \u0026ldquo;padaki\u0026rdquo;/uszkodzone kable, itp. Np. hdparm/dd na czystym dysku i dodatkowo iozone/bonnie++ na filesystemie by sprawdziÄ‡ czy nie skopaliÅ›my wyrÃ³wnania partycji. Po zbudowaniu RAID\u0026rsquo;a powtarzamy testy - na caÅ‚ym urzÄ…dzeniu (dd) i po sformatowaniu (iozone/bonnie++) by upewniÄ‡ siÄ™ Å¼e RAID jest prawidÅ‚owo wyrÃ³wnany (przy czym przy RAID5 moÅ¼emy siÄ™ spodziewaÄ‡ wynikÃ³w przy zapisie niÅ¼szych niÅ¼ przy odczycie - jest to OK). Jest to teÅ¼ dobry moment na sprawdzenie kilku optymalizacji dla macierzy: stripe_cache_size, wyÅ‚Ä…czenie NCQ, ustawienia odczytu z wyprzedzeniem, wyÅ‚Ä…czenie cache dyskÃ³w - po kaÅ¼dej z tych zmian ponawiamy benchmarki by upewniÄ‡ siÄ™ Å¼e uzyskaliÅ›my poprawÄ™/lub nie. Po przygotowaniu LVM\u0026rsquo;a - ponawiamy benchmarki na volumenie by upewniÄ‡ siÄ™ Å¼e nie skopaliÅ›my wyrÃ³wnania partycji/chunk\u0026rsquo;a/itd\u0026hellip; Dopieszczamy opcje formatowania filesystemu i jego montowania (np. noatime, commit, data, itd) - i znÃ³w posiÅ‚kujemy siÄ™ benchmarkami by potwierdziÄ‡ Å¼e pniemy siÄ™ z wydajnoÅ›ciÄ… w gÃ³rÄ™.  JeÅ›li myÅ›licie Å¼e to duÅ¼o to zalecaÅ‚bym powtÃ³rzenie czÄ™Å›ci benchmarkÃ³w 2~3 krotnie by upewniÄ‡ siÄ™ Å¼e wyniki nie odbiegajÄ… znacznie od siebie. Dodatkowo powinniÅ›my czyÅ›ciÄ‡ przed kaÅ¼dym banchmarkiem cache dyskowyÂ aby mieÄ‡ pewnoÅ›Ä‡ Å¼e lepsze wyniki nie sÄ… skutkiem wczytania danych do pamiÄ™ci. Z tego samego powodu jeÅ›li uruchamiamy benchmarki to iloÅ›Ä‡ zapisywanych/odczytywanych danych powinna byÄ‡ minimum 1,5~2 razy wiÄ™ksza niÅ¼ pamieÄ‡ RAM zainstalowana w systemie by na pewnie wszystkie dane nie zmieÅ›ciÅ‚y siÄ™ w cache\u0026rsquo;u. OczywiÅ›cie moÅ¼na to zlaÄ‡ ale pÃ³Åºniej nie ma siÄ™ co dziwiÄ‡ Å¼e system dziaÅ‚a wolno - a na produkcyjnej maszynie duÅ¼o trudniej zaoraÄ‡ caÅ‚Ä… konfiguracjÄ… i utworzyÄ‡ od poczÄ…tku z prawidÅ‚owym wyrÃ³wnaniem.\nZalecane jest wykorzystanie IOZone lub Bonnie++ poniewaÅ¼ testujÄ… one nie tylko prosty sekwencyjny odczyt, ale rÃ³wnieÅ¼ tworzenie/kasowanie plikÃ³w o rÃ³Å¼nych rozmiarach i w rÃ³Å¼nej iloÅ›ci - to pozwala lepiej sprawdziÄ‡ opÃ³Åºnienia wystÄ™pujÄ…ce przy przewidywanych przez nas obciÄ…Å¼eniach oraz upewniÄ‡ siÄ™ Å¼e caÅ‚a zabawa z wyrÃ³wnywaniem zasobÃ³w miaÅ‚a sens. OczywiÅ›cie to tylko zalecenia ðŸ˜‰\nhdparm W przypadku macierzy wykorzystanie prostego hdparm\u0026rsquo;a do testÃ³w:\nhdparm -tT /dev/md0 nie zwrÃ³ci realnych i sensownych wynikÃ³w. Pomiar jest zbyt krÃ³tki by uzyskaÄ‡ sensowne wyniki - lepiej wykorzystaÄ‡ dd z duÅ¼Ä… iloÅ›ciÄ… danych do odczytu.\ndd NarzÄ™dzie jakÅ¼e prymitywne a tak przydatne. MoÅ¼emy nim zmierzyÄ‡ sekwencyjny odczyt/zapis z/do macierzy i uzyskaÄ‡ bardziej realne wyniki niÅ¼ hdparm\u0026rsquo;em. Wystarczy wymusiÄ‡ operacjÄ™ na ok. dwukrotnie wiÄ™kszej iloÅ›ci danych niÅ¼ iloÅ›Ä‡ pamiÄ™ci RAM. Dodatkowo czyÅ›cimy cache\u0026rsquo;e przed i po mierzÄ…c caÅ‚oÅ›ciowy czas, np. tak:\nsync; echo 3 \u0026gt; /proc/sys/vm/drop_caches; time (dd if=/dev/zero of=/mnt/test/test.img bs=1024K count=10240 \u0026amp;\u0026amp; sync) Jest to szczegÃ³lnie przydatne np. przy dopasowywaniu optymalnej dla nas wartoÅ›ci parametru stripe_cache_size, wystarczy przygotowaÄ‡ odpowiedniÄ… pÄ™tlÄ™:\nfor i in 128 256 512 1024 2048 4096 8192 16384 32768; do echo \u0026#34;stripe_cache_size $i\u0026#34; echo $i \u0026gt;Â /sys/block/md0/md/stripe_cache_size sync; echo 3 \u0026gt; /proc/sys/vm/drop_caches; time (dd if=/dev/zero of=/mnt/test/test.img bs=1024K count=10240 \u0026amp;\u0026amp; sync) done Parametr bs okreÅ›la bufor wykorzystywany przy operacjach odczytu/zapisu - moÅ¼na go dostosowaÄ‡ do rozmiaru chunk\u0026rsquo;a/stripe-width/itp.. count okreÅ›la jak duÅ¼o takich buforÃ³w odczytaÄ‡/zapisaÄ‡ - w powyÅ¼szym przypadku jest to 10 tys. jednomegabajtowych buforÃ³w wiÄ™c Å‚Ä…cznie 10GB.\nbonnie++ Bonnie++ wymaga nieco przygotowania ale wyniki w moim przypadku bardzo odpowiadaÅ‚y rzeczywistym. Co pokrÃ³tce trzeba zrobiÄ‡:\nmkdir /srv/test chown -R guest:guest /srv/test bonnie++ -d /srv/test -s 16g -m nazwa_maszyny -f -u guest MoÅ¼emy dodaÄ‡ opcjÄ™ -b by po kaÅ¼dej operacji wykonywany byÅ‚ sync - to byÅ‚oby coÅ› podobnego do systemÃ³w bazodanowych lub pocztowych. JeÅ¼eli chcemy zasymulowaÄ‡ standardowe operacje na plikach to nie potrzebujemy tej opcji.\niozone W najprostszym wykonaniu:\niozone -a Wykona to seriÄ™ pomiarÃ³w na rÃ³Å¼nych rozmiarach plikÃ³w, iloÅ›ci powtÃ³rzeÅ„ itd. Najbardziej interesujÄ…ca opcjÄ… w konfiguracji RAID jest \u0026ldquo;Stride read\u0026rdquo;.\niozone -S 8192 -t 1 Parametr -S przekazuje rozmiar pamiÄ™ci cache procesora - wykorzystywany do alokacji pamiÄ™ci blokami itp (sprawdzaÅ‚em czy to cokolwiek pomoÅ¼e.. ale nie widziaÅ‚em duÅ¼ej rÃ³Å¼nicy).\nParametr -t 1 to benchmark przepustowoÅ›ci dysku a parametr cyfrowy okreÅ›la liczbÄ™ rÃ³wnoczesnych wÄ…tkÃ³w, ktÃ³re bÄ™dÄ… odczytywaÄ‡/zapisywaÄ‡ - moÅ¼na w ten sposÃ³b zasymulowaÄ‡ np. rÃ³wnoczesny streaming dla wielu ÅºrÃ³deÅ‚, itp.\niozone -S 8192 -a -s 40960 Tutaj parametr -s wskazuje na jakim rozmiarze pliku w KB ma byÄ‡ prowadzony benchmark - tutaj 40MB.\nPodsumowanie OgÃ³lnie zadowolony jestem Å¼e udaÅ‚o mi siÄ™ to wszystko zebraÄ‡ w jednym poÅ›cie bo dotychczas miaÅ‚em to zapisane w wielu rÃ³Å¼nych zakÅ‚adkach i spory problem gdy potrzebowaÅ‚em \u0026ldquo;wÅ‚aÅ›nie tego jednego polecenia\u0026rdquo;. Ale niezadowolony jestem z tego Å¼e nie udaÅ‚o mi siÄ™ ustaliÄ‡ caÅ‚oÅ›ci tego postÄ™powania dla dyskÃ³w o sektorach/erase block\u0026rsquo;ach wiÄ™kszych niÅ¼ 4 KB. Chodzi mi szczegÃ³lnie o brak jasnego wyjaÅ›nienia czy RAID5 jest prawidÅ‚owo wyrÃ³wnywany bo wedÅ‚ug jednych tak wÅ‚aÅ›nie jest, a wedÅ‚ug innych tak nie jest. StÄ…d niektÃ³rzy zalecajÄ… by stosowaÄ‡ format metadanych dla macierzy w wersji 0.9 lub 1.0 zamiast 1.2 ale nie ma jasnych ÅºrÃ³deÅ‚ tego rozumowania. Mam nadziejÄ™ Å¼e kiedyÅ› uda mi siÄ™ to jednoznacznie rozsÄ…dziÄ‡ - na pewno zaktualizujÄ™ wtedy tego posta.\nÅ¹rÃ³deÅ‚ka na ktÃ³rych oparÅ‚em to HOWTO http://serverfault.com/questions/390294/mdadm-raid5-too-slow-when-writing\nhttp://serverfault.com/questions/250707/why-does-mdadm-write-unusably-slow-when-mounted-synchronously\nhttp://serverfault.com/questions/416321/mdadm-raid-5-failed-with-2-drives-while-rebuilding\nhttp://www.cyberciti.biz/tips/linux-raid-increase-resync-rebuild-speed.html\nhttp://askubuntu.com/questions/20852/making-stripe-cache-size-permanent\nhttp://h3x.no/2011/07/09/tuning-ubuntu-mdadm-raid56\nhttps://raid.wiki.kernel.org/index.php/Performance\nhttp://www.mjmwired.net/kernel/Documentation/md.txt\nhttp://wiki.hetzner.de/index.php/Partition_Alignment/en\nhttp://www.fhgfs.com/wiki/wikka.php?wakka=PartitionAlignment\nO tym Å¼e LVM na RAID5 samÂ siÄ™Â wyrÃ³wnuje:\nhttp://marc.info/?l=linux-raid\u0026amp;m=126267824425009\u0026amp;w=2\nhttp://www.redhat.com/archives/linux-lvm/2009-September/msg00092.html\nMDADM metadata format 1.2 wyrownuje sie do 4KiB:\nhttp://www.redhat.com/archives/linux-lvm/2009-September/msg00092.html\nKalkulator stride\u0026rsquo;a\nhttp://busybox.net/~aldot/mkfs_stride.html\nFormat raid\u0026rsquo;a:\nhttps://raid.wiki.kernel.org/index.php/RAID_superblock_formats\nWyrÃ³wnanie do 4kb - choÄ‡ wydaje mi siÄ™ Å¼e goÅ›ciu robi to na czuja i ledwie mu siÄ™ udaÅ‚o:\nhttp://blog.bigsmoke.us/2010/05/13/aligning-partitions-with-raid-and-lvm-on-drives-with-4-kb-sectors\n","href":"/2012/11/lvm-na-raid5-i-dysku-z-sektorami-4kb/","title":"LVM na RAID5 i dysku z sektorami 4KB"},{"content":"Po kaÅ¼dej aktualizacji Ubuntu mam trochÄ™ zabawy by pozbieraÄ‡ do kupy skaner i drukarkÄ™ z mojego urzÄ…dzenia wielofunkcyjnego Brother DCP-130C. WybraÅ‚em je bo byÅ‚ to jedyny producent, ktÃ³ry deklarowaÅ‚ wsparcie dla Linux\u0026rsquo;a\u0026hellip; choÄ‡ z perspektywy czasu nie jestem pewien czy otrzymaÅ‚em to czego siÄ™ spodziewaÅ‚em\u0026hellip; Co prawda zamieszczajÄ… instrukcje i aktualizujÄ… drivery ale jeszcze ani raz nie zdarzyÅ‚o mi siÄ™ by po aktualizacji systemu postÄ™powanie wedÅ‚ug tych instrukcji zadziaÅ‚aÅ‚o bezÂ dodatkowejÂ pomocy.. OlaÄ‡!\nInstrukcja jest dla mojej drukarki ale powinna zadziaÅ‚aÄ‡ rÃ³wnieÅ¼ dla innych modeli Brother\u0026rsquo;a - w razie potrzeby moÅ¼na siÄ™ posiÅ‚kowaÄ‡ instrukcjami producenta.\nUruchomienie drukarki Pobieramy drivery dla drukarki z poniÅ¼szej strony:\nhttp://welcome.solutions.brother.com/bsc/public_s/id/linux/en/download_prn.html\nInstalujemy zaleÅ¼noÅ›ci:\napt-get installÂ ia32-libs lib32stdc++ Instalujemy drivery (w moim przypadku dla DCP-130C):\ndpkg -i --force-all dcp130clpr-1.0.1-1.i386.deb dpkg -i --force-all dcp135ccupswrapper-1.0.1-1.i386.deb Teraz w przeglÄ…darce wchodzimy na stronÄ™ konfiguracji CUPS\u0026rsquo;a:Â http://localhost:631/printersÂ - powinna tam widnieÄ‡ nasza drukarka z URI usb://Brother/Â (np.Â usb://Brother/DCP-130C?serial=BRO00000000). JeÅ›li URI jest inne to modyfikujemy drukarkÄ™ by wybraÄ‡ odpowiednie urzÄ…dzenie i sterownik. Gdyby jednak drukarka nie zostaÅ‚a automatycznie dodana to wchodzimy naÂ http://localhost:631/adminÂ iÂ klikamy Dodawanie drukarki - podajemy dane autoryzacyjne dla root\u0026rsquo;a, wybieramy urzÄ…dzenie i sterownik.\nPo dodaniu drukarki moÅ¼na wejÅ›Ä‡ w jej ustawienia (u mnieÂ http://localhost:631/printers/DCP-130C) i w menu Administracja wybraÄ‡ opcjÄ™: Ustaw domyÅ›lne opcje by okreÅ›liÄ‡ domyÅ›lne parametry wydrukÃ³w.\nZ dodawaniem drukarki nie miaÅ‚em duÅ¼ych problemÃ³w, ciekawiej jest ze skanerem\u0026hellip;\nUruchomienie skanera Z poniÅ¼szej strony pobieramy drivery dla naszego modelu drukarki:\nhttp://welcome.solutions.brother.com/bsc/public_s/id/linux/en/download_scn.html\nJa pobraÅ‚em deb\u0026rsquo;a dla wersji 64-bitowej:Â brscan2-0.2.5-1.amd64.deb.\nInstalujemy (instrukcja producenta tutaj):\napt-get install sane-utils dpkg -i --force-all brscan2-0.2.5-1.amd64.deb Teoretycznie powinno to wystarczyÄ‡ by root mÃ³gÅ‚ korzystaÄ‡ ze skanera, wiÄ™c popracujmy by uÅ¼ytkownicy teÅ¼ mogli. Edytujemy jako root plikÂ /lib/udev/rules.d/40-libsane.rules i odszukujemy liniÄ™ \u0026ldquo;# The following rule will disable\u0026rdquo; (u mnie gdzieÅ› w okolicy 1180 linii), przed niÄ… wklejamy tekst:\n# Brother scanners ATTRS{idVendor}==\u0026#34;04f9\u0026#34;, ENV{libsane_matched}=\u0026#34;yes\u0026#34; Zapisujemy plik. Teraz musimy dodaÄ‡ zainteresowanych uÅ¼ytkownikÃ³w do grupy scanner, robimy to np. tak:\ngpasswd -a roman scanner I powtarzamy dla innych userÃ³w.\nI na koniec wisienka na torcie - na 64 bitowym systemie postÄ™powanie wedÅ‚ug instrukcji zwyczajnie nie dziaÅ‚a bo potrzebne biblioteki instalujÄ… siÄ™ w zÅ‚ym miejscu\u0026hellip; sic!\nPliki trafiajÄ… do /usr/lib64 zamiast do /usr/lib - aby wszystko dziaÅ‚aÅ‚o jak trzeba musimy przekopiowaÄ‡ (albo chociaÅ¼ podlinkowaÄ‡) z /usr/lib64 do /usr/lib - co dokÅ‚adnie naleÅ¼y skopiowaÄ‡ moÅ¼na znaleÅºÄ‡ tutaj.\n","href":"/2012/11/instalacja-drukarki-i-skanera-brother-dcp-130c-na-ubuntu-12-04/","title":"Instalacja drukarki i skanera Brother DCP-130C na Ubuntu 12.04"},{"content":"","href":"/tags/mail/","title":"mail"},{"content":"","href":"/tags/poczta/","title":"poczta"},{"content":"Czasami potrzebny jest nam serwer pocztowy, ktÃ³ry przyÅ›le informacje dla root\u0026rsquo;a (np. monity smartd, mdadm, sypniÄ™te crony itp) ale rÃ³wnoczeÅ›nie nie chcemy stawiaÄ‡ peÅ‚nego serwera typu postfix/exim. Warto w tym celu wykorzystaÄ‡ zestaw heirloom-mailx + ssmtp. hairloom-mailx jest prostym shellowym klientem SMTP - przy okazji linkuje polecenie mail (przydatne w skryptach). ssmtp peÅ‚ni funkcjÄ™ serwera SMTP ale nie dziaÅ‚a jako demon - proces uruchamia siÄ™ gdy jest potrzebny i znika po wysÅ‚aniu maili. Dodatkowo ssmtp moÅ¼e zostaÄ‡ skonfigurowany by wysyÅ‚aÄ‡ maile nie tylko przez relay\u0026rsquo;a ale rÃ³wnieÅ¼ autoryzujÄ…c siÄ™ na zewnÄ™trznym serwerze pocztowym, np. gmail\u0026rsquo;u czy gdziekolwiek indziej.\nInstalacja apt-get install ssmtp heirloom-mailx Konfiguracja z relay\u0026rsquo;em Edytujemy plik /etc/ssmtp/ssmtp.conf - w konfiguracji z relay\u0026rsquo;em wystarczÄ… te linijki:\nroot=postmaster@domena.pl mailhub=domena.pl hostname=serwerek.domena.pl Warto zwrÃ³ciÄ‡ uwagÄ™ Å¼e dobrze by byÅ‚o aby domena serwerek.domena.pl istniaÅ‚a i wskazywaÅ‚a na nasz serwer - dziÄ™ki temu poczta nie odpadnie na prostych filtrach antyspamowych.\nKonfiguracja pod gmail\u0026rsquo;a W ssmtp.conf potrzebujemy:\nroot=postmaster@domena.pl mailhub=smtp.gmail.com:587 hostname=serwerek.domena.pl AuthUser=twojekonto@gmail.com AuthPass=twoje_haslo_do_gmaila UseTLS=YES UseSTARTTLS=YES AuthMethod=LOGIN Test Warto teraz sprawdziÄ‡ czy poczta wychodzi jak powinna:\necho test | mail -s \u0026#34;testowa wiadomosc\u0026#34; postmaster@domena.pl ","href":"/2012/11/prosty-mta-z-heirloom-mailx-i-ssmtp/","title":"Prosty MTA z heirloom-mailx i ssmtp"},{"content":"","href":"/tags/nautilus/","title":"Nautilus"},{"content":"LubiÄ™ mieÄ‡ porzÄ…dek w folderach i jedna rzecz, ktÃ³ra nie daje mi spokoju w systemach plikÃ³w ext to widocznoÅ›Ä‡ folderu lost+found - niby moÅ¼na go skasowaÄ‡ i powinien siÄ™ odtworzyÄ‡ (choÄ‡ podobno odtworzenie w czasie fsck\u0026rsquo;a moÅ¼e spowodowaÄ‡ utratÄ™ danych - trochÄ™ to dziwne i nie znalazÅ‚em ÅºrÃ³dÅ‚a no ale powiedzmy Å¼e nie chcÄ™ go usuwaÄ‡). ChciaÅ‚em go ukryÄ‡ (choÄ‡by w Nautilusie) by mnie nie draÅ¼niÅ‚. OczywiÅ›cie opcja z \u0026ldquo;.\u0026rdquo; na poczÄ…tku odpada, ale na szczÄ™Å›cie Nautilus wykorzystuje pewien hack, ktÃ³ry umoÅ¼liwia ukrycie dowolnego pliku/folderu.\nTworzymy w gÅ‚Ã³wnym katalogu danego punktu montowania, plik .hidden i wpisujemy do niego nazwy plikÃ³w, ktÃ³re chcemy ukryÄ‡ - w moim przypadku lost+found:\ncd /root/katalogu echo \u0026#34;lost+found\u0026#34; \u0026gt;\u0026gt; .hidden Po odÅ›wieÅ¼eniu Nautilus nie pokazuje juÅ¼ katalogu lost+found - dla mnie bomba.\n","href":"/2012/10/nautilus-ukrywanie-lostfound/","title":"Nautilus - ukrywanie lost+found"},{"content":"","href":"/tags/autoit/","title":"AutoIt"},{"content":"SkÅ‚adniki  1 kostka masÅ‚a, 1 Å¼Ã³Å‚tko, 6 Å‚yÅ¼ek cukru pudru, 1 szklanka mleka, 10 dkg wiÃ³rek kokosowych, 1 kieliszek wÃ³dki (ale z dwoma jest ostrzejsze), 3 Å‚yÅ¼ki kakao, 37 dkg herbatnikÃ³w kakaowych (doskonale spisujÄ… siÄ™ dwie paczki maÅ›lanych herbatnikÃ³w kakaowych).  Masa kakaowa Herbatniki dokÅ‚adnie rozwaÅ‚kowaÄ‡, dodaÄ‡ kakao i wymieszaÄ‡. ZagotowaÄ‡ pÃ³Å‚ szklanki mleka i gorÄ…cym zalaÄ‡ herbatniki. CaÅ‚oÅ›Ä‡ wymieszaÄ‡ na jednolitÄ… masÄ™. W drugim pojemniku rozmiksowaÄ‡ pÃ³Å‚ kostki masÅ‚a i 3 Å‚yÅ¼ki cukru pudru - po chwili dodaÄ‡ Å¼Ã³Å‚tko i wÃ³dkÄ™. Do tej masy stopniowo dodajemy herbatniki.\nMasa kokosowa ZagotowaÄ‡ pÃ³Å‚ szklanki mleka i gorÄ…cym zalaÄ‡ wiÃ³rki kokosowe, wymieszaÄ‡ by rÃ³wnomiernie namokÅ‚y. RozmiksowaÄ‡ pÃ³Å‚ kostki masÅ‚a z 3 Å‚yÅ¼kami cukru pudru. Stopniowo dodawaÄ‡ wiÃ³rki i nadal miksowaÄ‡.\nSkÅ‚adamy caÅ‚oÅ›Ä‡ WaÅ‚kujemy masÄ™ kakaowÄ… na papierze do pieczenie lub folii (papier jest lepszy) - staramy siÄ™ uzyskaÄ‡ ksztaÅ‚t zbliÅ¼ony do prostokÄ…ta (uÅ‚atwi to zwijanie rolady). Tak przygotowanÄ… ciemnÄ… masÄ™ pokrywamy rÃ³wnomiernÄ… warstwÄ… masy kokosowej. PÃ³Åºniej delikatnie zaczynamy zwijaÄ‡ z jednej strony jak makowiec - na koniec staramy siÄ™ doÅ›Ä‡ dokÅ‚adnie docisnÄ…Ä‡ papier by rolada nie \u0026ldquo;rozdÄ™Å‚a\u0026rdquo; siÄ™ przed stwardnieniem. Taki pakunek wrzucamy do lodÃ³wki na minimum 2~3 godziny.\nP.S. ChciaÅ‚em wrzuciÄ‡ fotkÄ™ ale zbyt szybko zniknÄ™Å‚a - moÅ¼e innym razem ðŸ˜„\n","href":"/2012/10/rolada-kokosowo-czekoladowa-na-zimno/","title":"Rolada kokosowo-czekoladowa na zimno"},{"content":"ZdarzyÅ‚o mi siÄ™ kilka usÅ‚ug dziaÅ‚ajÄ…cych na serwerach Windows, ktÃ³re zwyczajnie sypaÅ‚y siÄ™ i to tak brzydko Å¼e systemowe ustawienia by restartowaÅ‚y siÄ™ po padzie nie wystarczaÅ‚y. UsÅ‚uga dziaÅ‚aÅ‚a np. 3 godziny by potem siÄ™ poÅ‚oÅ¼yÄ‡, albo nigdy nie wstawaÅ‚a po starcie systemu - po prostu jakaÅ› masakra. ZgÅ‚oszenia do producenta czÄ™sto wyglÄ…daÅ‚y tak Å¼e w jego testowym Å›rodowisku bÅ‚Ä™du nie udaje siÄ™ powtÃ³rzyÄ‡ (i nic dziwnego bo nie sÄ…dzÄ™ by z ich konfiguracji korzystali rzeczywiÅ›ci uÅ¼ytkownicy). OczywiÅ›cie moÅ¼na zaczekaÄ‡ aÅ¼ ukaÅ¼e siÄ™ magiczna Å‚ata usuwajÄ…ca bÅ‚Ä…d ale do tego czasu to na nas wszyscy bÄ™dÄ… \u0026ldquo;wieszaÄ‡ psy\u0026rdquo; za niedostÄ™pnoÅ›Ä‡ usÅ‚ugi.\nW najprostszym podejÅ›ciu moÅ¼na napisaÄ‡ bat\u0026rsquo;cha, ktÃ³ry bÄ™dzie restartowaÅ‚ usÅ‚ugÄ™ (kÅ‚adÅ‚ i startowaÅ‚, sprawdzaÅ‚ czy dziaÅ‚a i tylko przy braku dziaÅ‚ania uruchamiaÅ‚, itp) - taki skrypcik odpalamy co 5 minut i powinno to zaÅ‚atwiÄ‡ sprawÄ™. ZaÅ‚atwi to najprostsze przypadki - ale nie bÄ™dzie caÅ‚kiem elastyczne.\nSzukaÅ‚em programu, ktÃ³ry dziaÅ‚aÅ‚by jako usÅ‚uga i \u0026ldquo;pilnowaÅ‚\u0026rdquo; innych usÅ‚ug systemowych i\u0026hellip; moÅ¼na coÅ› takiego kupiÄ‡ za 200$ (sic!). PostanowiÅ‚em poszukaÄ‡ na forum AutoIt\u0026rsquo;a - basciopodobnego jÄ™zyka skryptowego, ktÃ³ry wielokrotnie pomagaÅ‚ mi zautomatyzowaÄ‡ pewne zadania administracyjne - trafiÅ‚em na tego posta:Â http://www.autoitscript.com/forum/topic/80201-service-udf-v2-run-your-exe-as-service/\nZ tego adresu pobieramy ÅºrÃ³dÅ‚a - zmieniamy nazwÄ™ pliczku ServiceExample.au3 na np. ServiceKeeper.au3 i edytujemy (szukamy linijki region -\u0026gt; insert your running code here:\n#region --\u0026gt; insert your running code here  Local $status = _Service_QueryStatus(\u0026#34;shittyservice\u0026#34;) If $status[1] \u0026lt;\u0026gt; $SERVICE_RUNNING Then If $bDebug Then logprint(\u0026#34;shittyservice service not running!\u0026#34;) If $status[1] == $SERVICE_PAUSED Then If _Service_Resume(\u0026#34;shittyservice\u0026#34;) == 1 Then If $bDebug Then logprint(\u0026#34;shittyservice service resumed successfully\u0026#34;) Else If $bDebug Then logprint(\u0026#34;shittyservice service resume failded!\u0026#34;) If _Service_Start(\u0026#34;shittyservice\u0026#34;) == 1 Then If $bDebug Then logprint(\u0026#34;shittyservice service started successfully\u0026#34;) EndIf EndIf EndIf If $status[1] == $SERVICE_STOPPED Then If _Service_Start(\u0026#34;shittyservice\u0026#34;) == 1 Then If $bDebug Then logprint(\u0026#34;shittyservice service started successfully\u0026#34;) Else If $bDebug Then logprint(\u0026#34;shittyservice service start failded!\u0026#34;) EndIf EndIf EndIf Sleep(60000) # jak czesto sprawdzac san uslug - czas w milisekundach #endregion --\u0026gt; insert your running code here PowyÅ¼szy przykÅ‚ad sprawdza czy pewna \u0026ldquo;shittyusÅ‚uga\u0026rdquo; dziaÅ‚a, a jeÅ›li nie to podejmuje rÃ³Å¼ne prÃ³by jej uruchomienia. PrzykÅ‚ad najprostszy z moÅ¼liwych ale bardzo Å‚atwo moÅ¼na zamiast sprawdzenia jedne usÅ‚ugi powieliÄ‡ ten kod dla kilku usÅ‚ug i sprawdzaÄ‡ je w pÄ™tli (w wolnej chwili moÅ¼e wrzucÄ™ taki kod).\nSkrypcik dostosowujemy do swoich potrzeb, kompilujemy i wrzucamy na serwer potrzebujÄ…cy \u0026ldquo;rozrusznika\u0026rdquo;. UsÅ‚ugÄ™ trzeba zainstalowaÄ‡ przez odpalenie skryptu z parametrem -i, w naszym przypadku wyglÄ…daÅ‚o by to tak:\nServiceKeeper.exe -i UsÅ‚ugÄ™ moÅ¼na odinstalowaÄ‡ przez uruchomienie z parametrem -u.\nDobrze ustawiÄ‡ tÄ… usÅ‚ugÄ™ by startowaÅ‚a z opÃ³Åºnieniem. Nie wydaje mi siÄ™ sensowe sprawdzanie stanu usÅ‚ug czÄ™Å›ciej niÅ¼ raz na minutÄ™.\nZdarzaÅ‚o mi siÄ™ Å¼e ta usÅ‚uga sypaÅ‚a siÄ™ przy jej zatrzymywaniu (jest o tym wzmianka na forum), ale to mnie akurat maÅ‚o boli bo innych problemÃ³w nie miaÅ‚em.\n","href":"/2012/10/utrzymanie-przy-zyciu-sypiacych-sie-uslug-na-serwerach-windows/","title":"Utrzymanie przy Å¼yciu sypiÄ…cych siÄ™ usÅ‚ug na serwerach Windows"},{"content":"","href":"/tags/open-source/","title":"Open Source"},{"content":"JeÅ›li szukamy statystyk dla strony internetowej i ze wzglÄ™du na jej zawartoÅ›Ä‡ (np. sklep, coÅ› ze zwiÄ™kszonym naciskiem na poufnoÅ›Ä‡ etc..) nie potrafimy zaufaj wujkowi Googlowi to warto przyglÄ…dnÄ…Ä‡ siÄ™ Piwikowi.\nJest to system statystyk aspirujÄ…cy do bycia Open Source\u0026rsquo;owÄ… alternatywÄ… dla Google Analytics. AspirujÄ…cy (a nie bÄ™dÄ…cy) z tego wzglÄ™du Å¼e Google przechodzÄ…c na domyÅ›lny HTTPS (SPDY) dla zalogowanych uÅ¼ytkownikÃ³w uniemoÅ¼liwiÅ‚ Å›ledzenie stron z ktÃ³rych pochodzÄ… odwiedziny (tzw. refferals) - tym prostym sposobem tylko GA jest w stanie dostarczyÄ‡ peÅ‚nych informacji o wszystkich uÅ¼ytkownikach.\nNiemniej Piwik nadal moÅ¼e byÄ‡ bardzo atrakcyjnym narzÄ™dziem choÄ‡by dlatego Å¼e:\n statystyki zbieramy \u0026ldquo;lokalnie\u0026rdquo;, czyli gdzieÅ› na naszym serwerze - mamy nad nimi wÅ‚adzÄ™ (z wszystkimi konsekwencjami), do Piwik\u0026rsquo;a moÅ¼emy Å‚atwo stworzyÄ‡ wÅ‚asne rozszerzenia, ktÃ³re przedstawiÄ… to co chcemy w sposÃ³b jakiego oczekujemy, statystyki moÅ¼emy zbieraÄ‡ przez dodanie odwoÅ‚ania do skryptu w kodzie strony lub okresowo importujÄ…c logi z serwera (jak wspomniany przeze mnie kiedyÅ› awstats) lub na oba wspomniane sposoby - stÄ…d Piwik Å›wietnie sprawdza siÄ™ w hostingach (moÅ¼emy pokazaÄ‡ klientowi ile miaÅ‚ wejÅ›Ä‡, zrobiÄ‡ statystyki wykorzystania pasma itp), oprawa graficzna jest Å›wieÅ¼sza niÅ¼ w AWStats ðŸ˜ƒ ma nieduÅ¼e wymagania, gÅ‚Ã³wnie: PHP + MySQL.  InstrukcjÄ™ instalacji i wiÄ™cej informacji moÅ¼na znaleÅºÄ‡ tutaj:Â http://pl.piwik.org/dokumentacja/instalacja-piwika/\n","href":"/2012/09/piwik-alternatywa-dla-google-analytics/","title":"Piwik - alternatywa dla Google Analytics"},{"content":"Co prawda adresy URL pozwalajÄ… na stosowanie zarÃ³wno duÅ¼ych jak i maÅ‚ych liter ale rÃ³Å¼ne systemy mogÄ… je rÃ³Å¼nie obsÅ‚ugiwaÄ‡ i moÅ¼e siÄ™ trafiÄ‡ sytuacja, w ktÃ³rej nie zechcemy by np. duÅ¼e litery w ogÃ³le pojawiaÅ‚y siÄ™ w adresach URL. DoskonaÅ‚y przykÅ‚ad to mÃ³j niedawny wpis: Apache: ograniczenie dostÄ™pu dla zalogowanych uÅ¼ytkownikÃ³w z mod_rewrite i mod_auth_basic.\nZachodzi tam sytuacja, w ktÃ³rej katalog uÅ¼ytkownika jest jego loginem maÅ‚ymi literami (bÄ…dÅº duÅ¼ymi - jak kto woli), a uÅ¼ytkownik wpisujÄ…c login moÅ¼e uÅ¼yÄ‡ zarÃ³wno maÅ‚ych jak i duÅ¼ych liter i tutaj zaczyna siÄ™ jazda. MoÅ¼na uÅ¼yÄ‡ modyfikatora NC (no case), ale to wpÅ‚ynie tylko na porÃ³wnania - przepisanie Å›cieÅ¼ki na nazwÄ™ podanÄ… przez usera (z duÅ¼ymi i maÅ‚ymi literami) przekieruje do katalogu, ktÃ³rego nie ma (bo jest katalog tylko maÅ‚ymi/duÅ¼ymi).\nI wtedy przyda siÄ™ taka sztuczka:\nRewriteEngine On RewriteMap lc int:tolower RewriteCond %{REQUEST_URI} [A-Z] RewriteRule (.*) ${lc:$1} [R=301,L] Definiujemy mapÄ™ korzystajÄ…c z wbudowanego w moduÅ‚ sÅ‚ownika tolower, a nastÄ™pnie jeÅ›li w URL\u0026rsquo;u wystÄ™pujÄ… (w tym przypadku) duÅ¼e litery to przekierowujemy na URL\u0026rsquo;a z maÅ‚ymi.\n","href":"/2012/09/mod_rewrite-wymuszenie-malych-liter-w-adresie-url/","title":"mod_rewrite - wymuszenie maÅ‚ych liter w adresie URL"},{"content":"Obecnie dostÄ™pna jest juÅ¼ beta 2 Debiana Wheezy i utrzymywane sÄ… aktualizacje bezpieczeÅ„stwa wiÄ™c powolutku moÅ¼na na testowych maszynach sprawdzaÄ‡ co i jak siÄ™ zmieniÅ‚o.\nPoniewaÅ¼ do finalnej wersji pewnie sporo siÄ™ jeszcze zmieni to postaram siÄ™ z czasem aktualizowaÄ‡ ten post by zawieraÅ‚ bieÅ¼Ä…ce informacje.\nW razie wÄ…tpliwoÅ›ci patrz tutaj:Â http://wiki.debian.org/DebianTesting\n Robimy backup Aktualizujemy ÅºrÃ³dÅ‚a wskazywaÅ‚y na paczki gaÅ‚Ä™zi testing (poniÅ¼sze polecenie nadpisze Twoje obecne repozytoria):  cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;SRC deb http://ftp.pl.debian.org/debian/ wheezy main non-free contrib deb-src http://ftp.pl.debian.org/debian/ wheezy main non-free contrib deb http://security.debian.org/ wheezy/updates main contrib non-free deb-src http://security.debian.org/ wheezy/updates main contrib non-free deb http://ftp.pl.debian.org/debian/ wheezy-updates main non-free contrib deb-src http://ftp.pl.debian.org/debian/ wheezy-updates main non-free contrib SRC Teraz odÅ›wieÅ¼amy repozytoria:\nsudo apt-get update ProponujÄ™ pobraÄ‡ teÅ¼ pliki by podczas aktualizacji wszystkie leÅ¼aÅ‚y w cache\u0026rsquo;u - na wypadek gdyby nagle padÅ‚o Å‚Ä…cze itp\u0026hellip;\nsudo apt-get dist-upgrade -d Teraz zaktualizujemy kluczowe paczki:\nsudo apt-get install apt dpkg I resztÄ™ systemu:\nsudo apt-get dist-upgrade To teraz pozostaÅ‚o sprawdziÄ‡ co poszÅ‚o nie tak\u0026hellip; Powodzenia ðŸ˜‰\n","href":"/2012/09/aktualizacja-debian-squeeze-do-wheezy/","title":"Aktualizacja Debian Squeeze do Wheezy"},{"content":"","href":"/tags/wheezy/","title":"Wheezy"},{"content":"DziÅ› TIP z przeciwnego obozu - oprÃ³cz linuksowych systemÃ³w administrujÄ™ rÃ³wnieÅ¼ paroma serwerami windowsowymi i tutaj rÃ³wnieÅ¼ (a czasem nawet bardziej) uda mi siÄ™ znaleÅºÄ‡ coÅ› wartego zapamiÄ™tania.\nJedna z najbardziej charakterystycznych rzeczy na komputerach przyÅ‚Ä…czonych do domeny Windows to wyÅ›wietlanie \u0026ldquo;rÃ³Å¼nych dziwnych rzeczy\u0026rdquo; przy starcie systemu. ZarÃ³wno na Windowsie 2000 jak i na XP\u0026rsquo;ku na maÅ‚ym okienku przewijajÄ… informacje o aktualizacji polityk, instalacji oprogramowania itp\u0026hellip;\nZachowanie to zmieniÅ‚o siÄ™ na Vistach i 7-kach, ktÃ³re sÄ… nieco mniej rozmowne i wyÅ›wietlajÄ… jedynie komunikat typu \u0026ldquo;Trwa uruchamianie systemu\u0026hellip;\u0026rdquo; i tyla\u0026hellip; ZaÅ‚Ã³Å¼my Å¼e wrzucimy do instalacji kilka paczek i jeszcze zmienimy kilka polityk i przez to komputer na tym napisie zatrzyma siÄ™ na 5~10 minut - co zrobi uÅ¼yszkodnik po 3 minutach? Dojdzie do wniosku Å¼e \u0026ldquo;coÅ› siÄ™ zwiesiÅ‚o\u0026rdquo; i zresetuje komputer, a Å¼e akurat byÅ‚o nieco operacji dyskowych to mamy praktycznie pewnÄ… rozwaÅ‚kÄ™ tego systemu.\nJednym z rozwiÄ…zaÅ„ jest zwiÄ™kszenie \u0026ldquo;gadatliwoÅ›ci\u0026rdquo; tego etapu uruchamiania systemu - jest to moÅ¼liwe o ile posiadamy kontroler domeny na minimum Windows Server 2008. Tworzymy GPO w ktÃ³rym ustawiamy:Â Computer Config -\u0026gt; Admin Templates -\u0026gt; System -\u0026gt; Verbose vs normal status messages na Enabled.\nWÅ‚Ä…czenie tej opcji spowoduje zwiÄ™kszenie liczby wypisywanych komunikatÃ³w, nazw instalowanych programÃ³w i operacji wykonywanych przez system w fazie uruchamiania - wiÄ™kszoÅ›Ä‡ uÅ¼yszkodnikÃ³w widzÄ…c Å¼e zmieniajÄ… siÄ™ statusy (coÅ› instaluje itp) zwiÄ™ksza \u0026ldquo;okienko czasowe\u0026rdquo; do naciÅ›niÄ™cia resetu do ok 15 minut ðŸ˜‰\n","href":"/2012/09/gpo-windows-7-postep-przetwarzania-polityk-przy-starcie-systemu/","title":"GPO: Windows 7 - postÄ™p przetwarzania polityk przy starcie systemu"},{"content":"Gdy administruje siÄ™ duÅ¼ymi stronami internetowymi raz na czas np. po wiÄ™kszych zmianach w konfiguracji zachodzi potrzeba sprawdzenia czy na stronie nie ma stron prowadzÄ…cych donikÄ…d. O ile w maÅ‚ych serwisach moÅ¼na samemu szybko przeklikaÄ‡ siÄ™ przez stronkÄ™ to dla starych rozroÅ›niÄ™tych serwisÃ³w nie jest to takie proste.\nJest kilka narzÄ™dzi ktÃ³rych moÅ¼na uÅ¼yÄ‡ do testowania linkÃ³w na stronach - kaÅ¼de z nich ma swoje zalety i wady, postaram siÄ™ je przybliÅ¼yÄ‡.\nwget Wget\u0026rsquo;a najprawdopodobniej juÅ¼ masz i moÅ¼esz zaczynaÄ‡:\nwget -o /tmp/wget.log -nv -r -p http://example.com W pliku /tmp/wget.log moÅ¼emy znaleÅºÄ‡ komunikaty bÅ‚Ä™dÃ³w i na dobrÄ… sprawÄ™ tyle. CiÄ™Å¼ko to przetworzyÄ‡ ale jeÅ›li nasz serwis ma mechanizm do np. mailowego powiadomienia w momencie wystÄ…pienia krytycznego bÅ‚Ä™du to wget\u0026rsquo;em najszybciej moÅ¼na takie strony wyÅ‚apaÄ‡.\nlinkchecker Uruchamia siÄ™ go tak:\nlinkchecker -t3 --no-warnings http://example.com Program jakoÅ› nie przypadÅ‚ mi do gustu - dziaÅ‚aÅ‚ cholernie wolno i to na caÅ‚kiem maÅ‚ej stronie.\nlinklint Z trzech programÃ³w ten ma najdziwniejszÄ… skÅ‚adniÄ™ - ale da siÄ™ tego nauczyÄ‡, a moÅ¼liwoÅ›ci ma chyba najwiÄ™cej.\nlinklint -error -warn -xref -forward -out report.txt -net -http -host example.com /@ WystarczajÄ…co szybki i generuje przejrzyste raporty.przejrzyste raporty.\n","href":"/2012/09/sprawdzanie-nieaktywnych-linkow-na-stronie/","title":"Sprawdzanie nieaktywnych linkÃ³w na stronie"},{"content":"JeÅ›li posiadasz napÄ™d taÅ›mowy LTO do archiwizacji/backupu danych to wiesz Å¼e bardzo waÅ¼ne jest opisywanie taÅ›m szczegÃ³lnie gdy trzeba coÅ› odzyskaÄ‡. JeÅ¼eli masz szczÄ™Å›cie to posiadasz nie pojedynczy napÄ™d a autoloader obsÅ‚ugujÄ…cy wiele taÅ›m i wiesz Å¼e najlepiej gdy taÅ›my sÄ… opisane kodami paskowymi ktÃ³re autoloader potrafi rozpoznaÄ‡. DziÄ™ki temu nie ma potrzeby odczytywania nr. seryjnego z taÅ›my tylko szybciutko skanerem kodÃ³w. Tasiemki moÅ¼na kupowaÄ‡ juÅ¼ z kodami ale taÅ„sze sÄ… te bez kodÃ³w\u0026hellip; i tu pytanie - czy da siÄ™ tanio zdobyÄ‡ etykiety?\nKtoÅ› poÅ›wiÄ™ciÅ‚ trochÄ™ czasu i przygotowaÅ‚ webowe narzÄ™dzie do generowania kodÃ³w paskowych dla napÄ™dÃ³w LTO - plik generowany jest do postaci pdf\u0026rsquo;a ktÃ³ry moÅ¼na pÃ³Åºniej wydrukowaÄ‡ na papierze samoprzylepnym, pomachaÄ‡ chwilÄ™ noÅ¼yczkami i TA DAM! Mamy etykiety ðŸ˜‰\nOczywiÅ›cie zabawa ma sens jeÅ›li potrzebujemy tylko kilku szt. taÅ›m tygodniowo - przy wiÄ™kszej iloÅ›ci lepiej wydaÄ‡ kasÄ™ i niech ktoÅ› inny powycina etykiety za nas.\n","href":"/2012/09/generator-kodow-paskowych-dla-napedow-tasmowych-lto/","title":"Generator kodÃ³w paskowych dla napÄ™dÃ³w taÅ›mowych LTO"},{"content":"","href":"/tags/lto/","title":"LTO"},{"content":"Szkoda Å¼e polecenia do obsÅ‚ugi NFS\u0026rsquo;a nie zaczynajÄ… siÄ™ od nfs* - Å‚atwiej byÅ‚oby mi je zapamiÄ™taÄ‡. A jednym z takich, zapominanych najczÄ™Å›ciej jest listowanie zasobÃ³w, szczegÃ³lnie przydatne gdy korzysta siÄ™ z NFS\u0026rsquo;a na jakimÅ› NAS\u0026rsquo;ie (ktÃ³rego magiczny soft nie pokazuje gdzie i co eksportuje):\nshowmount -e 192.168.1.10 Export list for 192.168.1.10: /mnt/pools/A/A0/Music * /mnt/pools/A/A0/Movies * /mnt/pools/A/A0/Backups * /mnt/pools/A/A0/Pictures * /mnt/pools/A/A0/Documents * Teraz moÅ¼emy zamontowaÄ‡ zasÃ³b:\nmount 192.168.1.10:/mnt/pools/A/A0/Music /mnt/music ","href":"/2012/09/listowanie-zasobow-nfs/","title":"Listowanie zasobÃ³w NFS"},{"content":"","href":"/tags/nfs/","title":"NFS"},{"content":"Niedawno trafiÅ‚em na ciekawy problem w mod_rewrite - by przekierowywaÄ‡ uÅ¼ytkownikÃ³w logujÄ…cych siÄ™ jednym z moduÅ‚Ã³w mod_auth_basic do dedykowanych im katalogÃ³w, rÃ³wnoczeÅ›nie blokujÄ…c dostÄ™p do katalogÃ³w innych uÅ¼ytkownikÃ³w. Nie brzmi to jakoÅ› strasznie ale problem okazaÅ‚ siÄ™ byÄ‡ caÅ‚kiem nietrywialnym. Teoretyczne rozwiÄ…zanie sprowadzaÅ‚o siÄ™ do wyszukania loginu uÅ¼ytkownika ze Å›cieÅ¼ki URI i porÃ³wnania z nazwÄ… uÅ¼ytkownika ze zmiennej %{REMOTE_USER} - jeÅ›li wartoÅ›ci siÄ™ rÃ³Å¼niÄ… to Forbidden. Ale szybko okazaÅ‚o siÄ™ Å¼e w RewriteCond zmienne z dopasowaÅ„ moÅ¼na podstawiaÄ‡ tylko w pierwszym parametrze i Å¼e o ile moÅ¼na RewriteCond\u0026rsquo;y poÅ‚Ä…czyÄ‡ wyraÅ¼eniami logicznymi typu AND/OR to nie ma moÅ¼liwoÅ›ci porÃ³wnania czy dopasowania z kolejnych RewriteCond\u0026rsquo;Ã³w sÄ… identyczne. Po kilku dniach szperania w dokumentacji i rÃ³Å¼nych tutorialach udaÅ‚o mi siÄ™ trafiÄ‡ na jednÄ… wartoÅ›ciowÄ… wskazÃ³wkÄ™ ale tej stronki juÅ¼ nie ma, wiÄ™c opiszÄ™ problem dla potomnych.\nZaÅ‚oÅ¼enia sÄ… takie:\n mamy vhost\u0026rsquo;a ktÃ³ry udostÄ™pnia wszystkie foldery uÅ¼ytkownikÃ³w, kaÅ¼dy uÅ¼ytkownik posiada folder o nazwie dokÅ‚adnie takiej samej jak jego login, uÅ¼ytkownik po zalogowaniu ma byÄ‡ przekierowany do swojego folderu i przy prÃ³bie przejÅ›cia do folderÃ³w innych uÅ¼ytkownikÃ³w albo nawracamy go do jego folderu/albo dajemy forbidden.  Konfiguracja vhost\u0026rsquo;a PoniÅ¼ej podstawowa konfiguracja vhost\u0026rsquo;a:\n\u0026lt;VirtualHost *:80\u0026gt; ServerName files.example.com ServerAlias www.files.example.com DocumentRoot /var/www/files ErrorLog ${APACHE_LOG_DIR}/error.log LogLevel warn CustomLog ${APACHE_LOG_DIR}/access.log combined \u0026lt;Directory /var/www/files\u0026gt; AllowOverride none AuthType basic AuthName \u0026#34;Zaloguj sie\u0026#34; AuthUserFile /etc/apache2/passwd Require valid-user \u0026lt;/Directory\u0026gt; \u0026lt;/VirtualHost\u0026gt; Rewrite\u0026rsquo;y I najciekawsza czÄ™Å›Ä‡ czyli rewrite\u0026rsquo;y. Zaczynamy od przekierowania uÅ¼ytkownika do jego folderu:\nRewriteRule ^$ /%{REMOTE_USER} [R,L] PowyÅ¼szy rewrite sprawdza czy prÃ³bujemy wejÅ›Ä‡ do gÅ‚Ã³wnego katalogu, jeÅ›li tak to przekierowujemy do katalogu uÅ¼ytkownika.\nTo teraz magia, ktÃ³rej dÅ‚ugo szukaÅ‚em ðŸ˜ƒ\nRewriteCond %{REMOTE_USER} ^(.+) RewriteCond %1:$1 !^([^:]+):\\1$ RewriteRule ^([^/]+)/ - [F,L] JuÅ¼ wyjaÅ›niam co to robi - zacznÄ™ od przypomnienia Å¼e pomimo takiego zapisu w konfiguracji reguÅ‚y sÄ… przetwarzane nieco inaczej: Apache najpierw sprawdza czy dany URI pasuje do wyraÅ¼enia w RewriteRule, a dopiero gdy tak jest sprawdzane sÄ… warunki w RewriteCond. Czyli RewriteRule dopasowuje pierwszÄ… czÄ™Å›Ä‡ URI aÅ¼ do znaku ukoÅ›nika / i zapamiÄ™tuje w zmiennej $1. Dopiero teraz RewriteCond dopasowuje i zapamiÄ™tuje login uÅ¼ytkownika w zmiennej %1 (tak rule zapamiÄ™tuje w zmiennych z $, cond w zmiennych z %). Teraz gdy mamy juÅ¼ zapamiÄ™tane loginy z URI i zmiennej to moÅ¼emy je zapisaÄ‡ obok siebie w kolejnym RewriteCond oddzielajÄ…c znakiem ktÃ³ry w loginie wystÄ…piÄ‡ nie powinien (np. dwukropkiem) - $1:%1. Teraz dopasowujemy pierwszÄ… czÄ™Å›Ä‡ \u0026ldquo;sklejki\u0026rdquo;, czyli ^([^:]+): i zaraz potem wymagamy by pojawiÅ‚a siÄ™ ta sama wartoÅ›Ä‡ przez wstecznÄ… referencjÄ™Â \\1$Â - to porÃ³wnywane jest z pierwszym parametrem cond\u0026rsquo;a. To dopasowanie jest prawdziwe gdy uÅ¼ytkownik loguje siÄ™ prawidÅ‚owo, wiÄ™c negujemy je stawiajÄ…c ! na poczÄ…tku regexp\u0026rsquo;a, by kaÅ¼de bÅ‚Ä™dne logowanie powodowaÅ‚o wywoÅ‚anie RewriteRule, czyli Forbidden.\nPogmatwane? WiÄ™c teraz na przykÅ‚adzie:\n bÅ‚Ä™dne logowanie (bo prostsze):\nlogin: roman\nuri: zbyszek/\npo dopasowaniu w $1 mamy zbyszek, a w %1 mamy roman, wiÄ™c $1:%1 to zbyszek:roman, ostatni cond sprawdza czy zbyszek:roman rÃ³Å¼ni siÄ™ od zbyszek:zbyszek - a skoro tak to blokujemy dostÄ™p, dobre logowanie:\nlogin: roman\nuri: roman/\npo dopasowaniu w $1 i %1 mamy roman i sprawdzamy czy $1:%1 jest zgodne z roman:roman, a jest wiÄ™c po negacji nie blokujemy dostÄ™pu. Skoro dostÄ™pu nie blokujemy to roman moÅ¼e dostaÄ‡ siÄ™ do swoich plikÃ³w.  Finalna konfiguracja ZostaÅ‚o przedstawienie caÅ‚oÅ›ciowo konfiguracji:\n\u0026lt;VirtualHost *:80\u0026gt; ServerName files.example.com ServerAlias www.files.example.com DocumentRoot /var/www/files ErrorLog ${APACHE_LOG_DIR}/error.log LogLevel warn CustomLog ${APACHE_LOG_DIR}/access.log combined \u0026lt;Directory /var/www/files\u0026gt; AllowOverride none AuthType basic AuthName \u0026#34;Zaloguj sie\u0026#34; AuthUserFile /etc/apache2/passwd Require valid-user RewriteEngine on RewriteRule ^$ /%{REMOTE_USER} [R,L] RewriteCond %{REMOTE_USER} ^(.+) RewriteCond %1:$1 !^([^:]+):\\1$ RewriteRule ^([^/]+)/ - [F,L] \u0026lt;/Directory\u0026gt; \u0026lt;/VirtualHost\u0026gt; DuÅ¼e i maÅ‚e litery wpisywane w loginie przez userÃ³w Zerknij tutaj.\n","href":"/2012/09/apache-ograniczenie-dostepu-dla-zalogowanych-uzytkownikow-z-mod_rewrite-i-mod_auth_basic/","title":"Apache: ograniczenie dostÄ™pu dla zalogowanych uÅ¼ytkownikÃ³w z mod_rewrite i mod_auth_basic"},{"content":"","href":"/tags/mod_auth_basic/","title":"mod_auth_basic"},{"content":"WybÃ³r dobrego X-terminala to w Å¼yciu admina prawie jak wybÃ³r Å¼ony\u0026hellip; spÄ™dza siÄ™ wspÃ³lnie duÅ¼o czasu i miÅ‚o gdy estetycznie wyglÄ…da, robi to co chcemy, itd\u0026hellip; ðŸ˜‰\nNie lubiÄ™ gnome-terminal'a bo domyÅ›lnie binduje F10 co wnerwia mnie w midnight commanderze, stÄ…d szukaÅ‚em i szukaÅ‚em i jak dotychczas najbardziej podpasowaÅ‚ mi unicode-rxvt. MoÅ¼na uruchamiaÄ‡ go po prostu jako urxvt lub uruchomiÄ‡ demona urxvtd po zalogowaniu i potem odpalaÄ‡ tylko klienta urxvtc. Druga metoda skutkuje natychmiastowym startem terminala, wiec gdy podbindujÄ™ go sobie pod F12 mam terminal zawsze pod rÄ™kÄ… w mniej niÅ¼ sekundÄ™. Dodatkowo fajnie wyglÄ…da z pÃ³Å‚przezroczystoÅ›ciÄ… i nie ma Å¼adnych dodatkowych menu/gadÅ¼etÃ³w.\nSkrÃ³ty klawiaturowe Wygodne skrÃ³ty klawiaturowe to kolejny atut tego terminala, najczÄ™Å›ciej korzystam z:\n shift+dÃ³Å‚ - otwarcie nowej karty, shift+lewo/shift+prawo - przejÅ›cie na kartÄ™ w lewo/prawo, ctrl+lewo/ctrl+prawo - przeniesienie karty w lewo/prawo, ctrl+d - zamknij kartÄ™.  WiÄ™cej ciekawych informacji o tym terminalu moÅ¼na znaleÅºÄ‡ tutaj.\nKonfig dla urxvt cat \u0026gt; ~/.Xdefaults \u0026lt;\u0026lt;SRC visualBell: False Xft.antialias: true Xft.hinting: true Xft.hintstyle: 0 Xft.dpi: 75 urxvt*termName: rxvt-unicode urxvt*geometry: 110x35 urxvt*background: rgba:2000/2000/2000/dddd urxvt*foreground: white urxvt*depth: 32 urxvt*fading: 40 urxvt*shading: 40 # fajny font ale w nowszych Ubuntu dziwnie zachowuje sie kursor ;-( #urxvt*font: xft:Terminus:pixelsize=14 #urxvt*font: xft:Monospace:pixelsize=12 urxvt*font: xft:Ubuntu Mono:pixelsize=14 urxvt*scrollBar: false urxvt*saveLines: 30000 urxvt*tintColor: gray urxvt*perl-ext-common: default,matcher,selection-autotransform,tabbed,selection-pastebin # urlLauncher otwiera wpisanÄ… przeglÄ…darkÄ™ # po klikniÄ™ciu Å›rodkowym klawiszem myszy #urxvt*urlLauncher: firefox urxvt*urlLauncher: chromium-browser # to juÅ¼ nie jest config dla urxvt # ale przewaÅ¼nie teÅ¼ go dorzucam xterm*geometry: 110x35 xterm*background: black xterm*foreground: grey xterm*fading: 90 xterm*shading: 50 xterm*inheritPixmap: true xterm*font: -misc-fixed-medium-r-*-*-12-*-*-*-*--iso10646-1 xterm*scrollBar: false xterm*saveLines: 30000 xterm*tintColor: gray SRC P.S. JeÅ›li urxvt wydaje Ci siÄ™ zbyt spartaÅ„ski to zerknij na terminator\u0026rsquo;a.\n","href":"/2012/09/unicode-rxvt-moje-ustawienia/","title":"unicode-rxvt - moje ustawienia"},{"content":"","href":"/tags/urxvt/","title":"urxvt"},{"content":"","href":"/tags/fsck/","title":"fsck"},{"content":"JeÅ¼eli chcemy by po ponownym uruchomieniu w czasie startu zostaÅ‚y sprawdzone wszystkie dyski narzÄ™dziem to moÅ¼na to osiÄ…gnÄ…Ä‡ na dwa sposoby. Zawsze gdy tego potrzebujÄ™ zastanawiam siÄ™ tylko jaki plik trzeba byÅ‚o utworzyÄ‡\u0026hellip; forcefsck, fsck, fsckforce\u0026hellip; wiÄ™c notujÄ™ ðŸ˜‰\nUtworzenie pliku /forcefsck Pierwsza metoda polega na utworzeniu pliku forcefsck w gÅ‚Ã³wnym katalog, robimy to poniÅ¼szym poleceniem:\nsudo touch /forcefsck Polecenie shutdown Druga metoda wykorzystuje parametr -F polecenia shutdown ale nie dziaÅ‚a na wszystkich dystrybucjach (w takiej sytuacji patrz pierwsza metoda):\nsudo shutdown -rF now ","href":"/2012/09/wymuszenie-fsck-po-restarcie/","title":"Wymuszenie fsck po restarcie"},{"content":"Znajomi co jakiÅ› czas pytajÄ… mnie: jak nazywa siÄ™ ta aplikacja, ktÃ³rÄ… masz na telefonie do\u0026hellip;? Z jakiego programu do poczty korzystasz na tel\u0026hellip;? itd\u0026hellip;\nPytacie - wiÄ™c macie ðŸ˜ƒ\nDGT GTD Bardzo przydatna lista TODO. Stworzona z myÅ›lÄ… o metodzie Getting Things Done i bardzo uÅ‚atwia pamiÄ™tanie u rÃ³Å¼nych zadaniach. Posiada teÅ¼ bardzo wygodny widÅ¼et, na ktÃ³rym moÅ¼emy podglÄ…dnÄ…Ä‡ nasze najbliÅ¼sze zadania.\nOpera Mini Wbudowana przeglÄ…darka jest niezÅ‚a, ale Opera Mini kompresuje mocno strony wykorzystujÄ…c poÅ›redniczÄ…ce serwery proxy co znacznie obniÅ¼a koszty transmisji danych. Od niedawna posiada tez prymitywny ale niezgorszy czytnik RSS\u0026rsquo;Ã³w.\nWiFinder Prosty i funkcjonalny skaner sieci WiFi - wolÄ™ go zamiast domyÅ›lnego narzÄ™dzie do wyszukiwania i podÅ‚Ä…czania sieci WiFi.\nWiFi Analyzer Bardziej zaawansowany skaner, pokazujÄ…cy moc sygnaÅ‚y do poszczegÃ³lnych AP, jakoÅ›Ä‡ danego kanaÅ‚u. Szpanerska aplikacja przy kolegach adminach ðŸ˜‰\nK-9 Mail Klient pocztowy - doÅ›Ä‡ zaawansowany funkcjonalnie ale z bardzo prostym interfejsem (choÄ‡ poczÄ…tkowa konfiguracja bywa nieco \u0026ldquo;tricky\u0026rdquo;).\nAdFree Android Na root\u0026rsquo;owanym telefonie trzeba to mieÄ‡ - aplikacja blokuje reklamy w wiÄ™kszoÅ›ci popularnych aplikacji.\nAdvanced Task Killer Bardzo przydatny programik - szczegÃ³lnie na sÅ‚abszych telefonach (jak mÃ³j). Zabija aplikacje dziaÅ‚ajÄ…ce w tle, zwalniajÄ…c pamiÄ™Ä‡ i odciÄ…Å¼ajÄ…c procesor. DziÄ™ki temu nawet cienki telefon dziaÅ‚a caÅ‚kiem Å¼wawo. Dostajemy rÃ³wnieÅ¼ widÅ¼et, ktÃ³ry za jednym dotkniÄ™ciem zabija wszystko ðŸ˜‰\nTransportoid RozkÅ‚ad jazdy komunikacji miejskiej dla wielu polskich miast. MoÅ¼na sprawdziÄ‡ poÅ‚Ä…czenia danej linii, odjazdy z danego przystanku, wyszukaÄ‡ poÅ‚Ä…czenia. JesteÅ›my automatycznie informowani o zmianach rozkÅ‚adu, ktÃ³ry moÅ¼na z poziomu aplikacji pobraÄ‡ (bez Å¼adnych rejestracji).\n","href":"/2012/09/moje-ulubione-aplikacje-na-androida/","title":"Moje ulubione aplikacje na Androidâ€™a"},{"content":"JednÄ… z rzeczy, ktÃ³re podobajÄ… mi siÄ™ w maszynach wirtualnych Xen jest moÅ¼liwoÅ›Ä‡ zrobienia backupu caÅ‚ego obrazu i szybkie odzyskanie juÅ¼ w trakcie ciÄ™Å¼kiej awarii. Gdy dodatkowo korzysta siÄ™ z LVM\u0026rsquo;a to moÅ¼na na chwilÄ™ wyÅ‚Ä…czyÄ‡ DomU, utworzyÄ‡ snapshot jego dyskÃ³w, uruchomiÄ‡ DomU i w trakcie dziaÅ‚ania robiÄ‡ spÃ³jny backup ze snapshot\u0026rsquo;a. DziÄ™ki takiemu mechanizmowi serwer jest niedostÄ™pny przez kilkanaÅ›cie sekund, a backup spÃ³jny jakby zostaÅ‚ wykonany przy caÅ‚kowicie wyÅ‚Ä…czonej maszynie. Taki backup sprowadza siÄ™ do kilku poleceÅ„ ktÃ³re moÅ¼na oskryptowaÄ‡ np.:\nlvcreate -L1000M -s -n volumendomu-snap /dev/vg/volumendomu dd if=/dev/vg/volumendomu | gzip -9 \u0026gt; backup.img.gz Problem pojawia siÄ™ przy prÃ³bie montowania takiego snapshot\u0026rsquo;a by uzyskaÄ‡ dostÄ™p do plikÃ³w gdy na volumenie LVM zostanie utworzona partycja i dopiero ona formatowana (domyÅ›lnie przy ext3/4). Czyli potrzebujemy zamontowaÄ‡ partycjÄ™ z volumenu LVM ale ta nie jest wprost widoczna (nie ma urzÄ…dzenia np. /dev/vg/volumendomu1).\nTen sam problem pojawia siÄ™ przy dostÄ™pie do partycji \u0026ldquo;zaszytych\u0026rdquo; w obrazie zrzuconym narzÄ™dziem dd z caÅ‚ego dysku, np.:\ndd if=/dev/sda of=/mnt/backups/somewhere.img W obu przypadkach w obrazie/wolumenie jest zaszyta partycja i przy prÃ³bie montowania dostaniemy tylko monit o nieznanym typie systemu plikÃ³w.\nBy wylistowaÄ‡ partycje wewnÄ…trz obrazu lub wolumenu najwygodniejÂ posÅ‚uÅ¼ymÄ‡ siÄ™ narzÄ™dziem parted :\nsudoÂ parted -s /mnt/backups/somewhere.img \u0026#34;unit B print\u0026#34; Model: (file) Dysk /mnt/backups/somewhere.img: 500105740288B Rozmiar sektora (logiczny/fizyczny): 512B/512B Tablica partycji: msdos Numer PoczÄ…tek Koniec Rozmiar Typ System plikÃ³w Flaga 1 1048576B 500105740287B 500104691712B primary ntfs Parted moÅ¼e dziaÅ‚aÄ‡ albo w trybie interaktywnym albo razem z parametrem -sÂ podajemy na koÅ„cuÂ skrypt z poleceniami ktÃ³re majÄ… zostaÄ‡ podane. PowyÅ¼sze wywoÅ‚anie zmienia jednostki z kilo/megabajtÃ³w na bajty (dokÅ‚adnie tego potrzebujemy jako offset - nic nie bÄ™dziemy musieli przeliczaÄ‡).\nTeraz moÅ¼emy prÃ³bowaÄ‡ zamontowaÄ‡ danÄ… partycjÄ™ korzystajÄ…c z parametru offset w mount, np. tak:\nsudo mount -o loop,ro,offset=1048576 -t ntfs /mnt/backups/somewhere.img /mnt/test JeÅ›li posiadamy stosunkowo aktualne wersje jajka i pakietu util-linux to powyÅ¼sza sztuczka powinna siÄ™ udaÄ‡. JeÅ›li takowych nie posiadamy to moÅ¼emy mieÄ‡ problemy przy prÃ³bie montowania kolejnych partycji. Wtedy moÅ¼e byÄ‡ potrzebne rozpakowania pojedynczej partycji z obrazu poleceniem dd.\n","href":"/2012/09/montowanie-partycji-z-obrazu-dysku/","title":"Montowanie partycji z obrazu dysku"},{"content":"KiedyÅ› poproszono mnie o przeszukanie wszystkich plikÃ³w php na serwerze webowym po kÄ…tem wywoÅ‚ania pewnej funkcji. Oczywiste wydaÅ‚o mi siÄ™ uÅ¼ycie rekurencyjnie grep\u0026rsquo;a, wiÄ™c:\ngrep -R \u0026#34;JAKAS_FUNKCJA\u0026#34; /var/www/*.php Ale szybko okazaÅ‚o siÄ™ Å¼e grep dopasowuje maskÄ™ *.php rÃ³wnieÅ¼ do katalogÃ³w, wiÄ™c nie przeszukiwaÅ‚ katalogÃ³w ktÃ³re nie koÅ„czyÅ‚y siÄ™ na .php ehhh\u0026hellip;..\nDrugie podejÅ›cie okazaÅ‚o siÄ™ trafniejsze - najpierw poleceniem find wyszukujÄ™ wszystkie pliki php, a dopiero pÃ³Åºniej grepujÄ™ (wypisujÄ…c nazwÄ™ pliku i numer linii):\nfind /var/www/ -iname \u0026#39;*.php\u0026#39; -print0 | xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;grep -iHn \u0026#34;JAKAS_FUNKCJA\u0026#34; \u0026#34;{}\u0026#34;\u0026#39; PrzykÅ‚adowo wynik:\nfind /var/www -iname \u0026#39;*.php\u0026#39; -print0 | xargs -0 -I\u0026#39;{}\u0026#39; sh -c \u0026#39;grep -iHn \u0026#34;eval(\u0026#34; \u0026#34;{}\u0026#34;\u0026#39; /var/www/*****/wp-admin/press-this.php:208: var my_src = eval( /var/www/*****/wp-admin/press-this.php:219: var my_src = eval( /var/www/*****/wp-admin/press-this.php:402: eval(data); /var/www/*****/wp-admin/includes/class-pclzip.php:4063:// eval(\u0026#39;$v_result = \u0026#39;.$p_options[PCLZIP_CB_PRE_EXTRACT].\u0026#39;(PCLZIP_CB_PRE_EXTRACT, $v_local_header);\u0026#39;); /var/www/*****/wp-includes/class-phpmailer.php:1916: //TODO using /e (equivalent to eval()) is probably not a good idea /var/www/*****/wp-includes/class-json.php:22: * Javascript, and can be directly eval()\u0026#39;ed with no further parsing /var/www/*****/wp-includes/functions.php:190: if ( doubleval($bytes) \u0026gt;= $mag ) ","href":"/2012/08/przeszukiwanie-plikow-danego-typu-pod-katem-tekstu/","title":"Przeszukiwanie plikÃ³w danego typu pod kÄ…tem tekstu"},{"content":"To raczej nie jest podstawowy konfig i prÃ³Å¼no szukaÄ‡ go na stronie WordPress\u0026rsquo;a, wiÄ™c odradzam tÄ™ zabawÄ™ jeÅ›li nie zna siÄ™ zbyt dobrze nginx\u0026rsquo;a.\nPoniewaÅ¼ serwerek, na ktÃ³rym dziaÅ‚a stronka to sprzÄ™cik z Atomem 330 i mocy na CPU zbyt wiele nie ma to popularne pluginy (np. W3 Total Cache) potencjalnie zwiÄ™kszajÄ…ce wydajnoÅ›Ä‡ tak na prawdÄ™ zmulaÅ‚y stronkÄ™ jeszcze bardziej. PluginÃ³w sprawdziÅ‚em kilka i kaÅ¼dorazowo efekt byÅ‚ podobny - stronka dziaÅ‚aÅ‚a wolniej niÅ¼ bez ich pomocy.\nDruga sprawa to zwiÄ™kszony ruch - w takiej konfiguracji juÅ¼ przy kilku osobach rÃ³wnoczeÅ›nie przeglÄ…dajÄ…cych blog, serwerek zwyczajnie nie radziÅ‚ sobie z dynamicznym generowaniem strony.\nPomysÅ‚ na rozwiÄ…zanie problemu z wydajnoÅ›ciÄ… polegaÅ‚ na odpaleniu cache\u0026rsquo;ujÄ…cego reverse proxy przed wÅ‚aÅ›ciwÄ… stronÄ…, z krÃ³tkim okresem waÅ¼noÅ›ci cache\u0026rsquo;u (max kilka sekund) tak by przy duÅ¼ym obciÄ…Å¼eniu strony serwowaÄ‡ gÅ‚Ã³wnie z cache\u0026rsquo;u (tylko co pewien czas ktoÅ› bÄ™dzie miaÅ‚ niefart i bÄ™dzie musiaÅ‚ zaczekaÄ‡ na wygenerowanie strony), przy czym komentarze i panel administracyjny dziaÅ‚ajÄ… z pominiÄ™ciam cache\u0026rsquo;owania (czyli kaÅ¼dorazowo trafiajÄ… przez proxy do aplikacji).\nWaÅ¼ne jednak by osoba wysyÅ‚ajÄ…ca komentarz mogÅ‚a wynik swojego dziaÅ‚ania zobaczyÄ‡ od razu na stronie. PoniewaÅ¼ komentarze wysyÅ‚ane sÄ… metodÄ… HTTP POST to w momencie odebrania takiego poÅ‚Ä…czenia bÄ™dzie ustawiane ciasteczko dezaktywujÄ…ce cache dla danego poÅ‚Ä…czenia na kilka sekund (do momentu jego wygaÅ›niÄ™cia).\nPoniÅ¼ej plik konfiguracyjny, ktÃ³ry naleÅ¼y zapisaÄ‡ np. w: /etc/nginx/sites-available/wordpress\n# na poczÄ…tek ustawiamy lokalizacjÄ™ dla cache\u0026#39;u proxy_cache_path /var/cache/nginx/wordpress levels=1:2 keys_zone=WORDPRESS:10m inactive=24h max_size=100m; # nie chcÄ™ stronki z www na poczÄ…tku wiÄ™c caÅ‚y ruch przekierowujÄ… # na stronkÄ™ bez www server { listen 10.0.1.2:80; server_name www.example.com; rewrite ^ http://example.com$request_uri? permanent; } # tutaj ma miejsce magia - gÅ‚Ã³wny host obsÅ‚ugujÄ…cy stronkÄ™ # to tak na prawdÄ™ cache\u0026#39;ujÄ…ce proxy serwujÄ…ce okresowo # generowane pliki server { listen 10.0.1.2:80 default; access_log /var/log/nginx/wordpress.access.log; server_name example.com; # ten rewrite przerzuca do panelu admina nawet jeÅ›li  # na koÅ„cu nie wpiszemy ukoÅ›nika  # bez niego teÅ¼ to dziaÅ‚a ale przekierowanie jest przetwarzane  # przez skrypt stronki i dziaÅ‚a wolniej  rewrite ^/wp-admin$ /wp-admin/ last; # cache\u0026#39;ujemy tylko odpowiedzi 200 i przez 60s  # (moja stronka nie obsÅ‚uguje zbyt duÅ¼ego ruchu i rzadko  # jest modyfikowana - np. przez komentarze - wiÄ™c 60s jest OK,  # na bardziej aktywnych stronkach moÅ¼na siÄ™ pokusiÄ‡ o ustawienie  # 1~3s przez co stronka jest praktycznie dynamiczna ale mimo to  # cache zapewni obsÅ‚ugÄ™ nawet kilku tys. zapytaÅ„ na sekundÄ™  proxy_cache_valid 200 60s; # informacje dla backendu na jakiego host siÄ™ wbijamy  # i z jakiego \u0026#34;prawdziwego\u0026#34; IP  proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # moÅ¼emy ukryÄ‡ niektÃ³re nagÅ‚Ã³wki np. by nie podpowiadaÄ‡  # z jakich pluginÃ³w korzystamy w WordPressie  proxy_hide_header X-Powered-By; # kilka ustawieÅ„ timeout\u0026#39;Ã³w  proxy_connect_timeout 60; proxy_read_timeout 120; proxy_send_timeout 120; # WaÅ¼ne - poniÅ¼sza opcja ustawia w jaki sposÃ³b generowane sÄ…  # nazwy plikÃ³w w cache\u0026#39;u,  # dodajÄ…c np. kolejne zmienne moÅ¼emy zrÃ³Å¼nicowaÄ‡ cache dla  # pewnych grup uÅ¼ytkownikÃ³w  proxy_cache_key \u0026#34;$scheme$request_method$host$request_uri\u0026#34;; # domyÅ›lna lokalizacja  location / { # ustawiamy domyÅ›lnÄ… wartoÅ›Ä‡ zmiennej  set $no_cache \u0026#34;\u0026#34;; # If non GET/HEAD, don\u0026#39;t cache \u0026amp; mark user as uncacheable for 1 second via cookie  # jeÅ›li metoda inna niÅ¼ GET/HEAD to oznacz usera przez cookie jako niecachowanego  # na czas 60s (ustawiany poniÅ¼ej)  if ($request_method !~ ^(GET|HEAD)$) { set $no_cache \u0026#34;1\u0026#34;; } # jeÅ›li zalogowany to nie cache\u0026#39;uj  if ($http_cookie ~* \u0026#34;comment_author_|wordpress_(?!test_cookie)|wp-postpass_\u0026#34; ) { set $no_cache \u0026#34;1\u0026#34;; } # jeÅ¼eli ktÃ³ryÅ› z wczeÅ›niejszych warunkÃ³w jest speÅ‚niony  # to ustawiamy cookie, ktÃ³re poinformuje nas by nie cachowaÄ‡  # kolejnych zapytaÅ„  # (z powodu \u0026#34;dziwnego\u0026#34; zachowania if w nginx\u0026#39;ie ustawienie  # tego bezpoÅ›rednio we wczeÅ›niejszych warunkach nie dziaÅ‚a)  if ($no_cache = \u0026#34;1\u0026#34;) { add_header Set-Cookie \u0026#34;_mcnc=1; Max-Age=61; Path=/\u0026#34;; add_header X-Microcachable \u0026#34;0\u0026#34;; } # jeÅ›li cookie jest ustawione to pomijamy cache i serwujemy  # Å›wieÅ¼Ä… treÅ›Ä‡  if ($http_cookie ~* \u0026#34;_mcnc\u0026#34;) { set $no_cache \u0026#34;1\u0026#34;; } # dwie poniÅ¼sze opcje zapewniajÄ… pominiÄ™cia cache\u0026#39;owania  # w przypadku gdy wystÄ…pi ktÃ³ryÅ› z wczeÅ›niejszych warunkÃ³w  proxy_no_cache $no_cache; proxy_cache_bypass $no_cache; # Serwujemy cache jeÅ›li strona jest obecnie odÅ›wieÅ¼ana  # lub wystÄ…pi bÅ‚Ä…d  proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; # pliki wiÄ™ksze niÅ¼ 1M nie bÄ™dÄ… cache\u0026#39;owane  proxy_max_temp_file_size 1M; # cache\u0026#39;ujemy tylko odpowiedzi 200 i przez 60s  # (moja stronka nie obsÅ‚uguje zbyt duÅ¼ego ruchu i rzadko  # jest modyfikowana - np. przez komentarze - wiÄ™c 60s jest OK,  # na bardziej aktywnych stronkach moÅ¼na siÄ™ pokusiÄ‡ o ustawienie  # 1~3s przez co stronka jest praktycznie dynamiczna ale mimo to  # cache zapewni obsÅ‚ugÄ™ nawet kilku tys. zapytaÅ„ na sekundÄ™  proxy_cache_valid 200 60s; # zmieniamy domyÅ›lny klucz cache\u0026#39;owania tak by uwzglÄ™dniaÅ‚  # naszÄ… zmiennÄ…  proxy_cache_key \u0026#34;$scheme://$host$request_uri $no_cache\u0026#34;; # wskazujemy konkretnÄ… lokalizacjÄ™ cache\u0026#39;u  proxy_cache WORDPRESS; # podajemy lokalizacjÄ™ backendu (nie widziaÅ‚em sensu  # by udostÄ™pniaÄ‡ go na zewnÄ™trznym adresie)  proxy_pass http://127.0.0.1:81; # moÅ¼na ustawiÄ‡ dodatkowo cache\u0026#39;owanie strony w przeglÄ…darce  # (caÅ‚kiem niezaleÅ¼nie od tego co bÄ™dzie w cache\u0026#39;u na serwerze)  expires 60s; } # dla panelu administracyjnego ustawiamy proxy bez cache\u0026#39;u  location ~* wp\\-(admin|login) { # dostÄ™p do panelu administracyjnego dodatkowo chronimy  # hasÅ‚em - po co?  # bo w tym katalogu sÄ… rÃ³Å¼ne fajne skrypty, w ktÃ³rych juÅ¼  # nie raz znaleziono dziury  auth_basic \u0026#34;Go Away\u0026#34;; auth_basic_user_file htpasswd; # proxy bez cache\u0026#39;u  proxy_pass http://127.0.0.1:81; } # statykÄ™ cache\u0026#39;ujemy mocniej niÅ¼ treÅ›ci dynamiczne  # a czemu nie puszczam jej bezpoÅ›rednio? bo wyplute przez  # backend zostanÄ… skompresowane i w takiej postaci zachowajÄ…  # siÄ™ w cache\u0026#39;u - gdybym serwowaÅ‚ je bezpoÅ›rednio to nginx  # kompresowaÅ‚by np. css\u0026#39;y/js\u0026#39;y przy kaÅ¼dym dostÄ™pie do nich  location ~* \\.(jpg|png|gif|jpeg|css|js|mp3|wav|swf|mov|doc|pdf|xls|ppt|docx|pptx|xlsx)$ { # cache\u0026#39;ujemy statykÄ™ przez 2 godziny  proxy_cache_valid 200 120m; # dodatkowo ustawiamy dÅ‚ugie cache\u0026#39;owanie w przeglÄ…darkach  expires 864000; # puszczamy wszystko w proxy + cache  proxy_pass http://127.0.0.1:81; proxy_cache WORDPRESS; # wyÅ‚Ä…czam logowanie dostÄ™pu do statyki nawet w przypadku bÅ‚Ä™dÃ³w  # to maÅ‚o istotne  log_not_found off; access_log off; } # jeszcze inaczej ustawiam cache dla RSS\u0026#39;Ã³w  location ~* \\/[^\\/]+\\/(feed|\\.xml)\\/? { # cache\u0026#39;ujemy RSS\u0026#39;y przez 45 minut  if ($http_cookie ~* \u0026#34;comment_author_|wordpress_(?!test_cookie)|wp-postpass_\u0026#34; ) { set $no_cache 1; } proxy_cache_key \u0026#34;$scheme://$host$request_uri $no_cache\u0026#34;; proxy_cache_valid 200 45m; proxy_cache MYSITE; proxy_pass http://127.0.0.1:81; } } # to teraz konfiguracja serwera serwujÄ…cego treÅ›ci dynamiczne server { # nasÅ‚uchujemy lokalnie bo z zewnÄ…trz strona dostÄ™pna  # jest przez proxy  listen 127.0.0.1:81; error_log /var/log/nginx/mysite.error.log; root /var/www/wordpress; index index.php; # logujemy prawdziwe IP dziÄ™ki odpowiednim nagÅ‚Ã³wkom  # przesyÅ‚anym przez proxy  set_real_ip_from 127.0.0.0/24; real_ip_header X-Real-IP; # tutaj praktycznie klasyka - z tym Å¼e zamiast na koÅ„cu  # wskazywaÄ‡ index.php robiÄ™ najpierw kilka rewrite\u0026#39;Ã³w  # np. dla przeniesionych stron, itp  location / { try_files $uri $uri/ @rewrites; } location @rewrites { rewrite /main http://example.com/about/? permanent; rewrite /projekty http://example.com/category/projects/? permanent; rewrite /tag/gd http://example.com? permanent; rewrite /category/hobby http://roman.com? permanent; rewrite ^ /index.php last; } # na bardziej obleganych stronach limitowanie wyszukiwania moÅ¼e # pomÃ³c, ale to nie mÃ³j przypadek # location /search { limit_req zone=mysitesearch burst=3 nodelay; rewrite ^ /index.php; }  location ~* \\.(?:ico|css|js|gif|jpe?g|png)$ { # cache\u0026#39;owanie atrybutÃ³w statycznych plikÃ³w  open_file_cache max=1000 inactive=120s; open_file_cache_valid 45s; open_file_cache_min_uses 2; open_file_cache_errors off; # maksymalne cache\u0026#39;owanie statyki w przeglÄ…darkach  expires max; } # no i na koÅ„cu obsÅ‚uga skryptÃ³w php  location ~* \\.php$ { # albo plik istnieje i go serwujemy albo dajemy Forbidden  try_files $uri =403; # kilka standardowych ustawieÅ„  include fastcgi_params; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; # blokujemy moÅ¼liwoÅ›Ä‡ wykonywania skryptÃ³w z katalogu upload  # (nawet jeÅ›li komuÅ› uda siÄ™ je wepchnÄ…Ä‡)  if ($uri !~ \u0026#34;^/wp-content/uploads/\u0026#34;) { fastcgi_pass php-fastcgi; } # informacje dla proxy jak dÅ‚ugo moÅ¼e cache\u0026#39;owaÄ‡  add_header Cache-Control \u0026#34;max-age:60, public\u0026#34;; expires 60s; } # blokujÄ™ dostÄ™p do plikÃ³w zaczynajÄ…cych siÄ™ od kropki  location ~ /\\. { access_log off; log_not_found off; deny all; } # wyÅ‚Ä…czam logowanie do nieistotnych plikÃ³w  location = /robots.txt { allow all; access_log off; log_not_found off; } location = /favicon.ico { access_log off; log_not_found off; } } Konfiguracja potrzebuje jednego folderu na cache, do ktÃ³rego dostÄ™p do zapisu ma nginx (uÅ¼ytkownik na ktÃ³rym dziaÅ‚a proces):\nmkdir -p /var/cache/nginx/wordpress chown -R www-data:www-data /var/cache/nginx/wordpress A Å¼eby zaczÄ…Å‚ dziaÅ‚aÄ‡ trzeba go \u0026ldquo;wÅ‚Ä…czyÄ‡\u0026rdquo; i przeÅ‚adowaÄ‡ nginx\u0026rsquo;a:\ncd /etc/nginx/sites-available/ ln -s wordpress /etc/nginx/sites-enabled/wordpress service nginx reload Jedyna rzecz, ktÃ³rej brakuje w tym configu to konfiguracja backend\u0026rsquo;u do PHP\u0026rsquo;a (u mnie nazwanaÂ php-fastcgi) - moÅ¼e kiedyÅ› zrobiÄ™ HOWTO o konfiguracji NGINX+PHP, ale na tÄ… chwilÄ™ zakÅ‚adam Å¼e sobie poradzisz ðŸ˜ƒ\nBenchmark SprawdÅºmy jak to wyglÄ…da teraz:\nab -n 1000 -c 10 https://gagor.pl/ This is ApacheBench, Version 2.3 \u0026lt; $Revision: 1430300 $\u0026gt; Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking gagor.pl (be patient) Completed 100 requests Completed 200 requests Completed 300 requests Completed 400 requests Completed 500 requests Completed 600 requests Completed 700 requests Completed 800 requests Completed 900 requests Completed 1000 requests Finished 1000 requests Server Software: nginx Server Hostname: gagor.pl Server Port: 80 Document Path: / Document Length: 36263 bytes Concurrency Level: 10 Time taken for tests: 8.716 seconds Complete requests: 1000 Failed requests: 22 (Connect: 0, Receive: 0, Length: 22, Exceptions: 0) Write errors: 0 Total transferred: 36601094 bytes HTML transferred: 36263088 bytes Requests per second: 114.73 [#/sec] (mean) Time per request: 87.159 [ms] (mean) Time per request: 8.716 [ms] (mean, across all concurrent requests) Transfer rate: 4100.91 [Kbytes/sec] received Connection Times (ms) min mean[+/-sd] median max Connect: 1 16 7.1 15 55 Processing: 17 67 97.0 53 789 Waiting: 5 28 55.6 19 456 Total: 37 83 98.0 68 803 Percentage of the requests served within a certain time (ms) 50% 68 66% 74 75% 78 80% 80 90% 87 95% 95 98% 665 99% 755 100% 803 (longest request) Dla mnie bomba ðŸ˜ƒ\nPomysÅ‚ na taki rodzaj cache\u0026rsquo;owania zaczerpnÄ…Å‚em stÄ…d.\n","href":"/2012/06/nginx-konfiguracja-pod-wordpressa/","title":"Nginx - konfiguracja pod WordPressâ€™a"},{"content":"","href":"/tags/reverse-proxy/","title":"reverse proxy"},{"content":"PisaÅ‚em juÅ¼ HOWTO o konfiguracji Xen\u0026rsquo;aÂ ale nie opisaÅ‚em jak siÄ™ bawiÄ‡ wirtualkami gdy Xen\u0026rsquo;a juÅ¼ mamy. To nadrabiam.\nTworzenie i usuwanie maszyn wirtualnych Do tworzenia/niszczenia DomU wykorzystujÄ™ pakiet xen-tools dostarczajÄ…cy m.in. dwa narzÄ™dzia:\n xen-createÂ - dla ktÃ³rego przygotowaÅ‚em doÅ›Ä‡Â skomplikowanÄ…Â konfiguracjÄ™ przy okazji wczeÅ›niejszego posta: Instalacja i konfiguracja DomU. PrzykÅ‚ad uÅ¼ycia: xen-create --hostname example-domu --ip 10.0.0.77 \\ --gateway 10.0.0.1 --broadcast 10.0.0.255 --netmask 255.255.255.0 \\ --bridge br10 --vcpus 2 --memory=2G  xen-delete-imageÂ - narzÄ™dzie do kasowania wirtualnych maszyn. Maszyna musi byÄ‡ wyÅ‚Ä…czona aby moÅ¼na byÅ‚o jÄ… usunÄ…Ä‡. NarzÄ™dzie to kasuje plik konfiguracyjny maszyny wirtualnej oraz przydzielone jej volumeny lvm. PrzykÅ‚ad uÅ¼ycia: xen-delete-image nazwamaszyny   ZarzÄ…dzanie maszynami wirtualnymi Do uruchamiania, wyÅ‚Ä…czanie, resetowania (i ogÃ³lnie zarzÄ…dzania) maszynami wirtualnymi sÅ‚uÅ¼y tylko jedno polecenie:Â xmÂ z rÃ³Å¼nymi parametrami:\n xm list- listuje uruchomione w danej chwili wirtualne maszyny, wyÅ›wietlajÄ…c przydzielonÄ… im iloÅ›Ä‡ pamiÄ™ci, procesorÃ³w, stan (uruchomiona, zawieszona), czas dziaÅ‚ania (uptime). Dla objaÅ›nienia Domain-0 (zwane teÅ¼ Dom-O) to hyperwisor czyli fizyczna maszyna na ktÃ³rej uruchomione sÄ… wirtualki. xm topÂ - polecenie wyÅ›wietla dokÅ‚adne dane chwilowego zuÅ¼ycia zasobÃ³w dla rÃ³Å¼nych wirtualnych maszyn i Dom-0. xm create nazwapliku.cfgÂ - uruchamia maszynÄ™ wirtualnÄ… zgodnie z instrukcjami zawartymi w pliku konfiguracyjnym (przydzielone dyski, pamiÄ™Ä‡, etc). xm shutdown nazwamaszynyÂ - wysyÅ‚a sygnaÅ‚ wyÅ‚Ä…czenia maszyny wirtualnej i wraca do wiersza poleceÅ„. DokÅ‚adnie to polecenie wysyÅ‚a sygnaÅ‚ ACPI rÃ³wnowaÅ¼ny przyciÅ›niÄ™ciu przycisku Power na obudowie komputera - system operacyjny wykrywa to zdarzenie i zaczyna siÄ™ wyÅ‚Ä…czaÄ‡. Jest to zalecana instrukcja do wyÅ‚Ä…czania wirtualek. NaleÅ¼y pamiÄ™taÄ‡, Å¼e po wykonaniu tego polecenia jeszcze przez kilka/kilkanaÅ›cie sekund maszyna dziaÅ‚a - do puki nie skoÅ„czy siÄ™ wyÅ‚Ä…czaÄ‡. xm shutdown -w nazwamaszynyÂ - dziaÅ‚a jak powyÅ¼sze polecenie, ale dodatkowo czeka aÅ¼ maszyna wirtualna zostanie wyÅ‚Ä…czona a przydzielone jej zasoby zwolnione. Gdy to polecenie skoÅ„czy siÄ™ wykonywaÄ‡ mamy pewnoÅ›Ä‡, Å¼e maszyna jest juÅ¼ wyÅ‚Ä…czona. xm destroy nazwamaszynyÂ - polecenie do twardego resetu maszyny wirtualnej. Najpierw odbierany jest czas procesora dla maszyny, potem zwalniana pamiÄ™Ä‡ i zarezerwowane uchwyty. WykorzystujÄ…c to polecenie moÅ¼e dojÅ›Ä‡ do utraty danych lub uszkodzeniaÂ OSâ€˜u na wirtualnej maszynie. xm reboot nazwamaszynyÂ - restartuje maszynÄ™ wirtualnÄ… w bezpieczny sposÃ³b (czyli wysyÅ‚a sygnaÅ‚ ACPI doÂ wyÅ‚Ä…czeniaÂ i startuje DomU). Gdy zmodyfikujemy plik konfiguracyjny danego DomU nie wystarczy wywoÅ‚aÄ‡ xm reboot - przewaÅ¼nie potrzeba poÅ‚oÅ¼yÄ‡ maszynÄ™ i ponownie jÄ… uruchomiÄ‡, np. tak:  xm shutdown -w maszyna \u0026amp;\u0026amp; xm create maszyna.cfg  xm pause nazwamaszyny - pauzuje wirtualnÄ… maszynÄ™, zamraÅ¼ajÄ…c jÄ… w obecnym stanie razem z pamiÄ™ciÄ… itd. xm unpause nazwamaszynyÂ - uruchamia zapauzowanÄ… wczeÅ›niej maszynÄ™ wirtualnÄ…. DziaÅ‚a odwrotnie do polecenia powyÅ¼ej. xm console nazwamaszyny - polecenie dziaÅ‚a jak â€žpodpiÄ™cie monitoraâ€ do fizycznej maszyny, na pierwszy terminal. Bardzo przydatne zaraz po utworzeniu wirtualki jak rÃ³wnieÅ¼ w rÃ³Å¼nych sytuacjach kryzysowych ðŸ˜‰  Jest jeszcze kilka innych poleceÅ„ np. dodajÄ…cych na gorÄ…co urzÄ…dzenia blokowe ale ich dziaÅ‚anie mocno zaleÅ¼y od wersji Xen\u0026rsquo;a i jajka.\n","href":"/2012/06/xen-podstawowe-polecenia/","title":"Xen - Podstawowe polecenia"},{"content":"Ustawienie domyÅ›lnego vhosta w nginx\u0026rsquo;ie jest Å‚adnie opisane w dokumentacji i poczÄ…tkowo wydawaÅ‚o siÄ™ dobrze dziaÅ‚aÄ‡ ale gdy wykorzystaÅ‚em tÄ… konfiguracjÄ™ na serwerze z wieloma adresami IP i nasÅ‚uchiwaniem na porcie 80 (bez podania IP) to zachowywaÅ‚o siÄ™ to doÅ›Ä‡ dziwnie (przewaÅ¼nie nie Å‚adowaÅ‚o tej strony ktÃ³rÄ… chciaÅ‚em). Od teraz tworzÄ™ konfiguracjÄ™ domyÅ›lnego vhosta dla kaÅ¼dego z dostÄ™pnych adresÃ³w IP. Powiem szczerze Å¼e nie miaÅ‚em czasu na gÅ‚Ä™bsze zbadanie tego zachowania i wykorzystaÅ‚emÂ rozwiÄ…zanie, ktÃ³re dziaÅ‚aÅ‚o w kaÅ¼dym przypadku czyli po jednym konfigu na IP + przekierowanie na ogÃ³lnÄ… stronÄ™.\nserver { listen 10.0.0.100:80 default_server; server_name _; server_name_in_redirect off; rewrite ^ http://www.gagor.pl permanent; } ","href":"/2012/06/nginx-ustawienie-domyslnego-vhosta/","title":"Nginx - ustawienie domyÅ›lnego vhosta"},{"content":"VLAN\u0026rsquo;y sÄ… prostÄ… metodÄ… na separacjÄ™ sieci. Gdy mamy wiele sieci moÅ¼e zajÅ›Ä‡ potrzeba by poszczegÃ³lne DomU miaÅ‚y dostÄ™p do rÃ³Å¼nych VLAN\u0026rsquo;Ã³w (czasem nawet wielu rÃ³wnoczeÅ›nie). JeÅ¼eli serwer z Dom0 posiada minimumÂ giga-bitowÄ…Â kartÄ™ sieciowÄ… (a najlepiej kilka) to powinniÅ›my byÄ‡ w stanie z godziwÄ… jakoÅ›ciÄ… udostÄ™pniÄ‡ systemom DomU rÃ³Å¼ne VLAN\u0026rsquo;y z interfejsÃ³w gospodarza.\nZaprezentowane poniÅ¼ej skrypty zapoÅ¼yczyÅ‚em z tej strony:Â http://renial.net/weblog/2007/02/27/xen-vlan\nNa poczÄ…tek musimy zainstalowaÄ‡ pakiet vlan:\napt-get install vlan PÃ³Åºniej w pliku /etc/xen/xend-config.sxp ustawiamy taka skrypt dla konfiguracji sieci:\n(network-script network-multi-vlan) Tworzymy plik /etc/xen/scripts/network-multi-vlan i wpisujemy w nim (no dobra - komentarze moÅ¼na pominÄ…Ä‡):\n#!/bin/sh #=================================================================== # Xen vlan bridge start/stop script. # Xend calls a network script when it starts. # The script name to use is defined in /etc/xen/xend-config.sxp # in the network-script field. # # This script creates multiple bridges to segregate individual # domUs to separate VLANs. Customize to fit your needs. # # Usage: # # network-multi-vlan (start|stop|status) # #=================================================================== dir=$(dirname \u0026#34;$0\u0026#34;) # PoniÅ¼sza linijka pozwala udostÄ™pniÄ‡ dany interfejs sieciowy # w caÅ‚oÅ›ci jako domyÅ›lny bridge - jeÅ›li chcemy siÄ™ ograniczyÄ‡ # wyÅ‚Ä…cznie do bridge\u0026#39;y na VLAN\u0026#39;ach to moÅ¼emy tÄ… linijkÄ™ # zakomentowaÄ‡ (jak ja) \u0026#34;$dir/network-bridge\u0026#34; \u0026#34;$@\u0026#34; vifnum=0 netdev=eth0 # No i teraz odpalamy kolejne VLAN\u0026#39;y na poszczegÃ³lnych interfejsach. # Brak parametru netdev jest rÃ³wnoznaczny wybraniu netdev=eth0 # Parametr VLAN jest... hm... samoopisujÄ…cy \u0026#34;$dir/network-bridge-vlan\u0026#34; \u0026#34;$@\u0026#34; vlan=10 netdev=eth1 \u0026#34;$dir/network-bridge-vlan\u0026#34; \u0026#34;$@\u0026#34; vlan=11 \u0026#34;$dir/network-bridge-vlan\u0026#34; \u0026#34;$@\u0026#34; vlan=23 netdev=eth2 Pobieramy skryptÂ network-bridge-vlanÂ do lokalizacji:Â /etc/xen/scripts/network-bridge-vlan.\ncd /tmp wget https://gagor.pl/wp-content/uploads/2012/06/network-bridge-vlan.gz gunzip network-bridge-vlan.gz mv network-bridge-vlanÂ /etc/xen/scripts/network-bridge-vlan Å¹rÃ³dÅ‚a  http://wiki.xensource.com/xenwiki/XenDom0VLANstoDomUVirtualNICsÂ - ogÃ³lne schematy konfiguracji VLAN\u0026rsquo;Ã³w na Xen\u0026rsquo;ie, http://renial.net/weblog/2007/02/27/xen-vlanÂ - skrypty do konfiguracji VLAN\u0026rsquo;Ã³w pochodzÄ… z tej strony.  ","href":"/2012/06/xen-konfiguracja-interfejsu-sieciowego-dom0-jako-brdigea-dla-roznych-vlanow/","title":"Xen - Konfiguracja interfejsu sieciowego Dom0 jako brdigeâ€™a dla VLANâ€™Ã³w"},{"content":"Ostatnio trafiÅ‚em na ciekawy problem, ktÃ³ry wielokrotnie rozwiÄ…zywaÅ‚em w nginx\u0026rsquo;ie ale tym razem musiaÅ‚em zrobiÄ‡ to w Apache. Pewna stronka dziaÅ‚a sobie na HTTPS\u0026rsquo;ie i chciaÅ‚em by wszystkie powiÄ…zane z niÄ… pliki byÅ‚y serwowane z jej adresu szyfrowanym poÅ‚Ä…czeniem by nie pojawiaÅ‚y siÄ™ w przeglÄ…darce monity Å¼e \u0026ldquo;czÄ™Å›Ä‡ ruchu nie jest szyfrowana\u0026rdquo;. Tyle Å¼e czÄ™Å›Ä‡ potrzebnych plikÃ³w byÅ‚a juÅ¼ obecnie serwowana na innym serwerze (w innej domenie) poprzez HTTP.\nMogÅ‚em albo skopiowaÄ‡ te pliki i wykombinowaÄ‡ jakiÅ› mechanizm synchronizujÄ…cy albo wykorzystaÄ‡ proxy + cache. DrugieÂ rozwiÄ…zanieÂ wydaÅ‚o mi siÄ™ prostsze i Å‚adniejsze ðŸ˜ƒ\nNa poczÄ…tek wÅ‚Ä…czamy w Apache\u0026rsquo;m odpowiednie moduÅ‚y:\na2enmod proxy a2enmod proxy_http Teraz przykÅ‚adowa konfiguracja vhosta:\n\u0026lt;VirtualHost *:80\u0026gt; #podstawowa konfiguracja vhosta ServerAdmin webmaster@example.com ServerName www.example.com ServerAlias example.com # wyÅ‚Ä…cza dziaÅ‚anie Apache\u0026#39;go jako przekazujÄ…cego proxy (forwarding proxy) ProxyRequests Off # nie chciaÅ‚em by bÅ‚Ä™dy HTTP z backendowego serwera byÅ‚y przekazywane # zamiast nich bÄ™dÄ… bÅ‚Ä™dy Apache\u0026#39;go ProxyErrorOverride On # przykÅ‚ad prostego reverse proxy - wystarczÄ… dwa poniÅ¼sze polecenia # ProxyPass proxuje ruch do danego serwera pod wskazanym URL\u0026#39;em ProxyPass /stats/ http://google-anal.com/ # ProxyPassReverse modyfikuje nagÅ‚Ã³wki odpowiedzi ze zdalnego serwera # tak by odpowiedÅº wyglÄ…daÅ‚a na wysÅ‚anÄ… z lokalnego serwera ProxyPassReverse /stats/ http://google-anal.com/ # ciekawszy przykÅ‚ad proxowania z dodatkowymi ustawieniami cachowania # najpierw konfiguracja cache\u0026#39;u dyskowego \u0026lt;IfModule mod_disk_cache.c\u0026gt; # CacheRoot to wymagany parametr - Å›cieÅ¼ka w ktÃ³rej znajduje siÄ™ cache CacheRoot /var/cache/apache2/mod_disk_cache/example # poniewaÅ¼ przewidywaÅ‚em Å¼e cache\u0026#39;owanych bÄ™dzie kilka GB maÅ‚ych plikÃ³w # to by listowanie ich w cache\u0026#39;u byÅ‚o efektywne warto wykorzystaÄ‡ wielo # poziomowe zagÅ‚Ä™bienie katalogÃ³w - wtedy na kaÅ¼dym poziomie, w danym # katalogu bÄ™dzie stosunkowo maÅ‚o plikÃ³w, indeksy mniejsze, listowanie # szybsze CacheDirLevels 5 CacheDirLength 2 # teraz czas na konfiguracje cache\u0026#39;u \u0026lt;IfModule mod_cache.c\u0026gt; # pozwolÄ™ sobie na zignorowanie nagÅ‚Ã³wkÃ³w Expires/Cache-Control # z aplikacji sam lepiej wiem Å¼e te pliki nie zmieniajÄ… siÄ™ # zbyt czÄ™sto CacheIgnoreCacheControl On # pliki stracÄ… waÅ¼noÅ›Ä‡ w cache\u0026#39;u po tygodniu CacheDefaultExpire 604800 # poniewaÅ¼ zasoby nie rÃ³Å¼niÄ… siÄ™ dla rÃ³Å¼nych zalogowanych uÅ¼ytkownikÃ³w # zignorujÄ™ cookies\u0026#39;y CacheIgnoreHeaders Set-Cookie # nie chcÄ™ by proxy weryfikowaÅ‚o czy pojawiÅ‚a siÄ™ nowa wersja obrazka # bo raczej rzadko pojawiajÄ… siÄ™ zmiany CacheIgnoreNoLastMod On # cache uruchamiany dla dwÃ³ch \u0026#34;subkatalogÃ³w\u0026#34; # http://example.com/images oraz http://example.com/files CacheEnable disk /images CacheEnable disk /files \u0026lt;/IfModule\u0026gt; \u0026lt;/IfModule\u0026gt; # wÅ‚Ä…czamy mod_rewrite - bÄ™dzie za chwilkÄ™ potrzebny RewriteEngine on # poprzednio do uruchomienia proxy wykorzystaÅ‚em opcjÄ™ ProxyPass, # ale czÄ™sto potrzebujemy bardziej zaawansowanego przekierowania # i wtedy warto wykorzystaÄ‡ mod_rewrite do modyfikacji URL\u0026#39;i w locie # koniecznie z flagÄ… [P] RewriteRule ^/images/(.+)/(.+) http://10.0.0.100:8080/example-images/get.php?id=$1\u0026amp;width=$2 [P] \u0026lt;Location /images\u0026gt; # jak powyÅ¼ej - modyfikacja zwrotnych nagÅ‚Ã³wkÃ³w ProxyPassReverse /example-images/ # kilka nagÅ‚Ã³wkÃ³w z backendu ukrywam by nie byÅ‚y przekazywane dalej Header unset Server Header unset Expires Header unset ETag # akurat nagÅ‚Ã³wek Via moÅ¼na wyÅ‚Ä…czyÄ‡ w konfiguracji moduÅ‚u proxy # ale poniewaÅ¼ bywa przydatny przy debugowaniu to w niektÃ³rych miejscach # wolÄ™ gdy jest ustawiony - a w innych nie Header unset Via # rÄ™czne ustawienie nagÅ‚Ã³wka Cache-Control i zezwolenie # na cachowanie przez inne proxy lub przeglÄ…darki Header set Cache-Control \u0026#34;max-age=604800, public\u0026#34; \u0026lt;/Location\u0026gt; # i drugie przekierowanie RewriteRule ^/files/(.+)/(.+) http://10.0.0.100:8080/example-files/$1/$2 [P] \u0026lt;Location /files\u0026gt; ProxyPassReverse /example-files/ Header unset Server Header unset Via Header unset ETag Header unset Expires Header set Cache-Control \u0026#34;max-age=604800, public\u0026#34; \u0026lt;/Location\u0026gt; # standardowa konfiguracja DocumentRoot /var/www/example \u0026lt;Directory /var/www/example\u0026gt; Options -Indexes FollowSymLinks Includes AllowOverride None Order allow,deny Allow from all \u0026lt;/Directory\u0026gt; LogLevel warn CustomLog /var/log/apache2/example_access.log combined \u0026lt;/VirtualHost\u0026gt; ","href":"/2012/06/apache-reverse-proxy-z-cacheowaniem/","title":"Apache - reverse proxy z cacheâ€™owaniem"},{"content":"Gdy tworzymy pierwszÄ… aplikacjÄ™ webowÄ…, ktÃ³ra umoÅ¼liwia upload plikÃ³w przewaÅ¼nie lÄ…dujÄ… one lokalnie w pewniej lokalizacji. Gdy druga aplikacja potrzebuje dostÄ™pu do tych plikÃ³w wystarczy podaÄ‡ Å›cieÅ¼kÄ™. Problemy zaczynajÄ… siÄ™ gdy aplikacji jest kilka i rozmieszczonych na kilku serwerach. MoÅ¼na korzystaÄ‡ z sieciowych systemÃ³w plikÃ³w ale to czÄ™sto nie jest zbyt wygodne - ciÄ™Å¼ko odpowiednio ustawiÄ‡ uprawnienia by pewne aplikacje miaÅ‚y dostÄ™p do zapisu plikÃ³w a inne nie, trzeba skonfigurowaÄ‡ dany katalog w kilku miejscach w konfiguracji serwera WWW aby serwowaÄ‡ pliki itp\u0026hellip;\nJeÅ¼eli w utrzymaniu swoich aplikacji dociera siÄ™ do takiego momentu to kolejne pomysÅ‚y zakÅ‚adajÄ… wykorzystanie bazy danych do przechowywania plikÃ³w. Ale chwila googlania i juÅ¼ wiemy Å¼e bazy typu SQL Å›rednio radzÄ… sobie z przetwarzaniem tak duÅ¼ych rekordÃ³w jak pliki. Kolejny etap to sprawdzenie co mogÄ… nam zaoferowaÄ‡ bazy NoSQL.\nW tym miejscu przeczytaÅ‚em wiele rÃ³Å¼nych artykuÅ‚Ã³w i ostatecznie zastanawiaÅ‚em siÄ™ czy wybraÄ‡ MongoDB czy CouchDB. Oba projekty sÄ… bardzo podobne a gÅ‚Ã³wnÄ… ich zaletÄ… jest Å‚atwoÅ›Ä‡ wykorzystania w istniejÄ…cych aplikacjach webowych. Tutaj szczegÃ³lnie CouchDB wypada bardzo dobrze bo zarzÄ…dzanie i dostÄ™p do bazy odbywa siÄ™ standardowym protokoÅ‚em HTTP - polecenia wydaje siÄ™ POST\u0026rsquo;ami, a dane pobiera GET\u0026rsquo;ami. DziÄ™ki takiej budowie Å‚atwo moÅ¼na schowaÄ‡ CouchDB za reverse proxy i serwowaÄ‡ np. pliki uploadowane przez uÅ¼ytkownikÃ³w wprost z bazy - bez dorabiania dodatkowych interfejsÃ³w. Bardzo Å‚atwo teÅ¼ obsÅ‚uguje siÄ™ bazÄ™ z poziomu aplikacji AJAX. WiÄ™c w moim przypadku wypadÅ‚o na CouchDB.\nInstalacja Instalacja na Debianie jest banalna i sprowadza siÄ™ do:\napt-get install -y couchdb TADAM! Mamy dziaÅ‚ajÄ…ce CouchDB. DomyÅ›lnie baza nasÅ‚uchuje na adresie 127.0.0.1 i porcie 5984.\nDodatkowo Couch posiada webowy interfejs (zwany Futon\u0026rsquo;em) zarzÄ…dzajÄ…cy dostÄ™pny na tym samym porcie pod adresem, np. http://127.0.0.1:5984/_utils/\nOptymalizacja NODELAY W moim przypadku CouchDB sÅ‚uÅ¼y do przechowywania zarÃ³wno bardzo wielu maÅ‚ych plikÃ³w, jak i kilku caÅ‚kiem sporych. W przypadku bardzo maÅ‚ych plikÃ³w CouchDB w wersji 0.11 czeka z wysÅ‚aniem odpowiedzi od razu bo byÄ‡ moÅ¼e uda siÄ™ \u0026ldquo;dorzuciÄ‡ coÅ› jeszcze\u0026rdquo;. Takie zachowanie moÅ¼e powodowaÄ‡ opÃ³Åºnienia przy pobieraniu maÅ‚ych plikÃ³w, warto wiÄ™c zmieniÄ‡ w pliku /etc/couchdb/local.iniÂ takÄ… opcjÄ™:\n[httpd] socket_options = [{nodelay, true}] Ustawienie opcji TCP NODELAY wyÅ‚Ä…czy opÃ³Åºnienie przy wysyÅ‚aniu maÅ‚ych plikÃ³w.\nIdentyfikatory Warto zastanowiÄ‡ siÄ™ nad dÅ‚ugoÅ›ciÄ… i schematem identyfikatorÃ³w dla rekordÃ³w. DomyÅ›lnie majÄ… one 32 bajty co przy maÅ‚ej liczbie elementÃ³w w bazie jest mocnÄ… przesadÄ…. Rozmiar identyfikatorÃ³w znacznie wpÅ‚ywa na rozmiar bazy i jej wydajnoÅ›Ä‡ - dlatego czasem warto opracowaÄ‡ wÅ‚asny schemat generowanych identyfikatorÃ³w. PrzykÅ‚adowo jeÅ›li identyfikator bÄ™dzie generowany z cyfr oraz duÅ¼ych i maÅ‚ych liter to dla 3 znakÃ³w moÅ¼emy wygenerowaÄ‡ identyfikatory dla ponad 260 tys. elementÃ³w, dla 4 znakÃ³w juÅ¼ ponad 14 milionÃ³w co powinno wystarczyÄ‡ dla Å›redniej wielkoÅ›ci bazy.\nUstawienia bezpieczeÅ„stwa TrochÄ™ mnie zaskoczyÅ‚o podejÅ›cie do bezpieczeÅ„stwa w bazie CouchDB - domyÅ›lnie po instalacji baza dziaÅ‚a w trybie Admin Party, czyli kaÅ¼da osoba ktÃ³ra wejdzie do zarzÄ…dzania bez logowania ma uprawnienia administratora ðŸ˜„\nMnie ten stan rzeczy nie bardzo odpowiadaÅ‚ wiÄ™c:\n odpalamy interfejs zarzÄ…dzajÄ…cy - Futon i w prawym dolnym rogu szukamy tekstu: \u0026ldquo;Welcome to Admin Party! Everyone is admin. Fix this\u0026rdquo; - klikamy na \u0026ldquo;Fix this\u0026rdquo;, w okienku ktÃ³re siÄ™ pojawi podajemy login i hasÅ‚o administratora.\n  Po ustawieniu konta administratora dalsze musimy zadbaÄ‡ o ustawienie odpowiednich uprawnieÅ„ dla kaÅ¼dej nowo tworzonej bazy, czyli bazy tworzÄ… siÄ™ dostÄ™pem dla wszystkich ale moÅ¼emy ograniczyÄ‡ np. zapis/odczyt dla pewnych grup uÅ¼ytkownikÃ³w.\nZabezpieczenie bazy uÅ¼ytkownikÃ³w Po ustawieniu pierwszego uÅ¼ytkownika kolejna rzecz, o ktÃ³rÄ… powinniÅ›my zadbaÄ‡ do dostÄ™pna dla kaÅ¼dego do odczytu baza uÅ¼ytkownikÃ³w. Najlepiej gdy tylko administratorzy bÄ™dÄ… mieli do niej dostÄ™p. By to osiÄ…gnÄ…Ä‡:\n w Futonie wchodzimy do bazy _users i klikamy przycisk \u0026ldquo;Security\u0026rdquo; na gÃ³rze strony, w okienku ktÃ³re siÄ™ pojawi w polu Readers -\u0026gt; Roles (pole na samym dole) wpisujemy [\u0026quot;admin\u0026quot;]  Od teraz tylko administratorzy majÄ… dostÄ™p do bazy _users.\nUstawienie bazy jako tylko do odczytu To co chciaÅ‚em osiÄ…gnÄ…Ä‡ korzystajÄ…c z CouchDB to jakieÅ› repozytorium, do ktÃ³rego wrzucaÄ‡ mogÄ… wybraÅ„cy a czytaÄ‡ wszyscy (np. taki CDN dla stronki itp) ale otrzymanie takiego rezultatu jest nieco\u0026hellip; nieintuicyjne. By to osiÄ…gnÄ…Ä‡:\n w bazie ktÃ³rÄ… chcemy ustawiÄ‡ jako tylko do odczytu wchodzimy w Security i w polu Admin Roles (drugie z gÃ³ry) wpisujemy [\u0026quot;admin\u0026quot;]Â - to zablokuje dostÄ™p do panelu Security i moÅ¼liwoÅ›ci modyfikowania design dokumentÃ³w, nadal moÅ¼liwe jest jednak dodawanie, modyfikowani i kasowanie dokumentÃ³w,\n by zablokowaÄ‡ dostÄ™p do zapisu w CouchDB trzeba wykorzystaÄ‡ funkcjÄ™Â validate_doc_update ktÃ³ra bÄ™dzie wywoÅ‚ywana przy kaÅ¼dej prÃ³bie dostÄ™pu do pojedynczego dokumentu, by z niej skorzystaÄ‡ tworzymy nowy pusty dokument, zmieniamy pole _id dokumentu naÂ _design/auth dodajemy pole nazwane language z wartoÅ›ciÄ… javascript dodajemy kolejne pole nazwaneÂ validate_doc_update z wartoÅ›ciÄ…:  function(newDoc, oldDoc, userCtx) { if (userCtx.roles.indexOf(\u0026#39;_admin\u0026#39;) !== -1) { return; } else { throw({forbidden: \u0026#39;Nie jesteÅ› administratorem!\u0026#39;}); } }  zapisujemy dokument klikajÄ…c na \u0026ldquo;Save Document\u0026rdquo;\n  ","href":"/2012/06/couchdb-instalacja-i-wstepna-konfiguracja/","title":"CouchDB - Instalacja i wstÄ™pna konfiguracja"},{"content":"UÅ¼ywam LVM\u0026rsquo;a zarÃ³wno na desktopie jak i wielu serwerach bo bardzo podoba mi siÄ™ moÅ¼liwoÅ›Ä‡ powiÄ™kszenia akurat tej partycji, na ktÃ³rej brakuje miejsca. O ile pamiÄ™tam jak powiÄ™kszyÄ‡ partycjÄ™ XFS (xfs_growfs /punkt/montowania) to zawsze mam problem jak to zrobiÄ‡ na EXT3/4, wiÄ™c notujÄ™.\nPowiÄ™kszenie wolumenu LVM (np. o 10 gigabajtÃ³w):\nlvextend -L+10G /dev/vggroup/vol ZwiÄ™kszenie rozmiaru systemu plikÃ³w do nowego rozmiaru wolumenu:\nresize2fs /dev/vggroup/vol PowyÅ¼sze polecenie moÅ¼na wykonaÄ‡ na zamontowanym zasobie - online.\n","href":"/2012/06/dynamiczna-zmiana-rozmiaru-partycji-ext4-na-lvmie/","title":"Dynamiczna zmiana rozmiaru partycji EXT4 na LVMâ€™ie"},{"content":"W tym poÅ›cie nie rozpiszÄ™ siÄ™ zbytnio - wrzucam tylko config od ktÃ³rego zaczynam konfiguracjÄ™ nginx\u0026rsquo;a.\nuser www-data; worker_processes 4; pid /var/run/nginx.pid; events { worker_connections 1024; ## zaakceptuj tak duÅ¼o poÅ‚Ä…czeÅ„ jak to moÅ¼liwe  multi_accept on; ## epoll jest preferowany na jajkach od 2.6  ## http://www.kegel.com/c10k.html#nb.epoll  use epoll; } http { include /etc/nginx/mime.types; default_type application/octet-stream; access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; ## opcje TCP  sendfile on; tcp_nopush on; tcp_nodelay on; ## maksymalny rozmiar zapytnia  client_max_body_size 10m; ## timeout\u0026#39;y  client_body_timeout 60; client_header_timeout 60; keepalive_timeout 10; send_timeout 60; ## kompresja  gzip on; gzip_static on; gzip_vary on; gzip_disable \u0026#34;msie6\u0026#34;; gzip_comp_level 1; gzip_proxied any; gzip_buffers 16 8k; gzip_min_length 50; gzip_types text/plain text/css application/json application/x-javascript application/javascript text/javascript application/atom+xml application/xml application/xml+rss text/xml image/x-icon text/x-js application/xhtml+xml; ## bezpieczeÅ„stwo  ## security by obscurity - ukrywamy wersjÄ™ nginx\u0026#39;a  server_tokens off; ignore_invalid_headers on; ## resetuj zbyt dÅ‚ugie poÅ‚Ä…czenia - powinno pomÃ³c na slowlorisa  reset_timedout_connection on; ## wÅ‚Ä…czenie ochrony przed clickjackingiem - uruchamiam to per vhost  ## https://developer.mozilla.org/en/The_X-FRAME-OPTIONS_response_header  #add_header X-Frame-Options SAMEORIGIN;  ## potrzebne zeby zbudowac mape ponizej  map_hash_bucket_size 256; ## blacklist\u0026#39;a botÃ³w i referer\u0026#39;Ã³w  include blacklist.conf; ##  # jeÅ›li poÅ‚Ä…czenie na HTTPS\u0026#39;a to ustawiamy zmiennÄ… by mogÅ‚o byÄ‡ obsÅ‚uÅ¼one  ##  map $scheme $server_https { default off; https on; } include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } No i jeszcze zawartoÅ›Ä‡ blacklist.conf - na poczÄ…tek wystarczy a moÅ¼na rozszerzyÄ‡ pod siebie:\n## blokowanie agentÃ³w map $http_user_agent $bad_bot { default 0; libwww-perl 1; ~(?i)(httrack|htmlparser|libwww) 1; } ## blokowanie refererÃ³w map $http_referer $bad_referer { default 0; ~(?i)(babes|click|diamond|forsale|girl|jewelry|love|nudit|organic|poker|porn|poweroversoftware|sex|teen|webcam|zippo|casino|replica) 1; } ","href":"/2012/06/nginx-moj-domyslny-config/","title":"Nginx - mÃ³j domyÅ›lny config"},{"content":"JeÅ›li po aktualizacji firmware na swoim firewall\u0026rsquo;u do wersji MR3 natrafisz na komunikat Warning: SQL Logging is not enabled przy dostÄ™pie do logÃ³w to prawdopodobnie musisz zmieniÄ‡ ÅºrÃ³dÅ‚o logÃ³w dla interfejsu gui. PoniÅ¼ej polecenie CLI i moÅ¼liwe opcje:\nconfig log gui set logdevice {memory | disk | fortianalyzer} end Ja potrzebowaÅ‚em ustawiÄ‡ tÄ™ opcjÄ™ na fortianalyzer by uzyskaÄ‡ dostÄ™p do moich logÃ³w.\n","href":"/2012/04/fortigate-warning-sql-logging-is-not-enabled/","title":"Fortigate: Warning: SQL Logging is not enabled"},{"content":"ChciaÅ‚em zaimportowaÄ‡ mÃ³j certyfikat self-signed do Nokii E72 by nie krzyczaÅ‚a przy sprawdzaniu poczty. PotrzebowaÅ‚em certyfikatu w formacie DER, a miaÅ‚em w PEM - chwilÄ™ szukaÅ‚em jak dokonaÄ‡ konwersji, wiÄ™c ku pamiÄ™ci zapisujÄ™ kilka gotowych poleceÅ„:\nKonwersja certyfikatu z PEM na DER openssl x509 -in in.crt -inform PEM -out out.crt -outform DER Konwersja certyfikatu z DER na PEM openssl x509 -in in.crt -inform DER -out out.crt -outform DER Konwersja klucza z formatu PEM na DER openssl rsa -in in.crt -inform PEM -out out.crt -outform DER Konwersja klucza z formatu DER na PEM openssl rsa -in in.crt -inform DER -out out.crt -outform PEM Po konwersji certyfikat w formacie DER wystarczy wrzuciÄ‡ na kartÄ™ i otworzyÄ‡ z menadÅ¼era plikÃ³w, zainstalowaÄ‡.\n","href":"/2012/04/konwersja-formatu-certyfikatu-dla-telefonow-nokia/","title":"Konwersja formatu certyfikatu dla telefonÃ³w Nokia"},{"content":"Czasami odpalam klona jakiegoÅ› systemu by pÃ³Åºniej po drobnych zmianach uczyniÄ‡ go osobnym bytem. Jednym z krokÃ³w po odtworzeniu systemu jest wygenerowanie nowego zestawu kluczy dla serwera OpenSSH (by mÃ³j klient ssh nie siaÅ‚ warning\u0026rsquo;ami). MoÅ¼na to wykonaÄ‡ tak:\nNajpierw kasujemy obecne klucze:\nrm /etc/ssh/ssh_host_* Teraz generujemy nowe:\ndpkg-reconfigure openssh-server I na koniec restartujemy usÅ‚ugÄ™ by zaÅ‚adowaÄ‡ nowy zestaw kluczy (nie powinno to zerwaÄ‡ obecnej sesji, ale dla pewnoÅ›ci lepiej zadanie odpaliÄ‡ w screen\u0026rsquo;ie):\nservice ssh restart JeÅ¼eli zmienialiÅ›my klucze dla obecnego hosta to konieczne moÅ¼e byÄ‡ usuniÄ™cie nieaktualnego wpisu z ~/.ssh/known_hosts.\n","href":"/2012/02/ponowne-wygenerowanie-kluczy-serwera-openssh/","title":"Ponowne wygenerowanie kluczy serwera OpenSSH"},{"content":"Aby wybrane systemy DomU startowaÅ‚y automatycznie po restarcie hypervisora naleÅ¼y podlinkowaÄ‡ ich pliki konfiguracyjne w katalogu /etc/xen/auto po uprzednim jego utworzeniu. PrzykÅ‚adowo:\nmkdir /etc/xen/auto ln -s /etc/xen/example.cfg /etc/xen/auto/example.cfg Od teraz DomU example bÄ™dzie startowaÄ‡ automatycznie.\n","href":"/2012/02/xen-ustawienie-autostartu-domu/","title":"Xen - ustawienie autostartu DomU"},{"content":"JeÅ¼eli zdecydowaliÅ›my siÄ™ na systemu DomU w obrazach to moÅ¼emy korzystaÄ‡ z live migration. By uruchomiÄ‡ jej obsÅ‚ugÄ™, trzeba w pliku /etc/xen/xend-config.sxpÂ odkomentowaÄ‡Â odpowiednie linie iÂ ustawiÄ‡Â adres IP:\n(xend-relocation-server yes) (xend-relocation-port 8002) (xend-relocation-address \u0026#39;10.0.10.91\u0026#39;) Wykonywanie migracji xm migrate --live nazwa-domu nazwa.lub.ip.zdalnego.hosta ","href":"/2012/02/xen-wlaczenie-live-migration/","title":"Xen - WÅ‚Ä…czenie Live Migration"},{"content":"Ostatnio pisaÅ‚em o konfiguracji Dom0 - dzisiaj napiszÄ™ o uruchamianiu DomU.\nDo instalacji DomU wykorzystujÄ™ skrypty z pakietu xen-tools, moÅ¼na go zainstalowaÄ‡ poleceniem:\napt-get install xen-tools OczywiÅ›cie aby wszystko dziaÅ‚aÅ‚o fajnie musimy ustawiÄ‡ kilka domyÅ›lnych opcji, robimy to edytujÄ…c plikÂ /etc/xen-tools/xen-tools.conf. Lecimy po kolei:\n# Virtual machine disks are created as logical volumes in # volume group \u0026#39;universe\u0026#39; (hint: LVM storage is much faster # than file) lvm = universe OsobiÅ›cie korzystam z LVM\u0026rsquo;a ktÃ³ry zgodnie z hint\u0026rsquo;em jest znacznie szybszy od plikÃ³w obrazÃ³w. Daje do tego bardzo wygodne moÅ¼liwoÅ›Ä‡ w zarzÄ…dzaniu rozmiarami wolumenÃ³w przydzielonych DomU, moÅ¼liwoÅ›Ä‡ tworzenia snapshotÃ³w (np. na potrzeby backupu). Postawienie LVM\u0026rsquo;a w skrÃ³cie wyglÄ…da tak:\napt-get install lvm2 pvcreate /dev/sdb1 # to tylko przyklad - samodzielnie ustal partycje :) vgcreate universe /dev/sdb1 vgchange -a y universe PozostaÅ‚e opcje i bardziej skomplikowane przypadki tworzenia LVM\u0026rsquo;a moÅ¼na znaleÅºÄ‡ tutaj:Â http://tldp.org/HOWTO/LVM-HOWTO/commontask.html\nUstalamy domyÅ›lne parametry dla tworzonych DomU - oczywiÅ›cie zawsze moÅ¼emy je nadpisaÄ‡ poprzez podanie innej wartoÅ›ci w linii poleceÅ„, np. -memory 4Gb:\nsize = 8Gb # Disk image size. memory = 512Mb # Memory size swap = 1Gb # Swap size xfs_options = noatime,nodiratime DomyÅ›lnie nie ma konfiguracji dla systemu plikÃ³w ext4, wystarczy dodaÄ‡ w odpowiednich miejscach:\nfs = ext4 ext4_options = noatime,nodiratime,errors=remount-ro Ustawienia sieci:\n# Default gateway and netmask for new VMs gateway = 10.0.10.1 netmask = 255.255.255.0 broadcast = 192.168.3.255 Warto ustawiÄ‡ domyÅ›lne ustawienia sieci - choÄ‡ ja osobiÅ›cie wolÄ™ zawsze podawaÄ‡ te parametry rÄ™cznie.\n# When creating an image, interactively setup root password passwd = 1 DziÄ™ki tej opcji na koniec tworzenia DomU zostaniemy poproszeni o podanie hasÅ‚a dla root\u0026rsquo;a.\n# This is most useful on 64 bit host machines, for other systems it # doesn\u0026#39;t need to be used. # arch = amd64 DomyÅ›lna architektura dla tworzonych DomU - moÅ¼na przedefiniowaÄ‡ z linii poleceÅ„.\n# Uncomment if you wish newly created images to boot once they\u0026#39;ve been # created. # boot = 0 Ja nie lubiÄ™ gdy DomU uruchamiajÄ… siÄ™ automatycznie po przygotowaniu bo czÄ™sto rÄ™cznie modyfikujÄ™ konfiguracjÄ™ i dopiero uruchamiam wirtualkÄ™ - stÄ…d 0.\n# Let xen-create-image use pygrub, so that the grub from the VM is used, # which means you no longer need to store kernels outside the VMs. # Keeps things very flexible. pygrub=1 role = pygrub, myconfig Ta opcja powoduje Å¼e DomU bÄ™dzie posiadaÄ‡ wÅ‚asny kernel, ktÃ³ry moÅ¼e byÄ‡ aktualizowany niezaleÅ¼nie od kernela hypervisora. WÅ‚Ä…czenie tej opcji wymaga dodatkowej roli (pygrub) ktÃ³ra zainstaluje wymagane pakiety, etc. Niestety roli tej nie ma w standardowej instalacji wiÄ™c zamieszczam poniÅ¼ej plik znaleziony w sieci. Edytujemy plikÂ /etc/xen-tools/role.d/pygrub:\n#!/bin/sh # # Configure the new image to be suitable for booting via pygrub # # Wejn # -- # http://wejn.org/ # prefix=$1 # # Source our common functions - this will let us install a Debian package. # if [ -e /usr/lib/xen-tools/common.sh ]; then . /usr/lib/xen-tools/common.sh else echo \u0026#34;Installation problem\u0026#34; fi # # Update APT lists. # chroot ${prefix} /usr/bin/apt-get update # # Install the packages # set -e installDebianPackage ${prefix} perl installDebianPackage ${prefix} libklibc installDebianPackage ${prefix} klibc-utils installDebianPackage ${prefix} initramfs-tools installDebianPackage ${prefix} linux-image-2.6-xen-amd64 #chroot ${prefix} /usr/bin/dpkg -l | grep linux-image-xen-amd64 #if [ $? -ne 0 ]; then # installDebianPackage ${prefix} linux-image-2.6-xen-686 #else # installDebianPackage ${prefix} linux-image-2.6-xen-amd64 #fi # Force initrd if none exists echo ${prefix}/boot/initrd* | grep -q 2\\\\.6 if [ $? -ne 0 ]; then chroot ${prefix} update-initramfs -c -k `ls -1 ${prefix}/lib/modules/ | head -n 1` fi # Generate grub menu.lst LNZ=`basename \\`ls -1 ${prefix}/boot/vmlinuz*|tail -n 1\\`` RD=`basename \\`ls -1 ${prefix}/boot/initrd*|tail -n 1\\`` mkdir -p ${prefix}/boot/grub cat - \u0026lt; ${prefix}/boot/grub/menu.lst default 0 timeout 1 title Debian root (hd0,0) kernel /boot/$LNZ root=/dev/xvda2 ro initrd /boot/$RD EOF JeÅ¼eli na DomU mamy zamiar gÅ‚Ã³wny system plikÃ³w sformatowaÄ‡ jako XFS to pygrub nie bÄ™dzie potrafiÅ‚ siÄ™ z niego zbootowaÄ‡ - dobrze za to dziaÅ‚a z ext3 i ext4.\nRola myconfig do wstÄ™pnej konfiguracji systemu DomU Rola myconfig to mÃ³j wÅ‚asny zestaw skryptÃ³w, ktÃ³ry konfiguruje DomU w taki sposÃ³b jak lubiÄ™ - bym nie musiaÅ‚ kaÅ¼dorazowo traciÄ‡ czasu na ustawienie nowego systemu pod siebie. ZawartoÅ›Ä‡ poniÅ¼ej:\n#!/bin/sh # # Configure DomU to my needs # # Tomasz Gagor # -- # https://gagor.pl/ # prefix=$1 # # Source our common functions - this will let us install a Debian package. # if [ -e /usr/lib/xen-tools/common.sh ]; then . /usr/lib/xen-tools/common.sh else echo \u0026#34;Installation problem\u0026#34; fi # # Moje ulubione zrodla w sources.list # echo \u0026#34;deb http://ftp.pl.debian.org/debian/ squeeze main non-free contrib\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb-src http://ftp.pl.debian.org/debian/ squeeze main non-free contrib\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb http://security.debian.org/ squeeze/updates main contrib non-free\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb-src http://security.debian.org/ squeeze/updates main contrib non-free\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb http://ftp.pl.debian.org/debian/ squeeze-updates main non-free contrib\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb-src http://ftp.pl.debian.org/debian/ squeeze-updates main non-free contrib\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb http://backports.debian.org/debian-backports squeeze-backports main contrib non-free\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb http://packages.dotdeb.org stable all\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list echo \u0026#34;deb-src http://packages.dotdeb.org stable all\u0026#34; \u0026gt; ${prefix}/etc/apt/sources.list # Update APT lists. chroot ${prefix} /usr/bin/apt-get update # # Zainstaluj ulubione paczki # set -e installDebianPackage ${prefix} ssh installDebianPackage ${prefix} vim installDebianPackage ${prefix} mc installDebianPackage ${prefix} bash-completion installDebianPackage ${prefix} ethtool installDebianPackage ${prefix} less installDebianPackage ${prefix} screen installDebianPackage ${prefix} postfix installDebianPackage ${prefix} apticron # # Usun paczki ktorych nie potrzebuje lub nie lubie # # PPP removeDebianPackage ${prefix} pppconfig removeDebianPackage ${prefix} pppoeconf removeDebianPackage ${prefix} pppoe removeDebianPackage ${prefix} ppp removeDebianPackage ${prefix} libpcap0.7 # edytory removeDebianPackage ${prefix} nano removeDebianPackage ${prefix} ed removeDebianPackage ${prefix} nvi # inne #removeDebianPackage ${prefix} tasksel tasksel-data #removeDebianPackage ${prefix} pciutils #removeDebianPackage ${prefix} fdutils #removeDebianPackage ${prefix} cpio # skypt automatyczne czyszczacy cache apta # zmniejsza rozmiar backupow echo \u0026#39;#!/bin/bash\u0026#39; \u0026gt; ${prefix}/etc/cron.daily/apt-get-clean.sh echo \u0026#39;apt-get clean\u0026#39; \u0026gt;\u0026gt; ${prefix}/etc/cron.daily/apt-get-clean.sh chmod +x ${prefix}/etc/cron.daily/apt-get-clean.sh # ethtool - zwieksza wydajnosc wirtualizowanych urzadzen sieciowych echo \u0026#34;post-up ethtool -K eth0 tx off\u0026#34; \u0026gt;\u0026gt; ${prefix}/etc/network/interfaces # konfiguracja vima tak jak lubie chroot ${prefix} /usr/sbin/update-alternatives --set editor /usr/bin/vim.basic cat \u0026lt; ${prefix}/etc/vim/vimrc.local syntax on set background=dark if has(\u0026#34;autocmd\u0026#34;) filetype plugin indent on endif set showmatch VIMRC # konfiguracja bash-autocompletion cat \u0026lt;\u0026gt; ${prefix}/etc/bash.bashrc # enable bash completion in interactive shells if [ -f /etc/bash_completion ]; then . /etc/bash_completion fi BASHCOMP echo \u0026#39;source /etc/bash.bashrc\u0026#39; \u0026gt;\u0026gt; ${prefix}/etc/profile # instalacja i konfiguracja postfixa # poniÅ¼ej wpisz wÅ‚asny alias dla hostmastera echo \u0026#34;root: hostmaster@mojadomena.pl\u0026#34; \u0026gt;\u0026gt; ${prefix}/etc/aliases chroot ${prefix} /usr/bin/newaliases chroot ${prefix} /usr/sbin/postconf -e \u0026#34;myhostname = `cat ${prefix}/etc/hostname`\u0026#34; chroot ${prefix} /usr/sbin/postconf -e \u0026#34;mydestination = `cat ${prefix}/etc/hostname`, `cat ${prefix}/etc/hostname`.in.veracomp.pl, localhost.localdomain, localhost\u0026#34; chroot ${prefix} /usr/sbin/postconf -e \u0026#39;relayhost = mail.example.pl\u0026#39; chroot ${prefix} /usr/sbin/postconf -e \u0026#39;myorigin = /etc/mailname\u0026#39; # dostosuj domenÄ™ pod siebie echo \u0026#34;`cat ${prefix}/etc/hostname`.internal.example.pl\u0026#34; \u0026gt; ${prefix}/etc/mailname # konfiguracja locales chroot ${prefix} /usr/sbin/locale-gen # konfiguracja timezone echo \u0026#39;Europe/Warsaw\u0026#39; \u0026gt; ${prefix}/etc/timezone chroot ${prefix} dpkg-reconfigure -f noninteractive tzdata # konfiguracja mc i authorized_keys ssh takie jak na dom0 cp -r /root/.mc/ ${prefix}/root/ cp -r /root/.ssh/ ${prefix}/root/ ","href":"/2012/02/xen-na-squeeze-instalowanie-i-konfiguracja-hostow-gosci-domu/","title":"Xen na Squeeze - Instalowanie i konfiguracja hostÃ³w goÅ›ci (DomU)"},{"content":"Bardzo udany przepis - gdzieÅ› musiaÅ‚em go udokumentowaÄ‡ by nie zginÄ…Å‚ :)\nSkÅ‚adniki  1 duÅ¼a kaczka (2-2,5 kg) 4 zÄ…bki czosnku 1 kg jabÅ‚ek (w zaleÅ¼noÅ›ci od kaczki mogÄ… wystarczyÄ‡ 3 wiÄ™ksze sztuki) sok z cytryny do skropienia jabÅ‚ek 200 g suszonej Å¼urawiny pÃ³Å‚ butelki czerwonego wytrawnego wina rozmaryn 4 Å‚yÅ¼ki miodu cynamon kardamon sÃ³l pieprz  SposÃ³b wykonania KaczkÄ™ nacieramy solÄ…, pieprzem, rozmarynem oraz roztartym czosnkiem i pozostawiamy na min. 3-4 godziny w lodÃ³wce (moÅ¼na teÅ¼ przygotowaÄ‡ jÄ… wieczorem by byÅ‚a gotowa na nastÄ™pny dzieÅ„).\nJabÅ‚ka obieramy, usuwamy z nich nasiona i kroimy w Å›redniej wielkoÅ›ci kostkÄ™. Do jabÅ‚ek dodajemy Å¼urawinÄ™, skrapiamy caÅ‚oÅ›Ä‡ sokiem z cytryny, po czym dodajemy cynamon, kardamon i miÃ³d.\nPo wyjÄ™ciu z lodÃ³wki wypeÅ‚niamy wnÄ™trze kaczki wczeÅ›niej przygotowanym farszem i zaszywamy. Do rozgrzanego piekarnika (170-190 stopni) wstawiamy kaczkÄ™ umieszczonÄ… w naczyniu pod przykryciem. Po okoÅ‚o 1,5 godziny wyjmujemy kaczkÄ™ z piekarnika i z obu stron nacinamy skÃ³rÄ™ pomiÄ™dzy udami a korpusem - umoÅ¼liwi to wypÅ‚yniÄ™cie zebranego pod skÃ³rÄ… tÅ‚uszczu. Co 30 minut naleÅ¼y kaczkÄ™ podlewaÄ‡ powstaÅ‚ym sosem.\nCzas pieczenia kaczki zaleÅ¼y od jej wagi. WaÅ¼Ä…ca 1,5-2 kg sztukÄ™ naleÅ¼y piec od 90 minut do 2 godzin. Na godzinÄ™ przed koÅ„cem pieczenia wlewamy czerwone wino (ok. pÃ³Å‚ butelki). Na ostatnie 20 minut zdejmujemy pokrywÄ™ i przeÅ‚Ä…czamy piekarnik na zapiekanie od gÃ³ry by skÃ³rka mogÅ‚a siÄ™ zrumieniÄ‡.\nWynik CaÅ‚kiem puÅ›ciÅ‚o moje kiepskie szycie ale smaku to nie popsuÅ‚o :)\nÅ¹rÃ³dÅ‚o: Ugotowani\n","href":"/2012/02/kaczka-pieczona-z-zurawina-i-jablkami/","title":"Kaczka pieczona z Å¼urawinÄ… i jabÅ‚kami"},{"content":"Po co mi to? Wiele razy miaÅ‚em do czynienia z serwerami na ktÃ³rych dziaÅ‚aÅ‚o kilka/kilkanaÅ›cie usÅ‚ug rÃ³wnoczeÅ›nie, np. Apache (kilka stronek, webmail, phpmyadmin, itp), Postfix/Exim (poczta i Å¼eby byÅ‚o fajnie to na kontach systemowych), Samba (jakieÅ› zasoby dla pracownikÃ³w), MySQL (baza dla stronek), PostgreSQL (bo jedna stronka potrzebowaÅ‚a), itd\u0026hellip;. Przy takiej konfiguracji pomijane sÄ… kwestie separacji usÅ‚ug zewnÄ™trznych/wewnÄ™trznych - no ale firma/instytucja maÅ‚a nie ma sensu kasy na 3 kolejne serwery wydawaÄ‡ skoro dziaÅ‚a\u0026hellip;.\nTaka konfiguracja nie jest zbyt bezpieczna i ma wiele wad:\n ciÄ™Å¼ko backupowaÄ‡ tak duÅ¼y system w postaci obrazÃ³w, a odzyskiwanie z backupÃ³w caÅ‚oÅ›ci bÄ™dzie trwaÄ‡ wieki, sÅ‚aba separacja usÅ‚ug uÅ‚atwia ataki na zasoby wewnÄ™trzne (np. dziura w stronie moÅ¼e pozwoliÄ‡ na dostÄ™p do plikÃ³w z Samby), trudno rozgraniczyÄ‡ zasoby sprzÄ™towe (procesor, pamiÄ™Ä‡) konkretnym usÅ‚ugom, trudno jest migrowaÄ‡ usÅ‚ugi na inne serwery.  Wirtualizacja pozwala na zminimalizowanie tych problemÃ³w:\n backupowaÄ‡ moÅ¼na pojedyncze usÅ‚ugi (dziaÅ‚ajÄ…ce na rÃ³Å¼nych maszynach wirtualnych) np. z pomocÄ… snapshotÃ³w z minimalnym czasem przerwy w dziaÅ‚aniu, oddzielenie usÅ‚ug w osobnych maszynach wirtualnych pozwala \u0026ldquo;zamknÄ…Ä‡\u0026rdquo; napastnika w przypadku kompromitacji ktÃ³rejÅ› z usÅ‚ug (choÄ‡ zdarzaÅ‚y siÄ™ bÅ‚Ä™dy w implementacji maszyn wirtualnych pozwalajÄ…ce \u0026ldquo;wyskoczyÄ‡\u0026rdquo; z wirtualki), moÅ¼emy przydzielaÄ‡ pamiÄ™Ä‡ i konkretne rdzenie procesora danym maszynom wirtualnym, live migration pozwala w locie przenieÅ›Ä‡ maszynÄ™ wirtualnÄ… na inny serwer.  Xen jest szczegÃ³lnie dobrym wyborem jeÅ¼eli zamierzamy wirtualizowaÄ‡ systemy Linux\u0026rsquo;owe. MoÅ¼na je uruchamiaÄ‡ w trybie para-wirtualizacji, ktÃ³ra w mniejszym stopniu niÅ¼ peÅ‚na wirtualizacja obciÄ…Å¼a CPU.\nW trybie peÅ‚nej wirtualizacji moÅ¼na zainstalowaÄ‡ praktycznie dowolny system (rÃ³wnieÅ¼ Windows) choÄ‡ jest to tryb mniej wydajny.\nUwaga Post ten jest prÃ³bÄ… zebrania w jednym miejscu rÃ³Å¼nych moich doÅ›wiadczeÅ„ z Xen\u0026rsquo;em ale nie miaÅ‚em czasu na testowÄ… instalacjÄ™ wedÅ‚ug poniÅ¼szego tekstu, wiÄ™c mogÅ‚em gdzieÅ› coÅ› zamieszaÄ‡. Dlatego proszÄ™ o komentowanie jeÅ›li coÅ› nie zadziaÅ‚a.\nKonfiguracja hypervisor\u0026rsquo;a (Dom0) JeÅ¼eli zastanawiasz siÄ™ czy stawiaÄ‡ Xen\u0026rsquo;a na 32 czy 64-bitowym systemie to wybierz 64-bit. Na systemie 64-bitowym moÅ¼na uruchamiaÄ‡ systemy goÅ›ci 32 i 64-bitowe (w przeciwieÅ„stwie do hypervisora 32-bitowego) i nie bÄ™dzie problemÃ³w z obsÅ‚ugÄ… duÅ¼ej iloÅ›ci pamiÄ™ci.\nZaczynamy od instalacji hypervisor\u0026rsquo;a, zmodyfikowanej do dziaÅ‚ania z Xen wersji jÄ…dra i pakietu podstawowych narzÄ™dzi. Wszystko co potrzebne jest w jednym metapakiecie (xen-linux-system ale gdyby nie chciaÅ‚ iÅ›Ä‡ to lepiej wskazaÄ‡ konkretnÄ… wersjÄ™):\napt-get install xen-linux-system-2.6-xen-amd64 By mieÄ‡ dostÄ™p do peÅ‚nej wirtualizacji (np. by uruchamiaÄ‡ systemy Windows) naleÅ¼y doinstalowaÄ‡ jeszcze jednÄ… paczkÄ™ (jeÅ›li nie potrzebujemy to zawsze moÅ¼na doinstalowaÄ‡ pÃ³Åºniej):\napt-get install xen-qemu-dm-4.0 Squeeze domyÅ›lnie korzysta z GRUB\u0026rsquo;a 2 i niezbyt przeze mnie lubianej metody wykrywania systemÃ³w, ktÃ³ra po zainstalowaniu jajka dla Xen\u0026rsquo;a nadal bÄ™dzie domyÅ›lnie startowaÄ‡ podstawowy kernel. By to zmieniÄ‡ proponujÄ™ przenieÅ›Ä‡ wykrywanie domyÅ›lnego systemu na pozycjÄ™ pÃ³ÅºniejszÄ… niÅ¼ Xen\u0026rsquo;a - zmieniamy nazwÄ™ pliku:\nmv /etc/grub.d/10_linux /etc/grub.d/21_linux Ponadto jeÅ¼eli zamierzamy instalowaÄ‡ DomU na LVM\u0026rsquo;ie to na pewno zainteresuje nas wyÅ‚Ä…czenie opcji OS prober by DomU nie byÅ‚y wykrywane jako zainstalowane lokalnie systemy (wyÅ‚Ä…czy to teÅ¼ wykrywanie Windowsa jeÅ›li jest zainstalowany na tej samej maszynie).\nBy wyÅ‚Ä…czyÄ‡ OS prober\u0026rsquo;a otwÃ³rz plik /etc/default/grub i dodaj na koÅ„cu:\n# Wylaczenie OS prober\u0026#39;a by nie wykrywac maszyn wirtualnych na # logicznych wolumenach LVM i nie pokazywac ich w menu grub\u0026#39;a GRUB_DISABLE_OS_PROBER=true JeÅ¼eli chcesz dodaÄ‡ jakieÅ› dodatkowe parametry przy bootowaniu Xen\u0026rsquo;a dodaj poniÅ¼sze zmienne w /etc/default/grubÂ (przypisane wartoÅ›ci nie sÄ… prawidÅ‚owe i jeÅ›li nic nie potrzebujesz dodawaÄ‡ to pomiÅ„ ten krok):\n# parametry dla wszystkich opcji startowych Xen\u0026#39;a (rowniez recovery) GRUB_CMDLINE_XEN=\u0026#34;something\u0026#34; # dodatkowe parametry dla opcji non-recovery GRUB_CMDLINE_XEN_DEFAULT=\u0026#34;something else\u0026#34; Po modyfikacji opcji gruba musimy wykonaÄ‡ aktualizacjÄ™ poleceniem:\nupdate-grub DomyÅ›lnym zachowaniem dom0 Xen\u0026rsquo;a przy wyÅ‚Ä…czaniu bÄ…dÅº restartowaniu jest prÃ³ba zahibernowania wszystkich dziaÅ‚ajÄ…cych domU. Gdy nie przewidzimy takiej sytuacji i nie mamy wystarczajÄ…cej iloÅ›ci wolnego miejsca w /var czÄ™sto proces ten koÅ„czy siÄ™ bÅ‚Ä™dami. ZdarzajÄ… siÄ™ teÅ¼ problemy z prawidÅ‚owÄ… obsÅ‚ugÄ… hibernacji po stronie systemÃ³w dziaÅ‚ajÄ…cych w domU, wtedy po uruchomieniu dom0 i prÃ³bie zaÅ‚adowania zapisanych stanÃ³w maszyn koÅ„czymy z wiszÄ…cymi wirtualkami.\nNa dobrÄ… sprawÄ™ rÃ³wnie dobrym zachowaniem byÅ‚oby wyÅ‚Ä…czenie wszystkich domU i zaczekanie aÅ¼ to nastÄ…pi a po starcie dom0 uruchomienie ich od zera. MoÅ¼e caÅ‚y proces bÄ™dzie trwaÄ‡ chwilÄ™ dÅ‚uÅ¼ej ale mamy za to wiÄ™kszÄ… pewnoÅ›Ä‡ Å¼e przejdzie bez niespodzianek. By ustawiÄ‡ takie zachowanie Xen\u0026rsquo;a edytujemy /etc/default/xendomains:\nXENDOMAINS_RESTORE=false XENDOMAINS_SAVE= Aby systemy domU miaÅ‚y dostÄ™p do sieci naleÅ¼y w pliku /etc/xen/xend-config.sxpÂ upewniÄ‡ siÄ™ Å¼e network-script ustawione jest na network-bridge.\n(network-script \u0026#39;network-bridge antispoof=yes\u0026#39;) Przy takim ustawieniu systemu domU bÄ™dÄ… korzystaÄ‡ z gÅ‚Ã³wnego interfejsu dom0 aby uzyskaÄ‡ dostÄ™p do sieci. Dla wielu bÄ™dzie to niezbyt optymalne rozwiÄ…zanie ale na poczÄ…tek wystarczy (niecierpliwi mogÄ… zerknÄ…Ä‡ do dokumentacji Xen\u0026rsquo;a aby sprawdziÄ‡ inne opcje XenNetworking).\nDodatkowa opcja antispoof=yes aktywuje firewall, ktÃ³ry uniemoÅ¼liwi systemom domU przypisywanie sobie adresÃ³w innych systemÃ³w domU. By to dziaÅ‚aÅ‚o w konfiguracji maszyny wirtualnej w definicji interfejsu (vif) naleÅ¼y przypisaÄ‡ adres IP danemu systemowi domU.\nNa moim systemie nie wszystkie skrypty dla konfiguracji sieci miaÅ‚y atrybut do wykonywania co skutkowaÅ‚o bÅ‚Ä™dami przy uruchamianiu domU (np. \u0026ldquo;missing vif-script, or network-script, in the Xen configuration file\u0026rdquo;). By temu zapobiec ustawmy wszystkim skryptom odpowiednie uprawnienia:\nchmod +x /etc/xen/scripts/* W pliku /etc/xen/xend-config.sxp moÅ¼na ponadto ustawiÄ‡ jak duÅ¼o pamiÄ™ci i procesorÃ³w rezerwujemy dla systemu dom0. IloÅ›Ä‡ pamiÄ™ci dla dom0 moÅ¼na ograniczyÄ‡ dodajÄ…c opcjÄ™ dom0_mem dla kernela w zmiennejÂ GRUB_CMDLINE_XEN w konfiguracji gruba.\nNiektÃ³rzy zalecajÄ… wyÅ‚Ä…czenie dom0-balloning (czyli zajmowania przez dom0 caÅ‚ej pozostaÅ‚ej pamiÄ™ci po uruchomieniu systemÃ³w domU), a zamiast tego przydzielenie minimalnej iloÅ›ci pamiÄ™ci, np. tak:\n(dom0-min-mem 1024) (enable-dom0-ballooning no) Ja osobiÅ›cie wolÄ™ pozostawiÄ‡ balloning wÅ‚Ä…czony - po co blokowaÄ‡ ram skoro nikt inny z niego nie skorzysta, a tak to przynajmniej jest wiÄ™cej na bufory dyskowe ðŸ˜‰\nUstawienie konsoli By mieÄ‡ dostÄ™p do wyjÅ›cia z GRUB\u0026rsquo;a, Xen hypervisor\u0026rsquo;a, kernela i getty poprzez VGA i konsolÄ™ naleÅ¼y dokonaÄ‡ zmian w plikuÂ /etc/default/grubÂ jak poniÅ¼ej:\nGRUB_SERIAL_COMMAND=\u0026#34;serial --unit=0 --speed=9600 --word=8 --parity=no --stop=1\u0026#34; GRUB_TERMINAL=\u0026#34;console serial\u0026#34; GRUB_TIMEOUT=5 GRUB_CMDLINE_XEN=\u0026#34;com1=9600,8n1 console=com1,vga\u0026#34; GRUB_CMDLINE_LINUX=\u0026#34;console=tty0 console=hvc0\u0026#34; A nastÄ™pnie w /etc/inittab aktualizujemy linijki:\n1:2345:respawn:/sbin/getty 38400 hvc0 2:23:respawn:/sbin/getty 38400 tty1 # NO getty on ttyS0! W ten sposÃ³b tty1 pokazuje wyjÅ›cie VGA, a hvc0 kosolÄ™. Standardowo po modyfikacji opcji gruba musimy wykonaÄ‡ aktualizacjÄ™ poleceniem:\nupdate-grub JeÅ›li nic nie skopaliÅ›my to po restarcie powinniÅ›my otrzymaÄ‡ hypervisora gotowego do uruchamiania DomU.\nÅ¹rÃ³dÅ‚a  http://wiki.debian.org/Xen  ","href":"/2012/02/xen-na-squeeze-instalacja-i-konfiguracja-hypervisora/","title":"Xen na Squeeze - instalacja i konfiguracja hypervisorâ€™a"},{"content":"JakiÅ› czas temu korzystaÅ‚em z preload\u0026rsquo;a ktÃ³ry sam uczyÅ‚ siÄ™ jakie aplikacje odpalam i te programy Å‚adowaÅ‚ juÅ¼ podczas startu - przewaÅ¼nie nieco spowalnia to start systemu ale gdy juÅ¼ siÄ™ zaÅ‚aduje to programy, ktÃ³re uruchamiam jako pierwsze startujÄ… \u0026ldquo;z kopa\u0026rdquo;. Od jakiegoÅ› czasu popularniejszy jest instalowany domyÅ›lnie w Ubuntu ureadahead - peÅ‚ni on podobnÄ… funkcjÄ™ jak preload.\nMoÅ¼na zmusiÄ‡ ureadahead do ponownego wygenerowania nowej listy programÃ³w wczytywanych przy starcie do cache a oto jak zrobiÄ‡:\n NaleÅ¼y skasowaÄ‡ pliki z rozszerzeniem pack w /var/lib/ureadahead/:  sudo rm /var/lib/ureadahead/*.pack MoÅ¼na ustawiÄ‡ autmatyczne logowanie. Restartujemy system. Szybko logujemy siÄ™ do systemu i uruchomiamy aplikacje, ktÃ³re chcemy aby szybciej startowaÅ‚y. Gdy wszystko siÄ™ juÅ¼ zaÅ‚aduje sprawdzamy czy zaÅ‚adowaÅ‚y siÄ™ wszystkie programy, na ktÃ³rych nam zaleÅ¼aÅ‚o, np.:  sudo ureadahead --dump | grep firefox 6.JeÅ¼eli nie zaÅ‚adowaÅ‚y siÄ™ wszystkie programy to w plikuÂ /etc/init/ureadahead.conf zwiÄ™kszamy wartoÅ›Ä‡ w linii:\npre-stop exec sleep 45 na np. 90 i wracamy do punktu 1.\n","href":"/2012/01/wstepne-ladowanie-programow-przy-starcie-z-ureadahead/","title":"WstÄ™pne Å‚adowanie programÃ³w przy starcie z ureadahead"},{"content":"Aby umoÅ¼liwiÄ‡ odwiedzajÄ…cym nasze strony cachowanie obrazkÃ³w (tak by nie musieli pobieraÄ‡ ich kaÅ¼dorazowo bo przecieÅ¼ nie zmieniajÄ… siÄ™ aÅ¼ tak czÄ™sto) konieczne jest ustawienie nagÅ‚Ã³wkÃ³w: Cache-Control, Expires dla odpowiednich typÃ³w plikÃ³w. W Apachem jest do tego dedykowany moduÅ‚ - mod_expires. W Debianie dostarczany jest on bez domyÅ›lnej globalnej konfiguracji - a ja lubiÄ™ gdy cacheuje mi siÄ™ wiÄ™kszoÅ›Ä‡ statyki. Zawsze moÅ¼na dostosowaÄ‡ czas cachowania pod siebie wzglÄ™dem okreÅ›lonego typu pliku, np. dla Java ScriptÃ³w ustawiÄ‡ na 1 dzieÅ„ gdy czÄ™sto siÄ™ zmieniajÄ…. MoÅ¼na teÅ¼ w samej aplikacji zmieniaÄ‡ Å›cieÅ¼kÄ™ do pliku by wymusiÄ‡ odÅ›wieÅ¼enie (lub podawaÄ‡ Å›cieÅ¼kÄ™ z jakimÅ› losowym identyfikatorem wycinanym przez mod_rewrite).\nCache-Control, Expires Najpierw tworzymy globalny config (oczywiÅ›cie moÅ¼na sobie robiÄ‡ teÅ¼ taki per host - jak kto woli):\ncat \u0026gt; /etc/apache2/mods-available/expires.conf \u0026lt; \u0026lt;CONF \u0026lt;IfModule mod_expires.c\u0026gt; # wÅ‚Ä…czamy moduÅ‚ ExpiresActive on # cacheowanie typowych obrazÃ³w przez 3 miesiÄ…ce ExpiresByType image/jpg \u0026#34;access plus 3 months\u0026#34; ExpiresByType image/gif \u0026#34;access plus 3 months\u0026#34; ExpiresByType image/jpeg \u0026#34;access plus 3 months\u0026#34; ExpiresByType image/png \u0026#34;access plus 3 months\u0026#34; # cacheowanie CSS i JavaScript przez 2-1 miesiÄ…ca ExpiresByType text/css \u0026#34;access plus 2 month\u0026#34; ExpiresByType text/javascript \u0026#34;access plus 1 day\u0026#34; ExpiresByType application/javascript \u0026#34;access plus 1 day\u0026#34; # domyÅ›lna wartoÅ›Ä‡ cachowania ExpiresDefault \u0026#34;access plus 3 months\u0026#34; CONF DokÅ‚adniejsze wyjaÅ›nienie skÅ‚adni moÅ¼na znaleÅºÄ‡ tutaj. Teraz aktywujemy moduÅ‚ i restartujemy Apache\u0026rsquo;go (nie jestem pewien czy sam reload by wystarczyÅ‚):\na2enmod expires service apache2 restart I tyle - jeÅ›li sprawdzimy nagÅ‚Ã³wki (Firebug w Firefoxie albo NarzÄ™dzia programistyczne w Chromie) dla odpowiednich typÃ³w plikÃ³w to powinny one zawieraÄ‡ przykÅ‚adowo takie wartoÅ›ci:\nCache-Control:Â max-age=7776000 Expires:Â Thu, 19 Apr 2012 15:48:13 GMT FileETag UstawiajÄ…c powyÅ¼szÄ… konfiguracjÄ™ warto wyÅ‚Ä…czyÄ‡ generowanie nagÅ‚Ã³wka ETag. Co prawda w dawnym zamyÅ›le miaÅ‚ to byÄ‡ mechanizm pozwalajÄ…cy zbliÅ¼ony do cachowania a dajÄ…cy 100% pewnoÅ›ci Å¼e nowy plik zostanie pobrany a aktualne w kopie w cache juÅ¼ nie. Polega na obliczeniu hasha na podstawie \u0026ldquo;pewnych\u0026rdquo; danych o pliku (np.Â INode, data modyfikacji, rozmiar) - jeÅ¼eli posiadasz aktualny hash to nie musisz pobieraÄ‡ danych.\nPomysÅ‚ na poczÄ…tku nie byÅ‚ zÅ‚y\u0026hellip; ale obecne strony czÄ™sto udostÄ™pniajÄ… nawet kilkadziesiÄ…t (i wiÄ™cej) nieduÅ¼ych plikÃ³w. By pobraÄ‡ potrzebne do wygenerowania ETag\u0026rsquo;a dane trzeba wywoÅ‚aÄ‡ operacjÄ™ stat na pliku co przy wielu rÃ³wnoczesnych odwoÅ‚aniach potrafi mocno obciÄ…Å¼yÄ‡ dyski.\nNa serwerach ze Å›rednim i duÅ¼ym obciÄ…Å¼eniem warto wyÅ‚Ä…czyÄ‡ generowanie nagÅ‚Ã³wka w ten sposÃ³b:\necho \u0026#34;FileETag None\u0026#34; \u0026gt;\u0026gt; /etc/apache2/httpd.conf service apache2 reload ","href":"/2012/01/apache-mod_expires-konfiguracja/","title":"Apache mod_expires konfiguracja"},{"content":"Objaw przewaÅ¼nie jest taki: Å‚Ä…czysz siÄ™ po ssh podajÄ…c klucz/hasÅ‚o i czekasz nawet i 10 sekund aÅ¼ pojawi siÄ™ prompt. Po poÅ‚Ä…czeniu wszystkie polecenia dziaÅ‚ajÄ… z normalnÄ… szybkoÅ›ciÄ…. Brzmi znajomo? ðŸ˜‰\nTaki objaw przewaÅ¼nie jest skutkiem problemÃ³w z dziaÅ‚aniem DNS\u0026rsquo;a po stronie klienta lub serwera. Warto sprawdziÄ‡ poleceniami host/dig/nslookup po obu stronach jak duÅ¼o czasu potrzeba na rozwiÄ…zanie nazw. Najlepiej rozwiÄ…zaÄ‡ problem z DNS\u0026rsquo;em ustawiajÄ…c szybkie serwery ale gdy nie mamy takiej moÅ¼liwoÅ›ci to po stronie serwera moÅ¼na ustawiÄ‡ w /etc/sshd_config opcjÄ™:\nUseDNS no I restart ssh:\nservice ssh restart Spowoduje to wyÅ‚Ä…czenie znacznej czÄ™Å›ci zapytaÅ„ DNS po stronie serwera (w tym sprawdzanie reverse DNS\u0026rsquo;a dla hosta klienta w momencie Å‚Ä…czenia). Na kilku serwerach z kiepskim DNS\u0026rsquo;em opcja ta \u0026ldquo;daje niezÅ‚ego kopa\u0026rdquo;.\n","href":"/2012/01/dlugie-oczekiwanie-na-nawiazanie-polaczenia-ssh/","title":"DÅ‚ugie oczekiwanie na nawiÄ…zanie poÅ‚Ä…czenia ssh"},{"content":"Zawsze gdy potrzebujÄ™ zesniffowaÄ‡ coÅ› na Å¼ywo na Fortigate\u0026rsquo;ach muszÄ™ przeszukaÄ‡ Knowledge Base by przypomnieÄ‡ sobie wszystkie polecenia do tego potrzebne. Tym razem robiÄ™ notatki ðŸ˜ƒ\nSniffowanie diagnose debug enable diagnose debug flow filter addrÂ ip address clearÂ clear filter daddrÂ dest ip address dportÂ destination port negateÂ inverse filter portÂ port protoÂ protocol number saddrÂ source ip address sportÂ source port vdÂ index of virtual domain # np. diagnose debug flow filter saddr 10.10.80.3 diagnose debug flow filter daddr 8.8.8.8 diagnose debug flow filter dport 53 # wyÅ›wietl wyniki na konsoli diagnose debug flow show console enable # opcjonalne: wyÅ›wietla nazwy funkcji np. odwoÅ‚ania do routingu, itp diagnose debug flow show function-name enable # uruchomienie sniffowania - warto podaÄ‡ na koÅ„cu jakaÅ› wartoÅ›Ä‡ # by sniffowanie zakoÅ„czyÅ‚o siÄ™ po takiej liczbie pakietÃ³w # w przeciwnym wypadku wyniki bÄ™dÄ… siÄ™ wypisywaÄ‡ na konsoli # aÅ¼ uda nam siÄ™ na oÅ›lep wyÅ‚Ä…czyÄ‡ sniffowanie diagnose debug flow trace start 100 # zresetowanie filtrowania flow diagnose debug reset # wyÅ‚Ä…czenie sniffowania diagnose debug disable Diagnostyka tuneli IP-Sec # tutaj jest duÅ¼o proÅ›ciej, najpierw wÅ‚Ä…czamy debuga diagnose debug enable # a potem diagnose debug application ike 2 # lub dla bardzo, bardzo szczegÃ³Å‚owych logÃ³w diagnose debug application ike -1 Niestety nie ma tutaj moÅ¼liwoÅ›ci filtrowania (albo jeszcze o tym nie wiem), wiÄ™c jeÅ›li mamy duÅ¼o aktywnych tuneli to najlepiej zbieraÄ‡ wypisywane komunikaty do pliku i dopiero przeglÄ…daÄ‡.\n","href":"/2012/01/sniffowanie-w-fortios/","title":"Sniffowanie w FortiOS"},{"content":"Co jakiÅ› czas powtarza siÄ™ sytuacja, gdy muszÄ™ zaktualizowaÄ‡ jakiÅ› serwerek z Lennym do Squeeze\u0026rsquo;a i za kaÅ¼dym razem muszÄ™ googlaÄ‡ za odpowiednimi ÅºrÃ³dÅ‚ami, ktÃ³re paczki najpierw, etc\u0026hellip; WiÄ™c sobie zebraÅ‚em wszystko w poniÅ¼szym poÅ›cie.\nW razie wÄ…tpliwoÅ›ci patrz tutaj:Â http://www.debian.org/releases/squeeze/releasenotes\n  ZrÃ³b backup konfiguracji.\n  Trzeba zaktualizowaÄ‡ ÅºrÃ³dÅ‚a by wskazywaÅ‚y na squeeze\u0026rsquo;a (poniÅ¼sze polecenie nadpisze Twoje obecne repozytoria):\n  cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;SRC deb http://ftp.pl.debian.org/debian/ squeeze main non-free contrib deb-src http://ftp.pl.debian.org/debian/ squeeze main non-free contrib deb http://security.debian.org/ squeeze/updates main contrib non-free deb-src http://security.debian.org/ squeeze/updates main contrib non-free deb http://ftp.pl.debian.org/debian/ squeeze-updates main non-free contrib deb-src http://ftp.pl.debian.org/debian/ squeeze-updates main non-free contrib deb http://backports.debian.org/debian-backports squeeze-backports main contrib non-free SRC Teraz trzeba odÅ›wieÅ¼yÄ‡ repozytoria:\nsudo apt-get update ProponujÄ™ pobraÄ‡ teÅ¼ pliki by podczas aktualizacji wszystkie leÅ¼aÅ‚y w cache\u0026rsquo;u - na wypadek gdyby nagle padÅ‚o Å‚Ä…cze itp\u0026hellip;\nsudo apt-get dist-upgrade -d Teraz moÅ¼na zaktualizowaÄ‡ kluczowe paczki:\nsudo apt-get install apt dpkg I aktualizacja caÅ‚ego systemu:\nsudo apt-get dist-upgrade I moÅ¼na braÄ‡ siÄ™ do Å‚atania bugÃ³w w starej konfiguracji\u0026hellip; ðŸ˜‰\n","href":"/2012/01/upgrade-debian-lenny-do-squeeze/","title":"Upgrade Debian Lenny do Squeeze"},{"content":"JeÅ¼eli jesteÅ› wÅ‚aÅ›cicielem Skody Fabii I to wczeÅ›niej czy pÃ³Åºniej TwÃ³j BAT-Mobil zgÅ‚osi ktÃ³reÅ› z ostrzeÅ¼eÅ„ serwisowych:\n OIL - pojawia siÄ™ przewaÅ¼nie co 10 tys. km i wtedy gdy jeszcze nie trzeba wymieniaÄ‡ oleju w silniku ðŸ˜„ service INSP - nie wiem jak czÄ™sto siÄ™ pojawia a oznacza mniej wiÄ™cej \u0026ldquo;czas wesprzeÄ‡ finansowo lokalny autoryzowany serwis\u0026rdquo;.  RozwiÄ…zanie znalazÅ‚em tutajÂ - cytujÄ™ by mi nie zginÄ™Å‚o ;-)\n Kasowanie ostrzeÅ¼enia OIL:\n Przy wyÅ‚Ä…czonym silniku wciskamy i przytrzymujemy przycisk kasowaniaÂ przebiegu dziennego/pokrÄ™tÅ‚o ustawiania godziny, od teraz nazywany poÂ prostu \u0026lsquo;przyciskiem\u0026rsquo;. CaÅ‚y czas przytrzymujÄ…c \u0026lsquo;przycisk\u0026rsquo;, wÅ‚Ä…czamy zapÅ‚on. PowinniÅ›my zobaczyÄ‡ napis OIL, puszczamy \u0026lsquo;przycisk\u0026rsquo;. PrzekrÄ™camy \u0026lsquo;przycisk\u0026rsquo; w prawo, aÅ¼ zobaczymy \u0026lsquo;- - - -\u0026rsquo;. MoÅ¼emy wyÅ‚Ä…czyÄ‡ zapÅ‚on.  Kasowanie ostrzeÅ¼enia service INSP:\n Wykonujemy czynnoÅ›ci z punktÃ³w 1-3 podanych powyÅ¼ej. Wciskamy \u0026lsquo;przycisk\u0026rsquo;, powinniÅ›my zobaczyÄ‡ napis INSP, puszczamy przycisk. PrzekrÄ™camy \u0026lsquo;przycisk\u0026rsquo; w prawo, aÅ¼ zobaczymy \u0026lsquo;- - - -\u0026rsquo;. MoÅ¼emy wyÅ‚Ä…czyÄ‡ zapÅ‚on.  U mnie zadziaÅ‚aÅ‚o, mam nadziejÄ™, Å¼e siÄ™ komuÅ› przyda.\n ","href":"/2012/01/skoda-fabia-kasownie-ostrzezen-oil-i-service-insp/","title":"Skoda Fabia - Kasownie ostrzeÅ¼eÅ„ OIL i service INSP"},{"content":"Uruchamiamy SciTE i klikamy menu Options -\u0026gt; Open User Options File, wpisujemy dane:\n# domyÅ›lne korzystanie z fontÃ³w o staÅ‚ej szerokoÅ›ci font.base=$(font.monospace) font.small=$(font.monospace) font.comment=$(font.monospace) font.text=$(font.monospace) font.text.comment=$(font.monospace) font.embedded.base=$(font.monospace) font.embedded.comment=$(font.monospace) font.vbs=$(font.monospace) # numerowanie wierszy line.margin.visible=1 line.margin.width=3+ # ikonki toolbara z tematu systemowego toolbar.usestockicons=1 # zaznaczanie blokowe rectangular.selection.modifier=8 # ustawienia wgÅ‚Ä™bieÅ„ kodu indent.size=4 use.tabs=1 indent.automatic=1 WiÄ™cej opcji tutaj:Â http://www.scintilla.org/SciTEDoc.html\nSam pewnie jeszcze nie raz zaktualizujÄ™ ten wpis ðŸ˜„\n","href":"/2012/01/moj-domyslny-config-dla-scite/","title":"MÃ³j domyÅ›lny config dla SciTE"},{"content":"","href":"/tags/scite/","title":"SciTE"},{"content":"","href":"/tags/empathy/","title":"Empathy"},{"content":"W Gajim\u0026rsquo;ie od dawna brakowaÅ‚o mi wygodnego przeszukiwania po liÅ›cie kontaktÃ³w (takiego jakie ma siÄ™ pojawiÄ‡ juÅ¼ niebawem w wersji 0.15 - z pÃ³Å‚tora roku juÅ¼ na to czekam\u0026hellip;). W miÄ™dzy czasie znalazÅ‚em chwilÄ™ by pobawiÄ‡ siÄ™ Empathy - brzydki, nie ma przeglÄ…darki usÅ‚ug XMPP, ale wyszukiwanie na rosterze jest dokÅ‚adnie takie jakiego szukaÅ‚em (w miarÄ™ wpisywania znakÃ³w zawÄ™Å¼a listÄ™ kontaktÃ³w by pasowaÅ‚y do wpisywanego wzorca).\nTyle Å¼e skrÃ³ty klawiaturowe w tym programie zwyczajnie mnie rozwalajÄ… - przez lata przyzwyczaiÅ‚em siÄ™ Å¼e okienka czatu moÅ¼na zamknÄ…Ä‡ Escape\u0026rsquo;m - a tutaj nawet nie ma opcji, ktÃ³ra pozwalaÅ‚a by na takÄ… zmianÄ™ zachowania.\nRozwiÄ…zaniem jest edycja z root\u0026rsquo;a plikuÂ /usr/share/empathy/empathy-chat-window.ui i zamiana linii:\n\u0026lt;accelerator key=\u0026#34;W\u0026#34; modifiers=\u0026lt;wbr\u0026gt;\u0026#34;GDK_CONTROL_\u0026lt;/wbr\u0026gt;\u0026lt;wbr\u0026gt;MASK\u0026#34;/\u0026gt;\u0026lt;/wbr\u0026gt; na:\n\u0026lt;accelerator key=\u0026#34;Escape\u0026#34; /\u0026gt; Ta da! Restart komunikatora i da siÄ™ z nim Å¼yÄ‡.\nÅ¹rÃ³dÅ‚o:Â https://bugs.launchpad.net/ubuntu/+source/empathy/+bug/486508\n","href":"/2011/12/empathy-zamykanie-okienka-chatu-przyciskiem-escape/","title":"Empathy - zamykanie okienka chatu przyciskiem Escape"},{"content":"MoÅ¼na znaleÅºÄ‡ wiele tutoriali jakimi narzÄ™dziami wykonywaÄ‡ backupy. W wiÄ™kszoÅ›ci przypadkÃ³w absolutnie wystarczajÄ…cy okaÅ¼e siÄ™ flexbackup. Bardziej wymagajÄ…cy wykorzystajÄ… BackupPC, BaculÄ™ lub AmandÄ™. NarzÄ™dzia te pozwalajÄ… wykonaÄ‡ kopie peÅ‚ne, rÃ³Å¼nicowe, przyrostowe - kompresujÄ…c je dla zaoszczÄ™dzenia miejsca.\nWszystko fajnie - ale problemy pojawiajÄ… siÄ™ przy dostÄ™pie do tych danych. Å»eby odzyskaÄ‡ plik zmodyfikowany dzisiaj trzeba rozpakowaÄ‡ najpierw kopiÄ™ peÅ‚nÄ…, potem rÃ³Å¼nicowÄ…, przyrostowÄ… by wreszcie wyciÄ…gnÄ…Ä‡ plik z wczoraj\u0026hellip; hmm ten teÅ¼ jest skopany. No to lecimy jeszcze raz\u0026hellip;\nDodatkowo jeÅ¼eli danych jest kilkadziesiÄ…t GB to caÅ‚y proces wielokrotnej dekompresji moÅ¼e trwaÄ‡ nawet kilka godzin. ZaczÄ…Å‚em szukaÄ‡ alternatywnej metody backupowania i trafiÅ‚em na ciekawy artykuÅ‚ na podstawie, ktÃ³rego opracowaÅ‚em wÅ‚asny skrypt do backupu: http://www.mikerubel.org/computers/rsync_snapshots/\n#!/bin/bash  # zdalny serwer z ktÃ³rego chcemy wykonaÄ‡ backup RHOST=\u0026#34;server.test.pl\u0026#34; # zasoby rsync ze zdalnego serwera ktÃ³re zostanÄ… zsynchronizowane BACKUPDIRS=(\u0026#34;backup\u0026#34; \u0026#34;home\u0026#34; \u0026#34;mails\u0026#34;) # lokalny katalog do ktÃ³rego trafi backup DSTDIR=\u0026#34;/srv/backup/server\u0026#34; # maksymalny czas przechowywania backupÃ³w wyraÅ¼ony w dniach MAXAGE=33 # dodatkowe opcje dla rsynca (--verbose moÅ¼na zastÄ…piÄ‡ --quiet # Å‚atwiej zauwaÅ¼yÄ‡ wtedy bÅ‚Ä™dy), moÅ¼na wÅ‚Ä…czyÄ‡ kompresje # w przypadku synchronizacji ze zdalnej lokalizacji OPTIONS=\u0026#34;--del --verbose\u0026#34; # plik z hasÅ‚em dla rsync\u0026#39;a - zabezpieczenie marne ale w izolowanej # sieci dopuszczalne PASS=\u0026#34;/root/.rsync-passwd\u0026#34; DATE=`date +\u0026#39;%Y.%m.%d\u0026#39;` YESTERDAY=`ls -1 $DSTDIR | sort | tail -n1` LINKDEST=$DSTDIR/$YESTERDAY # prosty mechanizm lock\u0026#39;a by uniemoÅ¼liwiÄ‡ wielokrotne uruchomienie # skryptu, np. w sytuacji gdy nie zdÄ…Å¼y wykonaÄ‡ siÄ™ peÅ‚ny backup # przed kolejnym wywoÅ‚aniem if [ -f \u0026#34;/tmp/server_sync\u0026#34; -o -f \u0026#34;/tmp/server_sync_block\u0026#34; ]; then echo \u0026#34;Another sync is still running!\u0026#34; exit 1 fi touch /tmp/server_sync # wykonujemy kolejno kopie for DIR in ${BACKUPDIRS[@]}; do mkdir -p $DSTDIR/$DATE/$DIR # sprawdzenie czy mamy wczeÅ›niejszy backup, # jak mamy to robimy snapshot if [ -d \u0026#34;$DSTDIR/$YESTERDAY/$DIR\u0026#34; ]; then rsync -a --link-dest=$LINKDEST/$DIR \\  backup@$RHOST::archive/$DIR/ \\  $DSTDIR/$DATE/$DIR/ \\  --password-file=$PASS $OPTIONS else # jak nie mamy to robimy nowy rsync -a backup@$RHOST::archive/$DIR/ \\  $DSTDIR/$DATE/$DIR/ \\  --password-file=$PASS $OPTIONS fi # sprawdzenie czy synchronizacja siÄ™ udaÅ‚a # jeÅ›li siÄ™ nie udaÅ‚a to moÅ¼emy chcieÄ‡ skasowaÄ‡ niedokoÅ„czony # backup by kolejny nie musiaÅ‚ byÄ‡ \u0026#34;prawie peÅ‚nym\u0026#34; # plik /tmp/server_sync_block trzeba skasowaÄ‡ rÄ™cznie if [ $? -ne 0 -a $? -ne 24 ]; then echo \u0026#34;Something was wrong becase rsync return $?\u0026#34; touch /tmp/server_sync_block exit 2 fi done # zwalnianie lock\u0026#39;a rm -f /tmp/server_sync # kasowanie najstarszych backupÃ³w find $DSTDIR -maxdepth 1 -type d -mtime +$MAXAGE \\  -print0 | xargs -0 -r rm -r ","href":"/2011/12/automatyczne-backupy-w-stylu-snapshot-z-rsynciem/","title":"Automatyczne backupy w stylu snapshot z rsyncâ€™iem"},{"content":"ZdarzyÅ‚o mi siÄ™ bawiÄ‡ sprzÄ™towymi Firewallami firmy Fortigate - chcÄ…c sprawdziÄ‡ dziaÅ‚anie pewnych funkcji potrzebowaÅ‚em uruchomiÄ‡ dwa/trzy pudeÅ‚ka na osobnych Å‚Ä…czach. PomysÅ‚ polegaÅ‚ na prÃ³bie zmuszenia pudeÅ‚ek do wspÃ³Å‚pracy z modemem iPlus na USB.\nDrugim fajnym zastosowaniem tego triku jest moÅ¼liwoÅ›Ä‡ wykorzystania iPlusa jako \u0026ldquo;zapasowego Å‚Ä…cza\u0026rdquo; w przypadku awarii gÅ‚Ã³wnego.\nDziÄ™ki pomocy inÅ¼yniera Fortigate szybko udaÅ‚o mi siÄ™ zebraÄ‡ potrzebne do dziaÅ‚ania parametry, ktÃ³re naleÅ¼y uruchomiÄ‡ poprzez command line (telnet/ssh).\nJeÅ¼eli chcemy uruchomiÄ‡ modem dla konkretnego vdom\u0026rsquo;u to naleÅ¼y go najpierw wybraÄ‡, np:\nconfig vdom edit root JeÅ›li nie korzystamy z vdom\u0026rsquo;Ã³w to krok ten moÅ¼emy pominÄ…Ä‡. Dalej:\nconfig system modem set status enable set pin-init at+cpin=xxxx set auto-dial enable set idle-timer 6 set redial 2 set phone1 *99# set username1 ppp set passwd1 ppp set extra-init1 at+cgdcont=1,\\\u0026#34;IP\\\u0026#34;,\\\u0026#34;\u0026lt;a href=\u0026#34;http://www.plusgsm.pl%5C\u0026#34;\u0026gt;www.plusgsm.pl\\\u0026lt;/a\u0026gt;\u0026#34; end Przy czym w opcji pin-init zamiast xxxx naleÅ¼y podaÄ‡ PIN karty SIM.\nNa koniec potrzebny jest restart urzÄ…dzenia:\nexecute reboot Po restarcie bÄ™dziemy mieÄ‡ do dyspozycji nowy interfejs (modem). Automatycznie zostanie ustawioneÂ dns proxy.\nTestowaÅ‚em to na modemach Huawei E156G i Huawei E173 i rÃ³Å¼nych urzÄ…dzeniach FortiGate z firmware w wersji MR2.\n","href":"/2011/12/konfiguracja-modemu-usb-iplus-na-urzadzeniach-fortigate/","title":"Konfiguracja modemu USB iPlus na urzÄ…dzeniach FortiGate"},{"content":"WczeÅ›niej czy pÃ³Åºniej zawsze pojawiaÂ siÄ™ potrzeba zoptymalizowania naszej bazy MySQL. PrzedstawiÄ™ kilka zmian w konfiguracji, ktÃ³re powinny zwiÄ™kszyÄ‡ wydajnoÅ›Ä‡ w wiÄ™kszoÅ›ci przypadkÃ³w.\nMyISAM -Â key_buffer_size NajprostszÄ… optymalizacjÄ… baz/tabel z mechanizmem MyISAM jest odpowiednie dobranie bufora na cache dla kluczy i indeksÃ³w (dane nigdy nie sÄ… cachowane). PoniÅ¼sze zapytanie pozwala oszacowaÄ‡ zalecany rozmiar cache\u0026rsquo;u:\nSELECT CONCAT(ROUND(KBS/POWER(1024, IF(PowerOf1024\u0026lt;0,0,IF(PowerOf1024\u0026gt;3,0,PowerOf1024)))+0.4999), SUBSTR(\u0026#39; KMG\u0026#39;,IF(PowerOf1024\u0026lt;0,0, IF(PowerOf1024\u0026gt;3,0,PowerOf1024))+1,1)) recommended_key_buffer_size FROM (SELECT LEAST(POWER(2,32),KBS1) KBS FROM (SELECT SUM(index_length) KBS1 FROM information_schema.tables WHERE engine=\u0026#39;MyISAM\u0026#39; AND table_schema NOT IN (\u0026#39;information_schema\u0026#39;,\u0026#39;mysql\u0026#39;)) AA ) A, (SELECT 2 PowerOf1024) B; Wynik okreÅ›la zalecany rozmiar bufora (parametr key_buffer_size w pliku /etc/mysql/my.cnf) dla bieÅ¼Ä…cego stanu bazy - warto ciut dodaÄ‡ na zapas. Na systemach 32 bitowych parametrÂ key_buffer_size moÅ¼e przyjmowaÄ‡ maksymalnie 4GB, na 64 bitowych maksymalnie 8GB.\n[mysqld] key_buffer_size=xxxM InnoDB -Â innodb_buffer_pool_size W przypadku InnoDB cachowane mogÄ… byÄ‡ zarÃ³wno dane jak i klucze/indeksy a rozmiar bufora okreÅ›la parametrÂ innodb_buffer_pool_size. ZalecanÄ… minimalnÄ… wartoÅ›Ä‡ tego parametru moÅ¼emy oszacowaÄ‡ zapytaniem:\nSELECT CONCAT(ROUND(KBS/POWER(1024, IF(PowerOf1024\u0026lt;0,0,IF(PowerOf1024\u0026gt;3,0,PowerOf1024)))+0.49999), SUBSTR(\u0026#39; KMG\u0026#39;,IF(PowerOf1024\u0026lt;0,0, IF(PowerOf1024\u0026gt;3,0,PowerOf1024))+1,1)) recommended_innodb_buffer_pool_size FROM (SELECT SUM(data_length+index_length) KBS FROM information_schema.tables WHERE engine=\u0026#39;InnoDB\u0026#39;) A, (SELECT 2 PowerOf1024) B; W przypadku InnoDB po zmianie wartoÅ›ciÂ innodb_buffer_pool_size konieczne jest rÃ³wnieÅ¼ ustawienieÂ innodb_log_file_size na 25% wartoÅ›ciÂ innodb_buffer_pool_size lub 2047M (naleÅ¼y wybraÄ‡ mniejszÄ… z wartoÅ›ci). By wygenerowaÄ‡ pliki log o nowych rozmiarach musimy postÄ™powaÄ‡ wedÅ‚ug poniÅ¼szej instrukcji:\n Dopisujemy w pliku my.cnf parametry: [mysqld] innodb_buffer_pool_size=xxxM innodb_log_file_size=25% xxxM lub 2047M  WyÅ‚Ä…czamy bazÄ™: invoke-rc.d mysql stop  Kasujemy obecnie pliki log: rm /var/lib/mysql/ib_logfile[01]  Uruchamiamy bazÄ™: invoke-rc.d mysql start  Po starcie bazy zostanÄ… wygenerowane nowe pliki log o nowych rozmiarach.  InnoDB - kompaktowanie plikÃ³w W domyÅ›lnej konfiguracji MySQL dla baz InnoDB (na Debianie na bank, przypuszczam Å¼e na innych distro jest podobnie) wszystkie tabele, indeksy, metadane tabel i inne dane dotyczÄ…ce table InnoDB przechowywane sÄ… w jednym pliku:Â /var/lib/mysql/ibdata1\nNie jest to optymalne ustawienie szczegÃ³lnie gdy mamy duÅ¼o baz i o znacznych rozmiarach - wykonywanie wielu rÃ³wnoczesnych operacji na jednym gigantycznym pliku potrafi mocno przymuliÄ‡.\nPrÃ³ba kompaktowania/optymalizowania tabel InnoDB nie powoduje zmniejszenia tego pliku - bo gdy prÃ³bujemy optymalizowaÄ‡ tabele InnoDB powoduje to:\n uÅ‚oÅ¼enie danych i indeksÃ³w wewnÄ…trz pliku ibdata1 w sposÃ³b ciÄ…gÅ‚y, wzrost rozmiaru pliku ibdata1 poniewaÅ¼ powyÅ¼sze dane dopisywane sÄ… na jego koÅ„cu.  Niewiele osÃ³b spodziewa siÄ™ takiego rezultatu.Â MoÅ¼na zmniejszyÄ‡ rozmiar tego pliku wyÅ‚Ä…czajÄ…c dane tabel i ich indeksy do osobnych plikÃ³w ale proces ten wymaga peÅ‚nego backupu bazy i jej odtworzenia, wiÄ…Å¼e siÄ™ wiÄ™c z chwilowym (a w przypadku duÅ¼ych baz - dÅ‚uÅ¼szym) przestojem.\n Robimy peÅ‚ny backup bazy, np. poleceniem:  mysqldump --all-databases --single-transaction -uroot -p \u0026gt; my-dump.sql (dump\u0026rsquo;a moÅ¼na dodatkowo skompresowaÄ‡ gzipem dodajÄ…c pipe\u0026rsquo;a - przyspieszy to odzyskiwanie przez zmniejszenie iloÅ›ci danych potrzebnych do odczytania z dysku)\n Kasujemy wszystkie bazy z wyjÄ…tkiem schematu mysql (de facto powinno wystarczyÄ‡ skasowanie i odzyskanie tylko baz korzystajÄ…cych z tabel InnoDB)\n  WyÅ‚Ä…czamy usÅ‚ugÄ™:\n  invoke-rc.d mysql stop Dodajemy w pliku /etc/mysql/my.cnf parametry:  [mysqld] innodb_file_per_table innodb_log_file_size=25% xG innodb_buffer_pool_size=xG  pierwsza opcja powoduje wÅ‚aÅ›ciwe rozdzielenie tabel InnoDB do rÃ³Å¼nych plikÃ³w (dodanie tej opcji na serwerze na ktÃ³rym znajdujÄ… siÄ™ bazy InnoDB spowoduje ich uszkodzenie - odradzam), drugÄ… i trzeciÄ… linijkÄ™ konfigurujemy wedÅ‚ug wczeÅ›niejszej instrukcji o innodb_buffer_pool_size, moÅ¼emy teÅ¼ na czas przywracania danych dodaÄ‡ opcjÄ™ bulk_insert_buffer_size=256M, skrÃ³ci to czas potrzebny na przywrÃ³cenie bazy.  Kasujemy pliki: ibdata1, ib_logfile0 and ib_logfile1:  rm /var/lib/mysql/ibdata1 rm /var/lib/mysql/ib_logfile[01] Uruchamiamy serwer MySQL:  invoke-rc.d mysql start Przywracamy wszystkie bazy z dump\u0026rsquo;a:  catÂ my-dump.sql | mysql -uroot -p Plik ibdata1 uroÅ›nie ale od tej pory bÄ™dzie zawieraÄ‡ wyÅ‚Ä…cznie metadane tabel a poszczegÃ³lne tabele i indeksy bÄ™dÄ… przechowywane w osobnych plikach, np. tabela.ibd. Teraz optymalizowanie tabel InnoDB bÄ™dzie powodowaÄ‡ zmniejszenie rozmiarÃ³w plikÃ³w *.ibd a plik ibdata1 nie bÄ™dzie tak obciÄ…Å¼ony.\nZmiana metody flush\u0026rsquo;a W niektÃ³rych przypadkach ustawienie opcjiÂ innodb_flush_method na wartoÅ›Ä‡ O_DIRECT moÅ¼e poprawiÄ‡ wydajnoÅ›Ä‡, choÄ‡ w innych wydajnoÅ›Ä‡ moÅ¼e siÄ™ pogorszyÄ‡Â (na forach sugerowano wystÄ™powanie problemu na dedykowanych macierzach). MoÅ¼na bezpiecznie wÅ‚Ä…czyÄ‡ tÄ™ opcjÄ™ i wykonaÄ‡ kilka bechmarkÃ³w:\n[mysqld] innodb_flush_method=O_DIRECT Cache wynikÃ³w zapytaÅ„ SprawdÅºmy najpierw czy cachowanie jest wÅ‚Ä…czone (u mnie byÅ‚o to domyÅ›lne ustawienie), wydajemy zapytanie:\nSHOW VARIABLES LIKE \u0026#39;query_cache_type\u0026#39;; MoÅ¼liwe sÄ… 3 ustawienia:\n ON (query_cache_type = 1) - cachowanie wszystkich zapytaÅ„, OFFÂ (query_cache_type = 0) - cachowanie na Å¼Ä…danie, DEMANDÂ (query_cache_type = 2) - cachowanie wyÅ‚Ä…czone.  W przypadku opcji DEMAND cachowanie jest wÅ‚Ä…czane jeÅ¼eli po SELECT\u0026rsquo;cie dodamyÂ SQL_CACHE. Mi osobiÅ›cie najbardziej odpowiada opcja z cachowaniem wszystkiego.\nNastÄ™pnie naleÅ¼y ustawiÄ‡ w pliku my.cnf poniÅ¼sze zmienne wedÅ‚ug potrzeb:\nquery_cache_limit = 2M query_cache_size = 32M Pierwsza opcja ustala maksymalny rozmiar pojedynczego zapytanie, ktÃ³re bÄ™dzie cachowane - zapytania wiÄ™ksze nie bÄ™dÄ… cachowane. Druga opcja ustala rozmiar caÅ‚ego bufora na cache (przewaÅ¼nie wiÄ™cej dziaÅ‚a lepiej).\nMyISAM - unikanie repair with keycache Gdy nasza baza uroÅ›nie i bÄ™dziemy mieÄ‡ w niej tabele o rozmiarze przekraczajÄ…cym 2GB to da siÄ™ zauwaÅ¼yÄ‡ Å¼e pewne operacja jak np. zakÅ‚adanie indeksu, optymalizacja, naprawa - trwajÄ… cholernie dÅ‚ugo. MoÅ¼na to szczegÃ³lnie odczuÄ‡ wÅ‚aÅ›nie w momencie przekraczania rozmiaru 2GB i tak utworzenie indeksu na tabeli o rozmiarze 1,9GB trwa powiedzmy kilkanaÅ›cie/kilkadziesiÄ…t minut, a ta sama operacja na bazie o rozmiarze 2,1GB moÅ¼e zajÄ…Ä‡ nawet kilka godzin.\nPrzyczynÄ™ Å‚atwo namierzyÄ‡ obserwujÄ…c wynik polecenia:\nSHOW PROCESSLIST; w trakcie operacji na \u0026ldquo;maÅ‚ej\u0026rdquo; i \u0026ldquo;duÅ¼ej\u0026rdquo; tabeli. \u0026ldquo;MaÅ‚a\u0026rdquo; zatrzymuje siÄ™ na dÅ‚uÅ¼ej na operacji Repair By Sorting, a \u0026ldquo;duÅ¼a\u0026rdquo; kona godzinami na Repair With Keycache. WÅ‚aÅ›nie rÃ³Å¼nica w dziaÅ‚aniu obu mechanizmÃ³w sortowania daje w koÅ›Ä‡:\n repair by sorting - wykorzystuje do sortowania wiele plikÃ³w tymczasowych i wymaga sporo wolnego miejsca w katalogu ustawionym w opcji tmpdir (domyÅ›lnie ustawionej na /tmp) - jeÅ¼eli miejsca bÄ™dzie za maÅ‚o to wybierany bÄ™dzie mechanizm \u0026ldquo;repair with keycache\u0026rdquo;, repair with keycache - wykorzystuje do sortowania bardzo maÅ‚y bufor (u mnie 8MB), jest ok 10~20 krotnie wolniejszy niÅ¼ \u0026ldquo;repair by sorting\u0026rdquo; a do tego tworzy mniej optymalne indeksy.  O tym ktÃ³ry z mechanizmÃ³w zostanie wybrany decyduje opcja myisam_max_sort_file_size - zmienna ta ma domyÅ›lnie wartoÅ›Ä‡ 2GB i wÅ‚aÅ›nie dlatego problemy pojawiajÄ… siÄ™ po przekroczeniu tego rozmiaru. ProponujÄ™ ustawiÄ‡ jÄ… sporo powyÅ¼ej rozmiaru najwiÄ™kszych tablic - oczywiÅ›cie jeÅ›li miejsce w temp\u0026rsquo;ie pozwoli na to, np:\nmyisam_max_sort_file_size=8GB Przy takim ustawieniu warto mieÄ‡ w /tmp minimum drugie tyle wolnego miejsca.\nÅ¹rÃ³dÅ‚o http://dba.stackexchange.com/questions/3163/mysql-5-1-innodb-configuration-24gb-ram-bi-xeon-high-load\n","href":"/2011/12/mysql-proste-metody-optymalizacji/","title":"MySQL - Proste metody optymalizacji"},{"content":"","href":"/tags/rsync/","title":"rsync"},{"content":"","href":"/tags/snapshot/","title":"snapshot"},{"content":"","href":"/tags/dovecot/","title":"dovecot"},{"content":"DomyÅ›lna konfiguracja fail2ban\u0026rsquo;a (na Debianie) nie zawiera reguÅ‚ pozwalajÄ…cych na blokowanie prÃ³b wÅ‚amaÅ„ na skrzynki POP/IMAP dla dovecota (no chyba Å¼e korzystamy z saslauthd). MoÅ¼na szybko utworzyÄ‡ wÅ‚asny zestaw filtrÃ³w co przedstawiÄ™ poniÅ¼ej.\nTworzymy plik:Â /etc/fail2ban/filter.d/dovecot.conf\n[Definition] failregex = (?: pop3-login|imap-login): .*(?:Authentication failure|Aborted login \\(auth failed|Aborted login \\(tried to use disabled|Disconnected \\(auth failed|Aborted login \\(\\d+ authentication attempts).*rip=(?P\u0026lt;host\u0026gt;\\S*),.* ignoreregex = PÃ³Åºniej dopisujemy na koÅ„cu pliku:Â /etc/fail2ban/jail.conf\n[dovecot] enabled = true filter = dovecot port = pop3,pop3s,imap,imaps logpath = /var/log/mail.log maxretry = 20 # te dwa poniÅ¼ej wedle uznania - ja mam dobrze ustawione default\u0026#39;y #findtime = 1200 #bantime = 1200 ZostaÅ‚o zrestartowaÄ‡ fail2ban\u0026rsquo;a:\ninvoke-rc.d fail2ban restart Tip na bazie dokumentacji:Â http://wiki.dovecot.org/HowTo/Fail2Ban\n","href":"/2011/11/fail2ban-regulki-dla-dovecota/","title":"fail2ban - reguÅ‚ki dla dovecotâ€™a"},{"content":"Gdy juÅ¼ ustawimy reverse proxy przed Apache szybko moÅ¼na zauwaÅ¼yÄ‡ Å¼e w logach zamiast adresÃ³w IP zdalnych uÅ¼ytkownikÃ³w pojawia siÄ™ tylko jeden adres: adres naszego proxy. RÃ³wnieÅ¼ z poziomu php\u0026rsquo;a jako adres klienta widaÄ‡ IP naszego proxy.\nBy poradziÄ‡ sobie z tym problemem trzeba na serwerze reverse proxy ustawiÄ‡ przekazywanie informacji o oryginalnym adresie IP klienta w nagÅ‚Ã³wku X-Forwarded-For. W przypadku gdy reverse proxy dziaÅ‚a na nginx\u0026rsquo;e wystarczy dodaÄ‡ taki wpis:\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; Teraz w trzeba zainstalowaÄ‡ moduÅ‚ mod_rpaf dla Apachego, ktÃ³ry to zajmie siÄ™ interpretacjÄ… nagÅ‚Ã³wka i podmianÄ… IP proxy prawdziwym IP. Na Debianie wystarczy wpisaÄ‡:\napt-get install libapache2-mod-rpaf Po instalacji naleÅ¼y w plikuÂ /etc/apache2/mods-available/rpaf.conf w opcjiÂ RPAFproxy_ips dopisaÄ‡ adresy IP serwerÃ³w proxy, np (oczywiÅ›cie wpisz swoje adresy):\nRPAFproxy_ips 127.0.0.1 10.24.0.5 WaÅ¼ne by byÅ‚y to zaufane adresy IP - bo w tym miejscu pozwalamy by z tych lokalizacji moÅ¼liwe byÅ‚o nadpisanie adresu IP np. w logach. JeÅ¼eli pozwolimy na modyfikacjÄ™ adresÃ³w IP z zewnÄ…trz to atakujÄ…cy moÅ¼e wykorzystaÄ‡ to by nadpisaÄ‡ swÃ³j prawdziwy adres faÅ‚szywym.\nPozostaÅ‚o uruchomiÄ‡ moduÅ‚ i zrestartowaÄ‡ Apachego aby go zaÅ‚adowaÅ‚:\na2enmod rpaf invoke-rc.d apache2 restart Teraz zarÃ³wno w logach Apache\u0026rsquo;go jak i skryptach PHP\u0026rsquo;a bÄ™dzie przekazywane rzeczywiste IP uÅ¼ytkownika.\n","href":"/2011/11/x-forwarded-for-mod_rpaf-logowanie-rzeczywistych-adresow-ip-na-apache-za-reverse-proxy/","title":"X-Forwarded-For + mod_rpaf - logowanie rzeczywistych adresÃ³w IP na Apache za reverse proxy"},{"content":"","href":"/tags/apc/","title":"APC"},{"content":"","href":"/tags/eaccelerator/","title":"eAccelerator"},{"content":"Przez pewien czas korzystaÅ‚em z eAcceleratora do przyspieszenia dziaÅ‚ania stron pisanych w PHP\u0026rsquo;ie ale czasem bywaÅ‚ niestabilny. Aktualizacje pojawiaÅ‚y siÄ™ rzadko a od czasu do czasu miewaÅ‚em problemy ze stabilnoÅ›ciÄ… tej wtyczki na kilku bardziej skomplikowanych aplikacjach. ZdarzaÅ‚o siÄ™ Å¼e pomimo zmiany kodu w skrypcie php, eAccelerator serwowaÅ‚ wciÄ…Å¼ stary plik - konieczny byÅ‚ restart Apache\u0026rsquo;go by wszystko dziaÅ‚aÅ‚o jak trzeba.\nZaczÄ…Å‚em szukaÄ‡ alternatywy i trafiÅ‚em na dwa moduÅ‚y:\n APC (czyli Alternative PHP Cache), ktÃ³ry ma byÄ‡ nawet domyÅ›lnie wbudowany w PHP od wersji 5.4, XCache - projekt rozwijany przez jednego z programistÃ³w lighttpd.  ByÅ‚em ciekaw wydajnoÅ›ci poszczegÃ³lnych rozwiÄ…zaÅ„ wzglÄ™dem siebie, wiÄ™c przygotowaÅ‚em maÅ‚e Å›rodowisko testowe skÅ‚adajÄ…ce siÄ™ z 4 maszyn wirtualnych (dziaÅ‚ajÄ…cych pod kontrolÄ… VirtualBox\u0026rsquo;a):\n Apache 2.2 + PHP 5.3 Apache 2.2 + PHP 5.3 + eAccelerator 0.9.6.1 (instrukcja instalacji tutaj) Apache 2.2 + PHP 5.3 + APC 3.1.3p1 (pod Debianem paczka php-apc) Apache 2.2 + PHP 5.3 + XCache 1.3.0 (pod Debianem paczka php5-xcache)  Najpierw przygotowaÅ‚em pierwszÄ… maszynÄ™ wraz z konfiguracjÄ… MySQL\u0026rsquo;a i domyÅ›lnÄ… instalacjÄ… WordPress\u0026rsquo;a 3.2 by test byÅ‚ w miarÄ™ miarodajny. Kolejne maszynki to klony tej pierwszej, plus zainstalowane i domyÅ›lnie skonfigurowane kolejne rozszerzenia. KaÅ¼demu z rozszerzeÅ„ przyznaÅ‚em 32 MB pamiÄ™ci na cache.\nMetodyka testu Do automatyzacji testu posÅ‚uÅ¼yÅ‚ mi skrypt w bash\u0026rsquo;u uruchamiajÄ…cy ab dla 1000 zapytaÅ„ z kolejno rosnÄ…cÄ… liczbÄ… rÃ³wnolegÅ‚ych poÅ‚Ä…czeÅ„. Pozwoli to na porÃ³wnanie wydajnoÅ›ci optymalizatorÃ³w przy mniejszym i wiÄ™kszym obciÄ…Å¼eniu. Uruchomienie testu dla czystej instalacji bez dodatku pokaÅ¼e jak duÅ¼y przyrost wydajnoÅ›ci daje siÄ™ uzyskaÄ‡.\nJako systemy testowe posÅ‚uÅ¼yÅ‚y mi wirtualki uruchomione pod kontrolÄ… VirtualBOX\u0026rsquo;a z zainstalowanym aktualnym Debianem Squeeze. PrzydzieliÅ‚em im po 1 GB RAM\u0026rsquo;u i 2 rdzenie CPU. Wirtualki te raczej nie sÄ… highend\u0026rsquo;em ale do ogÃ³lnego porÃ³wnania optymalizatorÃ³w bÄ™dÄ… w zupeÅ‚noÅ›ci wystarczajÄ…ce.\nWyniki JuÅ¼ na pierwszy rzut oka widaÄ‡ Å¼e opÅ‚aca siÄ™ zainstalowaÄ‡ dowolny optymalizator bo ich wydajnoÅ›Ä‡ jest zbliÅ¼ona a w stosunku do czystej instalacji pozwalajÄ… obsÅ‚uÅ¼yÄ‡ prawie czterokrotnie wiÄ™kszy ruch. Przy czym system bez opcode cacher\u0026rsquo;a nie pokonaÅ‚ granicy 70 zapytaÅ„ na sekundÄ™ - zaczÄ…Å‚ swapowaÄ‡ i nie ukoÅ„czyÅ‚ kolejnych testÃ³w.\nPoniÅ¼ej wykres przedstawiajÄ…cy iloÅ›Ä‡ obsÅ‚ugiwanych Å¼Ä…daÅ„ w zaleÅ¼noÅ›ci od iloÅ›ci rÃ³wnoczesnych poÅ‚Ä…czeÅ„: I jeszcze jeden wykres, na ktÃ³rym porÃ³wnaÅ‚em wydajnoÅ›Ä‡ poszczegÃ³lnych optymalizatorÃ³w wzglÄ™dem czystego PHP\u0026rsquo;a Wychodzi na to Å¼e przez wiÄ™kszoÅ›Ä‡ testu eAccelerator byÅ‚ najszybszy, gdzieniegdzie przeplatajÄ…c siÄ™ z APC. XCache nieznacznie ale na caÅ‚ej dÅ‚ugoÅ›ci poniÅ¼ej dwÃ³ch wczeÅ›niejszych. CaÅ‚oÅ›ciowe rÃ³Å¼nice pomiÄ™dzy optymalizatorami przewaÅ¼nie nie przekraczaÅ‚y 3 zapytaÅ„/sekundÄ™ - wiÄ™c rÃ³Å¼nice pomiÄ™dzy nimi sÄ… rzÄ™du 1~2%. MoÅ¼na na tej podstawie wywnioskowaÄ‡ Å¼e wydajnoÅ›Ä‡ jest tak zbliÅ¼ona iÅ¼ nie powinna byÄ‡ jedynym kryterium wyboru optymalizatora dla naszego systemu.\nPoniÅ¼ej postaram siÄ™ zebraÄ‡ subiektywne oceny poszczegÃ³lnych rozwiÄ…zaÅ„ by dostarczyÄ‡ dodatkowych argumentÃ³w.\neAccelerator eAccelerator byÅ‚ najszybszy w teÅ›cie ale miewaÅ‚em z nim problemy (kilka razy ale\u0026hellip;) stÄ…d nie jest moim faworytem.\nZalety:\n zdecydowanie najszybszy, jest stosunkowo aktywnie rozwijany, doÅ›Ä‡ stabilny, wbudowany encoder i dekoder skryptÃ³w (do dystrybucji kodu bez ÅºrÃ³deÅ‚ w postaci skompilowanej).  Wady:\n brak paczek w repozytoriach Debiana - rÄ™czna kompilacja nie jest ciÄ™Å¼ka ale gdy trzeba go utrzymaÄ‡ na 30 serwerach to przestaje byÄ‡ zabawnie, pomimo Å¼e pojawiajÄ… siÄ™ nowe wersje to ostatnio miaÅ‚em problemy z pobraniem ich ze strony projektu - szukanie paczek \u0026ldquo;gdzieÅ›\u0026rdquo; na sieci nie wydaje mi siÄ™ bezpieczne, miaÅ‚em problem z pewnÄ… duÅ¼Ä… aplikacjÄ…, nie dziaÅ‚aÅ‚a stabilnie pod eAcceleratorem, eAccelerator powstaÅ‚ na bazie koduÂ Turck MMCache (ten nie jest juÅ¼ rozwijany) -istniejÄ… pewne wÄ…tpliwoÅ›ci licencyjne co do jego kodu\u0026hellip;  PHP APC APC pod wzglÄ™dem wydajnoÅ›ci nieznacznie ustÄ™puje eAcceleratorowi. CiekawÄ… funkcjÄ… udostÄ™pnianÄ… przez APC jest obsÅ‚ugaÂ RFC1867 (File Upload Progress hook handler). Jest teÅ¼ pewna potwierdzona plotka mÃ³wiÄ…ca o wÅ‚Ä…czeniu kodu APC do PHP\u0026rsquo;a 6. Teoretycznie jeÅ¼eli przesiÄ…dziemy siÄ™ juÅ¼ teraz na APC to pÃ³Åºniej powinno pÃ³jÅ›Ä‡ Å‚atwiej\u0026hellip;\nZalety:\n doÅ›Ä‡ szybki, aktywnie rozwijany, bardzo stabilny, dostÄ™pna paczka w repozytoriach Debiana (i z tego co wiem na wielu innych systemach teÅ¼ przewaÅ¼nie wystarczajÄ… domyÅ›lne repozytoria) obsÅ‚uga RFC1867 (upload progress), zostanie wÅ‚Ä…czony do PHP od wersji 5.4, APC udostÄ™pnia API umoÅ¼liwiajÄ…ce tworzenie wÅ‚asnych obiektÃ³w w pamiÄ™ci cache wspÃ³Å‚dzielonych pomiÄ™dzy zapytaniami np. by nie pobieraÄ‡ za kaÅ¼dym razem wÅ‚aÅ›ciwoÅ›ci profilu z bazy, listy uÅ¼ytkownikÃ³w, itp (coÅ› w stylu memcached). dostÄ™pny jest ze skryptem apc.php, ktÃ³ry pozwala zarzÄ…dzaÄ‡ obiektami w cache, czyÅ›ciÄ‡ itp.  Wady:\n podobno bywa problematyczny w konfiguracji z fast-cgi (choÄ‡ u mnie dziaÅ‚a), przy mocno zapchanym cache\u0026rsquo;u czyszczenie go potrafiÅ‚o siÄ™ zwiesiÄ‡.  XCache Ostatni projekt rozwijany jest przez jednego z programistÃ³w lighttpd. W chwili obecnej wydaje siÄ™ byÄ‡ doÅ›Ä‡ dojrzaÅ‚ym i wystarczajÄ…co stabilnym do produkcyjnego uÅ¼ycia. ChoÄ‡ gdy prÃ³bowaÅ‚em z niego korzystaÄ‡ jakiÅ› rok/dwa temu to miaÅ‚em sporo losowych padÃ³w - niezaleÅ¼nych od obciÄ…Å¼enia serwera.\nZalety:\n stabilny, aktywnie rozwijany z kilkoma gaÅ‚Ä™ziami (stable/unstable/devel) - moÅ¼emy wybraÄ‡ czy potrzebujemy funkcji czy stabilnoÅ›ci.  Wady:\n nieznacznie, ale jednak najniÅ¼sza wydajnoÅ›Ä‡, miaÅ‚em z nim maÅ‚o stycznoÅ›ci a szybko zraziÅ‚em siÄ™ do kiepskiej stabilnoÅ›ci - obecnie wydaje siÄ™ Å¼e nie stanowi to problemu.  Podsumowanie i mÃ³j wybÃ³r Do testu celowo wybraÅ‚em WordPress\u0026rsquo;a jako doÅ›Ä‡ duÅ¼y i wystarczajÄ…co skomplikowany projekt - jeÅ›li on bÄ™dzie dziaÅ‚aÄ‡ stabilnie to wiÄ™kszoÅ›Ä‡ mniejszych teÅ¼ powinna\u0026hellip; Ku mojemu zaskoczeniu Å¼aden z optymalizatorÃ³w nie sypnÄ…Å‚ bÅ‚Ä™dami. DziwiÅ‚o mnie to bo jeszcze jakiÅ› czas temu eAccelerator czasami losowo mi siÄ™ sypaÅ‚ - dziaÅ‚aÅ‚ przez tydzieÅ„ i nagle zgon w sobotÄ™ po poÅ‚udniu\u0026hellip; PÃ³Åºniej prÃ³bowaÅ‚em XCache i byÅ‚o podobnie\u0026hellip; tylko gorzej bo problemy wystÄ™powaÅ‚y czÄ™Å›ciej. APC testowaÅ‚em jako ostatnie ale w wykorzystywanych przeze mnie aplikacjach zachowywaÅ‚ siÄ™ bardzo stabilnie i przewidywalni. Jedyny problem z wieszaniem siÄ™ podczas czyszczenia/usuwania elementu z cache\u0026rsquo;u moÅ¼na obejÅ›Ä‡ stosunkowo szybkim restartem Apachego - skuteczne i efekt ten sam ðŸ˜ƒ Na jednym z serwerÃ³w testujÄ™ APC w trybie fast-cgi od okoÅ‚o dwÃ³ch miesiÄ™cy i jak na razie nie mogÄ™ narzekaÄ‡ (moÅ¼e w wolnej chwili uzupeÅ‚niÄ™ to zestawienie o testy w trybie fast-cgi).\nObecnie w wiÄ™kszoÅ›ci administrowanych przeze mnie serwerÃ³w z PHP\u0026rsquo;em standardowo instalujÄ™ APC. WybÃ³r jest dla mnie tym bardziej oczywisty Å¼e paczka ta jest dostÄ™pna w standardowych repozytoriach (Å‚atwoÅ›Ä‡ aktualizacji itd) - nie ma zatem potrzeby jak w przypadku eAcceleratora instalowania wielu paczek z zaleÅ¼noÅ›ciami by mÃ³c skompilowaÄ‡ 1 moduÅ‚.\nDodatkowÄ… zaletÄ… jest fakt Å¼e APC ma byÄ‡ standardowo wbudowany w kolejne wersje PHP\u0026rsquo;a - jeÅ¼eli w rozwijanych aplikacjach juÅ¼ teraz zwrÃ³ci siÄ™ uwagÄ™ na integracjÄ™ z tym rozwiÄ…zaniem to w przyszÅ‚oÅ›ci migracja nie powinna przysporzyÄ‡ problemÃ³w.\nJeÅ¼eli siÄ™ wahasz - wybierz APC. JeÅ¼eli w Twoim Å›rodowisku okaÅ¼e siÄ™ niestabilne zawsze moÅ¼esz sprÃ³bowaÄ‡ dwÃ³ch pozostaÅ‚ych rozwiÄ…zaÅ„.\nPrzydatne linki (czÄ™Å›Ä‡ potwierdza moje obserwacje, sÄ… teÅ¼ testy z drupalem):\nhttp://php.net/manual/en/book.apc.php http://xcache.lighttpd.net/ http://eaccelerator.net/Â (w chwili pisanie strona nie dziaÅ‚aÅ‚a ðŸ˜ƒ)\nhttp://www.ducea.com/2006/10/30/php-accelerators/ http://2bits.com/articles/benchmarking-drupal-with-php-op-code-caches-apc-eaccelerator-and-xcache-compared.html http://2bits.com/articles/benchmarking-apc-vs-eaccelerator-using-drupal.html http://hostingfu.com/article/increasing-php-application-performance-xcache\n","href":"/2011/11/porownanie-optymalizatorow-php-eaccelerator-php-apc-xcache/","title":"PorÃ³wnanie optymalizatorÃ³w PHP - eAccelerator, PHP APC, XCache"},{"content":"","href":"/tags/xcache/","title":"XCache"},{"content":"","href":"/tags/sles/","title":"SLES"},{"content":"AdministrowaÅ‚em do tej pory gÅ‚Ã³wnie darmowymi distro, ale gdzieÅ› tam ukradkiem wkradÅ‚o siÄ™ kilka \u0026ldquo;siusiakÃ³w\u0026rdquo; (aka SUSE Linux Enterprise Server). Å»yÅ‚em w utopijnym przekonaniu Å¼e skoro siÄ™ za nie pÅ‚aci to powinno siÄ™ z nimi Å‚atwiej wspÃ³Å‚pracowaÄ‡\u0026hellip; w przypadku instalacji aktualizacji (a w szczegÃ³lnoÅ›ci SP) nie byÅ‚o to aÅ¼ takie proste.\nPrzywykÅ‚em w darmowych dystrybucjach Å¼e gdy pojawiaÅ‚a siÄ™ nowszÄ… \u0026ldquo;wiÄ™ksza wersja\u0026rdquo; to po prostu moÅ¼na byÅ‚o jednym poleceniem zaktualizowaÄ‡ wszystkie pakiety. Å¹rÃ³dÅ‚a aktualizowaÅ‚y siÄ™ automatycznie (lub prawie automatycznie) - pÃ³Åºniej trzeba byÅ‚o poÅ‚ataÄ‡ ewentualne zmiany w plikach konfiguracyjnych. W SUSE jest ciut inaczej\u0026hellip; ðŸ˜‰\nInstalacja SP1 na SLES\u0026rsquo;ie 11 Instrukcja jest dla SLES\u0026rsquo;aÂ jedenastki (o ile pamiÄ™tam dziesiÄ…tkÄ™ aktualizowaÅ‚o siÄ™ inaczej) i Service Pack\u0026rsquo;a 1 - ale powinna zadziaÅ‚aÄ‡ rÃ³wnieÅ¼ w przypadku kaÅ¼dego kolejnego SP. Zaczynamy!\nZ root\u0026rsquo;a uruchamiamy polecenia:\nzypper ref -s zypper up -t patch zypper up -t patch (Nie pomyliÅ‚em siÄ™ - drugie polecenie naleÅ¼y uruchomiÄ‡ dwa razy - SIC!)\nPierwsze polecenie odÅ›wieÅ¼y informacje o dostÄ™pnych usÅ‚ugach i repozytoriach.\nDrugie polecenie zainstaluje aktualizacje dla programÃ³w zarzÄ…dzajÄ…cych paczkami w systemi, a kolejne wywoÅ‚anie powinno zainstalowaÄ‡ pozostaÅ‚e dostÄ™pne aktualizacje. PodwÃ³jne wywoÅ‚anieÂ zypper up -t patch znajduje siÄ™ w oficjalnej instrukcji - w nieoficjalnej znalezionej w sieci proponowano by uruchamiaÄ‡ to polecenie do puki nie bÄ™dzie miaÅ‚o juÅ¼ nic wiÄ™cej do zaktualizowania.\nPo wydaniu powyÅ¼szych poleceÅ„, w systemie (a dokÅ‚adnie w plikachÂ /etc/products.d/*.prod) powinny pojawiÄ‡ siÄ™ informacje o dostÄ™pnych pakietach narzÄ™dzi migracyjnych. By je wylistowaÄ‡ naleÅ¼y wydaÄ‡ polecenie:\ngrep \u0026#39;\u0026lt;product\u0026gt;\u0026#39; /etc/products.d/*.prod U mnie daÅ‚o to taki wynik:\n\u0026lt;product\u0026gt;sle-sdk-SP1-migration\u0026lt;/product\u0026gt; \u0026lt;product\u0026gt;SUSE_SLES-SP1-migration\u0026lt;/product\u0026gt; JeÅ¼eli u Ciebie to polecenie nic nie zwrÃ³ciÅ‚o tzn. Å¼e nie ma dostÄ™pnych aktualizacji lub Å¼e zbyt maÅ‚o razy uruchomiono zypper up -t patch ðŸ˜ƒ\nPowyÅ¼sze \u0026ldquo;produkty\u0026rdquo; - naleÅ¼y zainstalowaÄ‡ poleceniem:\nzypper in -t product sle-sdk-SP1-migration SUSE_SLES-SP1-migration Aby zaktualizowaÄ‡ system musimy mieÄ‡ dostÄ™p do podstawowego repozytorium z nowszymi wersjami pakietÃ³w - uzyskamy go rejestrujÄ…c siÄ™:\nsuse_register -d 2 -L /root/.suse_register.log JeÅ¼eli nie zapomnieliÅ›my o przedÅ‚uÅ¼eniu licencji i rejestracja przebiegÅ‚a pomyÅ›lnie to moÅ¼emy odÅ›wieÅ¼yÄ‡ zawartoÅ›Ä‡ nowych repozytoriÃ³w i usÅ‚ug:\nzypper ref -s Teraz wylistujmy dostÄ™pne repozytoria, poleceniem:\nzypper lr BARDZO WAÅ»NE: musimy wyÅ‚Ä…czyÄ‡ stare repozytoria (dla systemu bez SP) i wÅ‚Ä…czyÄ‡ nowe repozytoria dla systemu z SP1 - jeÅ¼eli tylko wÅ‚Ä…czymy nowe repozytoria to po kolejnej aktualizacji systemu mogÄ… zainstalowaÄ‡ siÄ™ paczki w starszych wersjach rozwalajÄ…c system! SprawdzaÅ‚em osobiÅ›cie i rzeczywiÅ›cie tak jest ðŸ˜ƒ\nWÅ‚Ä…czanie/wyÅ‚Ä…czanie repozytoriÃ³w umoÅ¼liwiajÄ… polecenia:\nzypper mr -disable repozytorium_do_wylaczenia zypper mr -enable repozytorium_do_wlaczenia Dopiero teraz system jest gotowy do aktualizacji, ktÃ³rÄ… przeprowadzamy poleceniem (jeÅ¼eli instalujemy zdalnie warto odpaliÄ‡ je spod screenâ€˜a):\nzypper dup Zypper zapyta czy chcemy usunÄ…Ä‡ zainstalowane wczeÅ›niej \u0026ldquo;produkty migracyjne\u0026rdquo; i zaktualizowaÄ‡ pozostaÅ‚e pakiety - naleÅ¼y potwierdziÄ‡ (oczywiÅ›cie jeÅ›li jesteÅ›my absolutnie pewni i mamy backup ðŸ˜ƒ ).\nZNÃ“W WAÅ»NE: po zakoÅ„czonej aktualizacji naleÅ¼y ponownie zarejestrowaÄ‡ siusiaka aby usunÄ…Ä‡ repozytoria z aktualizacjami dla czystej wersji 11 i zastÄ…piÄ‡ je repami dla wersji z SP 1:\nsuse_register -d 2 -L /root/.suse_register.log Teraz moÅ¼emy zrestartowaÄ‡ system by przeÅ‚adowaÅ‚o siÄ™ jajko i wszystkie usÅ‚ugi - jeÅ¼eli wszystko poszÅ‚o po naszej myÅ›li to powita nas SLES 11 SP 1.\nPrawda Å¼e proste a caÅ‚y proces wrÄ™cz oczywisty?\n","href":"/2011/10/sles-11-instalacja-service-packa/","title":"SLES 11 - instalacja Service Packâ€™a"},{"content":"Bardzo czÄ™sto konfigurujÄ…c usÅ‚ugi dostÄ™pne publicznie poÅ›wiÄ™ca siÄ™ sporo czasu na maksymalne zwiÄ™kszenie bezpieczeÅ„stwa przez \u0026ldquo;dopieszczanie\u0026rdquo; konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronÄ™ pewnych stron hasÅ‚em, dostÄ™p do SSH tylko kluczami, itd.) ale caÅ‚kowicie pomija siÄ™ przygotowanie systemu aktywnie monitorujÄ…cego bÅ‚Ä™dne prÃ³by autoryzacji. OczywiÅ›cie nie moÅ¼na umniejszaÄ‡ wagi pierwszego z wymienionych etapÃ³w ale zdecydowanie nie powinno pomijaÄ‡ siÄ™ teÅ¼ tego drugiego. PrzecieÅ¼ kaÅ¼dy admin chciaÅ‚by wiedzieÄ‡ gdy ktoÅ› prÃ³buje wÅ‚amaÄ‡ siÄ™ na jego serwer (FTP, HTTP, SSH, itp.) - tylko ilu z Nas zadaje sobie trud by uruchomiÄ‡ taki system?\nWielu z nas uwaÅ¼a Å¼e przygotowanie takiego mechanizmu jest zbyt pracochÅ‚onne, trudne, nie teraz, nie mam czasu, itd\u0026hellip;. Zapominamy przy tym Å¼e gotowy system zostanie oddany w rÄ™ce uÅ¼yszkodnikÃ³w a Ci na pewno bÄ™dÄ… z niego korzystaÄ‡ wbrew wszelkim zasadom bezpieczeÅ„stwa ðŸ˜ƒ\nNa przykÅ‚ad taki Roman z loginem romek ustawi hasÅ‚o do poczty abc123 - wirusy i boty zamiast prÃ³bowaÄ‡ Å‚amaÄ‡ hasÅ‚o jednego usera bardzo czÄ™sto prÃ³bujÄ… wbiÄ‡ siÄ™ na popularne loginy wykorzystujÄ…c proste hasÅ‚a - zaskakujÄ…ce jak czÄ™sto siÄ™ im to udaje. A pÃ³Åºniej Roman ma pretensje do admina Å¼e jego znajomi dostali po 10000 maili z wirusami\u0026hellip;\nTymczasem w wielu przypadkach wystarczy fail2ban w praktycznie podstawowej konfiguracji by ochroniÄ‡ typowe usÅ‚ugi przed:\n atakami brute force jak w powyÅ¼szym przykÅ‚adnie (SSH, Apache, vsftpd, proftpd, Postfix, SASL Auth, etc), atakiem pocztowego bot netu (blokowanie hostÃ³w generujÄ…cych duÅ¼Ä… iloÅ›Ä‡ bÅ‚Ä™dÃ³w), zÅ‚ymi crawler\u0026rsquo;ami czy narzÄ™dziami skanujÄ…cymi strony WWW, ataki flood na Bind DNS.  NarzÄ™dzie napisane jest w Perl\u0026rsquo;u i dziaÅ‚a jako demon zapisujÄ…c dane z syslog\u0026rsquo;a w maÅ‚ych paczkach i okresowo uruchamiajÄ…c testy sprawdzajÄ…ce - wpÅ‚ywa to korzystnie na wydajnoÅ›Ä‡ (bo nie musi analizowaÄ‡ caÅ‚odniowych logÃ³w jak prymitywniejsze narzÄ™dzia). ModuÅ‚owa konfiguracja pozwala Å‚atwo dodaÄ‡ filtry (wykrywajÄ…ce niezdefiniowane w standardzie zdarzenia) lub akcje (np. zamiast wycinaÄ‡ spam bota przez iptables moÅ¼na go wrzuciÄ‡ do naszego prywatnego RBL\u0026rsquo;a). W innym poÅ›cie podaÅ‚em przykÅ‚ad dodania reguÅ‚ dla dovecot\u0026rsquo;a.\nPomimo iÅ¼ narzÄ™dzie wydaje siÄ™ zbytnio nie obciÄ…Å¼aÄ‡ systemu to raczej nie odwaÅ¼yÅ‚bym siÄ™ go zainstalowaÄ‡ na mocno obciÄ…Å¼onym serwerze, gdzie generujÄ… siÄ™ miliony linii logÃ³w dziennie. W takiej sytuacji potrzebne jest inne rozwiÄ…zanie.\nInstalacja W moim przypadku na Debianie leci to typowo:\napt-get install fail2ban AplikacjÄ™ moÅ¼na teÅ¼ doÅ›Ä‡ Å‚atwo zainstalowaÄ‡ ze ÅºrÃ³deÅ‚ - zaleznoÅ›ci nie ma zbyt duÅ¼o.\nKonfiguracja Gdy juÅ¼ zainstalujemy fail2ban\u0026rsquo;a otwieramy gÅ‚Ã³wny plik konfiguracyjny /etc/fail2ban/jail.conf. IdÄ…c od poczÄ…tku warto zainteresowaÄ‡ siÄ™ opcjami:\n# poniÅ¼ej naleÅ¼y umieÅ›ciÄ‡ listÄ™ adresÃ³w IP, sieci CIDR, z ktÃ³rych # chcemy ignorowaÄ‡ zagroÅ¼enia ignoreip = 127.0.0.1 10.3.4.0/24 # domyÅ›lny czas BAN\u0026#39;a - moÅ¼na nadpisaÄ‡ w konfiguracji danej usÅ‚ugi bantime = 36000 # domyÅ›lna iloÅ›Ä‡ wykrytych akcji, po ktÃ³rych zostanie dojdzie # do BAN\u0026#39;a maxretry = 3 # adres osoby, ktÃ³ra ma byÄ‡ informowana o naÅ‚oÅ¼eniu/zdjÄ™ciu BAN\u0026#39;a destemail = moj@mail.pl # domyÅ›lna akcja, predefiniowane sÄ… 3 moÅ¼liwoÅ›ci: # action_ - tylko BAN # action_mw - BAN i powiadomienie mailem z danymi WHOIS # action_mwl - jak wyÅ¼ej plus linie z loga action = %(action_mwl)s Dalej w konfigu znajdujÄ… siÄ™ przygotowane definicje poszczegÃ³lnych usÅ‚ug i ich konfiguracja, np. SSH:\n[ssh] enabled = true port = ssh filter = sshd logpath = /var/log/auth.log maxretry = 5 bantime = 3600 [ssh-ddos] enabled = true port = ssh filter = sshd-ddos logpath = /var/log/auth.log maxretry = 6 Jak wspominaÅ‚em wczeÅ›niej w danym bloku moÅ¼na wpisaÄ‡ inne niÅ¼ domyÅ›lne wartoÅ›ci dla opcji bantime i maxretry. Opcja filter wskazuje na nazwÄ™ pliku z definicjÄ… filtru, np:Â /etc/fail2ban/filter.d/sshd.conf. W tej lokalizacji moÅ¼emy dodawaÄ‡ teÅ¼ wÅ‚asne filtry, trzeba tylko znaÄ‡ wyraÅ¼enia regularne. W opcji port moÅ¼emy zmieniÄ‡ port, na ktÃ³rym dziaÅ‚a usÅ‚uga (by banowanie dziaÅ‚aÅ‚o), korzystajÄ…c przy tym z nazw dostÄ™pnych w pliku /etc/services lub bezpoÅ›rednio wpisujÄ…c numer portu.\nDomyÅ›lnie nie jest wÅ‚Ä…czona ochrona Å¼adnej z usÅ‚ug. By jÄ… wÅ‚Ä…czyÄ‡ naleÅ¼y zmieniÄ‡ w stosownym bloku:\nenabled = false na:\nenabled = true i przeÅ‚adowaÄ‡ fail2ban\u0026rsquo;a:\ninvoke-rc.d fail2ban restart I na poczÄ…tek wystarczy. W kilku banalnych krokach uruchomiliÅ›my system monitorujÄ…cy logi i blokujÄ…cy prÃ³by wÅ‚amaÅ„.\nOczywiÅ›cie wÅ‚Ä…czajÄ…c ochronÄ™ danej usÅ‚ugi dobrze zapoznaÄ‡ siÄ™ z reguÅ‚ami zapisanymi w danym filtrze - by nie byÄ‡ zaskoczonym gdy sypnie mailami ðŸ˜‰\nWyÅ‚Ä…czenie powiadamiania o starcie fail2ban\u0026rsquo;a JeÅ¼eli wÅ‚Ä…czymy powiadamianie mailem o banach jako gratis fail2ban bÄ™dzie powiadamiaÄ‡ nas mailem o wÅ‚aczeniu i wyÅ‚Ä…czeniu ochrony dla kaÅ¼dej z usÅ‚ug - na wypadek gdyby ktoÅ› bez naszej wiedzy zechciaÅ‚ go wyÅ‚Ä…czyÄ‡. Dla wielu moÅ¼e to byÄ‡ irytujÄ…ce zachowanie.\nBy wyÅ‚Ä…czyÄ‡ powiadomienia trzeba wÂ pliku akcji - u mnie w:Â /etc/fail2ban/action.d/mail-whois-lines.confÂ wyczyÅ›ciÄ‡ opcje actionstart i actionstop by wyglÄ…daÅ‚y jak poniÅ¼ej:\nactionstop = actioncheck = ","href":"/2011/10/ochrona-uslug-przed-atakami-brute-force-z-fail2banem/","title":"Ochrona usÅ‚ug przed atakami brute force z fail2banâ€™em"},{"content":"","href":"/tags/pflogsumm/","title":"pflogsumm"},{"content":"JeÅ¼eli administrujesz nawet nieduÅ¼ym serwerem pocztowym na pewno masz Å›wiadomoÅ›Ä‡, Å¼e nie jesteÅ› w stanie monitorowaÄ‡ logÃ³w na bieÅ¼Ä…co. CiÄ™Å¼ko jest wyÅ‚apaÄ‡ np. problem w komunikacji z pewnÄ… domenÄ…. CiÄ™Å¼ko teÅ¼ oszacowaÄ‡ skalÄ™ ruchu na serwerze zarÃ³wno pod kÄ…tem iloÅ›ci jak i wolumenu maili. Trudno wybraÄ‡ domeny, dla ktÃ³rych warto by zrezygnowaÄ‡ z greylistingu, itd, itp\u0026hellip;\nNa szczÄ™Å›cie dostÄ™pne jest narzÄ™dzie pflogsumm, ktÃ³re wygeneruje nam doÅ›Ä‡ wyczerpujÄ…ce statystyki z logÃ³w postfix\u0026rsquo;a. Bardzo przydatne przy codziennym przeglÄ…dzie \u0026ldquo;stanu zdrowia\u0026rdquo; serwera pocztowego.\nPrzykÅ‚adowy wycinek statystyk z pewnego maÅ‚ego serwerka prezentuje siÄ™ tak:\nPostfix log summaries for Jul 4 Grand Totals ------------ messages 1158 received 1261 delivered 0 forwarded 5 deferred (50 deferrals) 2 bounced 392 rejected (23%) 0 reject warnings 0 held 0 discarded (0%) 164898k bytes received 242985k bytes delivered 201 senders 77 sending hosts/domains 354 recipients 51 recipient hosts/domains Per-Hour Traffic Summary time received delivered deferred bounced rejected -------------------------------------------------------------------- 0000-0100 26 28 2 0 7 0100-0200 14 18 3 0 10 0200-0300 4 4 1 0 8 0300-0400 6 6 1 0 8 0400-0500 4 4 0 0 8 0500-0600 2 2 1 0 9 0600-0700 8 8 1 0 9 0700-0800 16 18 1 0 10 0800-0900 58 60 1 0 8 0900-1000 104 110 5 0 17 1000-1100 132 152 2 0 18 1100-1200 106 106 1 0 31 1200-1300 64 70 2 0 9 1300-1400 112 132 2 0 14 1400-1500 98 106 1 0 78 1500-1600 86 88 2 0 32 1600-1700 56 56 3 0 23 1700-1800 58 77 5 2 19 1800-1900 36 36 3 0 16 1900-2000 26 26 2 0 24 2000-2100 48 50 3 0 9 2100-2200 32 42 2 0 10 2200-2300 34 34 3 0 10 2300-2400 28 28 3 0 5 ... Host/Domain Summary: Message Delivery sent cnt bytes defers avg dly max dly host/domain -------- ------- ------- ------- ------- ----------- 132 5688k 0 1.7 s 11.0 s gmail.com 104 2633k 0 4.6 s 2.8 m wp.pl 68 1525k 0 1.3 s 9.4 s interia.pl 42 744k 21 1.1 s 83.6 h o2.pl 30 89891 0 0.7 s 2.6 s op.pl 29 6677k 1 16.1 s 7.4 m poczta.onet.pl 26 540k 0 1.9 s 6.7 s poczta.fm ... Host/Domain Summary: Messages Received msg cnt bytes host/domain -------- ------- ----------- 50 4142k gmail.com 46 491259 facebookmail.com 38 1446k wp.pl 22 13520k interia.pl 14 675k o2.pl 10 105377 poczta.fm 10 57713 hotmail.com ... i duÅ¼o wiÄ™cej... Instalacja na Debianie:\napt-get install pflogsumm Testowo polecenie moÅ¼na uruchomiÄ‡ w nastÄ™pujÄ…cy sposÃ³b:\nsudo pflogsumm -i -d yesterday /var/log/mail.log /var/log/mail.log.1 W moim przypadku, logi przewijam codziennie ok 2:00 w nocy, dlatego podajÄ™ dwie Å›cieÅ¼ki do plikÃ³w log (bieÅ¼Ä…cego i wczorajszego) by mi te dwie godzinki nie umknÄ™Å‚y ðŸ˜‰\nPowyÅ¼sze polecenie wypisze na standardowe wyjÅ›cie statystyki w postaci Å‚adnie sformatowanych tekstowych tabel. Warto przyjrzeÄ‡ siÄ™ innym parametrom polecenia - moÅ¼na dziÄ™ki nim zrezygnowaÄ‡ ze statystyk, ktÃ³re nas nie interesujÄ…, bÄ…dÅº zmieniÄ‡ domyÅ›lnÄ… kolejnoÅ›Ä‡.\nTeraz warto uruchomiÄ‡ okresowe raportowanie. Edytujemy crona:\nsudo crontab -e Na generowanie statystyk warto wybraÄ‡ godzinÄ™ mniejszego obciÄ…Å¼enia serwera (@daily oznacza pÃ³Å‚noc), bo proces ich przygotowania doÅ›Ä‡ mocno obciÄ…Å¼y CPU. Wpisujemy polecenie wraz z interesujÄ…cymi nas parametrami:\n@daily /usr/sbin/pflogsumm -i --problems_first --no_bounce_detail \\  --no_deferral_detail -d yesterday \\  /var/log/mail.log /var/log/mail.log.1 | \\  mail -e -s \u0026#34;Statystyki poczty na `uname -n`\u0026#34; postmaster Kolejnego dnia powinniÅ›my otrzymaÄ‡ nasze statystyki.\n","href":"/2011/09/pflogsum-statystyki-poczty-dla-postfixa/","title":"pflogsumm - statystyki poczty dla postfixâ€™a"},{"content":"MiaÅ‚em ostatnio dziwnÄ… przygodÄ™: pewien serwer do backupu gdzie lÄ…duje duÅ¼o maÅ‚ych plikÃ³w i dodatkowo tworzonych jest sporo hardlinkÃ³w zaliczyÅ‚ pada. Co prawda staraÅ‚em siÄ™ go grzecznie poÅ‚oÅ¼yÄ‡ z pomocÄ… Magic SysRq ale poniewaÅ¼ nie wiedziaÅ‚em co byÅ‚o przyczynÄ… awarii fsck wydawaÅ‚ siÄ™ wskazany.\nPodczas prÃ³by uruchomienia fsck.ext4 na systemie plikÃ³w o rozmiarze ok 14TB z kilkuset milionami plikÃ³w po kilkudziesiÄ™ciu sekundach otrzymywaÅ‚em komunikat:\nBÅ‚Ä…d podczas przydzielania struktury icount: Memory allocation failed\nGooglajÄ…c dowiedziaÅ‚em siÄ™ Å¼e problem jest znany i wystÄ™puje podczas sprawdzania bardzo duÅ¼ych systemÃ³w plikÃ³w z duÅ¼Ä… iloÅ›ciÄ… hardlinkÃ³w. To akurat idealnie mÃ³j przypadek\u0026hellip; PrzewaÅ¼nie zdarza siÄ™ to na systemach 32 bitowych gdy fsck prÃ³buje zaalokowaÄ‡ powyÅ¼ej 2GB pamiÄ™ci. Jest to gÃ³rny limit moÅ¼liwej do wykorzystania przez pojedynczy proces pamiÄ™ci dla architektury 32 bitowej - nie moÅ¼na go przeskoczyÄ‡ nawet stosujÄ…c PAE. Ale mÃ³j system jest 64 bitowy, 8GB RAM\u0026rsquo;u, 8GB swap\u0026rsquo;a - nie jest dobrze jeÅ›li brakuje pamiÄ™ci ;-/\nZgodnie z sugestiami Teo Tso by zmniejszyÄ‡ zapotrzebowanie fsck na pamiÄ™Ä‡ moÅ¼na zmusiÄ‡ go by informacje o inodach i wÅ‚aÅ›ciwoÅ›ciach katalogÃ³w przechowywaÅ‚ w tymczasowym katalogu. By wskazaÄ‡ katalog tymczasowy naleÅ¼y utworzyÄ‡ plik: /etc/e2fsck.conf z zawartoÅ›ciÄ…:\n[scratch_files] directory = /var/cache/e2fsck Katalog trzeba utworzyÄ‡ rÄ™cznie:\nmkdir /var/cache/e2fsck Warto zadbaÄ‡ o kilka/kilkanaÅ›cie gigabajtÃ³w wolnego miejsca w tym katalogu - a najlepiej na czas sprawdzania podmontowaÄ‡ jakiÅ› zasÃ³b z fizycznie innego dysku niÅ¼ sprawdzany. Ja wykorzystaÅ‚em w tym celuÂ kilku gigabajtowegoÂ pen drive\u0026rsquo;a.\nTeraz moÅ¼na odpaliÄ‡ fsck\u0026rsquo;a (odpalajÄ…c zdalnie warto zrobiÄ‡ to w screen\u0026rsquo;ie):\nfsck.ext4 -f -C0 /dev/md1 Parametr -f wymusi sprawdzenie, a -C0 wyÅ›wietli pasek postÄ™pu co przy dÅ‚ugim sprawdzeniu da nam jakieÅ› wyobraÅ¼enie postÄ™pu. Tak uruchomiony fsck dziaÅ‚a zdecydowanie wolniej niÅ¼ przy domyÅ›lnych ustawieniach ale przynajmniej powinien siÄ™ wykonaÄ‡.\n# fsck.ext4 -fD -C0 /dev/md1 e2fsck 1.41.12 (17-May-2010) Przebieg 1: Sprawdzanie i-wÄ™zÅ‚Ã³w, blokÃ³w i rozmiarÃ³w /dev/md1: |=========== | 19.4% Opis podobnego problemu ze wsparciem Teo Tso:Â http://www.linux-archive.org/ext3-users/103464-2gb-memory-limit-running-fsck-6tb-device.html\n","href":"/2011/09/fsck-ext4-blad-podczas-przydzielania-struktury-icount-memory-allocation-failed/","title":"fsck.ext4 - BÅ‚Ä…d podczas przydzielania struktury icount: Memory allocation failed"},{"content":"","href":"/tags/magic-sysrq/","title":"Magic SysRq"},{"content":"Pomimo iÅ¼ Linux uchodzi za stabilne Å›rodowisko to raz na jakiÅ› czas trafi siÄ™ ciÄ™Å¼ka zwiecha - z powodu przeciÄ…Å¼enia, awarii sprzÄ™tu\u0026hellip; nieistotne\u0026hellip;\nZaÅ‚Ã³Å¼my Å¼e licho wziÄ™Å‚o za cel gÅ‚Ã³wny serwer plikÃ³w lub bazÄ™ danych dla wielu, wielu stron internetowych. DostaÄ‡ siÄ™ po ssh nie moÅ¼emy bo lecÄ… timeout\u0026rsquo;y, a siedzÄ…c bezpoÅ›rednio przy klawiaturze konsola nie reaguje. Mimo to coÅ› ostro daje po dyskach, wiÄ™c ewentualny twardy reset to na bank utrata czÄ™Å›ci plikÃ³w\u0026hellip; jeÅ›li system po nim w ogÃ³le wstanie\u0026hellip; ðŸ˜‘\nJeÅ›li powyÅ¼sza historyjka wyglÄ…da znajomo to zdecydowanie warto czytaÄ‡ dalej.\nW wielu dystrybucjach kernel standardowo jest skompilowany z opcjÄ…Â CONFIG_MAGIC_SYSRQ - opcja opisana jest jako szczegÃ³lnie przydatna dla developerÃ³w jÄ…dra ale i nam moÅ¼e siÄ™ przysÅ‚uÅ¼yÄ‡ jako ostatnia deska ratunku przed twardym resetem.\nAby wywoÅ‚aÄ‡ funkcjÄ™ trzeba przytrzymaÄ‡ na klawiaturze: Lewy ALT + PrintScrn/SysRq i przycisk okreÅ›lajÄ…cy funkcjÄ™. Kilka z moÅ¼liwych funkcji to:\n r - przeÅ‚Ä…cz klawiaturÄ™ z trybu RAW do XLATE (w wolnym tÅ‚umaczeniu: odzyskaj obsÅ‚ugÄ™ klawiatury od X\u0026rsquo;Ã³w), e - wyÅ›lij SIGTERM do wszystkich procesÃ³w z wyjÄ…tkiem init\u0026rsquo;a, i - wyÅ›lij SIGKILL do wszystkich procesÃ³w z wyjÄ…tkiem init\u0026rsquo;a, s - wywoÅ‚aj sync dla wszystkich zamontowanych zasobÃ³w (czyli zapisz wszystkie niezapisane dotÄ…d transakcje dyskowe), u - przemontuj wszystkie zamontowane zasoby to trybu tylko do odczytu, b - natychmiast uruchom ponownie system, bez odmontowania partycji i bez synchronizacji dyskÃ³w.  To tylko czÄ™Å›Ä‡ funkcji, ale wykonanie ich w kolejnoÅ›ci w jakiej zostaÅ‚y tu wypisane (czyli reisub) powinno skutkowaÄ‡ STOSUNKOWO bezpiecznym resetem, po ktÃ³rym nawet nie powinno byÄ‡ potrzebne skanowanie dyskÃ³w fsck\u0026rsquo;iem. KaÅ¼da z funkcji potrzebuje kilka/kilkanaÅ›cie sekund na wykonanie (szczegÃ³lnie warto zaczekaÄ‡ by po sync\u0026rsquo;u przestaÅ‚a migaÄ‡ kontrolka aktywnoÅ›ci dyskÃ³w twardych) - nie warto siÄ™ spieszyÄ‡.Â Po ostatnim wywoÅ‚aniu system powinien siÄ™ zrestartowaÄ‡ - zdarzyÅ‚o mi siÄ™ tylko kilka razy by procedura ta zawiodÅ‚a.\nMetodÄ™ moÅ¼na teÅ¼ wykorzystaÄ‡ dla serwerÃ³w zdalnych, ktÃ³re np. z jakiegoÅ› powodu nie chcÄ… siÄ™ zrestartowaÄ‡ w standardowy sposÃ³b. MoÅ¼na to zrobiÄ‡ wysyÅ‚ajÄ…c poszczegÃ³lne polecenia doÂ /proc/sysrq-trigger, np. tak:\necho b \u0026gt; /proc/sysrq-trigger Na zdalnych maszynach i VPS\u0026rsquo;ach wygodniejsze moÅ¼e byÄ‡ skonfigurowanie demona sysrqd.\nDla zainteresowanych, wiÄ™cej funkcji Magic SysRq (gÅ‚Ã³wnie diagnostycznych) i dokÅ‚adniejszy opis moÅ¼na znaleÅºÄ‡ na stronie wiki.\n","href":"/2011/09/magic-sysrq-bezpieczny-reset-linuxa/","title":"Magic SysRq - bezpieczny reset Linuxâ€™a"},{"content":"","href":"/tags/approx/","title":"approx"},{"content":"Wielu administratorÃ³w gdy zaczyna swojÄ… przygodÄ™ zarzÄ…dza jednÄ…/dwoma maszynami\u0026hellip; Po pewnym czasie jest ich juÅ¼ kilka\u0026hellip; W ktÃ³rymÅ› momencie dostrzega siÄ™ zalety wirtualizacji i na kilku maszynach fizycznych dziaÅ‚a kilkanaÅ›cie czy kilkadziesiÄ…t maszyn wirtualnych. W takiej sytuacji pobieranie aktualizacji dla wszystkich maszyn potrafi mocno zabiÄ‡ Å‚Ä…cze.\nI w tym momencie zaczynamy siÄ™ zastanawiaÄ‡ czy moÅ¼e nie warto byÅ‚oby zrobiÄ‡ wÅ‚asnego mirror\u0026rsquo;a paczek dla naszego ulubionego distro\u0026hellip; do prywatnego uÅ¼ytku\u0026hellip; synchronizowanego w nocy by nikomu nie przeszkadzaÄ‡\u0026hellip; i dostÄ™pnego nawet gdy bÄ™dziemy offline\u0026hellip; Zaczynamy liczyÄ‡ miejsce i okazuje siÄ™ Å¼e repozytorium Debiana dla architektury i386 to prawie 60GB (sic!), no ale mamy kilka maszynek z arch amd64 i tutaj teÅ¼ prawie 60GB - auÄ‡. W tym miejscu wielu dochodzi do wniosku Å¼e to jeszcze nie pora na wÅ‚asnego mirror\u0026rsquo;a ðŸ˜ƒ\nRozwiÄ…zaniem tego dylematu jest wykorzystanie approx\u0026rsquo;a, ktÃ³ry dziaÅ‚a jako cachujÄ…ce proxy dla repozytoriÃ³w Debiania i Ubuntu. PoÅ›redniczy on w pobieraniu plikÃ³w zapisujÄ…c kopiÄ™ kaÅ¼dego w lokalnym cache\u0026rsquo;u. Czyli pierwsze pobranie zasysa paczkÄ™ z sieci, a kolejne odwoÅ‚ania do approx\u0026rsquo;a serwujÄ… juÅ¼ tÄ™ pobranÄ… kopiÄ™. Ponadto przyjemne jest zachowanie approx\u0026rsquo;a, ktÃ³ry samodzielnie utrzymuje \u0026ldquo;czystoÅ›Ä‡\u0026rdquo; cachu usuwajÄ…c starsze paczki i aktualizujÄ…c nowe. Druga wielka zaleta tej aplikacji to lokalne skÅ‚adowanie tylko tych paczek ktÃ³re pobieramy - bo maÅ‚o kto potrzebuje caÅ‚ego repozytorium - drastycznie zmniejsza to rozmiar takiego mirror\u0026rsquo;a. U mnie mirror ma raptem kilkaset megabajtÃ³w.\nInstalacja i konfiguracja PoniewaÅ¼ paczka jest w domyÅ›lnych repozytoriach wystarczy:\napt-get install approx i po chwili mamy dziaÅ‚ajÄ…ce proxy.\nDomyÅ›lnie pliki skÅ‚adowane sÄ… w: /var/cache/approx - warto zadbaÄ‡ o odrobinÄ™ wolnego miejsca w tej lokalizacji.\nNaleÅ¼y jeszcze skonfigurowaÄ‡ odpowiednie repozytoria w pliku konfiguracyjnym: /etc/approx/approx.confÂ - u mnie wyglÄ…da on tak:\ndebian http://ftp.pl.debian.org/debian security http://security.debian.org/debian-security volatile http://volatile.debian.org/debian-volatile backports http://backports.debian.org/debian-backports # The following are the default parameter values, so there is # no need to uncomment them unless you want a different value. # See approx.conf(5) for details. $interface any $port 8080 $max_wait 30 #$max_rate unlimited #$user approx #$group approx #$syslog daemon #$pdiffs true #$verbose false #$debug true Po instalacji approx dziaÅ‚a na porcie 8080 o czym trzeba pamiÄ™taÄ‡ przy podawaniu URL\u0026rsquo;i w sources.list - mi to odpowiadaÅ‚o bo na porcie 80-tym mam odpalony serwer WWW pod jakieÅ› Å›mieci\u0026hellip; Ale Wam moÅ¼e odpowiadaÄ‡ uruchomienie approx\u0026rsquo;a na 80-tce.\nTeraz restartujemy approx\u0026rsquo;a by przeÅ‚adowaÄ‡ konfiguracjÄ™:\ninvoke-rc.d approx restart ZostaÅ‚o skonfigurowaÄ‡ plik /etc/apt/sources.list tak by wskazywaÅ‚ na nasze proxy. NaleÅ¼y to zrobiÄ‡ na kaÅ¼dej maszynce w naszej sieci by caÅ‚a zabawa miaÅ‚a sens.\nW przypadku Lenny\u0026rsquo;ego powinien on wyglÄ…daÄ‡ mniej wiÄ™cej tak:\ndeb http://approx.costam.pl:8080/debian lenny main non-free contrib deb-src http://approx.costam.pl:8080/debian lenny main non-free contrib deb http://approx.costam.pl:8080/security lenny/updates main contrib non-free deb-src http://approx.costam.pl:8080/security lenny/updates main contrib non-free deb http://approx.costam.pl:8080/volatile lenny/volatile main contrib non-free deb-src http://approx.costam.pl:8080/volatile lenny/volatile main contrib non-free deb http://approx.costam.pl:8080/backports lenny-backports-sloppy main W przypadku Squeeze\u0026rsquo;a tak:\ndeb http://approx.costam.pl:8080/debian squeeze main non-free contrib deb-src http://approx.costam.pl:8080/debian squeeze main non-free contrib deb http://approx.costam.pl:8080/security squeeze/updates main contrib non-free deb-src http://approx.costam.pl:8080/security squeeze/updates main contrib non-free deb http://approx.costam.pl:8080/debian squeeze-updates main non-free contrib deb-src http://approx.costam.pl:8080/debian squeeze-updates main non-free contrib deb http://approx.costam.pl:8080/backports squeeze-backports main No i na koniec sprawdzamy czy wszystko dziaÅ‚a:\napt-get update MoÅ¼emy sprÃ³bowaÄ‡ coÅ› zainstalowaÄ‡ i zobaczyÄ‡ jak siÄ™ spisze proxy.\n","href":"/2011/09/approx-cachujace-proxy-dla-repozytoriow-debiana/","title":"approx - cachujÄ…ce proxy dla repozytoriÃ³w Debiana"},{"content":"","href":"/tags/apt/","title":"apt"},{"content":"","href":"/tags/backports/","title":"backports"},{"content":"","href":"/tags/proxy/","title":"proxy"},{"content":"","href":"/tags/cache/","title":"cache"},{"content":"","href":"/tags/proc/","title":"proc"},{"content":"Linux bardzo agresywnie wykorzystuje wolnÄ… pamiÄ™Ä‡ RAM do buforowania danych odczytywanych z dyskÃ³w (inode\u0026rsquo;Ã³w, plikÃ³w, itd\u0026hellip;). Ma to niebagatelny wpÅ‚yw na zwiÄ™kszenie szybkoÅ›ci uruchamiania programÃ³w ktÃ³re juÅ¼ raz zostaÅ‚y uruchomione. Jednak nie zawsze jest to poÅ¼Ä…dane zachowanie, np. testujÄ…c szybkoÅ›Ä‡ uruchomienia/wykonywania tworzonej przez nas aplikacji - buforowanie zmienia czas Å‚adowania aplikacji przy kolejnych uruchomieniach.Â Dobrze byÅ‚oby mÃ³c wymusiÄ‡ zwolnienie buforÃ³w by kaÅ¼dy start programu miaÅ‚ porÃ³wnywalne \u0026ldquo;warunki startowe\u0026rdquo;.\nNa szczÄ™Å›cie moÅ¼na to zrobiÄ‡ w prosty sposÃ³b:\nsync \u0026amp;\u0026amp; echo 3 \u0026gt; /proc/sys/vm/drop_caches Polecenie to zwolni niewykorzystywany cache pliku stronicowania, katalogÃ³w i inodÃ³w.Â WczeÅ›niejsze uruchomienieÂ syncÂ pozwala zwolniÄ‡ wiÄ™kszÄ… iloÅ›Ä‡ buforÃ³w przez wymuszenie zapisania otwartych plikÃ³w.\nInne moÅ¼liwe warianty to:\n zwolnienie cache pliku stronicowania:  sync \u0026amp;\u0026amp; echo 1 \u0026gt; /proc/sys/vm/drop_caches  zwolnienie cache cache katalogÃ³w i inodÃ³w:  sync \u0026amp;\u0026amp; echo 2 \u0026gt; /proc/sys/vm/drop_caches Opcja ta dostÄ™pna jest w jajkach od wersji 2.6.16.\n","href":"/2011/09/wymuszenie-zwolnienia-pamieci-buforow-dyskowych-na-linuxie/","title":"Wymuszenie zwolnienia pamiÄ™ci buforÃ³w dyskowych na Linuxâ€™ie"},{"content":"","href":"/tags/mod_antiloris/","title":"mod_antiloris"},{"content":"","href":"/tags/mod_reqtimeout/","title":"mod_reqtimeout"},{"content":"","href":"/tags/slowloris/","title":"Slowloris"},{"content":"Od jakiegoÅ› czasu dostÄ™pny jest w sieci skrypt slowloris.plÂ pozwalajÄ…cy z pojedynczego komputera wykonaÄ‡ atak DOS na zdalny serwer WWW. Atak polega na uruchomieniu wielu rÃ³wnoczesnych sesji i bardzo wolnym wysyÅ‚aniu komunikatÃ³w HTTP. AtakujÄ…cy udaje \u0026ldquo;klienta z wolnym Å‚Ä…czem\u0026rdquo; rÃ³wnoczeÅ›nie uruchamiajÄ…c kolejne sesje by po pewnym czasie zajÄ…Ä‡ wszystkie dostÄ™pne. Serwer WWW przestaje wtedy odpowiadaÄ‡ na zapytania od innych klientÃ³w. Dodatkowo na Åºle wyskalowanych serwerach duÅ¼a liczba procesÃ³w Apachego moÅ¼e spowodowaÄ‡ swapowanie i bÅ‚Ä™dy braku pamiÄ™ci.\nW zaleÅ¼noÅ›ci od wydajnoÅ›ci atakowanej maszyny by doprowadziÄ‡ do jej zablokowania potrzeba przewaÅ¼nie od kilkunastu do kilkudziesiÄ™ciu sekund. Tak przeprowadzony atak DOS nie wymaga botnetu czy super wydajnego sprzÄ™tu - zwykÅ‚y lapciak w zupeÅ‚noÅ›ci wystarczy.\nNa chwilÄ™ obecnÄ… sÄ… juÅ¼ co najmniej dwie metody ochrony Apachego przed takim atakiem: mod_antiloris iÂ mod_reqtimeout. Pierwszy dostÄ™pny jako moduÅ‚ do rÄ™cznej kompilacji dla starszych wersji Apache (np. w Debianie Lennym). Drugi dostÄ™pny jest w standardzie od wersji 2.2.15 (np. w Debianie Squeeze).\nmod_antiloris pozwala na limitowanie iloÅ›ci rÃ³wnoczesnych sesji dla zdalnego klienta. W przypadku przekroczenia dozwolonej liczby zrywane jest poÅ‚Ä…czenie. Ma to swoje wady, np. gdy z naszego serwera WWW korzysta jakaÅ› duÅ¼a NAT\u0026rsquo;owana sieÄ‡ to przy wiÄ™kszej liczbie poÅ‚Ä…czeÅ„ zostanÄ… zablokowani \u0026ldquo;dobrzy\u0026rdquo; klienci. Trudne jest teÅ¼ wÅ‚aÅ›ciwe ustawienie maksymalnej liczby poÅ‚Ä…czeÅ„ - domyÅ›lnie ustawiona jest wartoÅ›Ä‡ 5. Ale niektÃ³re przeglÄ…darki (lub wtyczki do nich) podnoszÄ… limit rÃ³wnoczesnych poÅ‚Ä…czeÅ„ per serwer do 8.\nmod_reqtimeout pozwala na okreÅ›lenie po jakim czasie przerwaÄ‡ poÅ‚Ä…czenie w przypadku nie utrzymywania wystarczajÄ…cego przepÅ‚ywu danych. SkracajÄ…c - pozwala precyzyjnie wyciÄ…Ä‡ \u0026ldquo;wolnych\u0026rdquo; klientÃ³w. ModuÅ‚ ten monitoruje kaÅ¼dÄ… sesjÄ™ z osobna przez co nie ma zagroÅ¼enia blokowania sieci NAT czy \u0026ldquo;agresywnie\u0026rdquo; ustawionych przeglÄ…darek.\nInstalacja i konfiguracja mod_antilorisÂ (Apache do wersji 2.2.14) Najpierw musimy pobraÄ‡ potrzebne zaleÅ¼noÅ›ci:\napt-get install gcc apache2-prefork-dev PÃ³Åºniej pobieramy mod\u0026rsquo;a i rozpakowujemy:\nwget \u0026#34;ftp://ftp.monshouwer.eu/pub/linux/mod_antiloris/mod_antiloris-0.4.tar.bz2\u0026#34; tar xvf mod_antiloris-0.4.tar.bz2 cd mod_antiloris-0.4 JeÅ¼eli mamy takÄ… potrzebÄ™ moÅ¼emy wyedytowaÄ‡ plik mod_antiloris.c i podnieÅ›Ä‡ limit poÅ‚Ä…czeÅ„:\n#define antiloris_MAX_PER_IP 5 Do kompilacji moduÅ‚u wykorzystamy narzÄ™dzie apxs2, ktÃ³re skompiluje moduÅ‚ jako dynamicznie Å‚adowalny:\napxs2 -c mod_antiloris.c Teraz moÅ¼emy skopiowaÄ‡ moduÅ‚ do katalogu z innymi moduÅ‚ami:\nsudo cp .libs/mod_antiloris.so /usr/lib/apache2/modules/mod_antiloris.so Musimy teÅ¼ utworzyÄ‡ plik konfiguracyjny, ktÃ³ry bÄ™dzie Å‚adowaÄ‡ mod\u0026rsquo;a:\nsudo su -c \u0026#34;echo \u0026#39;LoadModule antiloris_module /usr/lib/apache2/modules/mod_antiloris.so\u0026#39; \u0026gt; /etc/apache2/mods-available/antiloris.load\u0026#34; WÅ‚Ä…czamy moduÅ‚:\nsudo a2enmod antiloris Na koniec musimy przeÅ‚adowaÄ‡ Apache\u0026rsquo;go:\nsudo service apache2 reload Instalacja i konfiguracja mod_reqtimeout (Apache od wersji 2.2.15) PoniewaÅ¼ moduÅ‚ jest dostÄ™pny wystarczy go uaktywniÄ‡ i przeÅ‚adowaÄ‡ Apachego:\nsudo a2enmod reqtimeout sudo service apache2 reload DomyÅ›lnie w Squeeze dostÄ™pny jest plik konfiguracyjny z poniÅ¼szymi wartoÅ›ciami:\nRequestReadTimeout header=20-40,minrate=500 RequestReadTimeout body=10,minrate=500 Pierwsza opcja oznacza: zezwalaj na wysyÅ‚anie zapytania przez co najmniej 20 sekund i zwiÄ™kszaj limit do maksymalnie 40 sekund po 1 sekundzie za kaÅ¼de przesÅ‚ane 500 bajtÃ³w.\nDruga opcja oznacza: zezwalaj na pobieranie przez co najmniej 10 sekund i zwiÄ™kszaj limit czasu w nieskoÅ„czonoÅ›Ä‡ po 1 sekundzie za kaÅ¼de pobrane 500 bajtÃ³w.\nDomyÅ›lne ustawienia sÄ… sensowne i powinny wystarczyÄ‡ w wiÄ™kszoÅ›ci przypadkÃ³w. Dodatkowe dopieszczenie tych opcji moÅ¼e byÄ‡ potrzebne na serwerach wysyÅ‚ajÄ…cych bÄ…dÅº odbierajÄ…cych doÅ›Ä‡ duÅ¼e pliki lub w przypadku \u0026ldquo;spersonalizowanych\u0026rdquo; atakÃ³w DOS.\nTest dziaÅ‚ania Skoro mamy juÅ¼ \u0026ldquo;tarczÄ™\u0026rdquo; warto sprawdziÄ‡ czy dziaÅ‚a. W tym celu pobieramy slowlorisa:\nwget \u0026#34;http://ha.ckers.org/slowloris/slowloris.pl\u0026#34; chmod +x slowloris.pl I moÅ¼emy uruchomiÄ‡ test:\nperl slowloris.pl -dns twojserwer.pl -port 80 -timeout 1 -num 300 -cache JeÅ¼eli po dwÃ³ch minutach (w zaleÅ¼noÅ›ci od konfiguracji sprzÄ™towej serwera) strona odpowiada i moÅ¼na siÄ™ na niÄ… bez problemÃ³w dostaÄ‡ to znaczy Å¼e nasz wysiÅ‚ek siÄ™ opÅ‚aciÅ‚.\nDalszym krokami wartymi podjÄ™cia moÅ¼e byÄ‡ analiza logÃ³w np. z uÅ¼yciem fail2ban i wycinanie na firewallu bardziej uciÄ…Å¼liwych goÅ›ci.\n","href":"/2011/09/zabezpieczenie-apachego-na-debianie-przed-slowlorisem/","title":"Zabezpieczenie Apachego na Debianie przed slowlorisâ€™em"},{"content":"","href":"/tags/io-wait/","title":"IO Wait"},{"content":"","href":"/tags/iostat/","title":"iostat"},{"content":"","href":"/tags/iotop/","title":"iotop"},{"content":"Na jednym z serwerÃ³w zauwaÅ¼yÅ‚em dziwny wzrost obciÄ…Å¼enia. Tzw. LOAD od kilku dni po woli rÃ³sÅ‚. top pokazywaÅ‚ Å¼e dwa rdzenie CPU czekajÄ… na dane z dysku - tzw. io wait na poziomie 80~90% ale Å¼aden proces w znaczÄ…cym stopniu nie obciÄ…Å¼aÅ‚ CPU.\nJest kilka narzÄ™dzi (iostat, wmstat), ktÃ³re pozwalajÄ… monitorowaÄ‡ obciÄ…Å¼enie dyskÃ³w ale ja nie szukaÅ‚em informacji czy i w jakim stopniu dyski sÄ… obciÄ…Å¼one - wiedziaÅ‚em Å¼e sÄ…. ChciaÅ‚em dowiedzieÄ‡ siÄ™ ktÃ³ry proces generuje to obciÄ…Å¼enie - by mÃ³c go ubiÄ‡ ðŸ˜ƒ\nPrzydatny okazaÅ‚ siÄ™ programik iotop - ktÃ³ry dziaÅ‚a jak top ale sortuje procesy w zaleÅ¼noÅ›ci od generowanego przez nie obciÄ…Å¼enia dyskÃ³w - wÅ‚aÅ›nie tego szukaÅ‚em:Program jest w standardowych repozytoriach Debiana i moÅ¼na go zainstalowaÄ‡ w ten sposÃ³b:\napt-get install iotop ","href":"/2011/09/sprawdzenie-ktory-proces-obciaza-dyski/","title":"Sprawdzenie ktÃ³ry proces obciÄ…Å¼a dyski"},{"content":"","href":"/tags/vmstat/","title":"vmstat"},{"content":"","href":"/tags/awstats/","title":"AWStats"},{"content":"","href":"/tags/cgi/","title":"CGI"},{"content":"","href":"/tags/jpgraph/","title":"JPGraph"},{"content":"Onego czasu prÃ³bowaÅ‚em znaleÅºÄ‡ coÅ› co uÅ‚atwiÅ‚oby mi rysowanie prostych wykresÃ³w wÂ PHP\u0026rsquo;ie inaczej niÅ¼ zÂ palca wÂ GD. Kumpel poleciÅ‚ miÂ JPGraph.\nJPGraph to Å›wietna sprawa, do generowania statystyk jak chociaÅ¼by na mojejÂ stronie, ale biblioteka potrafi duÅ¼o wiÄ™cej\u0026hellip;\nZaÅ‚Ã³Å¼my, Å¼e ze stronki zbieramy do bazy takie rzeczy jak: datÄ™, adres IP, iloÅ›Ä‡ poÅ‚Ä…czeÅ„ zÂ tego adresu. Prosta tabela (przykÅ‚ad wÂ Postgre SQL\u0026rsquo;u):\nCREATE TABLE wizyty ( pid serial NOT NULL, \u0026#34;data\u0026#34; date NOT NULL DEFAULT (\u0026#39;now\u0026#39;::text)::date, odslony integer NOT NULL DEFAULT 1, CONSTRAINT visits_pkey PRIMARY KEY (id) ); Dane zÂ takiej tabeli moÅ¼na Å‚atwo wyciÄ…gnÄ…Ä‡ jednym select\u0026rsquo;em:\nSELECT date_part(\u0026#39;day\u0026#39;, \u0026#34;data\u0026#34;) AS x, sum(odslony) AS y FROM wizyty WHERE date \u0026gt; (\u0026#39;today\u0026#39;::date - \u0026#39;30 days\u0026#39;::interval) GROUP BY \u0026#34;data\u0026#34; ORDER BY \u0026#34;data\u0026#34; LIMIT 30 PowyÅ¼sze zapytanie wyciÄ…gnie nam zÂ kolumny zÂ datÄ… tylko dzieÅ„ miesiÄ…ca, ktÃ³ry posÅ‚uÅ¼y za etykietÄ™ (oÅ› X) oraz sumÄ™ odsÅ‚on zÂ danego dnia (oÅ› Y), posortowane wedÅ‚ug daty iÂ tylko zÂ ostanich 30 dni.\nW zaleÅ¼noÅ›ci od sposobu dostÄ™pu iÂ pobierania wynikÃ³w, trzeba je Å‚adnie zapisaÄ‡ wÂ dwÃ³ch tablicach. Ja to robiÄ™ wÂ prostej pÄ™tli:\nforeach ($query-\u0026gt;result() as $row) { $x[] = $row-\u0026gt;x; $y[] = $row-\u0026gt;y; } MajÄ…c dane zostaÅ‚a zabawa zÂ ustawieniem oczekiwanych opcji wykresu:\n/* bez tego ani rusz */ include_once \u0026#39;jpgraph/jpgraph.php\u0026#39;; include_once \u0026#39;jpgraph/jpgraph_bar.php\u0026#39;; /* szerokoÅ›Ä‡ */ $width = 400; /* wysokoÅ›Ä‡ */ $height = 300; $graph = new Graph($width, $height); /* oÅ› X tekst, oÅ› Y wartoÅ›ci caÅ‚kowite */ $graph-\u0026gt;SetScale(\u0026#34;textint\u0026#34;); /* kolorowa ramka */ $graph-\u0026gt;SetFrame(true, \u0026#39;#222222\u0026#39;); $graph-\u0026gt;SetMarginColor(\u0026#39;#222222\u0026#39;); /* tytuÅ‚ wykresu, trochÄ™ konfiguracji fontÃ³w i kolorÃ³w */ $graph-\u0026gt;title-\u0026gt;Set(\u0026#39;Sumaryczna liczba odsÅ‚on\u0026#39;); $graph-\u0026gt;title-\u0026gt;SetFont(FF_VERDANA,FS_BOLD,10); $graph-\u0026gt;title-\u0026gt;SetColor(\u0026#39;#999999\u0026#39;); /* podobnieÅ¼ jak powyÅ¼ej dla osi X */ $graph-\u0026gt;xaxis-\u0026gt;SetFont(FF_VERDANA,FS_NORMAL,8); $graph-\u0026gt;xaxis-\u0026gt;SetColor(\u0026#39;#999999\u0026#39;); $graph-\u0026gt;yaxis-\u0026gt;SetFont(FF_VERDANA,FS_NORMAL,8); $graph-\u0026gt;yaxis-\u0026gt;SetColor(\u0026#39;#999999\u0026#39;); /* dodatkowe ozdobniki ;) */ $graph-\u0026gt;yscale-\u0026gt;ticks-\u0026gt;SupressZeroLabel(false); $graph-\u0026gt;yscale-\u0026gt;ticks-\u0026gt;SetColor(\u0026#39;#999999\u0026#39;); $graph-\u0026gt;xaxis-\u0026gt;SetTickLabels($x); /* genrujemy wÅ‚aÅ›ciwy wykres, w tym przypadku sÅ‚upkowy */ $bplot = new BarPlot($y); $bplot-\u0026gt;SetWidth(0.6); $bplot-\u0026gt;SetFillColor(\u0026#39;#D01A71@0.25\u0026#39;); $bplot-\u0026gt;SetColor(\u0026#39;gray\u0026#39;); /* dodajemy wykres do obiektu $graph (ktÃ³ry to moÅ¼e pomieÅ›ciÄ‡ i wyÅ›wietliÄ‡ wiele wykresÃ³w, co z resztÄ… pokazane jest poniÅ¼ej) */ $graph-\u0026gt;Add($bplot); /* teraz wykres liniowy */ $lplot = new LinePlot($y); /* z wypeÅ‚nieniem pod wykresem */ $lplot-\u0026gt;SetFillColor(\u0026#39;skyblue@0.5\u0026#39;); $lplot-\u0026gt;SetColor(\u0026#39;navy@0.7\u0026#39;); $lplot-\u0026gt;SetBarCenter(); /* typ znacznika na Å‚Ä…cznikach pomiÄ™dzy kolejnymi sÅ‚upkami */ $lplot-\u0026gt;mark-\u0026gt;SetType(MARK_SQUARE); $lplot-\u0026gt;mark-\u0026gt;SetColor(\u0026#39;blue@0.5\u0026#39;); $lplot-\u0026gt;mark-\u0026gt;SetFillColor(\u0026#39;lightblue\u0026#39;); $lplot-\u0026gt;mark-\u0026gt;SetSize(6); /* wrzucamy kolejny wykres do obrazu */ $graph-\u0026gt;Add($lplot); /* a teraz magia... */ $graph-\u0026gt;Stroke(); Co to robi\u0026hellip; Ano dokÅ‚adnie taki wykres jak ten poniÅ¼ej:\nCo prawda ten wykres nie odpowiada wÂ 100% podanemu ÅºrÃ³dÅ‚u. To statystyka zÂ mojej strony, ktÃ³ra niebieskÄ… liniÄ… zaznacza volumen pobranych danych - przykÅ‚ad jest nieco uproszczony.\nNa pierwszy rzut oka powyÅ¼szy skrypt wydaje siÄ™ doÅ›Ä‡ dÅ‚ugi iÂ jest tam duÅ¼o nie do koÅ„ca jasnych opcji, ale najfajniejsze jest to, Å¼e tak na prawdÄ™ nie trzeba siÄ™ tego uczyÄ‡. Biblioteka domyÅ›lnie dostarczana jest zÂ masÄ… przykÅ‚adÃ³w. Wystarczy wybraÄ‡ wykres podobny do tego, ktÃ³ry sami chcemy zrobiÄ‡ - skopiowaÄ‡ wiÄ™kszoÅ›Ä‡ kodu. ZnaleÅºÄ‡ inne wykresy, ktÃ³rych cechy chcemy powieliÄ‡ iÂ po kilku prÃ³bach skleimy takiego Frankenstein\u0026rsquo;a jakiego Å›wiat nie widziaÅ‚ wczeÅ›niej ;-D\nMÃ³j wykres akurat ma trochÄ™ zmieniony kolor tÅ‚a ramki iÂ fonty, tak aby lepiej wkomponowaÅ‚ siÄ™ wÂ mojÄ… stronÄ™ - reszta bazuje na dwÃ³ch przykÅ‚adach zÂ dokumentacji. Na zrobienie pierwszego wykresu zÂ wykorzystaniemÂ JPGraphÂ potrzebowaÅ‚em ok. godziny. Teraz wystarcza mi 10 minut ðŸ˜ƒ\n","href":"/2011/08/jpgraph-wykresy-z-phpa/","title":"JPGraph, wykresy z PHPâ€™a"},{"content":"Tak siÄ™ skÅ‚ada, Å¼eÂ DebianÂ ze wzglÄ™du na stosunkowo rzadkie wydawanie kolejnych wersji szybko staje siÄ™ niezbyt Å›wieÅ¼y a dostÄ™pne wÂ nim pakiety czÄ™sto nie speÅ‚aniajÄ… naszych oczekiwaÅ„. Nie ma najnowszej wersjiÂ Subversion\u0026hellip; Nie maÂ mod_securityÂ itd, itp\u0026hellip;\nRozwiÄ…zaniem tego problemu moÅ¼e byÄ‡ instalacja pakietÃ³w zÂ testowej gaÅ‚Ä™zi ale moÅ¼na polec na zaleÅ¼noÅ›ciach. MoÅ¼na teÅ¼ kompilowaÄ‡ ze ÅºrÃ³deÅ‚\u0026hellip; Tak czy siak w obu przypadkach aktualizacja iÂ utrzymanie tak zmodyfikowanego systemu byÅ‚oby jak wrzÃ³d na zadku.\nNa szczÄ™Å›cie jest prostsze rozwiÄ…zanie. System backportÃ³wÂ - czyli repozytorium dostarczajÄ…ce moÅ¼liwie najnowsze wersje pakietÃ³w dla gaÅ‚Ä™zi stabilnej. DodajÄ…c jedno ÅºrÃ³dÅ‚o moÅ¼na zainstalowaÄ‡Â subversion,Â mod_securityÂ iÂ inne, aÂ przy tym rÃ³wnoczeÅ›nie nie rozwaliÄ‡ sobie systemu.\nKonfiguracja - Squeeze Najpierw trzeba dodaÄ‡ dodatkowe ÅºrÃ³dÅ‚o pakietÃ³w:\necho \u0026#34;deb http://backports.debian.org/debian-backports \\ squeeze-backports main contrib non-free\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list Konfiguracja - Lenny Najpierw trzeba dodaÄ‡ dodatkowe ÅºrÃ³dÅ‚o pakietÃ³w:\necho \u0026#34;deb http://backports.debian.org/debian-backports \\ lenny-backports main contrib non-free\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list Ponadto w Lennym dostÄ™pne jest drugie repozytorium backportÃ³w tzw. lenny-backports-sloppy - to repozytorium nie gwarantuje bezproblemowej aktualizacji do Squeeze\u0026rsquo;a ale powinny siÄ™ tam znaleÅºÄ‡ nowsze wersje pakietÃ³w niÅ¼ w przypadku podstawowego repo.\nDodatkowym krokiem w przypadku Lennego, aczkolwiek zalecanym jest ustawienie tzw. pinningu dla backportÃ³w, aby pakiety zainstalowane zÂ nich byÅ‚y aktualizowane. Robimy to wklepujÄ…c:\necho \u0026#34;Package: *\u0026#34; \u0026gt;\u0026gt; /etc/apt/preferences echo \u0026#34;Pin: release a=lenny-backports\u0026#34; \u0026gt;\u0026gt; /etc/apt/preferences echo \u0026#34;Pin-Priority: 200\u0026#34; \u0026gt;\u0026gt; /etc/apt/preferences OdÅ›wieÅ¼anie repozytoriÃ³w Teraz odÅ›wieÅ¼amy repozytoria:\napt-get update Instalacja pakietÃ³w z backportÃ³w Instalacja pakietÃ³w zÂ backportÃ³w wymaga wymuszenia ich uÅ¼ycia, dziÄ™ki czemu jedynie wybrane przez nas pakiety zostanÄ… zainstalowane wÂ nowszych wersjach. Robimy to przykÅ‚adowo tak:\napt-get -t squeeze-backports install subversion lub\napt-get -t lenny-backports install subversion To tyle. MoÅ¼emy korzystaÄ‡ z aktualnych wersji paczek.\n","href":"/2011/08/konfiguracja-backportow-na-debianie/","title":"Konfiguracja backportÃ³w na Debianie"},{"content":"","href":"/tags/lenny/","title":"Lenny"},{"content":"Przy okazji wykonywania kilku drobnych optymalizacji swojej stronki natknÄ…Å‚em siÄ™ naÂ eAccelerator\u0026rsquo;a. Ciekawy projekt, ktÃ³ry wÂ sposobie dziaÅ‚ania przypomina Zend Optimizer\u0026rsquo;a ale ma jednÄ… zasadniczÄ… zaletÄ™ - jest darmowy ðŸ˜ƒ\nNiestety nie ma go wÂ repozytoriach Debiana, wiÄ™c trzeba go sobie skompilowaÄ‡ - caÅ‚y proces jest doÅ›Ä‡ prosty. Zaczynamy od pobrania najÅ›wieÅ¼szej paczki, obecnie jest to wersja 0.9.5.3:\nPobierz eAcceleratorÂ (ostatnio miaÅ‚em problem z tym linkiem wiÄ™c proponujÄ™ pogooglaÄ‡)\nPobieramy iÂ rozpakowujemy pliki:\ntar xvfj eaccelerator-0.9.5.3.tar.bz2 cd eaccelerator-0.9.5.3 Do kompilacjiÂ eAccelerator\u0026rsquo;a potrzebujemy paru paczek, ktÃ³re moÅ¼emy zainstalowaÄ‡ tak:\napt-get install build-essential php5-dev W katalogu ze ÅºrÃ³dÅ‚ami klepiemy (prawie standardowo):\nphpize ./configure make make install No iÂ eAcceleratorÂ jest juÅ¼ zainstalowany wÂ naszym systemie. PozostaÅ‚o wygenerowanie konfiguracjiÂ PHPÂ aby moduÅ‚ byÅ‚ automatycznie Å‚adowany oraz ustawienie podstawowych parametrÃ³w konfiguracyjnych.\nWÂ przypadku Debiana domyÅ›lna konfiguracja moduÅ‚Ã³wÂ PHPÂ przechowywana jest wÂ katalogu/etc/php5/conf.dÂ tam teÅ¼ zapiszemy naszÄ… konfiguracjÄ™ jakoÂ eaccelerator.ini. Tworzymy plik naszym ulubionym edytorem:\nvim /etc/php5/conf.d/eaccelerator.ini W pliku wpisujemy:\nextension=\u0026#34;eaccelerator.so\u0026#34; eaccelerator.shm_size=\u0026#34;128\u0026#34; eaccelerator.cache_dir=\u0026#34;/tmp/eaccelerator\u0026#34; eaccelerator.enable=\u0026#34;1\u0026#34; eaccelerator.optimizer=\u0026#34;1\u0026#34; eaccelerator.check_mtime=\u0026#34;1\u0026#34; eaccelerator.debug=\u0026#34;0\u0026#34; eaccelerator.filter=\u0026#34;\u0026#34; eaccelerator.shm_max=\u0026#34;0\u0026#34; eaccelerator.shm_ttl=\u0026#34;0\u0026#34; eaccelerator.shm_prune_period=\u0026#34;0\u0026#34; eaccelerator.shm_only=\u0026#34;0\u0026#34; eaccelerator.compress=\u0026#34;1\u0026#34; eaccelerator.compress_level=\u0026#34;9\u0026#34; extensionÂ - okreÅ›la plik moduÅ‚u, czasami moÅ¼e byÄ‡ konieczne podanie peÅ‚nej Å›cieÅ¼ki,\neaccelerator.shm_sizeÂ - okreÅ›la iloÅ›Ä‡ pamiÄ™ci wspÃ³Å‚dzielonej, ktÃ³rÄ…Â eAcceleratorÂ rezerwuje do przechowywani skompilowanych skryptÃ³w. Ja daÅ‚em 128MB bo mÃ³j serwerek ma 2GB RAM-u, ale przypuszczam Å¼e dla mniej obciÄ…Å¼onych maszyn wystarczy 16~32MB. NadajÄ…c temu parametrowi wartoÅ›Ä‡ 0Â ufamy programistom ðŸ˜‰\neaccelerator.cache_dirÂ - ustawiamy katalog, wÂ ktÃ³rym bÄ™dzie zapisywane to co nie bÄ™dzie siÄ™ juÅ¼ mieÅ›ciÄ‡ wÂ pamiÄ™ci wspÃ³Å‚dzielonej. Ja mam akurat sporÄ… osobnÄ… partycjÄ™ naÂ /tmp, ale rÃ³wnie dobrze nadaje siÄ™Â /var/cache/eacceleratorÂ czyÂ /var/tmp/eacceleratorÂ - ustawiamy jak nam wygodnie,\nSkoro juÅ¼ piszÄ™ oÂ katalogu na skrypty to warto go utworzyÄ‡ iÂ przypisaÄ‡ mu odpowiednie uprawnienia (ja ustawiam je tak aby tylkoÂ ApacheÂ miaÅ‚ dostÄ™p):\nmkdir /tmp/eaccelerator chown -R www-data:www-data /tmp/eaccelerator chmod 0770 /tmp/eaccelerator No to jeszcze restartÂ Apache\u0026rsquo;a iÂ moÅ¼emy sprawdzaÄ‡ jak dziaÅ‚a:\ninvoke-rc.d apache2 restart Najszybszym sposobem sprawdzenia czy moduÅ‚ siÄ™ Å‚aduje jest sprawdzenie wyniku poleceniaphp -vÂ - powinno to wyglÄ…daÄ‡ jak poniÅ¼ej:\nphp -v Zend Engine v2.2.0, Copyright (c) 1998-2008 Zend Technologies with eAccelerator v0.9.5.3, Copyright (c) 2004-2006 eAccelerator, \\  by eAccelerator Podobny wynik moÅ¼na uzyskaÄ‡ zÂ pomocÄ… funkcjiÂ phpinfo()Â iÂ prostego skryputÂ PHPÂ do jej wywoÅ‚ania.\nCzy warto? Na koniec trochÄ™ benchmarkÃ³w aby sprawdziÄ‡ czy caÅ‚a zabawa jest warta Å›wieczki ðŸ˜ƒ\nWykorzystam standardowe narzÄ™dzie dostÄ™pne zÂ Apache\u0026rsquo;m:Â abÂ (Apache benchmark):\nab -n 1000 -c 10 http://mojastrona.pl/ U mnie daÅ‚o to nastÄ™pujÄ…ce wyniki - zÂ wyÅ‚Ä…czonymÂ eAccelerator\u0026rsquo;em:\nConcurrency Level: 10 Time taken for tests: 8.648 seconds Complete requests: 1000 Failed requests: 0 Write errors: 0 Total transferred: 12836000 bytes HTML transferred: 12612000 bytes Requests per second: 115.64 [#/sec] (mean) Time per request: 86.477 [ms] (mean) Time per request: 8.648 [ms] (mean, across all concurrent requests) Transfer rate: 1449.54 [Kbytes/sec] received Oraz zÂ wÅ‚Ä…czonym:\nConcurrency Level: 10 Time taken for tests: 3.663 seconds Complete requests: 1000 Failed requests: 0 Write errors: 0 Total transferred: 12840344 bytes HTML transferred: 12616120 bytes Requests per second: 272.97 [#/sec] (mean) Time per request: 36.634 [ms] (mean) Time per request: 3.663 [ms] (mean, across all concurrent requests) Transfer rate: 3422.90 [Kbytes/sec] received Wynik jest caÅ‚kiem niezÅ‚y, ponad dwa razy szybciej. AÂ w niektÃ³rych przypadkach udaje siÄ™ wyciÄ…gnÄ…Ä‡ wiÄ™cej (nawet 5~10 krotnie). Tak, czy siak - warto!\n","href":"/2011/08/optymalizacja-php-z-eacceleratorem/","title":"Optymalizacja PHP z eAcceleratorâ€™em"},{"content":"","href":"/tags/postgresql/","title":"PostgreSQL"},{"content":"","href":"/tags/squeeze/","title":"Squeeze"},{"content":"Co prawda na swojej stronie zrobiÅ‚em kilka podstawowych statystyk iÂ coÅ› tam sobie logujÄ™ do bazy danych, ale gdyby siÄ™ chwilÄ™ zastanowiÄ‡ to przecieÅ¼ to samo robi serwerÂ wwwÂ - wrzuca do logÃ³w kaÅ¼de zapytanieÂ HTTP, kod bÅ‚Ä™du, nazwÄ™ agenta, itd. Dublowanie tych danych nie jest najbardziej optymalne.\nStÄ…d teÅ¼ chwilÄ™ pogooglaÅ‚em iÂ znalazÅ‚em Å›wietnyÂ Open Source\u0026rsquo;owy projekt:Â AWStats, ktÃ³ry jest webowym analizatorem logÃ³w dla serwerÃ³wÂ HTTP,Â FTPÂ iÂ SMTP.\nInstalacja i konfiguracja Najpierw instalacja, na moim Debianie leci to tak:\nsudo apt-get install awstats Teraz trzeba siÄ™ chwilÄ™ zastanowiÄ‡ nad konfiguracjÄ… serwera iÂ celem, ktÃ³ry chcemy osiÄ…gnÄ…Ä‡:\n czy staty bÄ™dÄ… dostÄ™pne publicznie? czy tylko dla ograniczonego grona zainsteresowanych (np. wÂ pewnej sieci)? a moÅ¼e zabezpieczenie hasÅ‚em?  WiedzÄ…c, Å¼eÂ AWStatsÂ dziaÅ‚ajÄ… jako skryptÂ CGIÂ wystawianie takiego serwisu \u0026ldquo;na Å›wiat\u0026rdquo; nie wydaje mi siÄ™ bezpiecznym rozwiÄ…zaniem. WolÄ™ np. skonfigurowaÄ‡ serwis tak aby byÅ‚ dostÄ™pny tylko wÂ LAN\u0026rsquo;ie, gdzie mam wiÄ™kszÄ… wÅ‚adzÄ™ iÂ szybciej poradzÄ™ sobie zÂ namierzeniem iÂ zablokowaniem ewentualnego napastnika ðŸ˜‰\nOpiszÄ™ tylko dwa pierwsze przypadki (jak ktoÅ› chce hasÅ‚o to szybko znajdzie jak je ustawiÄ‡) - pierwsza dla leniwych, druga dla ambitnych ðŸ˜‰\nPrzygotowania Bez wzglÄ™du na wybranÄ… metodÄ™ konfiguracji (leniwÄ…, bÄ…dÅº nie) do dziaÅ‚ania serwisu potrzebny jest wÅ‚Ä…czony wÂ ApacheÂ moduÅ‚Â CGI. Jest tak wÂ domyÅ›lnej konfiguracji ale jeÅ›li nie masz pewnoÅ›ci to odpal:\na2enmod cgi Musi teÅ¼ byÄ‡ zdefiniowany katalog ze skryptamiÂ CGIÂ zÂ uaktywnionÄ… interpretacjÄ…Â CGIÂ - domyÅ›lnie wÂ pliku /etc/apache2/sites-available wÂ pliku default jest poniÅ¼sza konfiguracja:\nScriptAlias /cgi-bin/ /usr/lib/cgi-bin/ \u0026lt;Directory \u0026#34;/usr/lib/cgi-bin\u0026#34;\u0026gt; AllowOverride None Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch Order allow,deny Allow from all \u0026lt;/Directory\u0026gt; Na potrzeby metody leniwej jest to wystarczajÄ…ca konfiguracja, dla ambitnych zalecam trochÄ™ inne umiejscowienie tego kodu.\nMetoda dla leniwych PoniewaÅ¼ pakietÂ AWStatsÂ instaluje siÄ™ przykÅ‚adowÄ… konfiguracjÄ… moÅ¼na bardzo szybko uruchomiÄ‡ staty, wystarczy skopiowaÄ‡ jeden plik:\ncp /usr/share/doc/awstats/examples/apache.conf /etc/apache2/conf.d/awstats No iÂ tyle ðŸ˜‰\nMetoda dla ambitnych Ambitnym zalecam nieco innÄ… konfiguracjÄ™: zÂ ograniczeniem dostÄ™pu do statystyk wyÅ‚Ä…cznie z LAN\u0026rsquo;u iÂ tak samo zÂ dostÄ™pem do skryptÃ³wÂ CGI. WÂ moim przypadku Å¼aden zÂ wystawianych przezemnie serwisÃ³w nie korzysta zÂ CGI, wiÄ™c udostÄ™pnianie tych skryptÃ³w wszystkim \u0026ldquo;zainteresowanym\u0026rdquo; nie ma sensu.\nProponujÄ™ wykorzystaÄ‡ taki lub podobny plik konfiguracyjny dla hosta serwujÄ…cego statystyki:\n\u0026lt;VirtualHost *:80\u0026gt; ServerName staty.domena.pl ServerAdmin webmaster@domena.pl DocumentRoot /var/www/stats/ \u0026lt;Directory /\u0026gt; Options FollowSymLinks AllowOverride None \u0026lt;/Directory\u0026gt; \u0026lt;Directory /var/www/stats/\u0026gt; Options -Indexes FollowSymLinks MultiViews AllowOverride None Order Deny,Allow Deny from all Allow from 192.168.1.0/24 \u0026lt;/Directory\u0026gt; ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/ \u0026lt;Directory \u0026#34;/usr/lib/cgi-bin\u0026#34;\u0026gt; AllowOverride None Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch Order Deny,Allow Deny from all Allow from 192.168.1.0/24 \u0026lt;/Directory\u0026gt; \u0026lt;Directory /var/lib/awstats\u0026gt; Options None AllowOverride None Order Deny,Allow Deny from all Allow from 192.168.1.0/24 \u0026lt;/Directory\u0026gt; Alias /awstats-icon/ /usr/share/awstats/icon/ \u0026lt;Directory /usr/share/awstats/icon\u0026gt; Options None AllowOverride None Order Deny,Allow Deny from all Allow from 192.168.1.0/24 \u0026lt;/Directory\u0026gt; ErrorLog /var/log/apache2/error.log LogLevel warn CustomLog /var/log/apache2/access.log combined \u0026lt;IfModule mod_rewrite.c\u0026gt; RewriteEngine On RewriteCond $1 !^$ RewriteCond %{REQUEST_URI} !.*cgi-bin RewriteCond %{REQUEST_URI} !.*awstats.pl RewriteRule /(.*)/? /cgi-bin/awstats.pl?config=$1 [PT] RewriteRule ^/awstats.pl(.*?) /cgi-bin/awstats.pl$1 [QSA,R,L] \u0026lt;/IfModule\u0026gt; \u0026lt;/VirtualHost\u0026gt; Z waÅ¼nych rzeczy do personalizacji:\n ServerName - wpisz swojÄ… nazwÄ™ serwisu, Allow from 192.168.1.0/24 - zamieÅ„ na adres/adresy, ktÃ³re Tobie odpowiadajÄ…, mod_rewrite - ostatnich kilka linijek wykorzystuje mod_rewrite do uproszczenia odwoÅ‚aÅ„ do statystyk, wystarczy wtedy wpisaÄ‡ adres np. tak: http://staty.domena.pl/nazwa.domeny.ktora.nas.interesuje.pl plik zapisujemy jakoÂ /etc/apache2/sites-available/awstats  Teraz zostaÅ‚o nam uaktywnienie site\u0026rsquo;a:\na2ensite awstats CzÄ™Å›Ä‡ wspÃ³lna konfiguracji Teraz tworzymy katalog na skrypt, ktÃ³ry wypisze nam dostÄ™pne statystyki:\nmkdir /var/www/stats chown -R www-data:www-data /var/www/stats/ WÅ‚aÅ›ciwa konfiguracja AWStats Pliki konfiguracyjneÂ AWStatsÂ znajdujÄ… siÄ™ wÂ kataloguÂ /etc/awstats. Jest ich dokÅ‚adnie 2Â szt.:\n awstats.conf awstats.conf.local  PlikÂ awstats.conf zawiera przykÅ‚adowÄ… konfiguracjÄ™ wystarczajÄ…cÄ… do odpalenia statystyk dla pojedynczego hosta. ZÂ kolei plikÂ awstats.conf.local jest miejscem gdzie moÅ¼na wrzuciÄ‡ wspÃ³lnÄ… konfiguracjÄ™ dla kilku plikÃ³w hostÃ³w.\nJeÅ¼eli mamy wiele hostÃ³w (a taki przypadek tutaj omawiam) to wygodniej bÄ™dzie nam wrzuciÄ‡ caÅ‚y plikÂ awstats.confÂ doÂ awstats.conf.localÂ iÂ w kolejnych plikach konfiguracyjnych zmieniaÄ‡ tylko parametry rozrÃ³Å¼niajÄ…ce poszczegÃ³lne hosty. Robimy wiÄ™c tak:\nmv /etc/awstats/awstats.conf.local /etc/awstats/awstats.conf.local.orig mv /etc/awstats/awstats.conf /etc/awstats/awstats.conf.local Teraz musimy zmieniÄ‡ kilka linijek wÂ plikuÂ awstats.conf.local:\n# musimy odszukaÄ‡ i zakomentowaÄ‡ poniÅ¼sze linie LogFile=\u0026#34;/var/log/apache/access.log\u0026#34; SiteDomain=\u0026#34;\u0026#34; HostAliases=\u0026#34;localhost 127.0.0.1\u0026#34; Include \u0026#34;/etc/awstats/awstats.conf.local\u0026#34; # w ten sposÃ³b #LogFile=\u0026#34;/var/log/apache/access.log\u0026#34; #SiteDomain=\u0026#34;\u0026#34; #HostAliases=\u0026#34;localhost 127.0.0.1\u0026#34; #Include \u0026#34;/etc/awstats/awstats.conf.local\u0026#34; # dodatkowo odszukujemy liniÄ™ LogFormat=4 # i zamieniamy na LogFormat=1 Teraz moÅ¼emy utworzyÄ‡ pliki konfiguracyjne dla naszych vhostÃ³w raptem wÂ kilku linijkach, np.:\nLogFile=\u0026#34;/var/log/apache2/access.log\u0026#34; SiteDomain=\u0026#34;domena.pl\u0026#34; HostAliases=\u0026#34;www.domena.pl\u0026#34; Include \u0026#34;/etc/awstats/awstats.conf.local\u0026#34; OczywiÅ›cie trzeba wpisaÄ‡ wÅ‚asnÄ… lokalizacjÄ™ pliku access.log. WÂ powyÅ¼szym przypadku jest to lokalizacja domyÅ›lna, wspÃ³lna dla wszystkich vhostÃ³w - rozrÃ³Å¼nienie ruchu do poszczegÃ³lnych vhostÃ³w nastÄ™puje dziÄ™ki podaniu parametrÃ³w SiteDomain (podstawowej domeny danej strony) oraz HostAliases (innych domen wskazujÄ…cych na tego samego vhosta).\nOstatnim elementem jest zaÅ‚adowanie pliku ze wspÃ³lnÄ… konfiguracjÄ….\nZmiana uprawnieÅ„ do logÃ³w Aby umoÅ¼liwiÄ‡ dostÄ™pÂ AWStatsÂ do logÃ³w serweraÂ ApacheÂ musimy wykonaÄ‡ dwie czynnoÅ›ci. Na poczÄ…tek zmiana atrybutu dla aktualnego pliku log:\nchmod o+r /var/log/apache2/access.log PÃ³Åºniej musimy zadbaÄ‡ aby logi po rotacji przez logrotate rÃ³wnieÅ¼ zachowywaÅ‚y atrybuty, oraz aby przed rotacjÄ…Â AWStatsÂ wygenerowaÅ‚o statystyki, ktÃ³rych nie zebraÅ‚o wczeÅ›niej. WÂ tym celu zmieniamy plikÂ /etc/logrotate.d/apache2Â tak by wyglÄ…daÅ‚ jak poniÅ¼ej:\n/var/log/apache2/*.log { weekly missingok rotate 52 compress delaycompress notifempty create 644 root adm sharedscripts prerotate /usr/share/doc/awstats/examples/awstats-update endscript postrotate if [ -f /var/run/apache2.pid ]; then /etc/init.d/apache2 restart \u0026gt; /dev/null fi endscript } PrzeÅ‚adowanie konfiguracji Apache Po tych wszystkich zmianach wÂ konfiguracji musimy zrestartowaÄ‡ Apache:\ninvoke-rc.d apache2 restart Testy konfiguracji Aby sprawdziÄ‡ konfiguracjÄ™Â AWStatsÂ sprÃ³bujemy wejÅ›Ä‡ na stronÄ™:http://staty.domena.pl/cgi-bin/awstats.pl?config=domena.pl\nJeÅ¼eli na Å¼adnym zÂ etapÃ³w nie popeÅ‚niliÅ›my bÅ‚Ä™du to naszym oczom powinny ukazaÄ‡ siÄ™ \u0026ldquo;wspaniaÅ‚e iÂ upragnione statystyki\u0026rdquo; ðŸ˜ƒ\nJedynÄ… delikatnÄ… wadÄ…Â awstatsÂ jest \u0026ldquo;brzydki\u0026rdquo; iÂ dÅ‚ugi link zÂ cgiÂ wÂ Å›rodku\u0026hellip; Nieco mnie to irytowaÅ‚o, wiÄ™c przysiadÅ‚em chwilÄ™ przy mod_rewrite iÂ przygotowaÅ‚em reguÅ‚ki (byÅ‚y podane wÂ konfiguracji dla ambitnych), ktÃ³re pozwalajÄ… rozpoczÄ…Ä‡ przeglÄ…danie statystyk zÂ uproszczonego linku postaci:\nhttp://staty.domena.pl/domena.pl\nProste, czyste iÂ klarowne, bez zbÄ™dnych Å›mieci.\nCo prawda koniec tutora, ale nie koniec samej konfiguracji - proponujÄ™ aby przejrzeÄ‡ przykÅ‚adowy plik zÂ konfiguracjÄ… iÂ zapoznaÄ‡ siÄ™ zÂ zawartymi tam opcjami.\n","href":"/2011/08/statystyki-odwiedzin-dla-wielu-serwisow-z-awstats/","title":"Statystyki odwiedzin dla wielu serwisÃ³w z AWStats"},{"content":"","href":"/tags/ca/","title":"CA"},{"content":"Certyfikaty oparte oÂ SSL stanowiÄ… obecnie podstawÄ™ bezpieczeÅ„stwa wielu usÅ‚ug sieciowych zaczynajÄ…c odÂ HTTP, przez POPS, IMAPS, itd\u0026hellip; Niestety zakupienie certyfikatu wÂ organizacjach jak VeriSgin czy Thawte jest doÅ›Ä‡ kosztowe, aÂ jeÅ¼eli potrzebujemy kilka certyfikatÃ³w to czÄ™sto na lokalne potrzeby jest to po prostu nie opÅ‚acalne.\nPostaram siÄ™ przedstawiÄ‡ wersjÄ™ \u0026ldquo;ekonomicznÄ…\u0026rdquo; certyfikacji ðŸ˜ƒ\nGenerowanie Certificate Signing Request Pierwszym etapem generowania certyfikatu jest przygotowanieÂ Certificate Signing Request, czyli czegoÅ› wÂ rodzaju \u0026ldquo;proÅ›by\u0026rdquo; oÂ certyfikat. Nasza \u0026ldquo;proÅ›ba\u0026rdquo; po podpisaniu przez centrum autoryzacyjne stanie siÄ™ certyfikatem.\nDo wygenerowania Request\u0026rsquo;u potrzebny jest najpierw klucz prywatny, ktÃ³ry generujemy np. tak:\nopenssl genrsa -aes256 -out priv.key 4096 PowyÅ¼sze polecenie poprosi nas dwa razy oÂ hasÅ‚o, ktÃ³re trzeba zapamiÄ™taÄ‡ (albo zapisaÄ‡ iÂ zamknÄ…Ä‡ wÂ sejfie) - zalecam wykorzystanie pseudolosowego ciÄ…gu znakÃ³w oÂ dÅ‚ugoÅ›ci minimum 10 znakÃ³w.\nPo genrsa moÅ¼emy uÅ¼yÄ‡ kilku opcji wybierajÄ…c wÂ ten sposÃ³b algorytm szyfrujÄ…cy - do wyboru sÄ…: des, des3, aes128, aes192, aes256. Ja wybraÅ‚em 256-bitowegoÂ AES\u0026rsquo;a - najmocniejszy zÂ tych algorytmÃ³w.\nOstatni parametr do dÅ‚ugoÅ›Ä‡ klucza. MoÅ¼na uÅ¼yÄ‡ innej wartoÅ›ci np. 1024. Klucz wygeneruje siÄ™ szybciej ale bÄ™dzie prostszy do zÅ‚amania. ZÂ moich doÅ›wiadczeÅ„ wynika, Å¼e niektÃ³re aplikacje mogÄ… mieÄ‡ problem zÂ obsÅ‚ugÄ… dÅ‚ugiego klucza (np. jak uÅ¼yty wÂ tym przykÅ‚adzie), wtedy uÅ¼ycie mniejszej wartoÅ›ci moÅ¼e byÄ‡ konieczne (lepsze sÅ‚absze zabezpieczenie niÅ¼ Å¼adne).\nWarto ograniczyÄ‡ uprawnienia do wygenerowanego klucza prywatnego tak by tylko wÅ‚aÅ›ciciel miaÅ‚ do niego dostÄ™p:\nchmod 400 priv.key Przy okazji tworzenia klucza prywatnego warto wspomnieÄ‡, Å¼e jeÅ¼eli bÄ™dziemy chcieli go uÅ¼yÄ‡ wÂ tak przygotowanej postaci np. wÂ Apache\u0026rsquo;m to przy kaÅ¼dym starcieÂ ApacheÂ bÄ™dzie nas prosiÄ‡ oÂ podanie hasÅ‚a odbezpieczajÄ…cego klucz prywatny. Niby to bezpieczne ale zÂ drugiej strony przez takie zabezpieczenieÂ ApacheÂ nie podniesie siÄ™ samodzielnie np. po awarii. RozwiÄ…zaniem jest przygotowanie odszyfrowanej wersji klucza prywatnego, zÂ ktÃ³rej bÄ™dzie korzystaÅ‚Â Apache. Robi siÄ™ to tak:\nopenssl rsa -in priv.key -out priv.unsecure.key chmod 400 priv.unsecure.key Klucz priv.unsecure.key podany wÂ konfiguracji programu nie bÄ™dzie wymagaÅ‚ hasÅ‚a. Koniecznie naleÅ¼y uniemoÅ¼liwiÄ‡ dostÄ™p do tego pliku wszystkim zÂ wyjÄ…tkiem root\u0026rsquo;a!\nopenssl req -new -key priv.key -out request.csr Co dalej? Ok. Mamy juÅ¼ request\u0026rsquo;a, warto wÂ tym miejscu wspomnieÄ‡ co moÅ¼emy zÂ nim zrobiÄ‡:\n MoÅ¼emy taki plik przesÅ‚aÄ‡ do centrum autoryzacji (CA) celem podpisania iÂ wygenerowania certyfiaktu. Klucze publiczneÂ CAÂ takich jak Thawte, VeriSign, itp sÄ… doÅ‚Ä…czane do przeglÄ…darek internetowych, OS\u0026rsquo;Ã³w, etc. dziÄ™ki temu strony internetowe (bÄ…dÅº inne usÅ‚ugi) zabezpieczone takimi certyfikatami weryfikujÄ… siÄ™ bez Å¼adnej dodatkowej akcji ze strony uÅ¼ytkownika. Warto wziÄ…Ä‡ pod uwagÄ™ to rozwiÄ…zanie, jeÅ¼eli np. chcemy zabezpieczyÄ‡ sklep internetowy - my odpuÅ›cimy to rozwiÄ…zanie ze wzglÄ™du na koszty ðŸ˜ƒ DrugÄ… opcjÄ… jest moÅ¼liwoÅ›Ä‡ samodzielnego podpisania certyfikatu tworzÄ…c tzw. SelfSigned Certificate. To zalecana opcja jeÅ¼eli mamy tylko jednÄ… stronÄ™/usÅ‚ugÄ™. UÅ¼ytkownik raz doda sobie nasz certyfikat jako zaufany iÂ bÄ™dzie mÃ³gÅ‚ korzystaÄ‡ zÂ szyfrowania do woli. Metoda ta robi siÄ™ problematyczna gdy trzeba zarzÄ…dzaÄ‡ wiÄ™kszÄ… liczbÄ… certyfikatÃ³w. Ostatnia opcja to utworzenie wÅ‚asnegoÂ CAÂ (czyli specjalnego certyfikatu), ktÃ³rym bÄ™dziemy podpisywaÄ‡ wygenerowane przez nas Requesty. Ma to tÄ™ zaletÄ™, Å¼e wystarczy rozdystrybuowaÄ‡ klucz publicznyÂ CAÂ iÂ bÄ™dzie to wystarczajÄ…ce do weryfikacji wszystkich naszych certyfikatÃ³w.  Tworzenie certyfikatÃ³w SelfSigned Zaczniemy od prostszej wersji czyli podpiszemy nasz request wygenerowanym przez nas wczeÅ›niej kluczem prywatnym tworzac tzw. SelfSigned Certificate. Aby to zrobiÄ‡ potrzebne jest takie polecenie:\nopenssl x509 -req -days 365 -in request.csr \\ -signkey priv.key -out certificate.crt Tak oto wygenerowaliÅ›my certyfikat certificate.crt waÅ¼ny przez 365 dni (tutaj dowolnoÅ›Ä‡ ustawieÅ„ ale 1Â rok to sensowny okres).\nWÅ‚aÅ›ciwoÅ›ci certyfikatu moÅ¼na sprawdziÄ‡ np. tak:\nopenssl x509 -noout -text -in certificate.crt Tworzenie wÅ‚asnego CA Najpierw naleÅ¼y utworzyÄ‡ klucz prywatny naszegoÂ CA, robi siÄ™ to dokÅ‚adnie tak samo jak wÂ przypadku generowanego wczeÅ›niej klucza prywatnego dla serwera. PÃ³Åºniej musimy wygenerowaÄ‡ requesta (analogicznie jak wÂ przypadku certyfikatu SelfSigned). Czyli dwa polecenia:\nopenssl genrsa -aes256 -out ca.key 4096 openssl req -new -x509 -days 365 \\ -key ca.key -out ca.crt Skoro mamy juÅ¼ certyfikat naszegoÂ CA, moÅ¼emy podpisaÄ‡ wczeÅ›niej wygenerowany Request dla serwera:\nopenssl x509 -req -days 365 -in request.csr -CA ca.crt \\ -CAkey ca.key -set_serial 01 -out certificate.crt OgÃ³lnie podpisywanie przebiega podobnie jak przy certyfikatach SelfSigned ale jak widaÄ‡ wykorzystywane sÄ… klucze naszegoÂ CAÂ iÂ pojawia siÄ™ nowy parametr: set_serial, ktÃ³rego wartoÅ›Ä‡ musi byÄ‡ inna dla kaÅ¼dego podpisanego przez toÂ CAÂ certyfikatu. NajproÅ›ciej aby serial przyjmowaÅ‚ numer kolejno wygenerowanego certyfikatu.\nJeÅ¼eli wiemy, Å¼e bÄ™dziemy generowaÄ‡ wiÄ™cej tego typu certyfikatÃ³w warto przygotowaÄ‡ sobie skrypt, ktÃ³ry zadba oÂ prawidÅ‚owÄ… wartoÅ›Ä‡ pola serial.\nPodsumowanie Certyfikaty przygotowane wÂ ten sposÃ³b moÅ¼na wrzuciÄ‡ doÂ Apache, postfix\u0026rsquo;a, itd\u0026hellip; iÂ w ten sposÃ³b szyfrujÄ…c ruch.\n","href":"/2011/08/certyfikaty-selfsigned/","title":"Certyfikaty SelfSigned"},{"content":"MÃ³j serwer pocztowy dziaÅ‚a od jakiegoÅ› czasu na dynamicznym IP (dobre bo tanie\u0026hellip;) iÂ przewaÅ¼nie nie ma zÂ tym problemÃ³w. PostaraÅ‚em siÄ™ jak mogÅ‚em ustawiajÄ…c SPF\u0026rsquo;a iÂ DomainKeys aby uwiarygodniÄ‡ go uÂ wiÄ™kszych dostawcÃ³w poczty.\nNiestety wszystko to diabli biorÄ… wÂ momencie gdy wygasa mi leasseÂ DHCPÂ iÂ dostajÄ™ nowe IP po jakimÅ› spamerze/zombiaku. Wisi takie wÂ 2-3 wiÄ™kszychÂ RBL\u0026rsquo;ach iÂ o dostarczaniu poczty moÅ¼na zapomnieÄ‡. MiÅ‚o gdy jeszcze zdalnyÂ MTAÂ zechce odesÅ‚aÄ‡ zwrotkÄ™ \u0026ldquo;zrÃ³bta coÅ› bo wisisz wÂ RBL\u0026rsquo;u takim aÂ takim\u0026hellip;\u0026rdquo;, ale zdecydowania niefajnie gdy wysyÅ‚asz pocztÄ™ aÂ ona od razu leci do /dev/null rblcheck PoszperaÅ‚em trochÄ™ iÂ znalazÅ‚em fajne narzÄ™dzie akaÂ rblcheck, ktÃ³re sprawdza domyÅ›lnie kilkaÂ RBL\u0026rsquo;i. MoÅ¼na teÅ¼ dodaÄ‡ kolejne jako parametry. WyglÄ…da to mniej wiÄ™cej tak:\n$ rblcheck 89.76.116.114 89.76.116.114 not listed by sbl.spamhaus.org 89.76.116.114 not listed by xbl.spamhaus.org 89.76.116.114 not listed by pbl.spamhaus.org 89.76.116.114 not listed by bl.spamcop.net 89.76.116.114 not listed by list.dsbl.org 89.76.116.114 not listed by dnsbl.njabl.org 89.76.116.114 listed by dul.dnsbl.sorbs.net Jak widaÄ‡ IP wisi wÂ jednym zÂ RBL\u0026rsquo;i.\nMoÅ¼na odpytaÄ‡Â RBL\u0026rsquo;e oÂ konkretny powÃ³d znalezienia siÄ™ na liÅ›cie (o ile funkcja taka jest obsÅ‚ugiwana):\n$ rblcheck 89.76.116.114 -t 89.76.116.114 not listed by sbl.spamhaus.org 89.76.116.114 not listed by xbl.spamhaus.org 89.76.116.114 not listed by pbl.spamhaus.org 89.76.116.114 not listed by bl.spamcop.net 89.76.116.114 not listed by list.dsbl.org 89.76.116.114 not listed by dnsbl.njabl.org 89.76.116.114 listed by dul.dnsbl.sorbs.net: \\ Dynamic IP Addresses See: http://www.sorbs.net/lookup.shtml?89.76.116.114 W tym przypadku nie byÅ‚o siÄ™ czym przejmowaÄ‡. Ta lista zawiera wszystkie IP dynamiczne, wiÄ™c nic dziwnego Å¼e nasze dynamiczne teÅ¼ tam jest. Nawet jeÅ¼eli ktoÅ› bÄ™dzie korzystaÄ‡ zÂ tej listy to raczej nie na zasadzie odcinania siÄ™ od dynamicznych IP, ale wÂ ramach punktowania wiarygodnoÅ›ci danego adresu. ZÂ naszej strony za bardzo nie jesteÅ›my wÂ stanie nic zÂ tym zrobiÄ‡ (bo nie zamierzamy dopÅ‚aciÄ‡ za statyczne IP), wiÄ™c tak musi byÄ‡.\nAutomatyzacja Najpierw zainstalowaÅ‚emÂ rblcheckâ€˜a:\nsudo apt-get install rblcheck PÃ³Åºniej wÂ /usr/local/sbin/check_rbls.shÂ utworzyÅ‚em skrypt sprawdzajÄ…cy kilka interesujÄ…cych mnieÂ RBL\u0026rsquo;i:\n#!/bin/bash  IP=`host mojadomena.pl | head -n1 | awk \u0026#39;{print $4}\u0026#39;` RBLCHECK=\u0026#34;rblcheck -t -s dul.dnsbl.sorbs.net \\ -s abuse.rfc-ignorant.org \\ -s postmaster.rfc-ignorant.org \\ -s dsn.rfc-ignorant.org \\ -s ix.dnsbl.manitu.net \\ -s rhsbl.ahbl.org\u0026#34; $RBLCHECK $IP | awk \u0026#39;{if($2 != \u0026#34;not\u0026#34;) print $0 }\u0026#39; Skrypt ten podlinkowaÅ‚em aby uruchamiaÅ‚ siÄ™ co godzinÄ™:\nln -s /usr/local/sbin/check_rbls.sh /etc/cron.hourly/ DziÄ™ki temu prostemu skryptowie jeÅ¼eli dostanÄ™ IP wiszÄ…ce wÂ tych kilkuÂ RBL\u0026rsquo;ach to stosunkowo szybko (maksymalnie wÂ ciÄ…gu godziny) siÄ™ oÂ tym dowiem. JeÅ¼eli natomiast IP bÄ™dzie czyste to nie bÄ™dÄ™ dostawaÄ‡ zbÄ™dnych maili. Do tego listÄ™ sprawdzanychÂ RBL\u0026rsquo;i moÅ¼na bardzo Å‚atwo powiÄ™kszyÄ‡ oÂ kolejne wÂ razie takiej potrzeby.\n","href":"/2011/08/dynamiczne-ip-i-rble/","title":"Dynamiczne IP i RBLâ€™e"},{"content":"","href":"/tags/ftp/","title":"FTP"},{"content":"","href":"/tags/grub/","title":"GRUB"},{"content":"Klastrowanie to moÅ¼e zbyt dumnie powiedziane. RozwiÄ…zanie to wyszukaÅ‚em gdy chcÄ…c skonfigurowaÄ‡ dwa serweryÂ apacheÂ do wspÃ³Å‚pracy na rzecz jednego serwisu okazaÅ‚o siÄ™, Å¼e sejse trzymane sÄ… tylko przez jeden serwer aÂ drugi nic oÂ nich nie wie. To oczywiÅ›cie nie pozwalaÅ‚o na prawidÅ‚owe dziaÅ‚anie jakiegokolwiek serwisu korzystajÄ…cego zÂ sesji.\nPomysÅ‚ jest taki, Å¼e zastÄ™pujemy domyÅ›ny mechanizm przechowywania sesji wÂ plikach na dysku mechanizmem memcache. PoniewaÅ¼Â memcachedÂ dziaÅ‚a jako usÅ‚uga sieciowa, rÃ³Å¼ne serwery mogÄ… siÄ™ odwoÅ‚ywaÄ‡ do puliÂ memcachedÂ iÂ odczytywaÄ‡ zapisane wÂ niej dane. WÂ przypadku sesji - nie jest waÅ¼ne, kto jÄ… utworzyÅ‚ - bo po jej wysÅ‚aniu do puliÂ memcachedÂ staje siÄ™ dostÄ™pna dla wszystkich klientÃ³wÂ phpÂ zÂ niej korzystajÄ…cych.\nJednym zÂ pierwszych pytaÅ„ nasuwajÄ…cych siÄ™ do takiej kofiguracji jest:Â a co jeÅ›li serwerÂ memcachedÂ padnie?Â WÂ chwili gdy wiele serwerÃ³wÂ apacheÂ zaleÅ¼y od jednego serweraÂ memcachedÂ jego awaria unieruchamia kaskadowo wszystkie.\nDlatego wykorzystaÅ‚em konfiguracjÄ™ zÂ dwoma serweramiÂ memcached. GdyÂ phpÂ zapisuje dane wÂ puliÂ memcachedÂ dane sÄ… wysyÅ‚ane do wszystkich podanych serwerÃ³w (w tym przypadku dwÃ³ch). AÂ odczytywanie polega na odpytaniu pierwszego podanego serwera, aÂ jeÅ›li to siÄ™ nie uda to drugiego. UkÅ‚ad nie jest idealny (jak mamy dwa dziaÅ‚ajÄ…ce serwery to aÅ¼ siÄ™ prosi oÂ loadbalancing) ale zmniejsza prawdopodobieÅ„stwo, Å¼e awaria pojedynczego elementu poÅ‚oÅ¼y wszystko.\nZ moim problemem moÅ¼a byÅ‚o sobie poradziÄ‡ teÅ¼ inaczej, np. zmieniajÄ…c mechanizm sesji na stronie na taki, ktÃ³ry korzysta zÂ bazy danych. OÂ ile wÂ przypadku jednego serwisu nie jest to duÅ¼y kÅ‚opot, to juÅ¼ przy kilku/kilkunastu byÅ‚oby to juÅ¼ spore przedsiÄ™wziÄ™cie.\nWaÅ¼nÄ… zaletÄ… tego rozwiÄ…zanie jest fakt, Å¼e nie sÄ… wymagane Å¼adne zmiany wÂ istniejÄ…cych serwisach. Po zmianie mechanizmu wÂ konfiguracjiÂ phpÂ wszystko powinno dziaÅ‚aÄ‡ bez zmian.\nInstalacja/Konfiguracja Najpierw trzeba zainstalowaÄ‡ iÂ uruchomiÄ‡Â memcachedÂ oraz rozszerzenieÂ php5-memcachedoÂ php\u0026rsquo;a, ktÃ³re da nam moÅ¼liwoÅ›Ä‡ korzystania zÂ niego. UÂ mnie robi siÄ™ to tak:\napt-get install memcached php5-memcache Teraz trzeba by wyedytowaÄ‡ konfiguracjÄ™Â /etc/memcached.conf. PoniÅ¼ej wycinek zÂ tego pliku zÂ opcjami, ktÃ³re naleÅ¼y ustawiÄ‡:\n# Maksymalna wartoÅ›Ä‡ pamiÄ™ci w MB jaka moÅ¼e byÄ‡ # wykorzystana przez demona. # Warto dostosowaÄ‡ do swoich potrzeb. -m 128 # Interfejs, na ktÃ³rym nasÅ‚uchiwaÄ‡ bÄ™dzie usÅ‚uga. # Ja dla wygody wybiorÄ™ wszystkie :) -l 0.0.0.0 # moÅ¼na teÅ¼ dostosowaÄ‡ port do nasÅ‚uchiwania -p 11211 # uÅ¼ytkownika nieuprzywilejowanego # (memcached domyÅ›lnie startuje jako root) -u nobody Wprowadzamy iÂ zapisujemy zmiany. Trzeba zrestartowaÄ‡ serwerÂ memcachedÂ uruchamiajÄ…c:\ninvoke-rc.d memcached restart Do tego momentu musimy powtÃ³rzyÄ‡ konfiguracjÄ™ na drugiej maszynie (bo inaczej po co klastrowaÄ‡ sesje).\nTeraz trzeba skonfiguraowaÄ‡Â php\u0026rsquo;a aby zamiast uÅ¼ywaÄ‡ sesji zapisywanych do plikÃ³w, korzystaÅ‚ zÂ memcached. EdytujemyÂ php.ini, uÂ mnie akurat wÂ lokalizacji:/etc/php5/apache2/php.ini. Odszukujemy opcje:\nsession.save_handler = files ;session.save_path = /var/lib/php5 I zamieniamy na:\nsession.save_handler = memcache ; adresy oczywiÅ›cie naleÅ¼y dostosowaÄ‡ do wÅ‚asnych ustawieÅ„ session.save_path = \u0026#34;tcp://localhost:11211, tcp://remotehost:11211\u0026#34; W kolejnym kroku edytujemy plik konfiguracyjny rozszerzeniaÂ php\u0026rsquo;a dla memcache wÂ /etc/php5/conf.d/memcache.iniÂ dodajÄ…c takie ustawienia:\nextension=memcache.so [memcache] memcache.dbpath=\u0026#34;/var/lib/memcache\u0026#34; memcache.maxreclevel=0 memcache.maxfiles=0 memcache.archivememlim=0 memcache.maxfilesize=0 memcache.maxratio=0 ; to jedyna wymagana opcja - resztÄ™ moÅ¼na dostosowaÄ‡ pod siebie ; albo zostawiÄ‡ domyÅ›lnie memcache.allow_failover=1 memcache.max_failover_attempts=20 memcache.default_port=11211 memcache.chunk_size=8192 memcache.hash_strategy=standard memcache.hash_function=\u0026#34;crc32\u0026#34; WiÄ™cej po poszczegÃ³lnych opcjach moÅ¼na siÄ™ dowiedzieÄ‡ zÂ dokumentacji php.\nTest JeÅ¼eli zrobiliÅ›my wszystko jak trzeba to sesje powinny zapisywaÄ‡ siÄ™ zÂ pamiÄ™ciÂ memcachediÂ dystrybuowaÄ‡ na wszystkie wpisane wÂ polu save_path serwery. MoÅ¼emy to sprawdziÄ‡ wykorzystujÄ…c np. taki skrypt:\n\u0026lt;?php session_start(); print \u0026#34;Opcja save_handler: \u0026#34; . ini_get(\u0026#34;session.save_handler\u0026#34;) . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; print \u0026#34;Opcja save_path: \u0026#34; . ini_get(\u0026#34;session.save_path\u0026#34;) . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if(isset($_SESSION[\u0026#39;testowa\u0026#39;])) { print \u0026#34;Testowa sesja jest juÅ¼ ustawiona: \u0026#34; . $_SESSION[\u0026#39;testowa\u0026#39;] . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else { $_SESSION[\u0026#39;testowa\u0026#39;] = \u0026#34;i wyglÄ…da, Å¼e dziaÅ‚a dobrze\u0026#34;; print \u0026#34;Ustawiamy testowÄ… sesjÄ… wartoÅ›ciÄ…: \u0026#34; . $_SESSION[\u0026#39;testowa\u0026#39;] . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } ?\u0026gt;Wystarczy odÅ›wieÅ¼yÄ‡ skrypt kilka razy. Za pierwszym razem sesja zostanie ustawiona aÂ kolejne odÅ›wieÅ¼enia bÄ™dÄ… juÅ¼ zwracaÅ‚y jej wartoÅ›Ä‡.\nProponujÄ™ teÅ¼ wyÅ‚Ä…czyÄ‡ jeden zÂ serwerÃ³wÂ memcachedÂ aby sprawdziÄ‡ czyÂ phpÂ poprawnie odwoÅ‚a siÄ™ do drugiego serwera.\n","href":"/2011/08/klastrowanie-sesji-php-z-memcached/","title":"Klastrowanie sesji PHP z memcached"},{"content":"Instalacja serweraÂ MySQLÂ na Debianie jest niezwykle prosta iÂ sprowadza siÄ™ do jednego polecenia:\nsudo apt-get install mysql-server Polecenie to zainstaluje iÂ uruchomi usÅ‚ugÄ™ serwerowÄ…Â MySQL. WÂ czasie instalacji bÄ™dziemy proszeni oÂ podanie hasÅ‚a dla root\u0026rsquo;a (ktÃ³re oczywiÅ›cie dobrze jest zapamiÄ™taÄ‡ bÄ…dÅº zapisaÄ‡).\nTak zainstalowana baza nasÅ‚uchuje na lokalnym porcie (localhost:3306) umoÅ¼liwiajÄ…Ä‡ dostÄ™p wyÅ‚Ä…cznie root\u0026rsquo;owi. Jest to bardzo bezpieczna konfiguracja\u0026hellip; Ale jeÅ›li nie mamy zamiaru na tej samej maszynie instalowaÄ‡ oprogramowania zarzÄ…dzajÄ…cego to nie zawsze jest to wygodne, tym bardziej gdy przykÅ‚adowo mamy dziaÅ‚ajÄ…cego phpmyadmin\u0026rsquo;a na jakimÅ› serwerzeÂ www. WÂ takim przypadku pierwszÄ… rzeczÄ…, ktÃ³rÄ… robiÄ™ jest udostÄ™pnienie dostÄ™pu zdalnego dla root\u0026rsquo;a. Warto zaznaczyÄ‡ Å¼e uprawnienia root\u0026rsquo;a moÅ¼na nadaÄ‡ dowolnemu uÅ¼ytkownikowi (np. romanowi) co jest duÅ¼o bezpieczniejszÄ… konfiguracjÄ… niÅ¼ dziaÅ‚anie bezpoÅ›rednio na koncie root\u0026rsquo;a (ktÃ³rego nazwa jest powszechnie znana).\nDostÄ™p zdalny dla root\u0026rsquo;a Aby umoÅ¼liwiÄ‡ zdalne zalogowanie siÄ™ do bazy zÂ uprawnieniami root\u0026rsquo;a trzeba ustawiÄ‡ odpowiednie GRANT\u0026rsquo;y, robimy to tak:\nmysql -u root -p mysql\u0026gt; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;roman\u0026#39;@\u0026#39;%\u0026#39; \u0026gt; IDENTIFIED BY \u0026#39;haslo dla zdalnego roota\u0026#39; WITH GRANT OPTION; mysql\u0026gt; FLUSH PRIVILEGES; mysql\u0026gt; exit Pierwsze polecenie poÅ‚Ä…czy nas zÂ bazÄ… proszÄ…c oÂ hasÅ‚o podane wÂ czasie instalacji.\nKolejne to poleceniaÂ SQL\u0026rsquo;owe, ktÃ³re pozwalajÄ… uÅ¼ytkownikowi â€˜roman' Å‚Ä…czÄ…cemu siÄ™ zÂ hosta â€˜%' (dowolnego) identyfikujÄ…cemu siÄ™ hasÅ‚em â€˜haslo dla zdalnego roota'. JeÅ¼eli chcemy ograniczyÄ‡ dostÄ™p do tylko jednego zdalnego adresu to zamiast znaku procenta wpisujemy ten adres IP. Tak dodany uÅ¼ytkownik ma teÅ¼ prawo nadawania uprawnieÅ„ (GRANT OPTION). PolecenieÂ FLUSH PRIVILEGESÂ przeÅ‚adowuje uprawnienia - umoÅ¼liwiajÄ…c logowanie zÂ podanymi wczeÅ›niej uprawnieniami.\nPozostaÅ‚o nam zmieniÄ‡ ustawienia serwera tak aby nasÅ‚uchiwaÅ‚ nie tylko na localhoÅ›cie. WÂ tym celu edytujemy plikÂ /etc/mysql/my.cnf:\nsudo vim /etc/mysql/my.cnf Odszukujemy nastÄ™pujÄ…cÄ… liniÄ™:\nbind-address = 127.0.0.1 LiniÄ™ tÄ™ moÅ¼emy zakomentowaÄ‡ co bÄ™dzie skutkowaÄ‡ nasÅ‚uchiwaniem przez serwer na wszystkich skonfigurowanych adresach IP (taki sam efekt da wpisanie wÂ polu adresu 0.0.0.0). MoÅ¼na teÅ¼ wpisaÄ‡ tylko jeden adres IP wÂ przypadku gdy na serwerze jest ich kilka iÂ nie chcemy aby serwer byÅ‚ dostÄ™pny na wszystkich.\nOstatnim krokiem jest zrestartowania serweraÂ MySQLÂ aby zadziaÅ‚aÅ‚y wprowadzone wÂ pliku konfiguracyjnym zmiany. MoÅ¼na to zrobiÄ‡ tak:\ninvoke-rc.d mysql restart JeÅ¼eli wÅ‚aÅ›nie zaÅ‚oÅ¼yÅ‚eÅ› i udostÄ™pniÅ‚eÅ› nowy serwer bazodanowy MySQL to oszczÄ™dÅº sobie pracy w przyszÅ‚oÅ›ci i od razu ustaw przechowywanie tabel InnoDB w osobnych plikach.\n","href":"/2011/08/mysql-na-szybko/","title":"MySQL - dostÄ™p zdalny na szybko"},{"content":"","href":"/tags/quota/","title":"quota"},{"content":"WiÄ™kszoÅ›Ä‡ systemÃ³w plikÃ³w wÂ linuksie pozwala na ustawienie quoty na dwÃ³ch poziomach: na uÅ¼ytkownika lub na grupÄ™ uÅ¼ytkownikÃ³w. WÂ wielu przypadkach taki podziaÅ‚ jest sensowny iÂ wystarczajÄ…cy. Ale zdarzajÄ… siÄ™ scenariusze, wÂ ktÃ³rych to za maÅ‚o.\nDobrym przykÅ‚adem jest serwerÂ FTPÂ zÂ wirtualnymi kontami uÅ¼ytkownikÃ³w. Czyli usÅ‚uga serwera dziaÅ‚a jako pewien nieuprzywilejowany uÅ¼ytkownik systemowy (przewaÅ¼nie ftp) przypisany do nieuprzywilejowanej grupy (np. nogroup). Konta uÅ¼ytkownikÃ³w serweraÂ FTPÂ sÄ… zdefiniowane wÂ bazie danych lub serwerzeÂ LDAP. Takie konta nazywa siÄ™ wirtualnymi poniewaÅ¼ po autoryzacji wÂ pewnym systemie (bazie danych,Â LDAP\u0026rsquo;ie) dziaÅ‚ajÄ… zÂ uprawnieniami pewnego systemowego konta (w tym przypadku ftp) - nie ma wiÄ™c odzwierciedlenia pomiÄ™dzy uÅ¼ytkownikami korzystajÄ…cymi zÂ ftpÂ aÂ kontami systemowymi.\nProblemem wÂ takim ukÅ‚adzie jest to, Å¼e nie moÅ¼na rozrÃ³Å¼niÄ‡ poszczegÃ³lnych uÅ¼ytkownikÃ³w wirtualnych, poniewaÅ¼ wszystkie operacje sÄ… wykonywane przez systemowego uÅ¼ytkownikaÂ ftpÂ iÂ to on jest wÅ‚aÅ›cicielem wszystich plikÃ³w utworzonych przez uÅ¼ytkownikÃ³w wirtualnych.\nRozwiÄ…zania sÄ… dwa:\n sewerÂ FTPÂ ma zaimplementowanÄ… obsÅ‚ugÄ™ quot dla uÅ¼ytkownikÃ³w wirtualnych, zÂ czego moÅ¼emy skorzystaÄ‡, tworzymy quotÄ™ na katalog domowy uÅ¼ytkownika wirtualnego.  Mnie bardziej odpowiadaÅ‚a druga metoda.\nO ile mi wiadomo wÂ ext3Â nie moÅ¼na tworzyÄ‡ quoty per katalog, na moje szczÄ™scie takÄ… moÅ¼liwoÅ›Ä‡ oferujeÂ xfs, zÂ ktÃ³rego korzystaÅ‚em.\nJeÅ¼eli jeszcze nie masz dysku sformatowanego jakoÂ xfsÂ to jest to dobry moment aby to zrobiÄ‡:\n# sdaX zastap nazwa urzadzenia ktore TY chcesz sformatowac mkfs.xfs /dev/sdaX # aby dzialala quoata per katalog trzeba zamonowac # dysk z opcja prjquota mount /dev/sdaX /mnt/ftp -o prjquota Logika quot per katalog wÂ xfs\u0026rsquo;ie jest taka, Å¼e najpierw tworzymy projekt zÂ powiÄ…zanym zÂ nim id, aÂ pÃ³Åºniej wiÄ…Å¼emy poprzez id projekt zÂ katalogiem. Przez co quota naÅ‚oÅ¼ona na projekt ma zastosowanie do katalogu. Konfiguracja projektÃ³w iÂ przypisanych im katalogÃ³w znajduje siÄ™ wÂ dwÃ³ch plikach: /etc/projid iÂ /etc/projects.\nUtwÃ³rzymy teraz projekt iÂ konfiguracjÄ™ dla niego:\n# nazwa projektu i jego id - w naszym przypadku # konto uzytkownika romana :) echo ftproman:10 \u0026gt;\u0026gt; /etc/projid # projektowi z id 10 przypisujemy katalog /mnt/ftp/roman echo 10:/mnt/ftp/roman \u0026gt;\u0026gt; /etc/projects PozostaÅ‚o uruchomiÄ‡ quotÄ™ wpisujÄ…Ä‡ komendy:\n# wiazemy projekt z punktem montowania xfs_quota -x -c \u0026#39;poject -s ftproman\u0026#39; /mnt/ftp # ustawiamy wlasiwa quote 1 gigabajt dla projektu xfs_quota -x -c \u0026#39;limit -p bhard=1g ftproman\u0026#39; /mnt/ftp To tyle - quota na katalog jest zaÅ‚oÅ¼ona iÂ dziaÅ‚a. Aby zobaczyÄ‡ jaka czÄ™Å›Ä‡ miejsca jest juÅ¼ wykorzystana wystarczy uruchomiÄ‡ polecenie:\nxfs_quota -x -c \u0026#39;report -h /mnt/ftp\u0026#39; Project quota on /mnt/ftp (/dev/sda3) Blocks Project ID Used Soft Hard Warn/Grace ---------- --------------------------------- ftproman 1,5M 0 1G 00 [------] Dla kolejnych uÅ¼ytkownikÃ³w musimy tworzyÄ‡ kolejne wpisy.\n","href":"/2011/08/quota-na-katalog-w-xfsie/","title":"Quota na katalog w XFSâ€™ie"},{"content":"","href":"/tags/rbl/","title":"RBL"},{"content":"","href":"/tags/rblcheck/","title":"rblcheck"},{"content":"","href":"/tags/selfsigned/","title":"SelfSigned"},{"content":"KiedyÅ› potrzebowaÅ‚em wÂ ramach testu obciÄ…Å¼eniowego wysÅ‚aÄ‡ duÅ¼o wiadomoÅ›ci zÂ zaÅ‚Ä…cznikami. ChciaÅ‚em to zrobiÄ‡ na szybko zÂ shell\u0026rsquo;a iÂ tutaj chwilÄ™ musiaÅ‚em pogooglaÄ‡ aby znaleÅºÄ‡ dziaÅ‚ajÄ…ce polecenie. To co znalazÅ‚em wyglÄ…da tak:\n(echo \u0026#34;testowa wiadomosc\u0026#34;; uuencode test.zip test.zip) \\ | mail -s \u0026#34;Test\u0026#34; testowy@mail.pl WiedzÄ…c juÅ¼ jak wysyÅ‚aÄ‡ maile zÂ zaÅ‚Ä…cznikami, maÅ‚y mail bombing mogÅ‚em zrobiÄ‡ tak:\nfor i in `seq 1 100`; do (cat tekst.txt; uuencode test.zip test.zip) \\  | mail -s \u0026#34;Test $i\u0026#34; testowy@mail.pl; done ","href":"/2011/08/wysylanie-zalacznikow-poleceniem-mail/","title":"WysyÅ‚anie zaÅ‚Ä…cznikÃ³w poleceniem mail"},{"content":"JeÅ¼eli tu zaglÄ…dasz pewnie zdarzyÅ‚o Ci siÄ™ kiedyÅ›, Å¼e przykÅ‚adowo wygrzebujesz jakiÅ› stary serwer iÂ nie masz pojÄ™cia co na nim byÅ‚o, ani do czego sÅ‚uÅ¼yÅ‚o, czy jeszcze dziaÅ‚a\u0026hellip; Albo jeszcze inaczej - serwer dziaÅ‚aÅ‚ tak dÅ‚ugo, Å¼e wszystkie osoby znajÄ…ce hasÅ‚o na root\u0026rsquo;a przeszÅ‚y na emeryturÄ™ lub zmarÅ‚y\u0026hellip; Nieistotne ðŸ˜ƒ\nJest pewna prosta sztuczka, pozwalajÄ…ca wbiÄ‡ siÄ™ na konto root\u0026rsquo;a nie znajÄ…c hasÅ‚a - dajÄ…c nam moÅ¼liwoÅ›Ä‡ jego zmiany. PotrzebneÂ dwa restartyÂ ale za to nie trzeba korzystaÄ‡ zÂ Å¼adnychlive cd.\n Na poczÄ…tek zmuszamy serwer do restartu - mieÄ‡ nadziejÄ™, Å¼e maszyna obsÅ‚uguje ACPI iÂ delikatne wciÅ›niÄ™cie przyciskuÂ powerÂ subtelnie jÄ… wyÅ‚Ä…czy. JeÅ›li to nie zadziaÅ‚a to kojarzÄ… mi siÄ™ tylko brzydkie rzeczy ðŸ˜ƒ Gdy po restarcie zaÅ‚aduje siÄ™Â grubÂ na domyÅ›lnej opcji bootowania wybieramy edycjÄ™ wciskajÄ…c \u0026ldquo;e\u0026rdquo;. Wybieramy liniÄ™ zaczynajÄ…cÄ… siÄ™ odÂ kernelÂ iÂ znÃ³w wybieramy edycjÄ™ wciskajÄ…c \u0026ldquo;e\u0026rdquo;. JeÅ¼eli znajduje siÄ™ tam parametrÂ roÂ to zastÄ™pujemy goÂ rwÂ iÂ dopisujemy na koÅ„cuÂ init=/bin/bash WbijamyÂ \u0026ldquo;enter\u0026rdquo;Â zapisujÄ…c zmieniony wiersz. Bootujemy siÄ™ zÂ tak zmienionej konfiguracji wciskajÄ…c \u0026ldquo;b\u0026rdquo;. Po chwili system zamiast wystartowaÄ‡ init\u0026rsquo;a iÂ uruchamiaÄ‡ usÅ‚ugi, lÄ…duje wÂ bash\u0026rsquo;u zÂ uprawnieniami root\u0026rsquo;a. AÂ skoro mamy root\u0026rsquo;a to moÅ¼emy wpisaÄ‡Â passwdÂ iÂ zmieniÄ‡ rootowi hasÅ‚o ðŸ˜ƒ Teraz juÅ¼ tylko reboot iÂ startujemy system normalnie - hasÅ‚o root\u0026rsquo;a powinno dziaÅ‚aÄ‡.  Niestety ta prosta sztuczka nie dziaÅ‚a na wszystkichÂ linux\u0026rsquo;ach - szczegÃ³lnie tych wykorzystujÄ…cych initramfs-tools. Na tych systemach trzeba ciut wiÄ™cej pokombinowaÄ‡ ale przynajmniej ma siÄ™ jakiÅ› punkt wyjÅ›cia.\n","href":"/2011/08/wlam-na-lokalne-konto-roota/","title":"WÅ‚am na lokalne konto rootâ€™a"},{"content":"My name is Tomasz GÄ…gor, for some people known as TiMoR.\nI\u0026rsquo;m working as sys admin/DevOps. I enjoy using Linux (especially Debian and clones but not only), virtualization, high available systems, web optimization, programming in Python/Perl/Ruby. I spend a lot of time solving problems with systems integration, optimization, etc. and this is the place where I want to keep things that I\u0026rsquo;ve done well (or I think I\u0026rsquo;ve done it well) for future use. Second use of this site is to get confirmation from other people about my solutions.\nWith your help I hope to become the best DevOps I can be.\nThis work is licensed under CC BY-SA 4.0\n","href":"/about/","title":"About me"},{"content":"","href":"/search/","title":"Search"}]