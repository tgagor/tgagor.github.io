<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nginx | Tom's Blog</title>
<meta name=keywords content><meta name=description content="pages for taxonomy (classification) term: nginx"><meta name=author content="timor"><link rel=canonical href=https://gagor.pro/tags/nginx/><link crossorigin=anonymous href=/assets/css/stylesheet.b75f2a8f35519547db38b55fa84baf47177f24f8e88f96c8d73a55d12ab8bcec.css integrity="sha256-t18qjzVRlUfbOLVfqEuvRxd/JPjoj5bI1zpV0Sq4vOw=" rel="preload stylesheet" as=style><link rel=icon href=https://gagor.pro/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pro/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pro/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pro/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pro/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gagor.pro/tags/nginx/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4F5HJ7RNKM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4F5HJ7RNKM",{anonymize_ip:!1})}</script><meta property="og:title" content="Nginx"><meta property="og:description" content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><meta property="og:type" content="website"><meta property="og:url" content="https://gagor.pro/tags/nginx/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nginx"><meta name=twitter:description content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pro/ accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pro/favicon-36x36.png alt aria-label=logo height=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://gagor.pro/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pro/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pro/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pro/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pro/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://gagor.pro/>Home</a>&nbsp;»&nbsp;<a href=https://gagor.pro/tags/>Tags</a></div><h1>Nginx</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Optimize Nginx for performance</h2></header><div class=entry-content><p>There are many possible real life cases and not all optimization technics will be suitable for you but I hope it will be a good starting place.
Also you shouldn’t copy paste examples with faith that they will make your server fly 😃 You have to support your decisions with excessive tests and help of monitoring system (ex. Grafana ).
Cache static and dynamic content Setting caching static and dynamic content strategy may offload your server from additional load from repetitive downloads of same, rarely updated files....</p></div><footer class=entry-footer><span title='2016-01-14 00:00:00 +0000 UTC'>2016-01-14</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Optimize Nginx for performance" href=https://gagor.pro/2016/01/optimize-nginx-for-performance/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>fail2ban - block wp-login.php brute force attacks</h2></header><div class=entry-content><p>Lately I had a lot of brute force attacks on my WordPress blog. I used basic auth to /wp-admin part in nginx configuration to block this and as a better solution I wan’t to block source IPs at all on firewall.
To do this, place this filter code in /etc/fail2ban/filter.d/wp-login.conf:
# WordPress brute force wp-login.php filter: # # Block IPs trying to authenticate in WordPress blog # # Matches e.g. # 178....</p></div><footer class=entry-footer><span title='2015-12-31 00:00:00 +0000 UTC'>2015-12-31</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to fail2ban - block wp-login.php brute force attacks" href=https://gagor.pro/2015/12/fail2ban-block-wp-login-php-brute-force-attacks/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - enabling SPDY with freeware certificate</h2></header><div class=entry-content><p>I was thinking about allowing access to my website using SPDY protocol for better performance and security (and for fun of course 😃 ). But SPDY have one disadvantage - you need SSL certificate signed by known authority that will verfiy in common browsers. So you can’t use self signed certificates because everyone will see a warning entering your site. Certs are quite expensive so I started searching for free one and to my surprise I found such!...</p></div><footer class=entry-footer><span title='2014-01-24 00:00:00 +0000 UTC'>2014-01-24</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - enabling SPDY with freeware certificate" href=https://gagor.pro/2014/01/nginx-enabling-spdy-with-freeware-certificate/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Preparing video files for streaming on website in MP4 and WEBM format</h2></header><div class=entry-content><p>Some time ago I prepared a PC that was responsible for batch encoding of movies to formats suitable for web players (such as. Video.js  external link , JW Player  external link , Flowplayer  external link , etc.)
I used HandBrake for conversion to MP4 format (becase this soft was the fastest one) and ffmpeg (aka avconv in new version) for two pass encoding to WEBM.
Below are commands used by me for that conversion:...</p></div><footer class=entry-footer><span title='2013-12-16 00:00:00 +0000 UTC'>2013-12-16</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Preparing video files for streaming on website in MP4 and WEBM format" href=https://gagor.pro/2013/12/preparing-video-files-for-streaming-on-website-in-mp4-and-webm-format/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - przydatne rewrite’y i różne sztuczki</h2></header><div class=entry-content><p>Polubiłem Nginx’a i wykorzystuję go na coraz więcej sposobów. Kilka rzeczy udało mi się całkiem fajnie w nim skonfigurować i postanowiłem zebrać te przykłady by następnym razem gdy postanowię do nich sięgnąć nie musieć wertować konfigów po serwerach 😃
Słowo wstępu Niektóre rewrite’y kończą się znakiem ? - czemu?
Otóż Nginx próbuje automatycznie dodawać parametry na końcu przepisanego adresu. Jeśli jednak wykorzystamy zmienną $request_uri to ona sama w sobie zawiera już parametry zapytania (czyli to co w URI znajduje się po znaku ?...</p></div><footer class=entry-footer><span title='2013-09-09 00:00:00 +0000 UTC'>2013-09-09</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - przydatne rewrite’y i różne sztuczki" href=https://gagor.pro/2013/09/nginx-przydatne-rewritey-i-rozne-sztuczki/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - hide server version and name in Server header and error pages</h2></header><div class=entry-content><p>On Debian you have to install nginx-extras package (because it have built in headers_more  external link module). Then you need two options (best in global configuration /etc/nginx/nginx.conf file, http part):
server_tokens off; more_set_headers 'Server: BadAss'; And it’s good to setup non standard error pages on every site (500 and 404 at minimum):
error_page 403 404 http://mysite.com/areyoulost; error_page 502 503 504 /500.html;</p></div><footer class=entry-footer><span title='2013-01-24 00:00:00 +0000 UTC'>2013-01-24</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - hide server version and name in Server header and error pages" href=https://gagor.pro/2013/01/nginx-hide-server-version-and-name-in-server-header-and-error-pages/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - kompresowanie plików dla gzip_static</h2></header><div class=entry-content><p>Ruski serwer WWW  external link ma przydatną funkcję serwowania wersji plików skompresowanych gzip’em - przez co możemy plik skompresować raz i będzie on serwowany klientom obsługującym kompresję HTTP ale już bez każdorazowego kompresowania go. Jest to bardzo przydatne na stronach z dużym ruchem gdzie można w ten sposób zaoszczędzić takty CPU na właściwą obsługę połączeń a nie kompresję. Drugie miejsce gdzie może to być przydatne to VPS’y i “cienkie” serwery, które na kompresji przy większym obciążeniu spędzają zbyt dużo czasu i daje się to odczuć w działaniu strony....</p></div><footer class=entry-footer><span title='2012-12-17 00:00:00 +0000 UTC'>2012-12-17</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - kompresowanie plików dla gzip_static" href=https://gagor.pro/2012/12/nginx-kompresowanie-plikow-dla-gzip_static/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - konfiguracja pod WordPress’a</h2></header><div class=entry-content><p>To raczej nie jest podstawowy konfig i próżno szukać go na stronie WordPress’a, więc odradzam tę zabawę jeśli nie zna się zbyt dobrze nginx’a.
Ponieważ serwerek, na którym działa stronka to sprzęcik z Atomem 330 i mocy na CPU zbyt wiele nie ma to popularne pluginy (np. W3 Total Cache) potencjalnie zwiększające wydajność tak na prawdę zmulały stronkę jeszcze bardziej. Pluginów sprawdziłem kilka i każdorazowo efekt był podobny - stronka działała wolniej niż bez ich pomocy....</p></div><footer class=entry-footer><span title='2012-06-29 00:00:00 +0000 UTC'>2012-06-29</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - konfiguracja pod WordPress’a" href=https://gagor.pro/2012/06/nginx-konfiguracja-pod-wordpressa/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - ustawienie domyślnego vhosta</h2></header><div class=entry-content><p>Ustawienie domyślnego vhosta w nginx’ie jest ładnie opisane w dokumentacji i początkowo wydawało się dobrze działać ale gdy wykorzystałem tą konfigurację na serwerze z wieloma adresami IP i nasłuchiwaniem na porcie 80 (bez podania IP) to zachowywało się to dość dziwnie (przeważnie nie ładowało tej strony którą chciałem). Od teraz tworzę konfigurację domyślnego vhosta dla każdego z dostępnych adresów IP. Powiem szczerze że nie miałem czasu na głębsze zbadanie tego zachowania i wykorzystałem rozwiązanie, które działało w każdym przypadku czyli po jednym konfigu na IP + przekierowanie na ogólną stronę....</p></div><footer class=entry-footer><span title='2012-06-18 00:00:00 +0000 UTC'>2012-06-18</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - ustawienie domyślnego vhosta" href=https://gagor.pro/2012/06/nginx-ustawienie-domyslnego-vhosta/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - mój domyślny config</h2></header><div class=entry-content><p>W tym poście nie rozpiszę się zbytnio - wrzucam tylko config od którego zaczynam konfigurację nginx’a.
user www-data; worker_processes 4; pid /var/run/nginx.pid; events { worker_connections 1024; ## zaakceptuj tak dużo połączeń jak to możliwe multi_accept on; ## epoll jest preferowany na jajkach od 2.6 ## http://www.kegel.com/c10k.html#nb.epoll use epoll; } http { include /etc/nginx/mime.types; default_type application/octet-stream; access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; ## opcje TCP sendfile on; tcp_nopush on; tcp_nodelay on; ## maksymalny rozmiar zapytnia client_max_body_size 10m; ## timeout'y client_body_timeout 60; client_header_timeout 60; keepalive_timeout 10; send_timeout 60; ## kompresja gzip on; gzip_static on; gzip_vary on; gzip_disable "msie6"; gzip_comp_level 1; gzip_proxied any; gzip_buffers 16 8k; gzip_min_length 50; gzip_types text/plain text/css application/json application/x-javascript application/javascript text/javascript application/atom+xml application/xml application/xml+rss text/xml image/x-icon text/x-js application/xhtml+xml; ## bezpieczeństwo ## security by obscurity - ukrywamy wersję nginx'a server_tokens off; ignore_invalid_headers on; ## resetuj zbyt długie połączenia - powinno pomóc na slowlorisa reset_timedout_connection on; ## włączenie ochrony przed clickjackingiem - uruchamiam to per vhost ## https://developer....</p></div><footer class=entry-footer><span title='2012-06-08 00:00:00 +0000 UTC'>2012-06-08</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - mój domyślny config" href=https://gagor.pro/2012/06/nginx-moj-domyslny-config/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://gagor.pro/tags/nginx/page/2/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span><a href=https://gagor.pro/>Tom's Blog</a> &copy; 2008-2024</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>