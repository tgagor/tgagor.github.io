<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux | Tom's Blog</title>
<meta name=keywords content><meta name=description content="pages for taxonomy (classification) term: linux"><meta name=author content="timor"><link rel=canonical href=https://gagor.pl/tags/linux/><link crossorigin=anonymous href=/assets/css/stylesheet.93a7bb0e4037b10e2d13ecb5a064edb636bd4156dfce17bfbd5115c4fce2d166.css integrity="sha256-k6e7DkA3sQ4tE+y1oGTttja9QVbfzhe/vVEVxPzi0WY=" rel="preload stylesheet" as=style><link rel=icon href=https://gagor.pl/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pl/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pl/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pl/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pl/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://gagor.pl/tags/linux/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4TQXK4C4W5"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4TQXK4C4W5",{anonymize_ip:!1})}</script><meta property="og:title" content="Linux"><meta property="og:description" content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><meta property="og:type" content="website"><meta property="og:url" content="https://gagor.pl/tags/linux/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux"><meta name=twitter:description content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pl accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pl/favicon-72x72.png alt aria-label=logo height=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pl/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pl/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pl/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pl/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pl/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://gagor.pl>Home</a>&nbsp;»&nbsp;<a href=https://gagor.pl/tags/>Tags</a></div><h1>Linux</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>fail2ban - regułki dla dovecot’a</h2></header><div class=entry-content><p>Domyślna konfiguracja fail2ban’a (na Debianie) nie zawiera reguł pozwalających na blokowanie prób włamań na skrzynki POP/IMAP dla dovecota (no chyba że korzystamy z saslauthd). Można szybko utworzyć własny zestaw filtrów co przedstawię poniżej.
Tworzymy plik: /etc/fail2ban/filter.d/dovecot.conf
[Definition] failregex = (?: pop3-login|imap-login): .*(?:Authentication failure|Aborted login \(auth failed|Aborted login \(tried to use disabled|Disconnected \(auth failed|Aborted login \(\d+ authentication attempts).*rip=(?P&lt;host>\S*),.* ignoreregex = Później dopisujemy na końcu pliku: /etc/fail2ban/jail.conf
[dovecot] enabled = true filter = dovecot port = pop3,pop3s,imap,imaps logpath = /var/log/mail....</p></div><footer class=entry-footer><span title='2011-11-28 00:00:00 +0000 UTC'>2011-11-28</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to fail2ban - regułki dla dovecot’a" href=https://gagor.pl/2011/11/fail2ban-regulki-dla-dovecota/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>SLES 11 - instalacja Service Pack’a</h2></header><div class=entry-content><p>Administrowałem do tej pory głównie darmowymi distro, ale gdzieś tam ukradkiem wkradło się kilka “siusiaków” (aka SUSE Linux Enterprise Server). Żyłem w utopijnym przekonaniu że skoro się za nie płaci to powinno się z nimi łatwiej współpracować… w przypadku instalacji aktualizacji (a w szczególności SP) nie było to aż takie proste.
Przywykłem w darmowych dystrybucjach że gdy pojawiała się nowszą “większa wersja” to po prostu można było jednym poleceniem zaktualizować wszystkie pakiety....</p></div><footer class=entry-footer><span title='2011-10-20 00:00:00 +0000 UTC'>2011-10-20</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to SLES 11 - instalacja Service Pack’a" href=https://gagor.pl/2011/10/sles-11-instalacja-service-packa/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Ochrona usług przed atakami brute force z fail2ban’em</h2></header><div class=entry-content><p>Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez “dopieszczanie” konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronę pewnych stron hasłem, dostęp do SSH tylko kluczami, itd.) ale całkowicie pomija się przygotowanie systemu aktywnie monitorującego błędne próby autoryzacji. Oczywiście nie można umniejszać wagi pierwszego z wymienionych etapów ale zdecydowanie nie powinno pomijać się też tego drugiego. Przecież każdy admin chciałby wiedzieć gdy ktoś próbuje włamać się na jego serwer (FTP, HTTP, SSH, itp....</p></div><footer class=entry-footer><span title='2011-10-03 00:00:00 +0000 UTC'>2011-10-03</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Ochrona usług przed atakami brute force z fail2ban’em" href=https://gagor.pl/2011/10/ochrona-uslug-przed-atakami-brute-force-z-fail2banem/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>pflogsumm - statystyki poczty dla postfix’a</h2></header><div class=entry-content><p>Jeżeli administrujesz nawet niedużym serwerem pocztowym na pewno masz świadomość, że nie jesteś w stanie monitorować logów na bieżąco. Ciężko jest wyłapać np. problem w komunikacji z pewną domeną. Ciężko też oszacować skalę ruchu na serwerze zarówno pod kątem ilości jak i wolumenu maili. Trudno wybrać domeny, dla których warto by zrezygnować z greylistingu, itd, itp…
Na szczęście dostępne jest narzędzie pflogsumm, które wygeneruje nam dość wyczerpujące statystyki z logów postfix’a....</p></div><footer class=entry-footer><span title='2011-09-22 00:00:00 +0000 UTC'>2011-09-22</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to pflogsumm - statystyki poczty dla postfix’a" href=https://gagor.pl/2011/09/pflogsum-statystyki-poczty-dla-postfixa/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>fsck.ext4 - Błąd podczas przydzielania struktury icount: Memory allocation failed</h2></header><div class=entry-content><p>Miałem ostatnio dziwną przygodę: pewien serwer do backupu gdzie ląduje dużo małych plików i dodatkowo tworzonych jest sporo hardlinków zaliczył pada. Co prawda starałem się go grzecznie położyć z pomocą Magic SysRq ale ponieważ nie wiedziałem co było przyczyną awarii fsck wydawał się wskazany.
Podczas próby uruchomienia fsck.ext4 na systemie plików o rozmiarze ok 14TB z kilkuset milionami plików po kilkudziesięciu sekundach otrzymywałem komunikat:
Błąd podczas przydzielania struktury icount: Memory allocation failed...</p></div><footer class=entry-footer><span title='2011-09-21 00:00:00 +0000 UTC'>2011-09-21</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to fsck.ext4 - Błąd podczas przydzielania struktury icount: Memory allocation failed" href=https://gagor.pl/2011/09/fsck-ext4-blad-podczas-przydzielania-struktury-icount-memory-allocation-failed/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Magic SysRq - bezpieczny reset Linux’a</h2></header><div class=entry-content><p>Pomimo iż Linux uchodzi za stabilne środowisko to raz na jakiś czas trafi się ciężka zwiecha - z powodu przeciążenia, awarii sprzętu… nieistotne…
Załóżmy że licho wzięło za cel główny serwer plików lub bazę danych dla wielu, wielu stron internetowych. Dostać się po ssh nie możemy bo lecą timeout’y, a siedząc bezpośrednio przy klawiaturze konsola nie reaguje. Mimo to coś ostro daje po dyskach, więc ewentualny twardy reset to na bank utrata części plików… jeśli system po nim w ogóle wstanie… 😑...</p></div><footer class=entry-footer><span title='2011-09-17 00:00:00 +0000 UTC'>2011-09-17</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Magic SysRq - bezpieczny reset Linux’a" href=https://gagor.pl/2011/09/magic-sysrq-bezpieczny-reset-linuxa/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>approx - cachujące proxy dla repozytoriów Debiana</h2></header><div class=entry-content><p>Wielu administratorów gdy zaczyna swoją przygodę zarządza jedną/dwoma maszynami… Po pewnym czasie jest ich już kilka… W którymś momencie dostrzega się zalety wirtualizacji i na kilku maszynach fizycznych działa kilkanaście czy kilkadziesiąt maszyn wirtualnych. W takiej sytuacji pobieranie aktualizacji dla wszystkich maszyn potrafi mocno zabić łącze.
I w tym momencie zaczynamy się zastanawiać czy może nie warto byłoby zrobić własnego mirror’a paczek dla naszego ulubionego distro… do prywatnego użytku… synchronizowanego w nocy by nikomu nie przeszkadzać… i dostępnego nawet gdy będziemy offline… Zaczynamy liczyć miejsce i okazuje się że repozytorium Debiana dla architektury i386 to prawie 60GB (sic!...</p></div><footer class=entry-footer><span title='2011-09-16 00:00:00 +0000 UTC'>2011-09-16</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to approx - cachujące proxy dla repozytoriów Debiana" href=https://gagor.pl/2011/09/approx-cachujace-proxy-dla-repozytoriow-debiana/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Wymuszenie zwolnienia pamięci buforów dyskowych na Linux’ie</h2></header><div class=entry-content><p>Linux bardzo agresywnie wykorzystuje wolną pamięć RAM do buforowania danych odczytywanych z dysków (inode’ów, plików, itd…). Ma to niebagatelny wpływ na zwiększenie szybkości uruchamiania programów które już raz zostały uruchomione. Jednak nie zawsze jest to pożądane zachowanie, np. testując szybkość uruchomienia/wykonywania tworzonej przez nas aplikacji - buforowanie zmienia czas ładowania aplikacji przy kolejnych uruchomieniach. Dobrze byłoby móc wymusić zwolnienie buforów by każdy start programu miał porównywalne “warunki startowe”.
Na szczęście można to zrobić w prosty sposób:...</p></div><footer class=entry-footer><span title='2011-09-15 00:00:00 +0000 UTC'>2011-09-15</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Wymuszenie zwolnienia pamięci buforów dyskowych na Linux’ie" href=https://gagor.pl/2011/09/wymuszenie-zwolnienia-pamieci-buforow-dyskowych-na-linuxie/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Zabezpieczenie Apachego na Debianie przed slowloris’em</h2></header><div class=entry-content><p>Od jakiegoś czasu dostępny jest w sieci skrypt slowloris.pl pozwalający z pojedynczego komputera wykonać atak DOS na zdalny serwer WWW. Atak polega na uruchomieniu wielu równoczesnych sesji i bardzo wolnym wysyłaniu komunikatów HTTP. Atakujący udaje “klienta z wolnym łączem” równocześnie uruchamiając kolejne sesje by po pewnym czasie zająć wszystkie dostępne. Serwer WWW przestaje wtedy odpowiadać na zapytania od innych klientów. Dodatkowo na źle wyskalowanych serwerach duża liczba procesów Apachego może spowodować swapowanie i błędy braku pamięci....</p></div><footer class=entry-footer><span title='2011-09-12 00:00:00 +0000 UTC'>2011-09-12</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Zabezpieczenie Apachego na Debianie przed slowloris’em" href=https://gagor.pl/2011/09/zabezpieczenie-apachego-na-debianie-przed-slowlorisem/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Sprawdzenie który proces obciąża dyski</h2></header><div class=entry-content><p>Na jednym z serwerów zauważyłem dziwny wzrost obciążenia. Tzw. LOAD od kilku dni po woli rósł. top pokazywał że dwa rdzenie CPU czekają na dane z dysku - tzw. io wait na poziomie 80~90% ale żaden proces w znaczącym stopniu nie obciążał CPU.
Jest kilka narzędzi (iostat, wmstat), które pozwalają monitorować obciążenie dysków ale ja nie szukałem informacji czy i w jakim stopniu dyski są obciążone - wiedziałem że są. Chciałem dowiedzieć się który proces generuje to obciążenie - by móc go ubić 😃...</p></div><footer class=entry-footer><span title='2011-09-02 00:00:00 +0000 UTC'>2011-09-02</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Sprawdzenie który proces obciąża dyski" href=https://gagor.pl/2011/09/sprawdzenie-ktory-proces-obciaza-dyski/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://gagor.pl/tags/linux/page/8/>«&nbsp;Prev&nbsp;
</a><a class=next href=https://gagor.pl/tags/linux/page/10/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span><a href=https://gagor.pl>Tom's Blog</a> &copy; 2008-2024</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>