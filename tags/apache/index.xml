<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Apache on timor's site</title><link>https://timor.site/tags/apache/</link><description>Recent content in Apache on timor's site</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Tue, 29 Dec 2015 00:00:00 +0000</lastBuildDate><atom:link href="https://timor.site/tags/apache/index.xml" rel="self" type="application/rss+xml"/><item><title>Apache - Force caching dynamic PHP content with mod_headers</title><link>https://timor.site/2015/12/apache-force-caching-dynamic-php-content-with-mod_headers/</link><pubDate>Tue, 29 Dec 2015 00:00:00 +0000</pubDate><guid>https://timor.site/2015/12/apache-force-caching-dynamic-php-content-with-mod_headers/</guid><description>Normally you want dynamic content to be fresh and not catchable. But sometimes it may be useful to cache it, like when you have website behind reverse proxy. To do this try something like this:
&amp;lt;filesmatch &amp;#34;\.(php|cgi|pl)$&amp;#34;&amp;gt; Header unset Pragma Header unset Expires Header set Cache-Control &amp;#34;max-age=3600, public&amp;#34; &amp;lt;/filesmatch&amp;gt; Sources http://www.askapache.com/htaccess/speed-up-your-site-with-caching-and-cache-control.html</description></item><item><title>Apache AuthBasic but excluding IP</title><link>https://timor.site/2015/12/apache-authbasic-but-excluding-ip/</link><pubDate>Wed, 23 Dec 2015 00:00:00 +0000</pubDate><guid>https://timor.site/2015/12/apache-authbasic-but-excluding-ip/</guid><description>Allow from IP without password prompt, and also allow from any address with password prompt
Order deny,allow Deny from all AuthName &amp;#34;htaccess password prompt&amp;#34; AuthUserFile /web/askapache.com/.htpasswd AuthType Basic Require valid-user Allow from 172.17.10.1 Satisfy Any Sources http://www.askapache.com/htaccess/apache-authentication-in-htaccess.html</description></item><item><title>Apache - precompressing static files with gzip</title><link>https://timor.site/2013/12/apache-precompressing-static-files-with-gzip/</link><pubDate>Fri, 27 Dec 2013 00:00:00 +0000</pubDate><guid>https://timor.site/2013/12/apache-precompressing-static-files-with-gzip/</guid><description>Some time ago I&amp;rsquo;ve show how to precompress js and css file with gzip to be available for Nginx&amp;rsquo;s mod_gzip. In default configuration Apache don&amp;rsquo;t have such module but similar functionality could be achieved with few custom rewirtes.
Basically we will start with these rewrites to serve gzipped CSS/JS files if they exist and the client accepts gzip compression:
RewriteEngine on RewriteCond %{HTTP:Accept-encoding} gzip RewriteCond %{REQUEST_FILENAME}\.gz -s RewriteRule ^(.*)\.(js|css)$ $1\.$2\.gz [QSA] Then we need to setup proper content types for such compressed files - I know how to do this in two ways:</description></item><item><title>Running Apache with mod_spdy and PHP-FPM</title><link>https://timor.site/2013/12/running-apache-with-mod_spdy-and-php-fpm/</link><pubDate>Mon, 16 Dec 2013 00:00:00 +0000</pubDate><guid>https://timor.site/2013/12/running-apache-with-mod_spdy-and-php-fpm/</guid><description>SPDY is new protocol proposed by Google as an alternative for HTTP(S). Currently Chrome and Firefox browsers are using it as default if available on server. It is faster in most cases by few to several percent. The side effect of using mod_spdy is that it&amp;rsquo;s working well only with thread safe Apache&amp;rsquo;s modules. PHP module for Apache is not thread safe so we need to use PHP as CGI or FastCGI service.</description></item><item><title>Certyfikaty nazwaSSL na wasnym serwerze</title><link>https://timor.site/2013/10/certyfikaty-nazwassl-na-wlasnym-serwerze/</link><pubDate>Tue, 22 Oct 2013 00:00:00 +0000</pubDate><guid>https://timor.site/2013/10/certyfikaty-nazwassl-na-wlasnym-serwerze/</guid><description>Od jakiego czasu mo偶na kupi w NetArcie certyfikaty SSL, a niedawno zrobili na nie promocj - 15z za pierwszy rok (za certyfikat na jedn stronk). Tzw. tanie i dobre. Po wyrobieniu certyfikatu i zapisaniu z panelu klienta mam pliczki: stonka.crt i netart_rootca.crt, kt贸re wrzucamy do Apachego, powiedzmy tak:
SSLCertificateFile /etc/ssl/certs/stonka.crt SSLCertificateKeyFile /etc/ssl/private/priv.key SSLCACertificateFile /etc/ssl/certs/netart_rootca.crt Certyfikat dziaa w Chromie ale nie weryfikuje si w Firefoxie i Internet Explorerze. FF wywietla bd: sec_error_unknown_issuer - co oznacza brak certyfikatu wystawcy gdzie w acuchu certyfikat贸w.</description></item><item><title>PHP - max_input_vars</title><link>https://timor.site/2013/01/php-max_input_vars/</link><pubDate>Tue, 22 Jan 2013 00:00:00 +0000</pubDate><guid>https://timor.site/2013/01/php-max_input_vars/</guid><description>W PHP 5.3 pojawia si nowa zmienna: max_input_vars, kt贸ra limituje ilo p贸l mo偶liwych do przesania przez formularz, obcinajc nadmiarowe. Pozwala to zapobiec atakom DoS na tablice hashujce (przynajmniej w tym jednym miejscu). Domylna warto tej zmiennej to 1000 i kreatywnym programistom udaje si t warto bez problemu osign 
Warte odnotowania jest to 偶e majc suhosin&amp;rsquo;a trzeba pamita o jeszcze dw贸ch innych zmiennych:
max_input_vars = 3000 suhosin.post.max_vars = 3000 suhosin.request.max_vars = 3000 Zmienne mo偶na zmieni od razu w /etc/php5/apache2/php.</description></item><item><title>Apache: mod_authnz_ldap z Active Directory</title><link>https://timor.site/2012/12/apache-mod_authnz_ldap-z-active-directory/</link><pubDate>Fri, 14 Dec 2012 00:00:00 +0000</pubDate><guid>https://timor.site/2012/12/apache-mod_authnz_ldap-z-active-directory/</guid><description>Gdy ju偶 si dorobi systemu Active Directory wygodnie jest wykorzysta jego baz u偶ytkownik贸w do autoryzacji w r贸偶nych miejscach, np. do pewnych &amp;ldquo;tajnych i tajniejszych&amp;rdquo; stron w Apache. Najprociej mo偶na to zrobi z wykorzystaniem LDAP.
Warto sprawdzi czy i jak mo偶emy dosta si do kontroler贸w. Gdy ju偶 mamy wszystkie potrzebne parametry konfigurujemy Apachego - na pocztek aktywujemy moduy:
a2enmod ldap a2enmod authnz_ldap Teraz mo偶emy edytujemy globalny plik konfiguracyjny mod_ldap&amp;rsquo;a by ustawi nieco cache&amp;rsquo;y (bardzo przydatne).</description></item><item><title>mod_rewrite - wymuszenie maych liter w adresie URL</title><link>https://timor.site/2012/09/mod_rewrite-wymuszenie-malych-liter-w-adresie-url/</link><pubDate>Tue, 25 Sep 2012 00:00:00 +0000</pubDate><guid>https://timor.site/2012/09/mod_rewrite-wymuszenie-malych-liter-w-adresie-url/</guid><description>Co prawda adresy URL pozwalaj na stosowanie zar贸wno du偶ych jak i maych liter ale r贸偶ne systemy mog je r贸偶nie obsugiwa i mo偶e si trafi sytuacja, w kt贸rej nie zechcemy by np. du偶e litery w og贸le pojawiay si w adresach URL. Doskonay przykad to m贸j niedawny wpis: Apache: ograniczenie dostpu dla zalogowanych u偶ytkownik贸w z mod_rewrite i mod_auth_basic.
Zachodzi tam sytuacja, w kt贸rej katalog u偶ytkownika jest jego loginem maymi literami (bd藕 du偶ymi - jak kto woli), a u偶ytkownik wpisujc login mo偶e u偶y zar贸wno maych jak i du偶ych liter i tutaj zaczyna si jazda.</description></item><item><title>Apache: ograniczenie dostpu dla zalogowanych u偶ytkownik贸w z mod_rewrite i mod_auth_basic</title><link>https://timor.site/2012/09/apache-ograniczenie-dostepu-dla-zalogowanych-uzytkownikow-z-mod_rewrite-i-mod_auth_basic/</link><pubDate>Sun, 09 Sep 2012 00:00:00 +0000</pubDate><guid>https://timor.site/2012/09/apache-ograniczenie-dostepu-dla-zalogowanych-uzytkownikow-z-mod_rewrite-i-mod_auth_basic/</guid><description>Niedawno trafiem na ciekawy problem w mod_rewrite - by przekierowywa u偶ytkownik贸w logujcych si jednym z modu贸w mod_auth_basic do dedykowanych im katalog贸w, r贸wnoczenie blokujc dostp do katalog贸w innych u偶ytkownik贸w. Nie brzmi to jako strasznie ale problem okaza si by cakiem nietrywialnym. Teoretyczne rozwizanie sprowadzao si do wyszukania loginu u偶ytkownika ze cie偶ki URI i por贸wnania z nazw u偶ytkownika ze zmiennej %{REMOTE_USER} - jeli wartoci si r贸偶ni to Forbidden. Ale szybko okazao si 偶e w RewriteCond zmienne z dopasowa mo偶na podstawia tylko w pierwszym parametrze i 偶e o ile mo偶na RewriteCond&amp;rsquo;y poczy wyra偶eniami logicznymi typu AND/OR to nie ma mo偶liwoci por贸wnania czy dopasowania z kolejnych RewriteCond&amp;rsquo;贸w s identyczne.</description></item><item><title>Apache - reverse proxy z cacheowaniem</title><link>https://timor.site/2012/06/apache-reverse-proxy-z-cacheowaniem/</link><pubDate>Sun, 17 Jun 2012 00:00:00 +0000</pubDate><guid>https://timor.site/2012/06/apache-reverse-proxy-z-cacheowaniem/</guid><description>Ostatnio trafiem na ciekawy problem, kt贸ry wielokrotnie rozwizywaem w nginx&amp;rsquo;ie ale tym razem musiaem zrobi to w Apache. Pewna stronka dziaa sobie na HTTPS&amp;rsquo;ie i chciaem by wszystkie powizane z ni pliki byy serwowane z jej adresu szyfrowanym poczeniem by nie pojawiay si w przegldarce monity 偶e &amp;ldquo;cz ruchu nie jest szyfrowana&amp;rdquo;. Tyle 偶e cz potrzebnych plik贸w bya ju偶 obecnie serwowana na innym serwerze (w innej domenie) poprzez HTTP.
Mogem albo skopiowa te pliki i wykombinowa jaki mechanizm synchronizujcy albo wykorzysta proxy + cache.</description></item><item><title>Apache mod_expires konfiguracja</title><link>https://timor.site/2012/01/apache-mod_expires-konfiguracja/</link><pubDate>Mon, 23 Jan 2012 00:00:00 +0000</pubDate><guid>https://timor.site/2012/01/apache-mod_expires-konfiguracja/</guid><description>Aby umo偶liwi odwiedzajcym nasze strony cachowanie obrazk贸w (tak by nie musieli pobiera ich ka偶dorazowo bo przecie偶 nie zmieniaj si a偶 tak czsto) konieczne jest ustawienie nag贸wk贸w: Cache-Control, Expires dla odpowiednich typ贸w plik贸w. W Apachem jest do tego dedykowany modu - mod_expires. W Debianie dostarczany jest on bez domylnej globalnej konfiguracji - a ja lubi gdy cacheuje mi si wikszo statyki. Zawsze mo偶na dostosowa czas cachowania pod siebie wzgldem okrelonego typu pliku, np.</description></item><item><title>X-Forwarded-For + mod_rpaf - logowanie rzeczywistych adres贸w IP na Apache za reverse proxy</title><link>https://timor.site/2011/11/x-forwarded-for-mod_rpaf-logowanie-rzeczywistych-adresow-ip-na-apache-za-reverse-proxy/</link><pubDate>Mon, 28 Nov 2011 00:00:00 +0000</pubDate><guid>https://timor.site/2011/11/x-forwarded-for-mod_rpaf-logowanie-rzeczywistych-adresow-ip-na-apache-za-reverse-proxy/</guid><description>Gdy ju偶 ustawimy reverse proxy przed Apache szybko mo偶na zauwa偶y 偶e w logach zamiast adres贸w IP zdalnych u偶ytkownik贸w pojawia si tylko jeden adres: adres naszego proxy. R贸wnie偶 z poziomu php&amp;rsquo;a jako adres klienta wida IP naszego proxy.
By poradzi sobie z tym problemem trzeba na serwerze reverse proxy ustawi przekazywanie informacji o oryginalnym adresie IP klienta w nag贸wku X-Forwarded-For. W przypadku gdy reverse proxy dziaa na nginx&amp;rsquo;e wystarczy doda taki wpis:</description></item><item><title>Por贸wnanie optymalizator贸w PHP - eAccelerator, PHP APC, XCache</title><link>https://timor.site/2011/11/porownanie-optymalizatorow-php-eaccelerator-php-apc-xcache/</link><pubDate>Wed, 02 Nov 2011 00:00:00 +0000</pubDate><guid>https://timor.site/2011/11/porownanie-optymalizatorow-php-eaccelerator-php-apc-xcache/</guid><description>Przez pewien czas korzystaem z eAcceleratora do przyspieszenia dziaania stron pisanych w PHP&amp;rsquo;ie ale czasem bywa niestabilny. Aktualizacje pojawiay si rzadko a od czasu do czasu miewaem problemy ze stabilnoci tej wtyczki na kilku bardziej skomplikowanych aplikacjach. Zdarzao si 偶e pomimo zmiany kodu w skrypcie php, eAccelerator serwowa wci偶 stary plik - konieczny by restart Apache&amp;rsquo;go by wszystko dziaao jak trzeba.
Zaczem szuka alternatywy i trafiem na dwa moduy:
APC (czyli Alternative PHP Cache), kt贸ry ma by nawet domylnie wbudowany w PHP od wersji 5.</description></item><item><title>Zabezpieczenie Apachego na Debianie przed slowlorisem</title><link>https://timor.site/2011/09/zabezpieczenie-apachego-na-debianie-przed-slowlorisem/</link><pubDate>Mon, 12 Sep 2011 00:00:00 +0000</pubDate><guid>https://timor.site/2011/09/zabezpieczenie-apachego-na-debianie-przed-slowlorisem/</guid><description>Od jakiego czasu dostpny jest w sieci skrypt slowloris.plpozwalajcy z pojedynczego komputera wykona atak DOS na zdalny serwer WWW. Atak polega na uruchomieniu wielu r贸wnoczesnych sesji i bardzo wolnym wysyaniu komunikat贸w HTTP. Atakujcy udaje &amp;ldquo;klienta z wolnym czem&amp;rdquo; r贸wnoczenie uruchamiajc kolejne sesje by po pewnym czasie zaj wszystkie dostpne. Serwer WWW przestaje wtedy odpowiada na zapytania od innych klient贸w. Dodatkowo na 藕le wyskalowanych serwerach du偶a liczba proces贸w Apachego mo偶e spowodowa swapowanie i bdy braku pamici.</description></item><item><title>Optymalizacja PHP z eAcceleratorem</title><link>https://timor.site/2011/08/optymalizacja-php-z-eacceleratorem/</link><pubDate>Mon, 29 Aug 2011 00:00:00 +0000</pubDate><guid>https://timor.site/2011/08/optymalizacja-php-z-eacceleratorem/</guid><description>Przy okazji wykonywania kilku drobnych optymalizacji swojej stronki natknem si naeAccelerator&amp;rsquo;a. Ciekawy projekt, kt贸ry wsposobie dziaania przypomina Zend Optimizer&amp;rsquo;a ale ma jedn zasadnicz zalet - jest darmowy 
Niestety nie ma go wrepozytoriach Debiana, wic trzeba go sobie skompilowa - cay proces jest do prosty. Zaczynamy od pobrania najwie偶szej paczki, obecnie jest to wersja 0.9.5.3:
Pobierz eAccelerator(ostatnio miaem problem z tym linkiem wic proponuj pogoogla)
Pobieramy irozpakowujemy pliki:</description></item><item><title>Statystyki odwiedzin dla wielu serwis贸w z AWStats</title><link>https://timor.site/2011/08/statystyki-odwiedzin-dla-wielu-serwisow-z-awstats/</link><pubDate>Mon, 29 Aug 2011 00:00:00 +0000</pubDate><guid>https://timor.site/2011/08/statystyki-odwiedzin-dla-wielu-serwisow-z-awstats/</guid><description>Co prawda na swojej stronie zrobiem kilka podstawowych statystyk ico tam sobie loguj do bazy danych, ale gdyby si chwil zastanowi to przecie偶 to samo robi serwerwww- wrzuca do log贸w ka偶de zapytanieHTTP, kod bdu, nazw agenta, itd. Dublowanie tych danych nie jest najbardziej optymalne.
Std te偶 chwil pogooglaem iznalazem wietnyOpen Source&amp;rsquo;owy projekt:AWStats, kt贸ry jest webowym analizatorem log贸w dla serwer贸wHTTP,FTPiSMTP.</description></item><item><title>Klastrowanie sesji PHP z memcached</title><link>https://timor.site/2011/08/klastrowanie-sesji-php-z-memcached/</link><pubDate>Sat, 27 Aug 2011 00:00:00 +0000</pubDate><guid>https://timor.site/2011/08/klastrowanie-sesji-php-z-memcached/</guid><description>Klastrowanie to mo偶e zbyt dumnie powiedziane. Rozwizanie to wyszukaem gdy chcc skonfigurowa dwa serweryapachedo wsp贸pracy na rzecz jednego serwisu okazao si, 偶e sejse trzymane s tylko przez jeden serwer adrugi nic onich nie wie. To oczywicie nie pozwalao na prawidowe dziaanie jakiegokolwiek serwisu korzystajcego zsesji.
Pomys jest taki, 偶e zastpujemy domyny mechanizm przechowywania sesji wplikach na dysku mechanizmem memcache. Poniewa偶memcacheddziaa jako usuga sieciowa, r贸偶ne serwery mog si odwoywa do pulimemcachediodczytywa zapisane wniej dane.</description></item></channel></rss>