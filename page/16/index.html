<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tom's Blog</title><meta name=keywords content="Blog,Technical,Automation,DevOps,Cloud,Linux,Leadership"><meta name=description content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><meta name=author content="timor"><link rel=canonical href=https://gagor.pro/><link crossorigin=anonymous href=/assets/css/stylesheet.dd9b399756d51cbc22dd492f8bc5e6baa73d268548ef7584ed5740fe95fdcbce.css integrity="sha256-3Zs5l1bVHLwi3Ukvi8Xmuqc9JoVI73WE7VdA/pX9y84=" rel="preload stylesheet" as=style><link rel=icon href=https://gagor.pro/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pro/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pro/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pro/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pro/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://gagor.pro/index.xml><link rel=alternate type=application/json href=https://gagor.pro/index.json><link rel=alternate type=text/redirects href=https://gagor.pro/_redirects><link rel=alternate hreflang=en href=https://gagor.pro/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta name=fediverse:creator content="@tgagor@mastodon.social"><link rel=me hreflang=en href=https://mastodon.social/@tgagor><meta property="og:url" content="https://gagor.pro/"><meta property="og:site_name" content="Tom's Blog"><meta property="og:title" content="Tom's Blog"><meta property="og:description" content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tom's Blog"><meta name=twitter:description content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Tom's Blog","url":"https://gagor.pro/","description":"Linux configuration, Automation, Security - Sysadmin/DevOps blog","logo":"https://gagor.pro/favicon.ico","sameAs":["https://www.linkedin.com/in/tgagor","https://github.com/tgagor","https://buymeacoffee.com/tgagor","https://ko-fi.com/tgagor","https://hub.docker.com/u/tgagor","https://mastodon.social/@tgagor","index.xml"]}</script></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pro/ accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pro/favicon-36x36.avif alt="Page logo" aria-label=logo height=36 width=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pro/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pro/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pro/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pro/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pro/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>DFS - sprawdzanie statusu replikacji</h2></header><div class=entry-content><p>Ostatnio zbyt dużo grzebię przy “windach” - ale cóż, czasem trzeba. Ostatnio ustawiałem DFS’a z replikacją dla dwóch sporych zasobów i jedna z rzeczy, o którą się rozbiłem to brak jakiegokolwiek podglądu tej synchronizacji z GUI. Ale znalazłem jedno polecenie, które działa w shellu (choć to się chyba batch tutaj nazywa) od Windows Server 2008 R2:
dfsrdiag ReplicationState /member:nazwaservera Polecenie co prawda nie podaje postępu procentowego ale można zobaczyć “czy coś jeszcze się synchronizuje” i czy nie ma żadnych błędów. Jeżeli to polecenie to za mało to można spróbować bardziej gadatliwej wersji:
...</p></div><footer class=entry-footer><span title='2013-09-04 00:00:00 +0000 UTC'>2013-09-04</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to DFS - sprawdzanie statusu replikacji" href=https://gagor.pro/2013/09/dfs-sprawdzanie-statusu-replikacji/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Root’owanie Androida 4.3 na Google Nexus 7 po aktualizacji do JWR66Y</h2></header><div class=entry-content><p>Ostatnio aktualizowałem swojego Nexusa do 4.3 i było miło tylko mi roota i recovery wystrzeliło… No ale żaden problem - chwila googlania, kilka poleceń i mam recovery i roota. Dzisiaj wrzuciłem niedużą aktualizację, która łata kilka bugów i znów po root’cie ;/
Zapisze sobie więc instrukcję by kolejnym razem już nie googlać 😃
P.S. Wiem co robię ryzykując uceglenie swojego urządzenia - u mnie ta instrukcja działa ale nie mogę tego zagwarantować każdemu - dlatego jeśli już się zdecydujesz to ROBISZ TO NA WŁASNĄ ODPOWIEDZIALNOŚĆ!
...</p></div><footer class=entry-footer><span title='2013-09-04 00:00:00 +0000 UTC'>2013-09-04</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Root’owanie Androida 4.3 na Google Nexus 7 po aktualizacji do JWR66Y" href=https://gagor.pro/2013/09/rootowanie-androida-4-3-na-google-nexus-7-po-aktualizacji-do-jwr66y/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Kopiowanie wolumenów LVM z dd i netcat</h2></header><div class=entry-content><p>Niedawno chciałem skopiować maszynę wirtualną z jednego hypervisora na innego. Były to 3 wolumeny LVM o rozmiarach od 50 do 100GB. Dawno temu zrobiłem sobie skrypty do backupu - jeden kompresuje wolumeny LVM - a drugi pozwala odtworzyć z dekompresja na drugim serwerze. Tyle że przy tak dużej maszynce będzie to trwało masakrycznie długo - fajnie byłoby móc równocześnie kopiować i odtwarzać (live)…
I wtedy przypomniało mi się narzędzie netcat - zrobiłem snapshoty wolumenów i mogłem zaczynać. W najbardziej podstawowej wersji potrzebowałem tylko tyle:
...</p></div><footer class=entry-footer><span title='2013-09-02 00:00:00 +0000 UTC'>2013-09-02</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Kopiowanie wolumenów LVM z dd i netcat" href=https://gagor.pro/2013/09/kopiowanie-wolumenow-lvm-z-dd-i-netcat/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>GPO: Instalacja GIMP’a 2.8</h2></header><div class=entry-content><p>Raz na jakiś czas trzeba coś niestandardowego wrzucić do instalacji w Active Directory a że nie wszystkie aplikacje mają dostępne paczki MSI to trzeba się nieco natrudzić.
Poniżej wrzucam skrypt, który instaluje GIMP’a 2.8 z domyślnego instalatora (wersja InnoSetup) przy okazji odinstalowując wcześniejsze wersje zainstalowane ręcznie.
Zapisujemy poniższy kod jako np. gimp-install.cmd
@echo off REM Installs GIMP cls echo ---------------------------------------------------- echo . echo . echo . Installing/Updating GIMP - Please Wait echo . echo . echo ---------------------------------------------------- REM Test if actual IF exist "%ProgramFiles%\GIMP\bin\gimp-2.8.exe" GOTO SkipInstall REM Exit the application taskkill.exe /F /FI "IMAGENAME eq gimp-2.8.exe" >nul REM Uninstall existing GIMP version, delete folder if exist "%ProgramFiles%\GIMP 2\uninst\unins000.exe" "%ProgramFiles%\GIMP 2\uninst\unins000.exe" /VERYSILENT :: Wait for 20 seconds ping -n 40 127.0.0.1 > NUL if exist "%ProgramFiles%\GIMP 2\" rd "%ProgramFiles%\GIMP 2\" /Q /S REM Install new version "\\serwerplikow.local\Instalki\GIMP\gimp-2.8.4-setup.exe" /VERYSILENT /NORESTART /DIR="%PROGRAMFILES%\GIMP 2.8" REM Skip installation if acctuall :SkipInstall REM Return exit code to SCCM exit /B %EXIT_CODE% Tworzymy nową regułkę GPO i zmierzamy do: Computer Configuration\Policies\Windows Settings\Scripts\Startup
W nowym okienku wybieramy Show Files…
Wklejamy plik skryptu do tego folderu i teraz możemy dodać go w tym samym oknie (Add…) - dzięki wrzuceniu skryptu w tym miejscu będzie się on automatycznie replikować na inne kontrolery. Skrypt będzie co prawda uruchamiany przy każdym starcie komputera ale pierwszy warunek będzie sprawdzać czy aplikacja jest zainstalowana więc nie spowolni to znacznie startu.
...</p></div><footer class=entry-footer><span title='2013-08-06 00:00:00 +0000 UTC'>2013-08-06</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to GPO: Instalacja GIMP’a 2.8" href=https://gagor.pro/2013/08/gpo-instalacja-gimpa-2-8/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>logrotate: kompresja logów xz</h2></header><div class=entry-content><p>Narzędzia xz-utils dostępne w nowszych systemach korzystają z mocniejszych algorytmów kompresji (jakaś odmiana LZMA, coś w stylu 7zip’a) przy zachowaniu kompatybilności składni poleceń z gzip’em/bzip’em - da się je zatem łatwo zintegrować w obecnych systemach. Ja chciałem wykorzystać xz do kompresji logów, które bywają przydatne ale przez większość czasy tylko zajmują miejsce :simple_smile:
W /etc/logrotate.conf dopisujemy:
compresscmd /usr/bin/xz uncompresscmd /usr/bin/unxz compressext .xz compressoptions -9T2 compressoptions można nie ustawiać bo domyślnie ma wartość -9 (czyli kompresuj na maxa), mój dodatek (czyli -T2) użyje dwóch wątków procesora gdy już ten mechanizm zostanie zimplementowany (bo na razie nie jest) :simple_smile:</p></div><footer class=entry-footer><span title='2013-07-29 00:00:00 +0000 UTC'>2013-07-29</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to logrotate: kompresja logów xz" href=https://gagor.pro/2013/07/logrotate-kompresja-logow-xz/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Bezstratna konwersja MKV z DTS do AC3 lub AAC</h2></header><div class=entry-content><p>Na jednym z urządzeń miałem problem z odtworzeniem plików (głównie MKV) z dźwiękiem zakodowanym w DTS. Pomijając że np. na tablecie 6-cio kanały DTS jest mi “niezbędny inaczej” to konwertując go do AAC stereo plik jest po prostu sporo mniejszy. Oczywiście nie zamierzam transkodować ścieżki video i na moje potrzeby mogłem sobie odpuścić zmianę częstotliwości próbkowania.
Najprościej wykorzystać pakiet ffmpeg (po nowemu avconv) lub mencoder (choć ten miewał niegdyś problem z poprawnym zapisywaniem wynikowych plików mkv, więc potrzebny jest dodatkowo mkvmerge z pakietu mkvtoolnix). mencoder transkoduje szybciej wykorzystując więcej rdzeniu CPU, ale później potrzebny był drugi przebieg z mkvmerge. ffmpeg jechał na jednym procku nawet z opcją threads ale za to wszystko mogę zrobić jednym poleceniem.
...</p></div><footer class=entry-footer><span title='2013-07-17 00:00:00 +0000 UTC'>2013-07-17</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Bezstratna konwersja MKV z DTS do AC3 lub AAC" href=https://gagor.pro/2013/07/bezstratna-konwersja-mkv-z-dts-do-ac3-lub-aac/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Dodawanie urządzeń SCSI/FC bez restartu serwera</h2></header><div class=entry-content><p>Raz na jakiś czas gdy grzebię przy maciorach muszę “odkryć” nowy volumen FC (lub rzadziej SCSI), który właśnie utworzyłem a restart serwera nie wchodzi w rachubę (zresztą na części systemów nic on nie da).
By to zrobić są dwie możliwości:
Ręczne wydanie poleceń odkrywających volumeny (na jajkach od 2.6.x) Sprawdzamy jakie mamy karty:
ls /sys/class/fc_host/ (wypisze się coś w stylu: host1, host2)
Wydajemy do wybranej przez nas karty żądanie wykonania LIP (to się chyba tłumaczy jako loopback initialization) co skutkuje przeskanowaniem szyny FC:
...</p></div><footer class=entry-footer><span title='2013-07-17 00:00:00 +0000 UTC'>2013-07-17</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Dodawanie urządzeń SCSI/FC bez restartu serwera" href=https://gagor.pro/2013/07/dodawanie-urzadzen-scsifc-bez-restartu-serwera/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Debian - Instalacja Bittorrent Sync (btsync)</h2></header><div class=entry-content><p>Bardzo spodobała mi się nowa aplikacja do zdalnej synchronizacji folderów z wykorzystaniem P2P. Ja wykorzystałem ją do automatycznych backupów archiwum zdjęć - zebrało mi się tego już prawie 130GB! Każde narzędzie, które chce np. je kompresować i raz na czas robić FULL backup jest skazane na porażkę - a fotek przybywa.
Na początek pobieramy interesującą nas wersję:
wget http://btsync.s3-website-us-east-1.amazonaws.com/btsync_i386.tar.gz wget http://btsync.s3-website-us-east-1.amazonaws.com/btsync_x64.tar.gz Oraz paczkę ze skryptami dla Debiana:
wget http://www.yeasoft.com/downloads/various/btsync-linux-deploy.tar.gz Ja wyciągam z niej skrypt /etc/init.d/btsync i konfigurację /etc/*
...</p></div><footer class=entry-footer><span title='2013-07-16 00:00:00 +0000 UTC'>2013-07-16</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Debian - Instalacja Bittorrent Sync (btsync)" href=https://gagor.pro/2013/07/debian-instalacja-bittorrent-sync-btsync/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Tworzenie patch’y z poleceniami diff i patch</h2></header><div class=entry-content><p>Jest kilka powodów dla których tworzenie patchy jest przydatne - jeśli tu jesteś to pewnie masz jakiś własny…
Tworzenie patch’a diff -crB old new > from-old-to-new.patch W powyższym poleceniu założyłem że old i new to katalogi z wieloma podkatalogami i plikami - stąd opcja -r. -c dodaje kilka linijek “kontekstu” przez co łatwiej rozeznać się w patch’u. Opcja -B ignoruje puste linie, których patchowanie mnie nie interesuje.
Patchowanie Na początek zawsze warto wywołać polecenie z opcją -dry-run by zobaczyć czy patch wykona się poprawnie:
...</p></div><footer class=entry-footer><span title='2013-04-01 00:00:00 +0000 UTC'>2013-04-01</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Tworzenie patch’y z poleceniami diff i patch" href=https://gagor.pro/2013/04/tworzenie-patchy-z-poleceniami-diff-i-patch/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Rozsynchronizowane serwery NTP</h2></header><div class=entry-content><p>Miałem ostatnio zabawną sytuację gdy kilka serwerów z zainstalowanym NTPD miało rozjazdy rzędu kilkunastu sekund. Wyszło na to że moje serwery synchronizowały się z różnymi zewnętrznymi serwerami NTP pomiędzy, którymi były rozjazdy i te rozjazdy synchronizowały się na moich serwerach. Jeden “z moich” ustanowiłem głównym a wszystkie inne przekierowałem na niego (komentując wszystkie inne serwery NTP w konfiguracji). Wymusiłem synchronizację:
ntp -q Sprawdziłem jak duży jest offset i jitter (powinny być bardzo małe):
...</p></div><footer class=entry-footer><span title='2013-03-31 00:00:00 +0000 UTC'>2013-03-31</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Rozsynchronizowane serwery NTP" href=https://gagor.pro/2013/03/rozsynchronizowane-serwery-ntp/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://gagor.pro/page/15/>«&nbsp;Prev&nbsp;
</a><a class=next href=https://gagor.pro/page/17/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span><a href=https://gagor.pro/>Tom's Blog</a> &copy; 2008-2025</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=https://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "8d51d5292abd4c77bad90db038659671"}'></script><script defer src=https://analytics.ahrefs.com/analytics.js data-key=ngiuUolR4+T0MnN5eV7I/A async></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>