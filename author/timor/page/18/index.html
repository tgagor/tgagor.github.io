<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Timor | Tom's Blog</title>
<meta name=keywords content><meta name=description content="pages for taxonomy (classification) term: timor"><meta name=author content="timor"><link rel=canonical href=https://gagor.pro/author/timor/><link crossorigin=anonymous href=/assets/css/stylesheet.985a7641e69c6b20f34bf2fd88dce5a50d271007390e15128242aada21b132f4.css integrity="sha256-mFp2QeacayDzS/L9iNzlpQ0nEAc5DhUSgkKq2iGxMvQ=" rel="preload stylesheet" as=style><link rel=icon href=https://gagor.pro/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pro/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pro/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pro/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pro/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gagor.pro/author/timor/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://gagor.pro/author/timor/"><meta property="og:site_name" content="Tom's Blog"><meta property="og:title" content="Timor"><meta property="og:description" content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Timor"><meta name=twitter:description content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pro/ accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pro/favicon-36x36.avif alt="Page logo" aria-label=logo height=36 width=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pro/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pro/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pro/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pro/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pro/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://gagor.pro/>Home</a>&nbsp;Â»&nbsp;<a href=https://gagor.pro/authors/>Authors</a></div><h1>Timor</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Zeitgeist activity.sqlite-wal getting huge</h2></header><div class=entry-content><p>I was looking at backup task running on my desk and saw that itâ€™s spending a lot of time on ~/.local/share/zeitgeist directory. I checked and it had 4.6GB:
du -sh ~/.local/share/zeitgeist/* 118M activity.sqlite 44M activity.sqlite.bck 32K activity.sqlite-shm 4,4G activity.sqlite-wal 311M fts.index WTF? Fortunately I found hereâ€‰ external link that I could easily delete some of this:
zeitgeist-daemon --quit Now check that itâ€™s not running:
...</p></div><footer class=entry-footer><span title='2016-02-04 00:00:00 +0000 UTC'>2016-02-04</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to Zeitgeist activity.sqlite-wal getting huge" href=https://gagor.pro/2016/02/zeitgeist-activity-sqlite-wal-getting-huge/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Optimize Nginx for performance</h2></header><div class=entry-content><p>There are many possible real life cases and not all optimization technics will be suitable for you but I hope it will be a good starting place.
Also you shouldnâ€™t copy paste examples with faith that they will make your server fly ðŸ˜ƒ You have to support your decisions with excessive tests and help of monitoring system (ex. Grafana ).
Cache static and dynamic content Setting caching static and dynamic content strategy may offload your server from additional load from repetitive downloads of same, rarely updated files. This will make your site to load faster for frequent visitors.
...</p></div><footer class=entry-footer><span title='2016-01-14 00:00:00 +0000 UTC'>2016-01-14</span>&nbsp;Â·&nbsp;7 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to Optimize Nginx for performance" href=https://gagor.pro/2016/01/optimize-nginx-for-performance/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>XenServer - export VM to file</h2></header><div class=entry-content><p>Sometime you need to make quick and dirty image backup of VM running on XenServer and this post is about such case ðŸ˜ƒ
List machines:
xl list Name ID Mem VCPUs State Time(s) Domain-0 0 4066 8 r----- 3526567.3 webfront1.example.com 1 4096 4 r----- 3186487.2 webfront2.example.com 2 2048 2 -b---- 920408.2 Now you may export one:
xe vm-export vm=webfront1.example.com filename=/srv/backup/webfront.xva Export succeeded You may also use uuid for that - list machines with xe vm-list (best with less) and then:
...</p></div><footer class=entry-footer><span title='2016-01-12 00:00:00 +0000 UTC'>2016-01-12</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to XenServer - export VM to file" href=https://gagor.pro/2016/01/xenserver-export-vm-to-file/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nagios - downtime on host/service from command line with curl</h2></header><div class=entry-content><p>Sometimes deployment process or other heavy task may cause some Nagios checks to rise below normal levels and bother admin1. If this is expected and you want to add downtime on host/service during this task you may use this script:
#!/bin/bash function die { echo $1; exit 1; } if [[ $# -eq 0 ]] ; then die "Give hostname and time in minutes as parameter!" fi if [[ $# -eq 1 ]] ; then MINUTES=15 else MINUTES=$2 fi HOST=$1 NAGURL=http://nagios.example.com/nagios/cgi-bin/cmd.cgi USER=nagiosuser PASS=nagiospassword SERVICENAME=someservice COMMENT="Deploying new code" export MINUTES echo "Scheduling downtime on $HOST for $MINUTES minutes..." # The following is urlencoded already STARTDATE=`date "+%d-%m-%Y %H:%M:%S"` # This gives us the date/time X minutes from now ENDDATE=`date "+%d-%m-%Y %H:%M:%S" -d "$MINUTES min"` curl --silent --show-error \ --data cmd_typ=56 \ --data cmd_mod=2 \ --data host=$HOST \ --data-urlencode "service=$SERVICENAME" \ --data-urlencode "com_data=$COMMENT" \ --data trigger=0 \ --data-urlencode "start_time=$STARTDATE" \ --data-urlencode "end_time=$ENDDATE" \ --data fixed=1 \ --data hours=2 \ --data minutes=0 \ --data btnSubmit=Commit \ --insecure \ $NAGURL -u "$USER:$PASS"| grep -q "Your command request was successfully submitted to Nagios for processing." || die "Failed to con tact nagios"; echo Scheduled downtime on nagios from $STARTDATE to $ENDDATE Threat this script as template with some tips:
...</p></div><footer class=entry-footer><span title='2016-01-11 00:00:00 +0000 UTC'>2016-01-11</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nagios - downtime on host/service from command line with curl" href=https://gagor.pro/2016/01/nagios-downtime-on-hostservice-from-command-line-with-curl/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Grafana - installation and configuraton with InfluxDB and CollectD on Debian/Ubuntu</h2></header><div class=entry-content><p>Now when you have CollectD and InfluxDB installed you may configure Grafana ðŸ˜ƒ
First configure repo with current Grafana version (select your distro):
curl https://packagecloud.io/gpg.key | sudo apt-key add - deb https://packagecloud.io/grafana/testing/debian/ wheezy main Now install package (on wheezy I needed to install apt-transport-https to allow installation of packages from repo via HTTPS):
apt-get update apt-get install -y apt-transport-https apt-get install -y grafana By default Grafana will use sqlite database to keep information about users, etc:
...</p></div><footer class=entry-footer><span title='2016-01-10 00:00:00 +0000 UTC'>2016-01-10</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to Grafana - installation and configuraton with InfluxDB and CollectD on Debian/Ubuntu" href=https://gagor.pro/2016/01/grafana-installation-and-configuraton-with-influxdb-and-collectd-on-debian-ubuntu/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>InfluxDB - installation and configuration on Debian/Ubuntu</h2></header><div class=entry-content><p>I wanted/needed some statistics on few my machines. I saw earlier grafana and was impressed so this was starting point. Then I started reading about graphite, carbon and whisper, and thenâ€¦ I found InfluxDB. Project is young but looks promising.
Letâ€™s start! On project page there is no info about repo but itâ€™s available, configure it:
curl -sL https://repos.influxdata.com/influxdb.key | apt-key add - echo "deb https://repos.influxdata.com/debian wheezy stable" > /etc/apt.sources.list.d/influxdb.conf for Ubuntu use url like (of course selecting your version):
...</p></div><footer class=entry-footer><span title='2016-01-09 00:00:00 +0000 UTC'>2016-01-09</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to InfluxDB - installation and configuration on Debian/Ubuntu" href=https://gagor.pro/2016/01/influxdb-installation-and-configuration-on-debianubuntu/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>CollectD - installation and configuration with InfluxDB on Debian/Ubuntu</h2></header><div class=entry-content><p>I wanted/needed some statistics on few my machines. I saw earlier grafana and was impressed so this was starting point. Then I started reading about graphite, carbon and whisper, and thenâ€¦ I found InfluxDB. Project is young but looks promising.
Installation of collectd is easy on Debian because packages are in default repo. One problem is that packages may be old, ex. on wheezy it version 5.1. But in backports/backports-sloppy you may find current 5.5, so enable backports first:
...</p></div><footer class=entry-footer><span title='2016-01-08 00:00:00 +0000 UTC'>2016-01-08</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to CollectD - installation and configuration with InfluxDB on Debian/Ubuntu" href=https://gagor.pro/2016/01/collectd-installation-and-configuration-with-influxdb-on-debianubuntu/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Letâ€™s Encrypt - without auto configuration</h2></header><div class=entry-content><p>From the first moment I heard about Letâ€™s Encrypt I liked it and wanted to use it as fast as possible. But the more I read how they want to implement it, the more I dislike it.
Current project with automatic configuration is not what I want to use at all. I have many very complicated configs and I do not trust such tools enough to use them. I like UNIXâ€™s single purpose principle, tools should do one thing and do it well - nothing more.
...</p></div><footer class=entry-footer><span title='2016-01-04 00:00:00 +0000 UTC'>2016-01-04</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to Letâ€™s Encrypt - without auto configuration" href=https://gagor.pro/2016/01/lets-encrypt-without-auto-configuration/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>fail2ban - block wp-login.php brute force attacks</h2></header><div class=entry-content><p>Lately I had a lot of brute force attacks on my WordPress blog. I used basic auth to /wp-admin part in nginx configuration to block this and as a better solution I wanâ€™t to block source IPs at all on firewall.
To do this, place this filter code in /etc/fail2ban/filter.d/wp-login.conf:
# WordPress brute force wp-login.php filter: # # Block IPs trying to authenticate in WordPress blog # # Matches e.g. # 178.218.54.109 - - [31/Dec/2015:10:39:34 +0100] "POST /wp-login.php HTTP/1.1" 401 188 "-" "Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0" # [Definition] failregex = ^&lt;HOST> .* "POST /wp-login.php ignoreregex = Then edit your /etc/fail2ban/jail.local and add:
...</p></div><footer class=entry-footer><span title='2015-12-31 00:00:00 +0000 UTC'>2015-12-31</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to fail2ban - block wp-login.php brute force attacks" href=https://gagor.pro/2015/12/fail2ban-block-wp-login-php-brute-force-attacks/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Ansible on Vagrant - skipping: no hosts matched</h2></header><div class=entry-content><p>I have some Ansible roles to configure my vps, Raspberry Pi, etc. I like to test them before I broke something on my real, not clustered machines - I use Vagrant for that.
But with it I had one problem - in playbooks I define hosts as groups of severs ex. web for my vps:
Example Ansible playbook - hosts: web gather_facts: True sudo: True ... But testing machine wasnâ€™t in this group and when I run vagrant I could only see:
...</p></div><footer class=entry-footer><span title='2015-12-29 00:00:00 +0000 UTC'>2015-12-29</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;timor</footer><a class=entry-link aria-label="post link to Ansible on Vagrant - skipping: no hosts matched" href=https://gagor.pro/2015/12/ansible-on-vagrant-skipping-no-hosts-matched/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://gagor.pro/author/timor/page/17/>Â«&nbsp;Prev&nbsp;
</a><a class=next href=https://gagor.pro/author/timor/page/19/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span><a href=https://gagor.pro/>Tom's Blog</a> &copy; 2008-2025</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=https://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "8d51d5292abd4c77bad90db038659671"}'></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>