<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>timor | timor's site</title><meta name=keywords content><meta name=description content="pages for taxonomy (classification) term: timor"><meta name=author content="timor"><link rel=canonical href=https://gagor.pl/authors/timor/><link crossorigin=anonymous href=/assets/css/stylesheet.93a7bb0e4037b10e2d13ecb5a064edb636bd4156dfce17bfbd5115c4fce2d166.css integrity="sha256-k6e7DkA3sQ4tE+y1oGTttja9QVbfzhe/vVEVxPzi0WY=" rel="preload stylesheet" as=style><link rel=icon href=https://gagor.pl/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pl/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pl/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pl/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pl/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://gagor.pl/authors/timor/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="timor"><meta property="og:description" content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"><meta property="og:type" content="website"><meta property="og:url" content="https://gagor.pl/authors/timor/"><meta name=twitter:card content="summary"><meta name=twitter:title content="timor"><meta name=twitter:description content="Linux configuration, Automation, Security - Sysadmin/DevOps blog"></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pl accesskey=h title="timor's site (Alt + H)"><img src=https://gagor.pl/favicon-72x72.png alt aria-label=logo height=36>timor's site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pl/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pl/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pl/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pl/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pl/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://gagor.pl/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://gagor.pl>Home</a>&nbsp;»&nbsp;<a href=https://gagor.pl/authors/>Authors</a></div><h1>timor</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>logrotate: kompresja logów xz</h2></header><div class=entry-content><p>Narzędzia xz-utils dostępne w nowszych systemach korzystają z mocniejszych algorytmów kompresji (jakaś odmiana LZMA, coś w stylu 7zip’a) przy zachowaniu kompatybilności składni poleceń z gzip’em/bzip’em - da się je zatem łatwo zintegrować w obecnych systemach. Ja chciałem wykorzystać xz do kompresji logów, które bywają przydatne ale przez większość czasy tylko zajmują miejsce :simple_smile:
W /etc/logrotate.conf dopisujemy:
compresscmd /usr/bin/xz uncompresscmd /usr/bin/unxz compressext .xz compressoptions -9T2 compressoptions można nie ustawiać bo domyślnie ma wartość -9 (czyli kompresuj na maxa), mój dodatek (czyli -T2) użyje dwóch wątków procesora gdy już ten mechanizm zostanie zimplementowany (bo na razie nie jest) :simple_smile:</p></div><footer class=entry-footer><span title='2013-07-29 00:00:00 +0000 UTC'>2013-07-29</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to logrotate: kompresja logów xz" href=https://gagor.pl/2013/07/logrotate-kompresja-logow-xz/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Bezstratna konwersja MKV z DTS do AC3 lub AAC</h2></header><div class=entry-content><p>Na jednym z urządzeń miałem problem z odtworzeniem plików (głównie MKV) z dźwiękiem zakodowanym w DTS. Pomijając że np. na tablecie 6-cio kanały DTS jest mi “niezbędny inaczej” to konwertując go do AAC stereo plik jest po prostu sporo mniejszy. Oczywiście nie zamierzam transkodować ścieżki video i na moje potrzeby mogłem sobie odpuścić zmianę częstotliwości próbkowania.
Najprościej wykorzystać pakiet ffmpeg (po nowemu avconv) lub mencoder (choć ten miewał niegdyś problem z poprawnym zapisywaniem wynikowych plików mkv, więc potrzebny jest dodatkowo mkvmerge z pakietu mkvtoolnix)....</p></div><footer class=entry-footer><span title='2013-07-17 00:00:00 +0000 UTC'>2013-07-17</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Bezstratna konwersja MKV z DTS do AC3 lub AAC" href=https://gagor.pl/2013/07/bezstratna-konwersja-mkv-z-dts-do-ac3-lub-aac/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Dodawanie urządzeń SCSI/FC bez restartu serwera</h2></header><div class=entry-content><p>Raz na jakiś czas gdy grzebię przy maciorach muszę “odkryć” nowy volumen FC (lub rzadziej SCSI), który właśnie utworzyłem a restart serwera nie wchodzi w rachubę (zresztą na części systemów nic on nie da).
By to zrobić są dwie możliwości:
Ręczne wydanie poleceń odkrywających volumeny (na jajkach od 2.6.x) Sprawdzamy jakie mamy karty:
ls /sys/class/fc_host/ (wypisze się coś w stylu: host1, host2)
Wydajemy do wybranej przez nas karty żądanie wykonania LIP (to się chyba tłumaczy jako loopback initialization) co skutkuje przeskanowaniem szyny FC:...</p></div><footer class=entry-footer><span title='2013-07-17 00:00:00 +0000 UTC'>2013-07-17</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Dodawanie urządzeń SCSI/FC bez restartu serwera" href=https://gagor.pl/2013/07/dodawanie-urzadzen-scsifc-bez-restartu-serwera/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Debian - Instalacja Bittorrent Sync (btsync)</h2></header><div class=entry-content><p>Bardzo spodobała mi się nowa aplikacja do zdalnej synchronizacji folderów z wykorzystaniem P2P. Ja wykorzystałem ją do automatycznych backupów archiwum zdjęć - zebrało mi się tego już prawie 130GB! Każde narzędzie, które chce np. je kompresować i raz na czas robić FULL backup jest skazane na porażkę - a fotek przybywa.
Na początek pobieramy interesującą nas wersję:
wget http://btsync.s3-website-us-east-1.amazonaws.com/btsync_i386.tar.gz wget http://btsync.s3-website-us-east-1.amazonaws.com/btsync_x64.tar.gz Oraz paczkę ze skryptami dla Debiana:
wget http://www.yeasoft.com/downloads/various/btsync-linux-deploy.tar.gz Ja wyciągam z niej skrypt /etc/init....</p></div><footer class=entry-footer><span title='2013-07-16 00:00:00 +0000 UTC'>2013-07-16</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Debian - Instalacja Bittorrent Sync (btsync)" href=https://gagor.pl/2013/07/debian-instalacja-bittorrent-sync-btsync/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Tworzenie patch’y z poleceniami diff i patch</h2></header><div class=entry-content><p>Jest kilka powodów dla których tworzenie patchy jest przydatne - jeśli tu jesteś to pewnie masz jakiś własny…
Tworzenie patch’a diff -crB old new > from-old-to-new.patch W powyższym poleceniu założyłem że old i new to katalogi z wieloma podkatalogami i plikami - stąd opcja -r. -c dodaje kilka linijek “kontekstu” przez co łatwiej rozeznać się w patch’u. Opcja -B ignoruje puste linie, których patchowanie mnie nie interesuje.
Patchowanie Na początek zawsze warto wywołać polecenie z opcją -dry-run by zobaczyć czy patch wykona się poprawnie:...</p></div><footer class=entry-footer><span title='2013-04-01 00:00:00 +0000 UTC'>2013-04-01</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Tworzenie patch’y z poleceniami diff i patch" href=https://gagor.pl/2013/04/tworzenie-patchy-z-poleceniami-diff-i-patch/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Rozsynchronizowane serwery NTP</h2></header><div class=entry-content><p>Miałem ostatnio zabawną sytuację gdy kilka serwerów z zainstalowanym NTPD miało rozjazdy rzędu kilkunastu sekund. Wyszło na to że moje serwery synchronizowały się z różnymi zewnętrznymi serwerami NTP pomiędzy, którymi były rozjazdy i te rozjazdy synchronizowały się na moich serwerach. Jeden “z moich” ustanowiłem głównym a wszystkie inne przekierowałem na niego (komentując wszystkie inne serwery NTP w konfiguracji). Wymusiłem synchronizację:
ntp -q Sprawdziłem jak duży jest offset i jitter (powinny być bardzo małe):...</p></div><footer class=entry-footer><span title='2013-03-31 00:00:00 +0000 UTC'>2013-03-31</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Rozsynchronizowane serwery NTP" href=https://gagor.pl/2013/03/rozsynchronizowane-serwery-ntp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Fortigate - VPN IPSec PSK XAuth z Android’a 4.x</h2></header><div class=entry-content><p>Do niedawna na moim telefonie VPN’ami były: PPTP lub L2TP - oba niespecjalnie mi się podobały. Ale od wersji 4-tej pojawiły się dwa nowe tryby: IPSec Xauth PSK i IPSec Xauth RSA. W pierwszym autoryzacja wykorzystuje login i hasło, w drugim certyfikaty.
Tryb IPSec Xauth PSK jest bardzo wygodny bo łatwo można połączyć go z zewnętrznymi mechanizmami uwierzytelniającymi np. LDAP, Active Directory, itp.
Pokażę jak skonfigurować swojego Fortigate’a by umożliwić połączenie z telefonów i tabletów na Androidzie 4....</p></div><footer class=entry-footer><span title='2013-03-30 00:00:00 +0000 UTC'>2013-03-30</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Fortigate - VPN IPSec PSK XAuth z Android’a 4.x" href=https://gagor.pl/2013/03/fortigate-vpn-ipsec-psk-xauth-z-androida-4-x/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Nginx - hide server version and name in Server header and error pages</h2></header><div class=entry-content><p>On Debian you have to install nginx-extras package (because it have built in headers_more module). Then you need two options (best in global configuration /etc/nginx/nginx.conf file, http part):
server_tokens off; more_set_headers 'Server: BadAss'; And it’s good to setup non standard error pages on every site (500 and 404 at minimum):
error_page 403 404 http://mysite.com/areyoulost; error_page 502 503 504 /500.html;</p></div><footer class=entry-footer><span title='2013-01-24 00:00:00 +0000 UTC'>2013-01-24</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Nginx - hide server version and name in Server header and error pages" href=https://gagor.pl/2013/01/nginx-hide-server-version-and-name-in-server-header-and-error-pages/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>PHP - max_input_vars</h2></header><div class=entry-content><p>W PHP 5.3 pojawiła się nowa zmienna: max_input_vars, która limituje ilość pól możliwych do przesłania przez formularz, obcinając nadmiarowe. Pozwala to zapobiec atakom DoS na tablice hashujące (przynajmniej w tym jednym miejscu). Domyślna wartość tej zmiennej to 1000 i kreatywnym programistom udaje się tą wartość bez problemu osiągnąć 😃
Warte odnotowania jest to że mając suhosin’a trzeba pamiętać o jeszcze dwóch innych zmiennych:
max_input_vars = 3000 suhosin.post.max_vars = 3000 suhosin.request.max_vars = 3000 Zmienne można zmienić od razu w /etc/php5/apache2/php....</p></div><footer class=entry-footer><span title='2013-01-22 00:00:00 +0000 UTC'>2013-01-22</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to PHP - max_input_vars" href=https://gagor.pl/2013/01/php-max_input_vars/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Linux - naprawianie bad sectorów</h2></header><div class=entry-content><p>Dyski się zużywają i w końcu wcześniej czy później pojawiają się na nich bad sectory. Jeden z moich dysków ciut się posypał a że służy wyłącznie do backupów to mogę z tym żyć. Ale z drugiej strony jeżeli już będę musiał sięgnąć do backupów to chcę mieć pewność że coś odzyskam, dlatego postanowiłem zrobić kilka testów. Nawet jeśli nie naprawi to sektorów to przynajmniej zostaną zaznaczone jako uszkodzone i realokowane....</p></div><footer class=entry-footer><span title='2012-12-27 00:00:00 +0000 UTC'>2012-12-27</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;timor</footer><a class=entry-link aria-label="post link to Linux - naprawianie bad sectorów" href=https://gagor.pl/2012/12/linux-naprawianie-bad-sectorow/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://gagor.pl/authors/timor/page/19/>«&nbsp;Prev&nbsp;</a>
<a class=next href=https://gagor.pl/authors/timor/page/21/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span><a href=https://gagor.pl>timor's site</a> &copy; 2008-2024</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>