<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How I stopped worrying and loved Makefiles | Tom's Blog</title>
<meta name=keywords content="Linux,MacOS,bash,DevOps"><meta name=description content="First contact with make When I was invited for my first job interview in the IT, I‚Äôve been asked such question:
How would you typically build a program from so"><meta name=author content="timor"><link rel=canonical href=https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/><link crossorigin=anonymous href=/assets/css/stylesheet.a686254d65e0d2d3c8431ef3cb68c992b4ccdcc8a7d89e60d7a491a5b2cbabbe.css integrity="sha256-poYlTWXg0tPIQx7zy2jJkrTM3Min2J5g16SRpbLLq74=" rel="preload stylesheet" as=style><link rel=icon href=https://gagor.pro/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pro/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pro/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pro/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pro/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="How I stopped worrying and loved Makefiles"><meta property="og:description" content="First contact with make When I was invited for my first job interview in the IT, I&rsquo;ve been asked such question:
How would you typically build a program from sources, what commands will you use?
I answered:
It&rsquo;s obvious:
./configure make make install Those times belong to the past now and nowadays not many programmers use GNU Make1. Try asking this question and you will see disgust at best.
For many it&rsquo;s the fist contact with make and often the last one, but not for me &#x1f609;"><meta property="og:type" content="article"><meta property="og:url" content="https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/"><meta property="og:image" content="https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-16T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-27T21:10:13+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover.webp"><meta name=twitter:title content="How I stopped worrying and loved Makefiles"><meta name=twitter:description content="First contact with make When I was invited for my first job interview in the IT, I&rsquo;ve been asked such question:
How would you typically build a program from sources, what commands will you use?
I answered:
It&rsquo;s obvious:
./configure make make install Those times belong to the past now and nowadays not many programmers use GNU Make1. Try asking this question and you will see disgust at best.
For many it&rsquo;s the fist contact with make and often the last one, but not for me &#x1f609;"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gagor.pro/posts/"},{"@type":"ListItem","position":2,"name":"How I stopped worrying and loved Makefiles","item":"https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How I stopped worrying and loved Makefiles","name":"How I stopped worrying and loved Makefiles","description":"First contact with make When I was invited for my first job interview in the IT, I\u0026rsquo;ve been asked such question:\nHow would you typically build a program from sources, what commands will you use?\nI answered:\nIt\u0026rsquo;s obvious:\n./configure make make install Those times belong to the past now and nowadays not many programmers use GNU Make1. Try asking this question and you will see disgust at best.\nFor many it\u0026rsquo;s the fist contact with make and often the last one, but not for me \u0026#x1f609;","keywords":["Linux","MacOS","bash","DevOps"],"articleBody":"First contact with make When I was invited for my first job interview in the IT, I‚Äôve been asked such question:\nHow would you typically build a program from sources, what commands will you use?\nI answered:\nIt‚Äôs obvious:\n./configure make make install Those times belong to the past now and nowadays not many programmers use GNU Make1. Try asking this question and you will see disgust at best.\nFor many it‚Äôs the fist contact with make and often the last one, but not for me üòâ\nWhat make does? Let build a base line. make orchestrates tasks based on dependencies, executing commands to generate target files and keep them up to date efficiently. It streamlines software compilation and project management.\nAs simple as it is, it does few things pretty well:\ndetects changes in files (source -\u003e binary), manages dependencies, manages default values for variables much easier than Bash, allows to build in parallel, OS detection, on my system binary is only 16kB in size, is available on any OS, and much more! My second contact with make - Postfix The second non obvious use of make I stood, was the way to refresh Postfix‚Äôs map files. With Postfix servers, you‚Äôve been usually writing a bunch of text files like aliases, transports, etc, which have to be indexed to the binary Berkley DB format.\n/etc/postfix/main.cf alias_maps = hash:/etc/postfix/aliases To ‚Äúgenerate‚Äù Berkley DB file you have to run:\nGenerate aliases database postalias aliases Which was producing aliases.db file. Other types of files required to use postmap command to generate them.\nThe more complicated the Postfix configuration, the more files you had. If you missed to update one of map files, your configuration wasn‚Äôt effective and you could spend hours debugging: why this f‚Ä¶ alias do not work?\nThat‚Äôs where make comes handy 2. You can just drop the file like this:\ncat Makefile .PHONY: reload all: aliases.db access.db virtual.db reload aliases.db: aliases postalias aliases access.db: access postmap access virtual.db: virtual postmap virtual reload: postfix reload Let me explain what happens here.\n.PHONY: reload: This line declares the target reload as a phony target 3. Phony targets are ones that do not represent actual files. This is typically used for targets that don‚Äôt produce output files, such as clean, all, etc. It ensures that even if a file named reload exists in the directory, the reload target will still be executed.\nall: aliases.db access.db virtual.db reload: This line specifies that when you run make all, it will generate the files aliases.db, access.db, and virtual.db, and then execute the reload target. As all target is the default, it‚Äôs enough to just run make.\naliases.db: aliases: This line specifies that aliases.db depends on the file aliases. If aliases file is newer than aliases.db or aliases.db doesn‚Äôt exist, the commands listed below will be executed.\npostalias aliases: This line is the command to generate the aliases.db file from the aliases file using the postalias command. postalias is a command used in Postfix to create or update the alias database.\nSimilarly, access.db: access and virtual.db: virtual are rules to generate access.db and virtual.db files from access and virtual files respectively using the postmap command.\nreload:: This line declares the reload target. When you run make reload, it will execute the command listed below.\npostfix reload: This line is the command to reload the Postfix service. It tells Postfix to reload its configuration, applying any changes that may have been made.\nSumming up, when you run make, it will generate or update the necessary database files for Postfix configuration (aliases.db, access.db, virtual.db) and then reload the Postfix service.\nNow you won‚Äôt make mistakes again.\nI know that today many of you would say: ‚Äújust use Ansible dude!‚Äù But at that time, there was no Ansible yet. I didn‚Äôt use this pattern for years now, so let check more up to date usage examples.\nUse of make in Python projects I love Python for it‚Äôs simplicity‚Ä¶ at least when it comes to coding, because when you start managing dependencies, it‚Äôs getting tricky. What do you use: raw dependencies.txt or rather Poetry‚Äâexternal link or Pipenv‚Äâexternal link ? Do you use system Python or maybe pyenv‚Äâexternal link ?\nMy answer: it depends üòÉ\nFor simple projects, I usually just use pip. Sometimes even without requirements.txt files, just listing in the README what to install. But the more projects I wrote, the harder it is to remember how to test them. Again, that‚Äôs where Make comes handy.\nSimple Makefile for Python projects .PHONY: requirements test .venv: python3 -m venv .venv requirements: source .venv/bin/activate \u0026\u0026 \\ python3 -m pip install -r requirements.txt \u0026\u0026 \\ python3 -m pip install pytest test: .venv requirements dev-requirements source .venv/bin/activate \u0026\u0026 \\ pytest What happens here?\n.PHONY: requirements test: Declares requirements and test as phony targets to ensure they are always executed regardless of file existence.\n.venv:: Creates a Python virtual environment named .venv if it doesn‚Äôt already exist.\nrequirements:: Installs Python packages listed in requirements.txt into the virtual environment created earlier. Additionally, it installs the pytest package globally.\ntest: .venv requirements dev-requirements: Sets up dependencies for testing, including the virtual environment and specified requirements. Then, it activates the virtual environment and runs the tests using pytest.\nAlternative config for Poetry, might look more or less like that: Simple Makefile for Python projects .PHONY: requirements test requirements: poetry install test: requirements poetry run pytest When I see Makefile in a Python project, I can blindly run make test and it will do what I expect -\u003e run tests. Whatever it requires to configure or run, it will just happen.\nmake in Terraform projects Similar situation to Python, I have with Terraform‚Äâexternal link projects. In simple project you just need:\nTypical Terraform flow terraform init terraform plan terraform apply But what if you use different accounts for PROD and DEV environments? What if you need to fetch latest version of modules?\nI have a Makefile for this too.\nTerraform Makefile .PHONY: init SHELL=/bin/bash # those variables you should initialize outside of this script # and export, Make will just set then based on what you will # have set in your environment. You can use for eg. `aws sts` AWS_ACCESS_KEY_ID ?= AWS_SECRET_ACCESS_KEY ?= AWS_REGION ?= \"us-west-2\" # dev by default ENVIRONMENT ?= dev STATE_FILE_BUCKET ?= s3-bucket-$(AWS_ACCESS_KEY_ID)-$(ENVIRONMENT)-terraform-state STATE_FILE_KEY ?= state/some_service/$(ENVIRONMENT)/terraform.tfstate # make some variable available in Terraform export TF_VAR_something ?= something1 export TF_VAR_something_else ?= something-else .terraform: terraform init \\ -reconfigure \\ -backend-config='key=$(STATE_FILE_KEY)' \\ -backend-config='bucket=$(STATE_FILE_BUCKET)' \\ -var-file=environments/$(ENVIRONMENT)/variables.tfvars \\ -out terraform.plan terraform get # this will switch Terraform version to the one that your project needs # https://github.com/tfutils/tfenv init: .terraform tfenv install plan: init terraform plan apply: plan terraform apply \\ -auto-approve \\ terraform.plan destroy: terraform destroy \\ -auto-approve \\ -var-file=environments/$(ENVIRONMENT)/variables.tfvars dev-plan: export AWS_ACCESS_KEY_ID=dev-key dev-plan: plan dev-apply: export AWS_ACCESS_KEY_ID=dev-key dev-apply: apply dev-destroy: export AWS_ACCESS_KEY_ID=dev-key dev-destroy: destroy prod-plan: export AWS_ACCESS_KEY_ID=prod-key prod-plan: plan prod-apply: export AWS_ACCESS_KEY_ID=prod-key prod-apply: apply clean: @rm -rf .terraform/modules @rm -f terraform.* This file expects a directory structure like\nDirectory structure $ tree example/ . ‚îú‚îÄ‚îÄ main.tf ‚îú‚îÄ‚îÄ variables.tf ‚îú‚îÄ‚îÄ provider.tf ‚îú‚îÄ‚îÄ backend.tf ‚îú‚îÄ‚îÄ outputs.tf ‚îú‚îÄ‚îÄ ... ‚îú‚îÄ‚îÄ environments/ ‚îÇ ‚îú‚îÄ‚îÄ dev ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ variables.tfars ‚îÇ ‚îú‚îÄ‚îÄ prod/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ variables.tfars ‚îÇ ‚îú‚îÄ‚îÄ .../ Backends configuration in the backend.tf file can be just basic:\nbackend.tf terraform { backend \"s3\" { region = \"us-west-2\" encrypt = true } } Rest of parameters are provided in the Makefile - it‚Äôs called partial backend configuration4. This configuration allows me to use same codebase for all the environments. All customizations have to be listed as variables in variables.tfvars files. It can be easily extended to suport 4 or 6 environments and the only think I need to remember is:\nmake dev-plan make dev-apply make for Hugo blogging Even for blogging with Hugo I have a Makefile5 that I use across multiple sites. It‚Äôs simplifying some of the steps, that I won‚Äôt need to remember them.\nMakefile for Hugo BASEDIR=$(CURDIR) INPUTDIR=$(BASEDIR)/content STATICDIR=$(BASEDIR)/static OUTPUTDIR=$(BASEDIR)/public RESOURCESDIR=$(BASEDIR)/resources PORT=1313 FTP_HOST=localhost FTP_USER=anonymous FTP_TARGET_DIR=/ SSH_HOST=vc1 SSH_PORT=22 SSH_USER=root SSH_TARGET_DIR=/var/www/hugo SSH_CHOWN=33:33 S3_BUCKET=my_s3_bucket CLOUDFILES_USERNAME=my_rackspace_username CLOUDFILES_API_KEY=my_rackspace_api_key CLOUDFILES_CONTAINER=my_cloudfiles_container DROPBOX_DIR=~/Dropbox/Public/ GITHUB_PAGES_BRANCH=gh-pages all: html publish: html gzip_static rsync_upload help: @echo 'Makefile for a hugo Web site ' @echo ' ' @echo 'Usage: ' @echo ' make html (re)generate the web site ' @echo ' make clean remove the generated files ' @echo ' make publish generate using production settings ' @echo ' make server [PORT=1313] serve site at http://localhost:1313' @echo ' make ssh_upload upload the web site via SSH ' @echo ' make rsync_upload upload the web site via rsync+ssh ' @echo ' make dropbox_upload upload the web site via Dropbox ' @echo ' make ftp_upload upload the web site via FTP ' @echo ' make s3_upload upload the web site via S3 ' @echo ' make cf_upload upload the web site via Cloud Files' @echo ' make github upload the web site via gh-pages ' @echo ' ' html: clean hugo --minify clean: [ ! -d $(OUTPUTDIR) ] || rm -rf $(OUTPUTDIR) \u0026\u0026 mkdir -p $(OUTPUTDIR) \u0026\u0026 touch $(OUTPUTDIR)/.placeholder rm -rf $(RESOURCESDIR) server: ifdef PORT hugo server -D -p $(PORT) --disableFastRender --buildExpired --buildFuture else hugo server -D --disableFastRender --buildExpired --buildFuture endif generate: clean cd $(BASEDIR); hugo check_urls: @cd /tmp; wget -r --spider http://localhost:$(PORT) 2\u003e\u00261 | grep -B 2 \"404 Not Found\" | grep http:// | cut -d \" \" -f 4 | sort -u markdownlint: @docker run --rm -ti -v ${PWD}:/data:ro markdownlint/markdownlint content gzip_static: for pattern in \"*.js\" \"*.json\" \"*.css\" \"*.htm\" \"*.html\" \"*.xml\"; do \\ find $(OUTPUTDIR) -iname $$pattern -print0 | xargs -0 -I'{}' sh -c 'gzip -c9 \"{}\" \u003e \"{}.gz\" \u0026\u0026 touch -r \"{}\" \"{}.gz\"'; \\ done optimize_images: find $(STATICDIR) -mtime -7 -iname *.png -print | parallel optipng -quiet -preserve -o7 find $(INPUTDIR) -mtime -7 -iname *.png -print | parallel optipng -quiet -preserve -o7 find $(STATICDIR) -mtime -7 -iname *.jpg -print | parallel jpegtran -optimize -progressive -copy none -outfile \"{}\" \"{}\" find $(INPUTDIR) -mtime -7 -iname *.jpg -print | parallel jpegtran -optimize -progressive -copy none -outfile \"{}\" \"{}\" ssh_upload: generate scp -P $(SSH_PORT) -r $(OUTPUTDIR)/* $(SSH_USER)@$(SSH_HOST):$(SSH_TARGET_DIR) rsync_upload: generate gzip_static ifdef SSH_CHOWN rsync -e \"ssh -p $(SSH_PORT)\" -P -avh --delete $(OUTPUTDIR)/ $(SSH_USER)@$(SSH_HOST):$(SSH_TARGET_DIR) --chown $(SSH_CHOWN) else rsync -e \"ssh -p $(SSH_PORT)\" -P -avh --delete $(OUTPUTDIR)/ $(SSH_USER)@$(SSH_HOST):$(SSH_TARGET_DIR) endif dropbox_upload: generate cp -r $(OUTPUTDIR)/* $(DROPBOX_DIR) ftp_upload: generate lftp ftp://$(FTP_USER)@$(FTP_HOST) -e \"mirror -R $(OUTPUTDIR) $(FTP_TARGET_DIR) ; quit\" s3_upload: generate s3cmd sync $(OUTPUTDIR)/ s3://$(S3_BUCKET) --acl-public --delete-removed --guess-mime-type cf_upload: generate cd $(OUTPUTDIR) \u0026\u0026 swift -v -A https://auth.api.rackspacecloud.com/v1.0 -U $(CLOUDFILES_USERNAME) -K $(CLOUDFILES_API_KEY) upload -c $(CLOUDFILES_CONTAINER) . github: generate # ghp-import -m \"Generate Hugo site\" -b $(GITHUB_PAGES_BRANCH) $(OUTPUTDIR) # git push origin $(GITHUB_PAGES_BRANCH) cd $(OUTPUTDIR) git add --all git commit -m \"Update\" git push .PHONY: all html help clean generate server ssh_upload rsync_upload dropbox_upload ftp_upload s3_upload cf_upload github This Makefile is actually an extension‚Äâexternal link of one dedicated Pelican‚Äâexternal link static page generator\nSummary There are many creative ways to use Makefiles to automate and simplify daily tasks. Tool is small and simple, available on any platform (even on Windows via WSL or Cygwin‚Äâexternal link ). Many of my colleagues considered this tool an ‚Äúold school‚Äù or ‚Äúobsolete‚Äù initially, but they eventually fall under impression of the recipes simplicity and now just replicate them all around.\nI hope, I will also impress you üòâ Good luck and happy automating!\nEnjoyed? https://www.gnu.org/software/make/‚Äâexternal link ‚Ü©Ô∏é\nhttps://www.postfix.org/DATABASE_README.html‚Äâexternal link ‚Ü©Ô∏é\nhttps://www.gnu.org/software/make/manual/html_node/Phony-Targets.html‚Äâexternal link ‚Ü©Ô∏é\nhttps://developer.hashicorp.com/terraform/language/settings/backends/configuration#partial-configuration‚Äâexternal link ‚Ü©Ô∏é\nhttps://github.com/getpelican/pelican-blog/blob/main/Makefile‚Äâexternal link ‚Ü©Ô∏é\n","wordCount":"1895","inLanguage":"en","image":"https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover.webp","datePublished":"2024-02-16T00:00:00Z","dateModified":"2024-04-27T21:10:13+02:00","author":{"@type":"Person","name":"timor"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://gagor.pro/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pro/ accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pro/favicon-36x36.png alt aria-label=logo height=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pro/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pro/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pro/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pro/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pro/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gagor.pro/>Home</a>&nbsp;¬ª&nbsp;<a href=https://gagor.pro/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How I stopped worrying and loved Makefiles</h1><div class=post-meta><span title='2024-02-16 00:00:00 +0000 UTC'>2024-02-16</span>&nbsp;¬∑&nbsp;9 min&nbsp;¬∑&nbsp;timor</div></header><figure class=entry-cover><img loading=eager srcset="https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover_hu7b2848c47bcc664aceb787e86b701311_184880_360x0_resize_q75_h2_box_2.webp 360w ,https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover_hu7b2848c47bcc664aceb787e86b701311_184880_480x0_resize_q75_h2_box_2.webp 480w ,https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover_hu7b2848c47bcc664aceb787e86b701311_184880_720x0_resize_q75_h2_box_2.webp 720w ,https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover_hu7b2848c47bcc664aceb787e86b701311_184880_1080x0_resize_q75_h2_box_2.webp 1080w ,https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover_hu7b2848c47bcc664aceb787e86b701311_184880_1500x0_resize_q75_h2_box_2.webp 1500w ,https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover.webp 1500w" sizes="(min-width: 768px) 720px, 100vw" src=https://gagor.pro/2024/02/how-i-stopped-worrying-and-loved-makefiles/images/cover.webp alt="[Photo by Antony Trivet](https://www.pexels.com/photo/herd-of-blue-wildebeest-walking-in-savanna-6053000/)" width=1500 height=613><p><a href=https://www.pexels.com/photo/herd-of-blue-wildebeest-walking-in-savanna-6053000/ target=_blank>Photo by Antony Trivet<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span></a></p></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#first-contact-with-make aria-label="First contact with make">First contact with make</a></li><li><a href=#what-make-does aria-label="What make does?">What make does?</a></li><li><a href=#my-second-contact-with-make---postfix aria-label="My second contact with make - Postfix">My second contact with make - Postfix</a></li><li><a href=#use-of-make-in-python-projects aria-label="Use of make in Python projects">Use of make in Python projects</a></li><li><a href=#make-in-terraform-projects aria-label="make in Terraform projects">make in Terraform projects</a></li><li><a href=#make-for-hugo-blogging aria-label="make for Hugo blogging">make for Hugo blogging</a></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><h2 id=first-contact-with-make>First contact with make<a hidden class=anchor aria-hidden=true href=#first-contact-with-make>#</a></h2><p>When I was invited for my first job interview in the IT, I&rsquo;ve been asked such question:</p><blockquote><p>How would you typically build a program from sources, what commands will you use?</p></blockquote><p>I answered:</p><blockquote><p>It&rsquo;s obvious:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>./configure
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>make install
</span></span></code></pre></div></blockquote><p>Those times belong to the past now and nowadays not many programmers use GNU Make<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Try asking this question and you will see disgust at best.</p><p>For many it&rsquo;s the fist contact with <code>make</code> and often the last one, but not for me &#x1f609;</p><h2 id=what-make-does>What <code>make</code> does?<a hidden class=anchor aria-hidden=true href=#what-make-does>#</a></h2><p>Let build a base line. <code>make</code> orchestrates tasks based on dependencies, executing commands to generate target files and keep them up to date efficiently. It streamlines software compilation and project management.</p><p>As simple as it is, it does few things pretty well:</p><ul><li>detects changes in files (source -> binary),</li><li>manages dependencies,</li><li>manages default values for variables much easier than Bash,</li><li>allows to build in parallel,</li><li>OS detection,</li><li>on my system binary is only 16kB in size,</li><li>is available on any OS,</li><li>and much more!</li></ul><h2 id=my-second-contact-with-make---postfix>My second contact with make - Postfix<a hidden class=anchor aria-hidden=true href=#my-second-contact-with-make---postfix>#</a></h2><p>The second non obvious use of <code>make</code> I stood, was the way to refresh Postfix&rsquo;s map files. With Postfix servers, you&rsquo;ve been usually writing a bunch of text files like <code>aliases</code>, <code>transports</code>, etc, which have to be indexed to the binary Berkley DB format.</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>/etc/postfix/main.cf</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>alias_maps = hash:/etc/postfix/aliases
</span></span></code></pre></div></div></div><br><p>To &ldquo;generate&rdquo; Berkley DB file you have to run:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Generate aliases database</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postalias aliases
</span></span></code></pre></div></div></div><br><p>Which was producing <code>aliases.db</code> file. Other types of files required to use <code>postmap</code> command to generate them.</p><p>The more complicated the Postfix configuration, the more files you had. If you missed to update one of map files, your configuration wasn&rsquo;t effective and you could spend hours debugging: why this f&mldr; alias do not work?</p><p>That&rsquo;s where <code>make</code> comes handy <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. You can just drop the file like this:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>cat Makefile</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=display:flex><span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>:</span> reload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>all</span><span style=color:#f92672>:</span> aliases.db access.db virtual.db reload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>aliases.db</span><span style=color:#f92672>:</span> aliases
</span></span><span style=display:flex><span>    postalias aliases
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>access.db</span><span style=color:#f92672>:</span> access
</span></span><span style=display:flex><span>    postmap access
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>virtual.db</span><span style=color:#f92672>:</span> virtual
</span></span><span style=display:flex><span>    postmap virtual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>reload</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    postfix reload
</span></span></code></pre></div></div></div><br><p>Let me explain what happens here.</p><ol><li><p><code>.PHONY: reload</code>: This line declares the target <code>reload</code> as a phony target <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. Phony targets are ones that do not represent actual files. This is typically used for targets that don&rsquo;t produce output files, such as clean, all, etc. It ensures that even if a file named <code>reload</code> exists in the directory, the <code>reload</code> target will still be executed.</p></li><li><p><code>all: aliases.db access.db virtual.db reload</code>: This line specifies that when you run <code>make all</code>, it will generate the files <code>aliases.db</code>, <code>access.db</code>, and <code>virtual.db</code>, and then execute the <code>reload</code> target. As <code>all</code> target is the default, it&rsquo;s enough to just run <code>make</code>.</p></li><li><p><code>aliases.db: aliases</code>: This line specifies that <code>aliases.db</code> depends on the file <code>aliases</code>. If <code>aliases</code> file is newer than <code>aliases.db</code> or <code>aliases.db</code> doesn&rsquo;t exist, the commands listed below will be executed.</p></li><li><p><code>postalias aliases</code>: This line is the command to generate the <code>aliases.db</code> file from the <code>aliases</code> file using the <code>postalias</code> command. <code>postalias</code> is a command used in Postfix to create or update the alias database.</p></li><li><p>Similarly, <code>access.db: access</code> and <code>virtual.db: virtual</code> are rules to generate <code>access.db</code> and <code>virtual.db</code> files from <code>access</code> and <code>virtual</code> files respectively using the <code>postmap</code> command.</p></li><li><p><code>reload:</code>: This line declares the <code>reload</code> target. When you run <code>make reload</code>, it will execute the command listed below.</p></li><li><p><code>postfix reload</code>: This line is the command to reload the Postfix service. It tells Postfix to reload its configuration, applying any changes that may have been made.</p></li></ol><p>Summing up, when you run <code>make</code>, it will generate or update the necessary database files for Postfix configuration (<code>aliases.db</code>, <code>access.db</code>, <code>virtual.db</code>) and then reload the Postfix service.</p><p>Now you won&rsquo;t make mistakes again.</p><p>I know that today many of you would say: &ldquo;just use Ansible dude!&rdquo; But at that time, there was no Ansible yet. I didn&rsquo;t use this pattern for years now, so let check more up to date usage examples.</p><h2 id=use-of-make-in-python-projects>Use of <code>make</code> in Python projects<a hidden class=anchor aria-hidden=true href=#use-of-make-in-python-projects>#</a></h2><p>I love Python for it&rsquo;s simplicity&mldr; at least when it comes to coding, because when you start managing dependencies, it&rsquo;s getting tricky. What do you use: raw <code>dependencies.txt</code> or rather <a href=https://python-poetry.org/ target=_blank>Poetry<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>or <a href=https://pipenv.pypa.io/en/latest/ target=_blank>Pipenv<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>? Do you use system Python or maybe <a href=https://github.com/pyenv/pyenv target=_blank><code>pyenv</code><span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>?</p><p>My answer: it depends &#x1f603;</p><p>For simple projects, I usually just use <code>pip</code>. Sometimes even without <code>requirements.txt</code> files, just listing in the README what to install. But the more projects I wrote, the harder it is to remember how to test them. Again, that&rsquo;s where Make comes handy.</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Simple Makefile for Python projects</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=display:flex><span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>:</span> requirements test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>.venv</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    python3 -m venv .venv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>requirements</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    source .venv/bin/activate <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        python3 -m pip install -r requirements.txt <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        python3 -m pip install pytest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> .venv requirements dev-requirements
</span></span><span style=display:flex><span>    source .venv/bin/activate <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        pytest
</span></span></code></pre></div></div></div><br><p>What happens here?</p><ol><li><p><code>.PHONY: requirements test</code>: Declares <code>requirements</code> and <code>test</code> as phony targets to ensure they are always executed regardless of file existence.</p></li><li><p><code>.venv:</code>: Creates a Python virtual environment named <code>.venv</code> if it doesn&rsquo;t already exist.</p></li><li><p><code>requirements:</code>: Installs Python packages listed in <code>requirements.txt</code> into the virtual environment created earlier. Additionally, it installs the <code>pytest</code> package globally.</p></li><li><p><code>test: .venv requirements dev-requirements</code>: Sets up dependencies for testing, including the virtual environment and specified requirements. Then, it activates the virtual environment and runs the tests using <code>pytest</code>.</p></li></ol><p>Alternative config for Poetry, might look more or less like that:<div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Simple Makefile for Python projects</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=display:flex><span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>:</span> requirements test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>requirements</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    poetry install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> requirements
</span></span><span style=display:flex><span>    poetry run pytest
</span></span></code></pre></div></div></div><br></p><p>When I see <code>Makefile</code> in a Python project, I can blindly run <code>make test</code> and it will do what I expect -> run tests. Whatever it requires to configure or run, it will just happen.</p><h2 id=make-in-terraform-projects><code>make</code> in Terraform projects<a hidden class=anchor aria-hidden=true href=#make-in-terraform-projects>#</a></h2><p>Similar situation to Python, I have with <a href=https://www.terraform.io/ target=_blank>Terraform<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>projects. In simple project you just need:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Typical Terraform flow</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform init
</span></span><span style=display:flex><span>terraform plan
</span></span><span style=display:flex><span>terraform apply
</span></span></code></pre></div></div></div><br><p>But what if you use different accounts for PROD and DEV environments? What if you need to fetch latest version of modules?</p><p>I have a <code>Makefile</code> for this too.</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Terraform Makefile</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=display:flex><span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>:</span> init
</span></span><span style=display:flex><span>SHELL<span style=color:#f92672>=</span>/bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># those variables you should initialize outside of this script
</span></span></span><span style=display:flex><span><span style=color:#75715e># and export, Make will just set then based on what you will
</span></span></span><span style=display:flex><span><span style=color:#75715e># have set in your environment. You can use for eg. `aws sts`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>AWS_ACCESS_KEY_ID <span style=color:#f92672>?=</span>
</span></span><span style=display:flex><span>AWS_SECRET_ACCESS_KEY <span style=color:#f92672>?=</span>
</span></span><span style=display:flex><span>AWS_REGION <span style=color:#f92672>?=</span> <span style=color:#e6db74>&#34;us-west-2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># dev by default
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>ENVIRONMENT <span style=color:#f92672>?=</span> dev
</span></span><span style=display:flex><span>STATE_FILE_BUCKET <span style=color:#f92672>?=</span> s3-bucket-<span style=color:#66d9ef>$(</span>AWS_ACCESS_KEY_ID<span style=color:#66d9ef>)</span>-<span style=color:#66d9ef>$(</span>ENVIRONMENT<span style=color:#66d9ef>)</span>-terraform-state
</span></span><span style=display:flex><span>STATE_FILE_KEY <span style=color:#f92672>?=</span> state/some_service/<span style=color:#66d9ef>$(</span>ENVIRONMENT<span style=color:#66d9ef>)</span>/terraform.tfstate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># make some variable available in Terraform
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export </span>TF_VAR_something <span style=color:#f92672>?=</span> something1
</span></span><span style=display:flex><span><span style=color:#66d9ef>export </span>TF_VAR_something_else <span style=color:#f92672>?=</span> something-else
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>.terraform</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    terraform init <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-reconfigure <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-backend-config<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;key=$(STATE_FILE_KEY)&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-backend-config<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;bucket=$(STATE_FILE_BUCKET)&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-var-file<span style=color:#f92672>=</span>environments/<span style=color:#66d9ef>$(</span>ENVIRONMENT<span style=color:#66d9ef>)</span>/variables.tfvars <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-out terraform.plan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	terraform get
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># this will switch Terraform version to the one that your project needs
</span></span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/tfutils/tfenv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>init</span><span style=color:#f92672>:</span> .terraform
</span></span><span style=display:flex><span>	tfenv install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>plan</span><span style=color:#f92672>:</span> init
</span></span><span style=display:flex><span>    terraform plan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>apply</span><span style=color:#f92672>:</span> plan
</span></span><span style=display:flex><span>    terraform apply <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-auto-approve <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		terraform.plan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>destroy</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    terraform destroy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-auto-approve <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		-var-file<span style=color:#f92672>=</span>environments/<span style=color:#66d9ef>$(</span>ENVIRONMENT<span style=color:#66d9ef>)</span>/variables.tfvars
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dev-plan</span><span style=color:#f92672>:</span> export AWS_ACCESS_KEY_ID=dev-key
</span></span><span style=display:flex><span><span style=color:#a6e22e>dev-plan</span><span style=color:#f92672>:</span> plan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dev-apply</span><span style=color:#f92672>:</span> export AWS_ACCESS_KEY_ID=dev-key
</span></span><span style=display:flex><span><span style=color:#a6e22e>dev-apply</span><span style=color:#f92672>:</span> apply
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dev-destroy</span><span style=color:#f92672>:</span> export AWS_ACCESS_KEY_ID=dev-key
</span></span><span style=display:flex><span><span style=color:#a6e22e>dev-destroy</span><span style=color:#f92672>:</span> destroy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>prod-plan</span><span style=color:#f92672>:</span> export AWS_ACCESS_KEY_ID=prod-key
</span></span><span style=display:flex><span><span style=color:#a6e22e>prod-plan</span><span style=color:#f92672>:</span> plan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>prod-apply</span><span style=color:#f92672>:</span> export AWS_ACCESS_KEY_ID=prod-key
</span></span><span style=display:flex><span><span style=color:#a6e22e>prod-apply</span><span style=color:#f92672>:</span> apply
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>clean</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    @rm -rf .terraform/modules
</span></span><span style=display:flex><span>    @rm -f terraform.*
</span></span></code></pre></div></div></div><br><p>This file expects a directory structure like</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Directory structure</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ tree example/
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ main.tf
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ variables.tf
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ provider.tf
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ backend.tf
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ outputs.tf
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ ...
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ environments/
</span></span><span style=display:flex><span>‚îÇ   ‚îú‚îÄ‚îÄ dev
</span></span><span style=display:flex><span>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tfars
</span></span><span style=display:flex><span>‚îÇ   ‚îú‚îÄ‚îÄ prod/
</span></span><span style=display:flex><span>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tfars
</span></span><span style=display:flex><span>‚îÇ   ‚îú‚îÄ‚îÄ .../
</span></span></code></pre></div></div></div><br><p>Backends configuration in the <code>backend.tf</code> file can be just basic:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>backend.tf</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#a6e22e>terraform</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>backend</span> <span style=color:#e6db74>&#34;s3&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>region</span> = <span style=color:#e6db74>&#34;us-west-2&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>encrypt</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><br><p>Rest of parameters are provided in the Makefile - it&rsquo;s called partial backend configuration<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. This configuration allows me to use same codebase for all the environments. All customizations have to be listed as variables in <code>variables.tfvars</code> files. It can be easily extended to suport 4 or 6 environments and the only think I need to remember is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make dev-plan
</span></span><span style=display:flex><span>make dev-apply
</span></span></code></pre></div><h2 id=make-for-hugo-blogging><code>make</code> for Hugo blogging<a hidden class=anchor aria-hidden=true href=#make-for-hugo-blogging>#</a></h2><p>Even for blogging with Hugo I have a <code>Makefile</code><sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> that I use across multiple sites. It&rsquo;s simplifying some of the steps, that I won&rsquo;t need to remember them.</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Makefile for Hugo</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=display:flex><span>BASEDIR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>CURDIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>INPUTDIR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>BASEDIR<span style=color:#66d9ef>)</span>/content
</span></span><span style=display:flex><span>STATICDIR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>BASEDIR<span style=color:#66d9ef>)</span>/static
</span></span><span style=display:flex><span>OUTPUTDIR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>BASEDIR<span style=color:#66d9ef>)</span>/public
</span></span><span style=display:flex><span>RESOURCESDIR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>BASEDIR<span style=color:#66d9ef>)</span>/resources
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>1313</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FTP_HOST<span style=color:#f92672>=</span>localhost
</span></span><span style=display:flex><span>FTP_USER<span style=color:#f92672>=</span>anonymous
</span></span><span style=display:flex><span>FTP_TARGET_DIR<span style=color:#f92672>=</span>/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SSH_HOST<span style=color:#f92672>=</span>vc1
</span></span><span style=display:flex><span>SSH_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>SSH_USER<span style=color:#f92672>=</span>root
</span></span><span style=display:flex><span>SSH_TARGET_DIR<span style=color:#f92672>=</span>/var/www/hugo
</span></span><span style=display:flex><span>SSH_CHOWN<span style=color:#f92672>=</span>33:33
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>S3_BUCKET<span style=color:#f92672>=</span>my_s3_bucket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CLOUDFILES_USERNAME<span style=color:#f92672>=</span>my_rackspace_username
</span></span><span style=display:flex><span>CLOUDFILES_API_KEY<span style=color:#f92672>=</span>my_rackspace_api_key
</span></span><span style=display:flex><span>CLOUDFILES_CONTAINER<span style=color:#f92672>=</span>my_cloudfiles_container
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DROPBOX_DIR<span style=color:#f92672>=</span>~/Dropbox/Public/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GITHUB_PAGES_BRANCH<span style=color:#f92672>=</span>gh-pages
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>all</span><span style=color:#f92672>:</span> html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>publish</span><span style=color:#f92672>:</span> html gzip_static rsync_upload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>help</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;Makefile for a hugo Web site                                              &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;                                                                          &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;Usage:                                                                    &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make html                           (re)generate the web site          &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make clean                          remove the generated files         &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make publish                        generate using production settings &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make server [PORT=1313]             serve site at http://localhost:1313&#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make ssh_upload                     upload the web site via SSH        &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make rsync_upload                   upload the web site via rsync+ssh  &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make dropbox_upload                 upload the web site via Dropbox    &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make ftp_upload                     upload the web site via FTP        &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make s3_upload                      upload the web site via S3         &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make cf_upload                      upload the web site via Cloud Files&#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;   make github                         upload the web site via gh-pages   &#39;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#39;                                                                          &#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>html</span><span style=color:#f92672>:</span> clean
</span></span><span style=display:flex><span>	hugo --minify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>clean</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span> ! -d <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> rm -rf <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span> <span style=color:#f92672>&amp;&amp;</span> mkdir -p <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span> <span style=color:#f92672>&amp;&amp;</span> touch <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span>/.placeholder
</span></span><span style=display:flex><span>	rm -rf <span style=color:#66d9ef>$(</span>RESOURCESDIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>ifdef</span> <span style=color:#960050;background-color:#1e0010>PORT</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>hugo</span> <span style=color:#960050;background-color:#1e0010>server</span> <span style=color:#960050;background-color:#1e0010>-D</span> <span style=color:#960050;background-color:#1e0010>-p</span> <span style=color:#66d9ef>$(</span>PORT<span style=color:#66d9ef>)</span> <span style=color:#960050;background-color:#1e0010>--disableFastRender</span> <span style=color:#960050;background-color:#1e0010>--buildExpired</span> <span style=color:#960050;background-color:#1e0010>--buildFuture</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>else</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>hugo</span> <span style=color:#960050;background-color:#1e0010>server</span> <span style=color:#960050;background-color:#1e0010>-D</span> <span style=color:#960050;background-color:#1e0010>--disableFastRender</span> <span style=color:#960050;background-color:#1e0010>--buildExpired</span> <span style=color:#960050;background-color:#1e0010>--buildFuture</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>generate</span><span style=color:#f92672>:</span> clean
</span></span><span style=display:flex><span>	cd <span style=color:#66d9ef>$(</span>BASEDIR<span style=color:#66d9ef>)</span>; hugo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>check_urls</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	@cd /tmp; wget -r --spider http://localhost:<span style=color:#66d9ef>$(</span>PORT<span style=color:#66d9ef>)</span> 2&gt;&amp;<span style=color:#ae81ff>1</span> | grep -B <span style=color:#ae81ff>2</span> <span style=color:#e6db74>&#34;404 Not Found&#34;</span> | grep http:// | cut -d <span style=color:#e6db74>&#34; &#34;</span> -f <span style=color:#ae81ff>4</span> | sort -u
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>markdownlint</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	@docker run --rm -ti -v <span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span>:/data:ro markdownlint/markdownlint content
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>gzip_static</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> pattern in <span style=color:#e6db74>&#34;*.js&#34;</span> <span style=color:#e6db74>&#34;*.json&#34;</span> <span style=color:#e6db74>&#34;*.css&#34;</span> <span style=color:#e6db74>&#34;*.htm&#34;</span> <span style=color:#e6db74>&#34;*.html&#34;</span> <span style=color:#e6db74>&#34;*.xml&#34;</span>; <span style=color:#66d9ef>do</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>		find <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span> -iname $$pattern -print0 | xargs -0 -I<span style=color:#e6db74>&#39;{}&#39;</span> sh -c <span style=color:#e6db74>&#39;gzip -c9 &#34;{}&#34; &gt; &#34;{}.gz&#34; &amp;&amp; touch -r &#34;{}&#34; &#34;{}.gz&#34;&#39;</span>; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	<span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>optimize_images</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>	find <span style=color:#66d9ef>$(</span>STATICDIR<span style=color:#66d9ef>)</span> -mtime -7 -iname *.png -print | parallel optipng -quiet -preserve -o7
</span></span><span style=display:flex><span>	find <span style=color:#66d9ef>$(</span>INPUTDIR<span style=color:#66d9ef>)</span>  -mtime -7 -iname *.png -print | parallel optipng -quiet -preserve -o7
</span></span><span style=display:flex><span>	find <span style=color:#66d9ef>$(</span>STATICDIR<span style=color:#66d9ef>)</span> -mtime -7 -iname *.jpg -print | parallel jpegtran -optimize -progressive -copy none -outfile <span style=color:#e6db74>&#34;{}&#34;</span> <span style=color:#e6db74>&#34;{}&#34;</span>
</span></span><span style=display:flex><span>	find <span style=color:#66d9ef>$(</span>INPUTDIR<span style=color:#66d9ef>)</span>  -mtime -7 -iname *.jpg -print | parallel jpegtran -optimize -progressive -copy none -outfile <span style=color:#e6db74>&#34;{}&#34;</span> <span style=color:#e6db74>&#34;{}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ssh_upload</span><span style=color:#f92672>:</span> generate
</span></span><span style=display:flex><span>	scp -P <span style=color:#66d9ef>$(</span>SSH_PORT<span style=color:#66d9ef>)</span> -r <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span>/* <span style=color:#66d9ef>$(</span>SSH_USER<span style=color:#66d9ef>)</span>@<span style=color:#66d9ef>$(</span>SSH_HOST<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>SSH_TARGET_DIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rsync_upload</span><span style=color:#f92672>:</span> generate gzip_static
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>ifdef</span> <span style=color:#960050;background-color:#1e0010>SSH_CHOWN</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rsync -e &#34;ssh -p $(SSH_PORT)&#34; -P -avh --delete $(OUTPUTDIR)/ $(SSH_USER)@$(SSH_HOST)</span><span style=color:#f92672>:</span><span style=color:#66d9ef>$(</span>SSH_TARGET_DIR<span style=color:#66d9ef>)</span> --chown <span style=color:#66d9ef>$(</span>SSH_CHOWN<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>else</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rsync -e &#34;ssh -p $(SSH_PORT)&#34; -P -avh --delete $(OUTPUTDIR)/ $(SSH_USER)@$(SSH_HOST)</span><span style=color:#f92672>:</span><span style=color:#66d9ef>$(</span>SSH_TARGET_DIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>endif</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dropbox_upload</span><span style=color:#f92672>:</span> generate
</span></span><span style=display:flex><span>	cp -r <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span>/* <span style=color:#66d9ef>$(</span>DROPBOX_DIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ftp_upload</span><span style=color:#f92672>:</span> generate
</span></span><span style=display:flex><span>	lftp ftp://<span style=color:#66d9ef>$(</span>FTP_USER<span style=color:#66d9ef>)</span>@<span style=color:#66d9ef>$(</span>FTP_HOST<span style=color:#66d9ef>)</span> -e <span style=color:#e6db74>&#34;mirror -R </span><span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span><span style=color:#e6db74> </span><span style=color:#66d9ef>$(</span>FTP_TARGET_DIR<span style=color:#66d9ef>)</span><span style=color:#e6db74> ; quit&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s3_upload</span><span style=color:#f92672>:</span> generate
</span></span><span style=display:flex><span>	s3cmd sync <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span>/ s3://<span style=color:#66d9ef>$(</span>S3_BUCKET<span style=color:#66d9ef>)</span> --acl-public --delete-removed --guess-mime-type
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cf_upload</span><span style=color:#f92672>:</span> generate
</span></span><span style=display:flex><span>	cd <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span> <span style=color:#f92672>&amp;&amp;</span> swift -v -A https://auth.api.rackspacecloud.com/v1.0 -U <span style=color:#66d9ef>$(</span>CLOUDFILES_USERNAME<span style=color:#66d9ef>)</span> -K <span style=color:#66d9ef>$(</span>CLOUDFILES_API_KEY<span style=color:#66d9ef>)</span> upload -c <span style=color:#66d9ef>$(</span>CLOUDFILES_CONTAINER<span style=color:#66d9ef>)</span> .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>github</span><span style=color:#f92672>:</span> generate
</span></span><span style=display:flex><span>	<span style=color:#75715e># ghp-import -m &#34;Generate Hugo site&#34; -b $(GITHUB_PAGES_BRANCH) $(OUTPUTDIR)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># git push origin $(GITHUB_PAGES_BRANCH)</span>
</span></span><span style=display:flex><span>	cd <span style=color:#66d9ef>$(</span>OUTPUTDIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	git add --all
</span></span><span style=display:flex><span>	git commit -m <span style=color:#e6db74>&#34;Update&#34;</span>
</span></span><span style=display:flex><span>	git push
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>.PHONY</span><span style=color:#f92672>:</span> all html help clean generate server ssh_upload rsync_upload dropbox_upload ftp_upload s3_upload cf_upload github
</span></span></code></pre></div></div></div><br><p>This Makefile is actually <a href=https://github.com/getpelican/pelican-blog/blob/main/Makefile target=_blank>an extension<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>of one dedicated <a href=https://getpelican.com/ target=_blank>Pelican<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>static page generator</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>There are many creative ways to use <code>Makefiles</code> to automate and simplify daily tasks. Tool is small and simple, available on any platform (even on Windows via WSL or <a href=https://www.cygwin.com/ target=_blank>Cygwin<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>). Many of my colleagues considered this tool an &ldquo;old school&rdquo; or &ldquo;obsolete&rdquo; initially, but they eventually fall under impression of the recipes simplicity and now just replicate them all around.</p><p>I hope, I will also impress you &#x1f609; Good luck and happy automating!</p><hr><p>Enjoyed?
<a class=kofi href=https://ko-fi.com/tgagor target=_blank><img height=36 style=border:0;height:36px src='https://storage.ko-fi.com/cdn/kofi5.png?v=3' border=0 alt='Buy Me a Coffee at ko-fi.com'></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.gnu.org/software/make/ target=_blank>https://www.gnu.org/software/make/<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://www.postfix.org/DATABASE_README.html target=_blank>https://www.postfix.org/DATABASE_README.html<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html target=_blank>https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://developer.hashicorp.com/terraform/language/settings/backends/configuration#partial-configuration target=_blank>https://developer.hashicorp.com/terraform/language/settings/backends/configuration#partial-configuration<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://github.com/getpelican/pelican-blog/blob/main/Makefile target=_blank>https://github.com/getpelican/pelican-blog/blob/main/Makefile<span style=white-space:nowrap>&#8201;<svg style="height:.7em;width:.7em" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>external link</title><path fill="currentcolor" d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg></span> </a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://gagor.pro/tags/linux/>Linux</a></li><li><a href=https://gagor.pro/tags/macos/>MacOS</a></li><li><a href=https://gagor.pro/tags/bash/>Bash</a></li><li><a href=https://gagor.pro/tags/devops/>DevOps</a></li></ul><nav class=paginav><a class=prev href=https://gagor.pro/2024/02/adding-mermaid-diagrams-to-hugo/><span class=title>¬´ Prev</span><br><span>Adding Mermaid diagrams to Hugo</span>
</a><a class=next href=https://gagor.pro/2024/02/best-practices-for-patching-and-deprecating-images/><span class=title>Next ¬ª</span><br><span>Best practices for patching and deprecating images</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on x" href="https://x.com/intent/tweet/?text=How%20I%20stopped%20worrying%20and%20loved%20Makefiles&amp;url=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f&amp;hashtags=Linux%2cMacOS%2cbash%2cDevOps"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f&amp;title=How%20I%20stopped%20worrying%20and%20loved%20Makefiles&amp;summary=How%20I%20stopped%20worrying%20and%20loved%20Makefiles&amp;source=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f&title=How%20I%20stopped%20worrying%20and%20loved%20Makefiles"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on whatsapp" href="https://api.whatsapp.com/send?text=How%20I%20stopped%20worrying%20and%20loved%20Makefiles%20-%20https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on telegram" href="https://telegram.me/share/url?text=How%20I%20stopped%20worrying%20and%20loved%20Makefiles&amp;url=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How I stopped worrying and loved Makefiles on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20I%20stopped%20worrying%20and%20loved%20Makefiles&u=https%3a%2f%2fgagor.pro%2f2024%2f02%2fhow-i-stopped-worrying-and-loved-makefiles%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=tgagor/tgagor.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg4MDg1Mw==" data-category=Announcements data-category-id=DIC_kwDOAmCIlc4CcAtN data-mapping=pathname data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=transparent_dark data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://gagor.pro/>Tom's Blog</a> &copy; 2008-2024</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=https://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "8d51d5292abd4c77bad90db038659671"}'></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>