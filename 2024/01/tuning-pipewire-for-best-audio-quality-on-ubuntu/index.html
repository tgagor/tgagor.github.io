<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tuning PipeWire for best audio quality on Ubuntu | Tom's Blog</title>
<meta name=keywords content="Linux,Ubuntu,Audio,PipeWire"><meta name=description content="TL;DR If you‚Äôre not interested in the ‚Äústory of my life‚Äù, go directly to ‚ÄúTuning PipeWire‚Äù section.
I‚Äôm not an audiophile, but I spent whole days in the headph"><meta name=author content="timor"><link rel=canonical href=https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/><link crossorigin=anonymous href=/assets/css/stylesheet.54d9f8673f7336b5aaf6aed1f553f58f41d018b0cf41d3fd49e352ff367f9312.css integrity="sha256-VNn4Zz9zNrWq9q7R9VP1j0HQGLDPQdP9SeNS/zZ/kxI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://gagor.pl/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pl/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pl/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pl/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pl/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4TQXK4C4W5"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4TQXK4C4W5",{anonymize_ip:!1})}</script><meta property="og:title" content="Tuning PipeWire for best audio quality on Ubuntu"><meta property="og:description" content="TL;DR If you&rsquo;re not interested in the &ldquo;story of my life&rdquo;, go directly to &ldquo;Tuning PipeWire&rdquo; section.
I&rsquo;m not an audiophile, but I spent whole days in the headphones and I like when sound sounds good. I like slight bass boost, which adds this kick to the melody, but won&rsquo;t overwhelm me after an hour of listening. I like when high tones are clear, but I get annoyed if they&rsquo;re too strong."><meta property="og:type" content="article"><meta property="og:url" content="https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/"><meta property="og:image" content="https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-28T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover.webp"><meta name=twitter:title content="Tuning PipeWire for best audio quality on Ubuntu"><meta name=twitter:description content="TL;DR If you&rsquo;re not interested in the &ldquo;story of my life&rdquo;, go directly to &ldquo;Tuning PipeWire&rdquo; section.
I&rsquo;m not an audiophile, but I spent whole days in the headphones and I like when sound sounds good. I like slight bass boost, which adds this kick to the melody, but won&rsquo;t overwhelm me after an hour of listening. I like when high tones are clear, but I get annoyed if they&rsquo;re too strong."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://gagor.pl/posts/"},{"@type":"ListItem","position":3,"name":"Tuning PipeWire for best audio quality on Ubuntu","item":"https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tuning PipeWire for best audio quality on Ubuntu","name":"Tuning PipeWire for best audio quality on Ubuntu","description":"TL;DR If you\u0026rsquo;re not interested in the \u0026ldquo;story of my life\u0026rdquo;, go directly to \u0026ldquo;Tuning PipeWire\u0026rdquo; section.\nI\u0026rsquo;m not an audiophile, but I spent whole days in the headphones and I like when sound sounds good. I like slight bass boost, which adds this kick to the melody, but won\u0026rsquo;t overwhelm me after an hour of listening. I like when high tones are clear, but I get annoyed if they\u0026rsquo;re too strong.","keywords":["Linux","Ubuntu","Audio","PipeWire"],"articleBody":" TL;DR If you‚Äôre not interested in the ‚Äústory of my life‚Äù, go directly to ‚ÄúTuning PipeWire‚Äù section.\nI‚Äôm not an audiophile, but I spent whole days in the headphones and I like when sound sounds good. I like slight bass boost, which adds this kick to the melody, but won‚Äôt overwhelm me after an hour of listening. I like when high tones are clear, but I get annoyed if they‚Äôre too strong. And finally, I hate all cracks, hisses or electric circuit noises.\nMy hardware I‚Äôve collected a bunch of these over the years üòÑ\nAsus Xonar DX Sampling Sampling rate SNR 24 bit 192kHz 116 dB I have it for around 10 years. It‚Äôs great. Well supported by Linux. Not supported by Windows 11, as it‚Äôs too old.\nThere‚Äôs one thing that irritates me - Intel cards used to automatically detect when headphone was plugged to the front panel and automatically switching audio to it, Xonar do not have it üò¢\nROG SupremeFX aka Realtek ALC4080 + Savitech SV3H712 AMP Sampling Sampling rate SNR 32 bit 384kHz 120 dB It‚Äôs integrated audio on my motherboard. It‚Äôs sometimes referred as a ‚Äúpremium audio‚Äù. The way it‚Äôs installed, pretends USB connection, to avoid any noises that could go via circuit (all digital). To be honest, it‚Äôs pretty decent - no cracks or strange noises, but Linux support was üí© for quite a long time. S/PDIF didn‚Äôt work well until I upgraded kernel to 6.5. Even now, it happen that sound card is loaded but it‚Äôs not giving any output via S/PDIF until a restart.\nFiiO K5 Pro Sampling Sampling rate SNR 32 bit 768kHz 115 dB That‚Äôs my recent Xmas gift. Works well on Linux and MacOS. Provides more power, than I need with any of my headphones.\nLegacy of the PulseAudio PulseAudio was blamed for high latency and some ‚Äúnon optimal‚Äù decisions. Default configuration was enforcing resampling to 44.1 kHz always, where many media now use 48 kHz. This means that audio was resampled most of the time, even when my sound card supports higher sample rates. I wanted to avoid that and it‚Äôs well described how to achieve it on the Delightly Linux1 2 blog.\nRecent systems switch to new, better PipeWire audio system by default. I‚Äôd like to be sure, that I still get the best from my hardware. Not that I could hear the difference‚Ä¶ üòÉ Just for the sake of doing it the right way!\nI‚Äôve been looking for a good description on ‚Äúhow to tune it‚Äù and I failed. Arch‚Äôs Wiki3 is usually a good source, but there‚Äôs no direct description regarding quality. I also found some Reddit posts 4 5, but nothing step by step. Let me share what I found.\nTuning PipeWire PipeWire runs as a user-space service and it can use configs from per-system or per-user configs. That‚Äôs how it look like:\n/usr/share/pipewire - default configs, /etc/pipewire - system wide configs, to override defaults, ~/.config/pipewire - per-use configs, can use: full file names like ~/.config/pipewire/pipewire.conf subsection replacements ~/.config/pipewire/pipewire.conf.d/ (same pattern works in /etc/pipewire too) It‚Äôs easier to play in user‚Äôs home dir, but I prefer to have it in the system space. As I found quite a lot of differences in those config files between Ubuntu versions, I like ‚Äúsubsection‚Äù approach as it allows to overwrite only the parts I want, leaving rest on defaults.\nDefault parameters After system installation my /etc/pipewire was just empty. I was wondering where can I check the defaults and I found it, under:\nCheck default configs ls -1 /usr/share/pipewire/ client.conf client-rt.conf filter-chain filter-chain.conf jack.conf minimal.conf pipewire-aes67.conf pipewire-avb.conf pipewire.conf pipewire-pulse.conf It‚Äôs a good source of documentation and examples.\nSet client resample quality When resampling happens, let it happen with the best possible quality. Look for resample.quality in the client.conf file, uncomment it and set to 10:\nConfigure resampling mkdir -p ~/.config/pipewire/client.conf.d cat \u003c ~/.config/pipewire/client.conf.d/resample-quality.conf stream.properties = { resample.quality = 10 } EOF And another one for Pulse Audio:\nConfigure resampling mkdir -p ~/.config/pipewire/pipewire-pulse.conf.d/ cat \u003c ~/.config/pipewire/pipewire-pulse.conf.d/resample-quality.conf stream.properties = { resample.quality = 10 } EOF DSP configuration That‚Äôs my configuration I use:\nConfigure DSP mkdir -p ~/.config/pipewire/pipewire.conf.d cat \u003c ~/.config/pipewire/pipewire.conf.d/dsp-defaults.conf context.properties = { ## Properties for the DSP configuration. default.clock.rate = 48000 default.clock.allowed-rates = [ 44100 48000 88200 96000 176400 192000 352800 384000 705600 768000 ] #default.clock.quantum = 1024 default.clock.min-quantum = 32 default.clock.max-quantum = 8192 #default.clock.quantum-limit = 8192 } EOF Let see what happen here:\ndefault.clock.rate - PipeWire has one global sample rate used in the processing pipeline. All signals are converted to this sample rate and then converted to the sample rate of the device. That said, if you set it too low, it won‚Äôt use capabilities of your device. If you set it higher that the sources you use, it will be resampling to higher frequencies, which will just waste CPU time.\ndefault.clock.allowed-rates - This one lists the frequencies that are supported by your sound device. By default it‚Äôs set to [ 48000 ], which quite often will resample audio. To allow use of other frequencies, I had to manually list them.\nAlsa monitor config Theoretically: it specifies the supported input/output audio formats for ALSA devices. In this case, it is set to ‚Äúall,‚Äù indicating that PipeWire should support all available output audio formats. This includes various audio formats such as PCM (Pulse Code Modulation), AC3 (Dolby Digital), DTS (Digital Theater Systems), and more.\nConfigure Alsa #cat \u003c\u003c EOF | sudo tee -a /etc/pipewire/alsa-monitor.conf cat \u003c ~/.config/pipewire/alsa-monitor.conf [alsa-monitor] output_formats = all input_formats = all EOF Info\nI‚Äôm having hard time to recall where I found this and why I needed it? I will updated when I figure it out.\nReload PipeWire configuration To reload configuration files after the change, you can restart PipeWire like this:\nRestart PipeWire systemctl --user restart pipewire.service systemctl --user restart pipewire-pulse.service Warning\nSome applications (eg. Spotify) might not detect new sinks and will stay ‚Äúmuted‚Äù. Restart them to get the sound back.\nFor testing, command line tools like mpv or aplay are more reliable.\nHow to check if it works? Warning\nRestart PipeWire first!\nWe can check specific files effective configuration by calling:\nCheck config $ pw-config -n pipewire.conf list ... ], \"config.name.d\": \"pipewire.conf.d\", \"override.1.0.config.path\": \"/home/timor/.config/pipewire/pipewire.conf.d/dsp-defaults.conf\", \"override.1.0.config.name\": \"dsp-defaults.conf\", \"override.1.0.context.properties\": { ## Properties for the DSP configuration. default.clock.rate = 48000 default.clock.allowed-rates = [ 44100 48000 88200 96000 176400 192000 352800 384000 705600 768000 ] #default.clock.quantum = 1024 default.clock.min-quantum = 32 default.clock.max-quantum = 8192 #default.clock.quantum-limit = 8192 } or\nCheck config pw-config -n client.conf list ... \"config.name.d\": \"client.conf.d\", \"override.1.0.config.path\": \"/home/timor/.config/pipewire/client.conf.d/resample-quality.conf\", \"override.1.0.config.name\": \"resample-quality.conf\", \"override.1.0.stream.properties\": { resample.quality = 10 } Check config pw-config -n pipewire-pulse.conf list ... \"config.name.d\": \"pipewire-pulse.conf.d\", \"override.1.0.config.path\": \"/home/timor/.config/pipewire/pipewire-pulse.conf.d/resample-quality.conf\", \"override.1.0.config.name\": \"resample-quality.conf\", \"override.1.0.stream.properties\": { resample.quality = 10 } If all looks good, we should check if it‚Äôs working as we want by calling pw-top:\nAlternatively we can watch directly Alsa‚Äôs outputs:\nCheck raw Alsa's hardware params watch -n1 cat /proc/asound/card*/pcm*/sub0/hw_params Is it wroth it? Probably not.\nOne difference I found between PipeWire and PulseAudio is some kind of delay, before the sink is closed. For example, if I start Spotify which will create sink with 44.1 kHz sampling rate and enable Youtube - it will keep 44.1 kHz despite Youtube working with 48 kHz. You‚Äôre usually not listening two many sources at the same time, but it behaves the same even if I shut down Spotify and start Youtube ‚Äútoo fast‚Äù. It‚Äôs at least bunch of seconds, I didn‚Äôt found if it‚Äôs configurable yet.\nWith PulseAudio, it was instant. When I was checking PCM outputs, they were just switching instantly. With PipeWire, if I won‚Äôt keep OS silent for a while, it might start with much lower sample rates. You know, 44.1 kHz is more than I can hear, but it‚Äôs just disappointing and feels like a regression.\nI can see also other ‚Äúsilly‚Äù behaviors of PipeWire. At lest 2 of my cards support 32 bit sampling, but even if source use 32bit, Alsa usually use just 24. Again, it‚Äôs nothing I could hear, but if hardware is capable of more, why not to use it?\nThose are things I feel missing right now, but maybe it‚Äôs something that might be solved with more configs üòâ\nI can‚Äôt really hear the difference. I stayed with 192 kHz sampling rate as a default for few days. I felt rather tired, when listening too long and I couldn‚Äôt name what was the reason. 95% of the audio I listen comes from 2 sources:\nSpotify (44.1 kHz) Youtube (48 kHz) For me this means that the default of 48 kHz as a sampling rate is just fine. Spotify gets resampled up, which should be less harmful than resampling to the lower frequencies. That‚Äôs why I stayed there.\nTODO Force Alsa to use 32 bit sampling by default. My cards support it but I only see S24LE going to the output. Same like with sampling rate, why to convert if I should be able to just drop it on the hardware? 6\nI heard about Harman curve and I‚Äôd like to play with it. I have relatively good headphones: Bayerdynamic DT 990 Pro 250 Ohm. They sound quite well and don‚Äôt make me feel tired - I guess it‚Äôs a matter of open design. Still I think they‚Äôre strengthening higher frequencies. I‚Äôd like to use AutoEQ profile, to setup my headphones according to the ‚Äúrecommended‚Äù way. But I don‚Äôt like to do it with external equalizer app - PipeWire should be able to handle that, I just don‚Äôt know yet how :) 7 8\nI‚Äôve read some day that the more I age, the less frequencies I can hear. Which means my kids might be hearing some noises which I won‚Äôt be able. There are even Ringtones for teenagers that rely on this phenomena. Teachers can‚Äôt hear them. 9 10 11\nhttps://delightlylinux.wordpress.com/2017/01/13/experience-better-sound-in-linux-with-the-asus-xonar-dx-sound-card/¬†‚Ü©Ô∏é\nhttps://delightlylinux.wordpress.com/2017/01/23/asus-xonar-dsx-and-linux/¬†‚Ü©Ô∏é\nhttps://wiki.archlinux.org/title/PipeWire¬†‚Ü©Ô∏é\nhttps://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/Configuration?version_id=25749f548c1e2fddd9e1678d9b7e57ebfcae3cf2¬†‚Ü©Ô∏é\nhttps://www.reddit.com/r/Fedora/comments/xd8tg7/audio_quality_with_pipewire_dac/¬†‚Ü©Ô∏é\nhttps://wiki.archlinux.org/title/PipeWire#High_latency_with_USB_DACs_(e.g._Schiit_DACs)¬†‚Ü©Ô∏é\nhttps://headphonesaddict.com/harman-curve/¬†‚Ü©Ô∏é\nhttps://autoeq.app/¬†‚Ü©Ô∏é\nhttps://www.sciencedirect.com/topics/medicine-and-dentistry/high-frequency-hearing-loss¬†‚Ü©Ô∏é\nhttps://www.signia.net/en/service/hearing-test/¬†‚Ü©Ô∏é\nhttps://www.classicfm.com/discover-music/how-high-can-you-hear-video-frequency-hearing-test/¬†‚Ü©Ô∏é\n","wordCount":"1647","inLanguage":"en","image":"https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover.webp","datePublished":"2024-01-28T00:00:00Z","dateModified":"2024-01-28T00:00:00Z","author":{"@type":"Person","name":"timor"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://gagor.pl/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pl accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pl/favicon-72x72.png alt aria-label=logo height=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pl/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pl/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pl/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pl/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pl/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gagor.pl>Home</a>&nbsp;¬ª&nbsp;<a href=https://gagor.pl/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Tuning PipeWire for best audio quality on Ubuntu</h1><div class=post-meta><span title='2024-01-28 00:00:00 +0000 UTC'>2024-01-28</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;timor</div></header><figure class=entry-cover><img loading=eager srcset="https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover_hubd58ee914d7eeffaaf0e56b2b7cc4d20_80522_360x0_resize_q75_h2_box_2.webp 360w ,https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover_hubd58ee914d7eeffaaf0e56b2b7cc4d20_80522_480x0_resize_q75_h2_box_2.webp 480w ,https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover_hubd58ee914d7eeffaaf0e56b2b7cc4d20_80522_720x0_resize_q75_h2_box_2.webp 720w ,https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover_hubd58ee914d7eeffaaf0e56b2b7cc4d20_80522_1080x0_resize_q75_h2_box_2.webp 1080w ,https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover_hubd58ee914d7eeffaaf0e56b2b7cc4d20_80522_1500x0_resize_q75_h2_box_2.webp 1500w ,https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover.webp 1500w" sizes="(min-width: 768px) 720px, 100vw" src=https://gagor.pl/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/cover.webp alt width=1500 height=625></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#my-hardware aria-label="My hardware">My hardware</a></li><li><a href=#legacy-of-the-pulseaudio aria-label="Legacy of the PulseAudio">Legacy of the PulseAudio</a></li><li><a href=#tuning-pipewire aria-label="Tuning PipeWire">Tuning PipeWire</a><ul><li><a href=#default-parameters aria-label="Default parameters">Default parameters</a></li><li><a href=#set-client-resample-quality aria-label="Set client resample quality">Set client resample quality</a></li><li><a href=#dsp-configuration aria-label="DSP configuration">DSP configuration</a></li><li><a href=#alsa-monitor-config aria-label="Alsa monitor config">Alsa monitor config</a></li></ul></li><li><a href=#reload-pipewire-configuration aria-label="Reload PipeWire configuration">Reload PipeWire configuration</a></li><li><a href=#how-to-check-if-it-works aria-label="How to check if it works?">How to check if it works?</a></li><li><a href=#is-it-wroth-it aria-label="Is it wroth it?">Is it wroth it?</a></li><li><a href=#todo aria-label=TODO>TODO</a></li></ul></div></details></div><div class=post-content><blockquote><p>TL;DR<br>If you&rsquo;re not interested in the &ldquo;story of my life&rdquo;, go directly to &ldquo;<a href=#tuning-pipewire>Tuning PipeWire</a>&rdquo; section.</p></blockquote><p>I&rsquo;m not an audiophile, but I spent whole days in the headphones and I like when sound sounds good. I like slight bass boost, which adds this kick to the melody, but won&rsquo;t overwhelm me after an hour of listening. I like when high tones are clear, but I get annoyed if they&rsquo;re too strong. And finally, I hate all cracks, hisses or electric circuit noises.</p><h2 id=my-hardware>My hardware<a hidden class=anchor aria-hidden=true href=#my-hardware>#</a></h2><p>I&rsquo;ve collected a bunch of these over the years &#x1f604;</p><ol><li><strong>Asus Xonar DX</strong></li></ol><figure><img loading=lazy src=images/asus-xonar.webp></figure><table><thead><tr><th>Sampling</th><th>Sampling rate</th><th>SNR</th></tr></thead><tbody><tr><td>24 bit</td><td>192kHz</td><td>116 dB</td></tr></tbody></table><p>I have it for around 10 years. It&rsquo;s great. Well supported by Linux. Not supported by Windows 11, as it&rsquo;s too old.</p><p>There&rsquo;s one thing that irritates me - Intel cards used to automatically detect when headphone was plugged to the front panel and automatically switching audio to it, Xonar do not have it &#x1f622;</p><ol start=2><li><strong>ROG SupremeFX</strong> aka Realtek ALC4080 + Savitech SV3H712 AMP</li></ol><figure><img loading=lazy src=images/supreme-fx.webp></figure><table><thead><tr><th>Sampling</th><th>Sampling rate</th><th>SNR</th></tr></thead><tbody><tr><td>32 bit</td><td>384kHz</td><td>120 dB</td></tr></tbody></table><p>It&rsquo;s integrated audio on my motherboard. It&rsquo;s sometimes referred as a &ldquo;premium audio&rdquo;. The way it&rsquo;s installed, pretends USB connection, to avoid any noises that could go via circuit (all digital). To be honest, it&rsquo;s pretty decent - no cracks or strange noises, but Linux support was &#x1f4a9; for quite a long time. S/PDIF didn&rsquo;t work well until I upgraded kernel to 6.5. Even now, it happen that sound card is loaded but it&rsquo;s not giving any output via S/PDIF until a restart.</p><ol start=3><li><strong>FiiO K5 Pro</strong></li></ol><figure><img loading=lazy src=images/fiio.webp></figure><table><thead><tr><th>Sampling</th><th>Sampling rate</th><th>SNR</th></tr></thead><tbody><tr><td>32 bit</td><td>768kHz</td><td>115 dB</td></tr></tbody></table><p>That&rsquo;s my recent Xmas gift. Works well on Linux and MacOS. Provides more power, than I need with any of my headphones.</p><h2 id=legacy-of-the-pulseaudio>Legacy of the PulseAudio<a hidden class=anchor aria-hidden=true href=#legacy-of-the-pulseaudio>#</a></h2><p>PulseAudio was blamed for high latency and some &ldquo;non optimal&rdquo; decisions. Default configuration was enforcing resampling to 44.1 kHz always, where many media now use 48 kHz. This means that audio was resampled most of the time, even when my sound card supports higher sample rates. I wanted to avoid that and it&rsquo;s well described how to achieve it on the <a href=https://delightlylinux.wordpress.com>Delightly Linux</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> blog.</p><p>Recent systems switch to new, better PipeWire audio system by default. I&rsquo;d like to be sure, that I still get the best from my hardware. Not that I could hear the difference&mldr; &#x1f603; Just for the sake of doing it the right way!</p><p>I&rsquo;ve been looking for a good description on &ldquo;how to tune it&rdquo; and I failed. Arch&rsquo;s Wiki<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> is usually a good source, but there&rsquo;s no direct description regarding quality. I also found some Reddit posts <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>, but nothing step by step. Let me share what I found.</p><h2 id=tuning-pipewire>Tuning PipeWire<a hidden class=anchor aria-hidden=true href=#tuning-pipewire>#</a></h2><p>PipeWire runs as a user-space service and it can use configs from per-system or per-user configs. That&rsquo;s how it look like:</p><ol><li><code>/usr/share/pipewire</code> - default configs,</li><li><code>/etc/pipewire</code> - system wide configs, to override defaults,</li><li><code>~/.config/pipewire</code> - per-use configs, can use:</li></ol><ul><li>full file names like <code>~/.config/pipewire/pipewire.conf</code></li><li>subsection replacements <code>~/.config/pipewire/pipewire.conf.d/</code></li><li>(same pattern works in <code>/etc/pipewire</code> too)</li></ul><p>It&rsquo;s easier to play in user&rsquo;s home dir, but I prefer to have it in the system space. As I found quite a lot of differences in those config files between Ubuntu versions, I like &ldquo;subsection&rdquo; approach as it allows to overwrite only the parts I want, leaving rest on defaults.</p><h3 id=default-parameters>Default parameters<a hidden class=anchor aria-hidden=true href=#default-parameters>#</a></h3><p>After system installation my <code>/etc/pipewire</code> was just empty. I was wondering where can I check the defaults and I found it, under:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Check default configs</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -1 /usr/share/pipewire/
</span></span><span style=display:flex><span>client.conf
</span></span><span style=display:flex><span>client-rt.conf
</span></span><span style=display:flex><span>filter-chain
</span></span><span style=display:flex><span>filter-chain.conf
</span></span><span style=display:flex><span>jack.conf
</span></span><span style=display:flex><span>minimal.conf
</span></span><span style=display:flex><span>pipewire-aes67.conf
</span></span><span style=display:flex><span>pipewire-avb.conf
</span></span><span style=display:flex><span>pipewire.conf
</span></span><span style=display:flex><span>pipewire-pulse.conf
</span></span></code></pre></div></div></div><br><p>It&rsquo;s a good source of documentation and examples.</p><h3 id=set-client-resample-quality>Set client resample quality<a hidden class=anchor aria-hidden=true href=#set-client-resample-quality>#</a></h3><p>When resampling happens, let it happen with the best possible quality. Look for <code>resample.quality</code> in the <code>client.conf</code> file, uncomment it and set to <code>10</code>:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Configure resampling</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/.config/pipewire/client.conf.d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; ~/.config/pipewire/client.conf.d/resample-quality.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>stream.properties = {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    resample.quality      = 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></div></div><br><p>And another one for Pulse Audio:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Configure resampling</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/.config/pipewire/pipewire-pulse.conf.d/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; ~/.config/pipewire/pipewire-pulse.conf.d/resample-quality.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>stream.properties = {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    resample.quality      = 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></div></div><br><h3 id=dsp-configuration>DSP configuration<a hidden class=anchor aria-hidden=true href=#dsp-configuration>#</a></h3><p>That&rsquo;s my configuration I use:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Configure DSP</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/.config/pipewire/pipewire.conf.d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; ~/.config/pipewire/pipewire.conf.d/dsp-defaults.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>context.properties = {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ## Properties for the DSP configuration.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    default.clock.rate          = 48000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    default.clock.allowed-rates = [ 44100 48000 88200 96000 176400 192000 352800 384000 705600 768000 ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    #default.clock.quantum       = 1024
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    default.clock.min-quantum   = 32
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    default.clock.max-quantum   = 8192
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    #default.clock.quantum-limit = 8192
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></div></div><br><p>Let see what happen here:</p><ol><li><p><strong>default.clock.rate</strong> - PipeWire has one global sample rate used in the processing pipeline. All signals are converted to this sample rate and then converted to the sample rate of the device.
That said, if you set it too low, it won&rsquo;t use capabilities of your device. If you set it higher that the sources you use, it will be resampling to higher frequencies, which will just waste CPU time.</p></li><li><p><strong>default.clock.allowed-rates</strong> - This one lists the frequencies that are supported by your sound device. By default it&rsquo;s set to <code>[ 48000 ]</code>, which quite often will resample audio. To allow use of other frequencies, I had to manually list them.</p></li></ol><h3 id=alsa-monitor-config>Alsa monitor config<a hidden class=anchor aria-hidden=true href=#alsa-monitor-config>#</a></h3><p>Theoretically: it specifies the supported input/output audio formats for ALSA devices. In this case, it is set to &ldquo;all,&rdquo; indicating that PipeWire should support all available output audio formats. This includes various audio formats such as PCM (Pulse Code Modulation), AC3 (Dolby Digital), DTS (Digital Theater Systems), and more.</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Configure Alsa</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#cat &lt;&lt; EOF | sudo tee -a /etc/pipewire/alsa-monitor.conf</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; ~/.config/pipewire/alsa-monitor.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[alsa-monitor]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output_formats = all
</span></span></span><span style=display:flex><span><span style=color:#e6db74>input_formats = all
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></div></div><br><style type=text/css>.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:#444;background:#e7f2fa}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de}.notice.warning .notice-title{background:rgba(217,83,79,.9)}.notice.warning{background:#fae2e2}.notice.info .notice-title{background:#f0b37e}.notice.info{background:#fff2db}.notice.note .notice-title{background:#6ab0de}.notice.note{background:#e7f2fa}.notice.tip .notice-title{background:rgba(92,184,92,.8)}.notice.tip{background:#e6f9e6}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice info"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"/></svg></span>Info</p><p>I&rsquo;m having hard time to recall where I found this and why I needed it? I will updated when I figure it out.</p></div><h2 id=reload-pipewire-configuration>Reload PipeWire configuration<a hidden class=anchor aria-hidden=true href=#reload-pipewire-configuration>#</a></h2><p>To reload configuration files after the change, you can restart PipeWire like this:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Restart PipeWire</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl --user restart pipewire.service
</span></span><span style=display:flex><span>systemctl --user restart pipewire-pulse.service
</span></span></code></pre></div></div></div><br><div class="notice warning"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"/></svg></span>Warning</p><p>Some applications (eg. Spotify) might not detect new sinks and will stay &ldquo;muted&rdquo;. Restart them to get the sound back.</p><p>For testing, command line tools like <em>mpv</em> or <em>aplay</em> are more reliable.</p></div><h2 id=how-to-check-if-it-works>How to check if it works?<a hidden class=anchor aria-hidden=true href=#how-to-check-if-it-works>#</a></h2><div class="notice warning"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"/></svg></span>Warning</p><p>Restart PipeWire first!</p></div><p>We can check specific files effective configuration by calling:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Check config</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pw-config -n pipewire.conf list
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;config.name.d&#34;</span>: <span style=color:#e6db74>&#34;pipewire.conf.d&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.config.path&#34;</span>: <span style=color:#e6db74>&#34;/home/timor/.config/pipewire/pipewire.conf.d/dsp-defaults.conf&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.config.name&#34;</span>: <span style=color:#e6db74>&#34;dsp-defaults.conf&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.context.properties&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## Properties for the DSP configuration.</span>
</span></span><span style=display:flex><span>    default.clock.rate          <span style=color:#f92672>=</span> <span style=color:#ae81ff>48000</span>
</span></span><span style=display:flex><span>    default.clock.allowed-rates <span style=color:#f92672>=</span> <span style=color:#f92672>[</span> <span style=color:#ae81ff>44100</span> <span style=color:#ae81ff>48000</span> <span style=color:#ae81ff>88200</span> <span style=color:#ae81ff>96000</span> <span style=color:#ae81ff>176400</span> <span style=color:#ae81ff>192000</span> <span style=color:#ae81ff>352800</span> <span style=color:#ae81ff>384000</span> <span style=color:#ae81ff>705600</span> <span style=color:#ae81ff>768000</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#default.clock.quantum       = 1024</span>
</span></span><span style=display:flex><span>    default.clock.min-quantum   <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>    default.clock.max-quantum   <span style=color:#f92672>=</span> <span style=color:#ae81ff>8192</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#default.clock.quantum-limit = 8192</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div></div><br><p>or</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Check config</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pw-config -n client.conf list
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;config.name.d&#34;</span>: <span style=color:#e6db74>&#34;client.conf.d&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.config.path&#34;</span>: <span style=color:#e6db74>&#34;/home/timor/.config/pipewire/client.conf.d/resample-quality.conf&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.config.name&#34;</span>: <span style=color:#e6db74>&#34;resample-quality.conf&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.stream.properties&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    resample.quality      <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div></div><br><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Check config</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pw-config -n pipewire-pulse.conf list
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;config.name.d&#34;</span>: <span style=color:#e6db74>&#34;pipewire-pulse.conf.d&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.config.path&#34;</span>: <span style=color:#e6db74>&#34;/home/timor/.config/pipewire/pipewire-pulse.conf.d/resample-quality.conf&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.config.name&#34;</span>: <span style=color:#e6db74>&#34;resample-quality.conf&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;override.1.0.stream.properties&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    resample.quality      <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div></div><br><p>If all looks good, we should check if it&rsquo;s working as we want by calling <code>pw-top</code>:</p><script src=/shortcode-gallery/jquery-3.7.1.min.js></script><script src=/shortcode-gallery/lazy/jquery.lazy.min.js></script><script src=/shortcode-gallery/swipebox/js/jquery.swipebox.min.js></script><link rel=stylesheet href=/shortcode-gallery/swipebox/css/swipebox.min.css><script src=/shortcode-gallery/justified_gallery/jquery.justifiedGallery.min.js></script><link rel=stylesheet href=/shortcode-gallery/justified_gallery/justifiedGallery.min.css><style></style><div id=gallery-d6e91a5977a72161a8f3e9db583a1a97-15-wrapper class=gallery-wrapper><div id=gallery-d6e91a5977a72161a8f3e9db583a1a97-15 class=justified-gallery><div><a href=/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/pw-top.webp class=galleryImg><img width=600 height=156 style=filter:blur(25px) src="data:image/jpeg;base64,/9j/2wCEAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9PjsBCgsLDg0OHBAQHDsoIig7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O//AABEIAAgAIAMBIgACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AORNxL/z0f8A76pDcS/89X/76qM0h6VtZHLzy7loTylQRM44/vU15pR/y8Pn/eNMX7v4UyT71FkPml3P/9k=" class=lazy data-src=/2024/01/tuning-pipewire-for-best-audio-quality-on-ubuntu/images/pw-top_hu58520022b53c1c26bc04879fd202716c_43762_e807e714472ac07005f8cedb8e7ce469.webp></a></div></div></div><script>jQuery||alert("jquery is not loaded"),$(document).ready(()=>{const e=$("#gallery-d6e91a5977a72161a8f3e9db583a1a97-15");let t=null;e.on("jg.complete",()=>{$(()=>{$(".lazy").Lazy({visibleOnly:!0,afterLoad:e=>e.css({filter:"none",transition:"filter 1.0s ease-in-out"})})}),t=$(".galleryImg").swipebox(jQuery.extend({},{}))}),e.justifiedGallery({rowHeight:"150",margins:"5",border:0,randomize:!1,waitThumbnailsLoad:!1,lastRow:"justify",captions:!1})})</script><p>Alternatively we can watch directly Alsa&rsquo;s outputs:</p><div class="terminal space shadow"><div class=top><div class=btns><span class="circle red"></span>
<span class="circle yellow"></span>
<span class="circle green"></span></div><div class=title>Check raw Alsa's hardware params</div></div><div class=terminalbody><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>watch -n1 cat /proc/asound/card*/pcm*/sub0/hw_params
</span></span></code></pre></div></div></div><br><h2 id=is-it-wroth-it>Is it wroth it?<a hidden class=anchor aria-hidden=true href=#is-it-wroth-it>#</a></h2><p>Probably not.</p><p>One difference I found between PipeWire and PulseAudio is some kind of delay, before the sink is closed. For example, if I start Spotify which will create sink with 44.1 kHz sampling rate and enable Youtube - it will keep 44.1 kHz despite Youtube working with 48 kHz. You&rsquo;re usually not listening two many sources at the same time, but it behaves the same even if I shut down Spotify and start Youtube &ldquo;too fast&rdquo;. It&rsquo;s at least bunch of seconds, I didn&rsquo;t found if it&rsquo;s configurable yet.</p><p>With PulseAudio, it was instant. When I was checking PCM outputs, they were just switching instantly. With PipeWire, if I won&rsquo;t keep OS silent for a while, it might start with much lower sample rates. You know, 44.1 kHz is more than I can hear, but it&rsquo;s just disappointing and feels like a regression.</p><p>I can see also other &ldquo;silly&rdquo; behaviors of PipeWire. At lest 2 of my cards support 32 bit sampling, but even if source use 32bit, Alsa usually use just 24. Again, it&rsquo;s nothing I could hear, but if hardware is capable of more, why not to use it?</p><p>Those are things I feel missing right now, but maybe it&rsquo;s something that might be solved with more configs &#x1f609;</p><p>I can&rsquo;t really hear the difference. I stayed with 192 kHz sampling rate as a default for few days. I felt rather tired, when listening too long and I couldn&rsquo;t name what was the reason. 95% of the audio I listen comes from 2 sources:</p><ul><li>Spotify (44.1 kHz)</li><li>Youtube (48 kHz)</li></ul><p>For me this means that the default of 48 kHz as a sampling rate is just fine. Spotify gets resampled up, which should be less harmful than resampling to the lower frequencies. That&rsquo;s why I stayed there.</p><h2 id=todo>TODO<a hidden class=anchor aria-hidden=true href=#todo>#</a></h2><ol><li><p>Force Alsa to use 32 bit sampling by default. My cards support it but I only see S24LE going to the output. Same like with sampling rate, why to convert if I should be able to just drop it on the hardware? <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p></li><li><p>I heard about Harman curve and I&rsquo;d like to play with it. I have relatively good headphones: Bayerdynamic DT 990 Pro 250 Ohm. They sound quite well and don&rsquo;t make me feel tired - I guess it&rsquo;s a matter of open design. Still I think they&rsquo;re strengthening higher frequencies. I&rsquo;d like to use AutoEQ profile, to setup my headphones according to the &ldquo;recommended&rdquo; way.
But I don&rsquo;t like to do it with external equalizer app - PipeWire should be able to handle that, I just don&rsquo;t know yet how :) <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup></p></li><li><p>I&rsquo;ve read some day that the more I age, the less frequencies I can hear. Which means my kids might be hearing some noises which I won&rsquo;t be able. There are even Ringtones for teenagers that rely on this phenomena. Teachers can&rsquo;t hear them. <sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup> <sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup> <sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup></p></li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://delightlylinux.wordpress.com/2017/01/13/experience-better-sound-in-linux-with-the-asus-xonar-dx-sound-card/>https://delightlylinux.wordpress.com/2017/01/13/experience-better-sound-in-linux-with-the-asus-xonar-dx-sound-card/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://delightlylinux.wordpress.com/2017/01/23/asus-xonar-dsx-and-linux/>https://delightlylinux.wordpress.com/2017/01/23/asus-xonar-dsx-and-linux/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://wiki.archlinux.org/title/PipeWire>https://wiki.archlinux.org/title/PipeWire</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href="https://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/Configuration?version_id=25749f548c1e2fddd9e1678d9b7e57ebfcae3cf2">https://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/Configuration?version_id=25749f548c1e2fddd9e1678d9b7e57ebfcae3cf2</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://www.reddit.com/r/Fedora/comments/xd8tg7/audio_quality_with_pipewire_dac/>https://www.reddit.com/r/Fedora/comments/xd8tg7/audio_quality_with_pipewire_dac/</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://wiki.archlinux.org/title/PipeWire#High_latency_with_USB_DACs_(e.g._Schiit_DACs)>https://wiki.archlinux.org/title/PipeWire#High_latency_with_USB_DACs_(e.g._Schiit_DACs)</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=https://headphonesaddict.com/harman-curve/>https://headphonesaddict.com/harman-curve/</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=https://autoeq.app/>https://autoeq.app/</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=https://www.sciencedirect.com/topics/medicine-and-dentistry/high-frequency-hearing-loss>https://www.sciencedirect.com/topics/medicine-and-dentistry/high-frequency-hearing-loss</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=https://www.signia.net/en/service/hearing-test/>https://www.signia.net/en/service/hearing-test/</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://www.classicfm.com/discover-music/how-high-can-you-hear-video-frequency-hearing-test/>https://www.classicfm.com/discover-music/how-high-can-you-hear-video-frequency-hearing-test/</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://gagor.pl/tags/linux/>Linux</a></li><li><a href=https://gagor.pl/tags/ubuntu/>Ubuntu</a></li><li><a href=https://gagor.pl/tags/audio/>Audio</a></li><li><a href=https://gagor.pl/tags/pipewire/>PipeWire</a></li></ul><nav class=paginav><a class=prev href=https://gagor.pl/2024/01/my-pre-commit-config-for-hugo-blog/><span class=title>¬´ Prev</span><br><span>My pre-commit config for Hugo blog</span>
</a><a class=next href=https://gagor.pl/2024/01/git-hacks-a-set-of-my-favorite-git-aliases/><span class=title>Next ¬ª</span><br><span>Git hacks - a set of my favorite git aliases</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on x" href="https://x.com/intent/tweet/?text=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu&amp;url=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f&amp;hashtags=Linux%2cUbuntu%2cAudio%2cPipeWire"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f&amp;title=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu&amp;summary=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu&amp;source=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f&title=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on whatsapp" href="https://api.whatsapp.com/send?text=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu%20-%20https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on telegram" href="https://telegram.me/share/url?text=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu&amp;url=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tuning PipeWire for best audio quality on Ubuntu on ycombinator" href="https://news.ycombinator.com/submitlink?t=Tuning%20PipeWire%20for%20best%20audio%20quality%20on%20Ubuntu&u=https%3a%2f%2fgagor.pl%2f2024%2f01%2ftuning-pipewire-for-best-audio-quality-on-ubuntu%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=tgagor/tgagor.github.io issue-term=pathname theme=photon-dark crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://gagor.pl>Tom's Blog</a> &copy; 2008-2024</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>