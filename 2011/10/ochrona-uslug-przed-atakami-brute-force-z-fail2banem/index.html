<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ochrona usług przed atakami brute force z fail2ban’em | Tom's Blog</title>
<meta name=keywords content="Debian,fail2ban,Linux,Security"><meta name=description content="Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez “dopieszczanie” konfiguracji (cer"><meta name=author content="timor"><link rel=canonical href=https://gagor.pro/2011/10/ochrona-uslug-przed-atakami-brute-force-z-fail2banem/><link crossorigin=anonymous href=/assets/css/stylesheet.b75f2a8f35519547db38b55fa84baf47177f24f8e88f96c8d73a55d12ab8bcec.css integrity="sha256-t18qjzVRlUfbOLVfqEuvRxd/JPjoj5bI1zpV0Sq4vOw=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://gagor.pro/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gagor.pro/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gagor.pro/favicon-32x32.png><link rel=apple-touch-icon href=https://gagor.pro/apple-touch-icon.png><link rel=mask-icon href=https://gagor.pro/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4F5HJ7RNKM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4F5HJ7RNKM",{anonymize_ip:!1})}</script><meta property="og:title" content="Ochrona usług przed atakami brute force z fail2ban’em"><meta property="og:description" content="Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez &ldquo;dopieszczanie&rdquo; konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronę pewnych stron hasłem, dostęp do SSH tylko kluczami, itd.) ale całkowicie pomija się przygotowanie systemu aktywnie monitorującego błędne próby autoryzacji. Oczywiście nie można umniejszać wagi pierwszego z wymienionych etapów ale zdecydowanie nie powinno pomijać się też tego drugiego. Przecież każdy admin chciałby wiedzieć gdy ktoś próbuje włamać się na jego serwer (FTP, HTTP, SSH, itp."><meta property="og:type" content="article"><meta property="og:url" content="https://gagor.pro/2011/10/ochrona-uslug-przed-atakami-brute-force-z-fail2banem/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2011-10-03T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-24T11:55:54+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ochrona usług przed atakami brute force z fail2ban’em"><meta name=twitter:description content="Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez &ldquo;dopieszczanie&rdquo; konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronę pewnych stron hasłem, dostęp do SSH tylko kluczami, itd.) ale całkowicie pomija się przygotowanie systemu aktywnie monitorującego błędne próby autoryzacji. Oczywiście nie można umniejszać wagi pierwszego z wymienionych etapów ale zdecydowanie nie powinno pomijać się też tego drugiego. Przecież każdy admin chciałby wiedzieć gdy ktoś próbuje włamać się na jego serwer (FTP, HTTP, SSH, itp."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gagor.pro/posts/"},{"@type":"ListItem","position":2,"name":"Ochrona usług przed atakami brute force z fail2ban’em","item":"https://gagor.pro/2011/10/ochrona-uslug-przed-atakami-brute-force-z-fail2banem/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ochrona usług przed atakami brute force z fail2ban’em","name":"Ochrona usług przed atakami brute force z fail2ban’em","description":"Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez \u0026ldquo;dopieszczanie\u0026rdquo; konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronę pewnych stron hasłem, dostęp do SSH tylko kluczami, itd.) ale całkowicie pomija się przygotowanie systemu aktywnie monitorującego błędne próby autoryzacji. Oczywiście nie można umniejszać wagi pierwszego z wymienionych etapów ale zdecydowanie nie powinno pomijać się też tego drugiego. Przecież każdy admin chciałby wiedzieć gdy ktoś próbuje włamać się na jego serwer (FTP, HTTP, SSH, itp.","keywords":["Debian","fail2ban","Linux","Security"],"articleBody":"Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez “dopieszczanie” konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronę pewnych stron hasłem, dostęp do SSH tylko kluczami, itd.) ale całkowicie pomija się przygotowanie systemu aktywnie monitorującego błędne próby autoryzacji. Oczywiście nie można umniejszać wagi pierwszego z wymienionych etapów ale zdecydowanie nie powinno pomijać się też tego drugiego. Przecież każdy admin chciałby wiedzieć gdy ktoś próbuje włamać się na jego serwer (FTP, HTTP, SSH, itp.) - tylko ilu z Nas zadaje sobie trud by uruchomić taki system?\nWielu z nas uważa że przygotowanie takiego mechanizmu jest zbyt pracochłonne, trudne, nie teraz, nie mam czasu, itd…. Zapominamy przy tym że gotowy system zostanie oddany w ręce użyszkodników a Ci na pewno będą z niego korzystać wbrew wszelkim zasadom bezpieczeństwa 😃\nNa przykład taki Roman z loginem romek ustawi hasło do poczty abc123 - wirusy i boty zamiast próbować łamać hasło jednego usera bardzo często próbują wbić się na popularne loginy wykorzystując proste hasła - zaskakujące jak często się im to udaje. A później Roman ma pretensje do admina że jego znajomi dostali po 10000 maili z wirusami…\nTymczasem w wielu przypadkach wystarczy fail2ban w praktycznie podstawowej konfiguracji by ochronić typowe usługi przed:\natakami brute force jak w powyższym przykładnie (SSH, Apache, vsftpd, proftpd, Postfix, SASL Auth, etc), atakiem pocztowego bot netu (blokowanie hostów generujących dużą ilość błędów), złymi crawler’ami czy narzędziami skanującymi strony WWW, ataki flood na Bind DNS. Narzędzie napisane jest w Perl’u i działa jako demon zapisując dane z syslog’a w małych paczkach i okresowo uruchamiając testy sprawdzające - wpływa to korzystnie na wydajność (bo nie musi analizować całodniowych logów jak prymitywniejsze narzędzia). Modułowa konfiguracja pozwala łatwo dodać filtry (wykrywające niezdefiniowane w standardzie zdarzenia) lub akcje (np. zamiast wycinać spam bota przez iptables można go wrzucić do naszego prywatnego RBL’a). W innym poście podałem przykład dodania reguł dla dovecot’a .\nPomimo iż narzędzie wydaje się zbytnio nie obciążać systemu to raczej nie odważyłbym się go zainstalować na mocno obciążonym serwerze, gdzie generują się miliony linii logów dziennie. W takiej sytuacji potrzebne jest inne rozwiązanie.\nInstalacja W moim przypadku na Debianie leci to typowo:\napt-get install fail2ban Aplikację można też dość łatwo zainstalować ze źródeł - zalezności nie ma zbyt dużo.\nKonfiguracja Gdy już zainstalujemy fail2ban’a otwieramy główny plik konfiguracyjny /etc/fail2ban/jail.conf. Idąc od początku warto zainteresować się opcjami:\n# poniżej należy umieścić listę adresów IP, sieci CIDR, z których # chcemy ignorować zagrożenia ignoreip = 127.0.0.1 10.3.4.0/24 # domyślny czas BAN'a - można nadpisać w konfiguracji danej usługi bantime = 36000 # domyślna ilość wykrytych akcji, po których zostanie dojdzie # do BAN'a maxretry = 3 # adres osoby, która ma być informowana o nałożeniu/zdjęciu BAN'a destemail = moj@mail.pl # domyślna akcja, predefiniowane są 3 możliwości: # action_ - tylko BAN # action_mw - BAN i powiadomienie mailem z danymi WHOIS # action_mwl - jak wyżej plus linie z loga action = %(action_mwl)s Dalej w konfigu znajdują się przygotowane definicje poszczególnych usług i ich konfiguracja, np. SSH:\n[ssh] enabled = true port = ssh filter = sshd logpath = /var/log/auth.log maxretry = 5 bantime = 3600 [ssh-ddos] enabled = true port = ssh filter = sshd-ddos logpath = /var/log/auth.log maxretry = 6 Jak wspominałem wcześniej w danym bloku można wpisać inne niż domyślne wartości dla opcji bantime i maxretry. Opcja filter wskazuje na nazwę pliku z definicją filtru, np: /etc/fail2ban/filter.d/sshd.conf. W tej lokalizacji możemy dodawać też własne filtry, trzeba tylko znać wyrażenia regularne. W opcji port możemy zmienić port, na którym działa usługa (by banowanie działało), korzystając przy tym z nazw dostępnych w pliku /etc/services lub bezpośrednio wpisując numer portu.\nDomyślnie nie jest włączona ochrona żadnej z usług. By ją włączyć należy zmienić w stosownym bloku:\nenabled = false na:\nenabled = true i przeładować fail2ban’a:\ninvoke-rc.d fail2ban restart I na początek wystarczy. W kilku banalnych krokach uruchomiliśmy system monitorujący logi i blokujący próby włamań.\nOczywiście włączając ochronę danej usługi dobrze zapoznać się z regułami zapisanymi w danym filtrze - by nie być zaskoczonym gdy sypnie mailami 😉\nWyłączenie powiadamiania o starcie fail2ban’a Jeżeli włączymy powiadamianie mailem o banach jako gratis fail2ban będzie powiadamiać nas mailem o właczeniu i wyłączeniu ochrony dla każdej z usług - na wypadek gdyby ktoś bez naszej wiedzy zechciał go wyłączyć. Dla wielu może to być irytujące zachowanie.\nBy wyłączyć powiadomienia trzeba w pliku akcji - u mnie w: /etc/fail2ban/action.d/mail-whois-lines.conf wyczyścić opcje actionstart i actionstop by wyglądały jak poniżej:\nactionstop = actioncheck = ","wordCount":"740","inLanguage":"en","datePublished":"2011-10-03T00:00:00Z","dateModified":"2024-03-24T11:55:54+01:00","author":{"@type":"Person","name":"timor"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gagor.pro/2011/10/ochrona-uslug-przed-atakami-brute-force-z-fail2banem/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://gagor.pro/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gagor.pro/ accesskey=h title="Tom's Blog (Alt + H)"><img src=https://gagor.pro/favicon-72x72.png alt aria-label=logo height=36>Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gagor.pro/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://gagor.pro/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://gagor.pro/bookshelf/ title=Bookshelf><span>Bookshelf</span></a></li><li><a href=https://gagor.pro/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://gagor.pro/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gagor.pro/>Home</a>&nbsp;»&nbsp;<a href=https://gagor.pro/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Ochrona usług przed atakami brute force z fail2ban’em</h1><div class=post-meta><span title='2011-10-03 00:00:00 +0000 UTC'>2011-10-03</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;timor</div></header><div class=post-content><p>Bardzo często konfigurując usługi dostępne publicznie poświęca się sporo czasu na maksymalne zwiększenie bezpieczeństwa przez &ldquo;dopieszczanie&rdquo; konfiguracji (certyfikaty z mocnym szyfrowaniem, ochronę pewnych stron hasłem, dostęp do SSH tylko kluczami, itd.) ale całkowicie pomija się przygotowanie systemu aktywnie monitorującego błędne próby autoryzacji. Oczywiście nie można umniejszać wagi pierwszego z wymienionych etapów ale zdecydowanie nie powinno pomijać się też tego drugiego. Przecież każdy admin chciałby wiedzieć gdy ktoś próbuje włamać się na jego serwer (FTP, HTTP, SSH, itp.) - tylko ilu z Nas zadaje sobie trud by uruchomić taki system?</p><p>Wielu z nas uważa że przygotowanie takiego mechanizmu jest zbyt pracochłonne, trudne, nie teraz, nie mam czasu, itd&mldr;. Zapominamy przy tym że gotowy system zostanie oddany w ręce użyszkodników a Ci na pewno będą z niego korzystać wbrew wszelkim zasadom bezpieczeństwa &#x1f603;</p><p>Na przykład taki Roman z loginem <code>romek</code> ustawi hasło do poczty <code>abc123</code> - wirusy i boty zamiast próbować łamać hasło jednego usera bardzo często próbują wbić się na popularne loginy wykorzystując proste hasła - zaskakujące jak często się im to udaje. A później Roman ma pretensje do admina że jego znajomi dostali po 10000 maili z wirusami&mldr;</p><p>Tymczasem w wielu przypadkach wystarczy <strong>fail2ban</strong> w praktycznie podstawowej konfiguracji by ochronić typowe usługi przed:</p><ul><li>atakami brute force jak w powyższym przykładnie (SSH, Apache, vsftpd, proftpd, Postfix, SASL Auth, etc),</li><li>atakiem pocztowego bot netu (blokowanie hostów generujących dużą ilość błędów),</li><li>złymi crawler&rsquo;ami czy narzędziami skanującymi strony WWW,</li><li>ataki flood na Bind DNS.</li></ul><p>Narzędzie napisane jest w Perl&rsquo;u i działa jako demon zapisując dane z syslog&rsquo;a w małych paczkach i okresowo uruchamiając testy sprawdzające - wpływa to korzystnie na wydajność (bo nie musi analizować całodniowych logów jak prymitywniejsze narzędzia). Modułowa konfiguracja pozwala łatwo dodać filtry (wykrywające niezdefiniowane w standardzie zdarzenia) lub akcje (np. zamiast wycinać spam bota przez iptables można go wrzucić do naszego prywatnego RBL&rsquo;a). <a href=/2011/11/fail2ban-regulki-dla-dovecota/>W innym poście podałem przykład dodania reguł dla dovecot&rsquo;a</a>
.</p><p>Pomimo iż narzędzie wydaje się zbytnio nie obciążać systemu to raczej nie odważyłbym się go zainstalować na mocno obciążonym serwerze, gdzie generują się miliony linii logów dziennie. W takiej sytuacji potrzebne jest inne rozwiązanie.</p><h2 id=instalacja>Instalacja<a hidden class=anchor aria-hidden=true href=#instalacja>#</a></h2><p>W moim przypadku na Debianie leci to typowo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt-get install fail2ban
</span></span></code></pre></div><p>Aplikację można też dość łatwo zainstalować ze źródeł - zalezności nie ma zbyt dużo.</p><h2 id=konfiguracja>Konfiguracja<a hidden class=anchor aria-hidden=true href=#konfiguracja>#</a></h2><p>Gdy już zainstalujemy fail2ban&rsquo;a otwieramy główny plik konfiguracyjny /etc/fail2ban/jail.conf. Idąc od początku warto zainteresować się opcjami:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># poniżej należy umieścić listę adresów IP, sieci CIDR, z których
</span></span><span style=display:flex><span># chcemy ignorować zagrożenia
</span></span><span style=display:flex><span>ignoreip = 127.0.0.1 10.3.4.0/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># domyślny czas BAN&#39;a - można nadpisać w konfiguracji danej usługi
</span></span><span style=display:flex><span>bantime  = 36000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># domyślna ilość wykrytych akcji, po których zostanie dojdzie
</span></span><span style=display:flex><span># do BAN&#39;a
</span></span><span style=display:flex><span>maxretry = 3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># adres osoby, która ma być informowana o nałożeniu/zdjęciu BAN&#39;a
</span></span><span style=display:flex><span>destemail = moj@mail.pl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># domyślna akcja, predefiniowane są 3 możliwości:
</span></span><span style=display:flex><span># action_    - tylko BAN
</span></span><span style=display:flex><span># action_mw  - BAN i powiadomienie mailem z danymi WHOIS
</span></span><span style=display:flex><span># action_mwl - jak wyżej plus linie z loga
</span></span><span style=display:flex><span>action = %(action_mwl)s
</span></span></code></pre></div><p>Dalej w konfigu znajdują się przygotowane definicje poszczególnych usług i ich konfiguracja, np. SSH:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[ssh]
</span></span><span style=display:flex><span>enabled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>port    <span style=color:#f92672>=</span> ssh
</span></span><span style=display:flex><span>filter  <span style=color:#f92672>=</span> sshd
</span></span><span style=display:flex><span>logpath  <span style=color:#f92672>=</span> <span style=color:#f92672>/</span><span style=color:#66d9ef>var</span><span style=color:#f92672>/</span>log<span style=color:#f92672>/</span>auth<span style=color:#f92672>.</span>log
</span></span><span style=display:flex><span>maxretry <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>bantime <span style=color:#f92672>=</span> <span style=color:#ae81ff>3600</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[ssh<span style=color:#f92672>-</span>ddos]
</span></span><span style=display:flex><span>enabled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>port    <span style=color:#f92672>=</span> ssh
</span></span><span style=display:flex><span>filter  <span style=color:#f92672>=</span> sshd<span style=color:#f92672>-</span>ddos
</span></span><span style=display:flex><span>logpath  <span style=color:#f92672>=</span> <span style=color:#f92672>/</span><span style=color:#66d9ef>var</span><span style=color:#f92672>/</span>log<span style=color:#f92672>/</span>auth<span style=color:#f92672>.</span>log
</span></span><span style=display:flex><span>maxretry <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
</span></span></code></pre></div><p>Jak wspominałem wcześniej w danym bloku można wpisać inne niż domyślne wartości dla opcji <code>bantime</code> i <code>maxretry</code>. Opcja <code>filter</code> wskazuje na nazwę pliku z definicją filtru, np: /etc/fail2ban/filter.d/sshd.conf. W tej lokalizacji możemy dodawać też własne filtry, trzeba tylko znać wyrażenia regularne. W opcji <code>port</code> możemy zmienić port, na którym działa usługa (by banowanie działało), korzystając przy tym z nazw dostępnych w pliku <code>/etc/services</code> lub bezpośrednio wpisując numer portu.</p><p>Domyślnie nie jest włączona ochrona żadnej z usług. By ją włączyć należy zmienić w stosownym bloku:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>enabled = false
</span></span></code></pre></div><p>na:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>enabled = true
</span></span></code></pre></div><p>i przeładować fail2ban&rsquo;a:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>invoke-rc.d fail2ban restart
</span></span></code></pre></div><p>I na początek wystarczy. W kilku banalnych krokach uruchomiliśmy system monitorujący logi i blokujący próby włamań.</p><p>Oczywiście włączając ochronę danej usługi dobrze zapoznać się z regułami zapisanymi w danym filtrze - by nie być zaskoczonym gdy sypnie mailami 😉</p><h3 id=wyłączenie-powiadamiania-o-starcie-fail2bana>Wyłączenie powiadamiania o starcie fail2ban&rsquo;a<a hidden class=anchor aria-hidden=true href=#wyłączenie-powiadamiania-o-starcie-fail2bana>#</a></h3><p>Jeżeli włączymy powiadamianie mailem o banach jako gratis fail2ban będzie powiadamiać nas mailem o właczeniu i wyłączeniu ochrony dla każdej z usług - na wypadek gdyby ktoś bez naszej wiedzy zechciał go wyłączyć. Dla wielu może to być irytujące zachowanie.</p><p>By wyłączyć powiadomienia trzeba w pliku akcji - u mnie w: <code>/etc/fail2ban/action.d/mail-whois-lines.conf</code> wyczyścić opcje <code>actionstart</code> i <code>actionstop</code> by wyglądały jak poniżej:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>actionstop =
</span></span><span style=display:flex><span>actioncheck =
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://gagor.pro/tags/debian/>Debian</a></li><li><a href=https://gagor.pro/tags/fail2ban/>fail2ban</a></li><li><a href=https://gagor.pro/tags/linux/>Linux</a></li><li><a href=https://gagor.pro/tags/security/>Security</a></li></ul><nav class=paginav><a class=prev href=https://gagor.pro/2011/10/sles-11-instalacja-service-packa/><span class=title>« Prev</span><br><span>SLES 11 - instalacja Service Pack’a</span>
</a><a class=next href=https://gagor.pro/2011/09/pflogsum-statystyki-poczty-dla-postfixa/><span class=title>Next »</span><br><span>pflogsumm - statystyki poczty dla postfix’a</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on x" href="https://x.com/intent/tweet/?text=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em&amp;url=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f&amp;hashtags=Debian%2cfail2ban%2cLinux%2cSecurity"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f&amp;title=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em&amp;summary=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em&amp;source=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f&title=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on whatsapp" href="https://api.whatsapp.com/send?text=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em%20-%20https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on telegram" href="https://telegram.me/share/url?text=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em&amp;url=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ochrona usług przed atakami brute force z fail2ban’em on ycombinator" href="https://news.ycombinator.com/submitlink?t=Ochrona%20us%c5%82ug%20przed%20atakami%20brute%20force%20z%20fail2ban%e2%80%99em&u=https%3a%2f%2fgagor.pro%2f2011%2f10%2fochrona-uslug-przed-atakami-brute-force-z-fail2banem%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=tgagor/tgagor.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzOTg4MDg1Mw==" data-category=Announcements data-category-id=DIC_kwDOAmCIlc4CcAtN data-mapping=pathname data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=transparent_dark data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://gagor.pro/>Tom's Blog</a> &copy; 2008-2024</span>
<span>Content licensed under <a rel="license noopener noreferrer" target=_blank href=http://creativecommons.org/licenses/by-sa/4.0/>(CC BY-SA 4.0)</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>